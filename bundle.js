!function(e){function t(i){if(o[i])return o[i].exports;var n=o[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,i){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,o){"use strict";function i(e,t){return e instanceof box2d.b2Vec2?new box2d.b2Vec2(e.x/r,e.y/r):void 0!==t?new box2d.b2Vec2(e/r,t/r):e/r}function n(e,t){return e instanceof box2d.b2Vec2?new box2d.b2Vec2(e.x*r,e.y*r):void 0!==t?new box2d.b2Vec2(e*r,t*r):e*r}Object.defineProperty(t,"__esModule",{value:!0}),t.scaleToWorld=i,t.scaleToPixels=n,o(48);var r=10},function(e,t,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(){void 0!==d&&d.remove(),c.innerHTML="&nbsp",u.innerHTML=""}var r=o(43),s=i(r),a=o(42),l=i(a),h=o(4),p=i(h);window.p5=l.default;var c=document.getElementById("chapter"),u=document.getElementById("title"),m=document.getElementById("disp"),d=void 0;s.default.base("/nature-of-code"),(0,s.default)("/",function(e){n();var t="<ol>";p.default.forEach(function(e,o){t+="<li>"+e.name,e.samples&&(t+="<ul>",e.samples.forEach(function(e){t+='<li><a href="'+o+"/"+e.slug+'">'+e.name+"</a></li>"}),t+="</ul>"),t+="</li>"}),m.innerHTML=t+"</ol>"}),(0,s.default)("/:chapter/:demo",function(e){m.innerHTML="",void 0!==d&&d.remove();var t=p.default[e.params.chapter];if(void 0===t.samples)return s.default.redirect("/");var o=t.samples.filter(function(t){return t.slug===e.params.demo})[0];if(void 0===o)return s.default.redirect("/");c.innerHTML=t.name,u.innerHTML=o.name,d=new l.default(o.demo,"disp")}),(0,s.default)("*",function(e){s.default.redirect("/")}),(0,s.default)({hashbang:!0})},function(e,t,o){var i=o(39);"string"==typeof i&&(i=[[e.i,i,""]]);var n={};n.transform=void 0;o(49)(i,n);i.locals&&(e.exports=i.locals)},function(e,t,o){"use strict";o(2),o(1)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=[{name:"Introduction",samples:[{name:"Random Walk Towards Mouse Pointer",slug:"random-walk-towards-mouse-pointer",demo:o(24)},{name:"Uniform distribution / Gaussian distribution / Perlin noise",slug:"uniform-vs-normal-vs-perlin-noise",demo:o(25)},{name:"Random Walk using Perlin Noise",slug:"random-walk-perlin-noise",demo:o(23)},{name:"Generating cloud using Perlin Noise",slug:"clouds-using-perlin-noise",demo:o(22)}]},{name:"Vectors",samples:[{name:"Bouncing Ball",slug:"bouncing-ball",demo:o(38)},{name:"Ball with random acceleration",slug:"ball-with-acceleration",demo:o(37)},{name:"Ball with random acceleration experiencing Gravity",slug:"ball-with-acceleration-and-gravity",demo:o(36)}]},{name:"Forces",samples:[{name:"Helium balloons",slug:"helium-balloons",demo:o(14)},{name:"Playing with mass",slug:"playing-with-mass",demo:o(16)},{name:"Playing with Friction",slug:"playing-with-friction",demo:o(15)},{name:"Fluid Resistance: Experiment with drag force",slug:"fluid-resistance",demo:o(12)},{name:"Gravitational Attraction",slug:"gravitational-attraction",demo:o(13)},{name:"Satellite launch",slug:"satellite-launch",demo:o(17)}]},{name:"Oscillation",samples:[{name:"Cannon",slug:"cannon",demo:o(26)},{name:"Pointing in the direction of Motion",slug:"pointing-in-the-direction-of-motion",demo:o(28)},{name:"Pendulum",slug:"pendulum",demo:o(27)}]},{name:"Particle Systems",samples:[{name:"Particle System which follows mouse",slug:"particle-system-follows-mouse",demo:o(29)},{name:"Particle system with repeller",slug:"particle-system-with-repeller",demo:o(30)}]},{name:"Physics Libraries",samples:[{name:"First Experiment using Box2D",slug:"first-box2d-experiment",demo:o(34)},{name:"Chain shape",slug:"chain-shape",demo:o(31)},{name:"Custom shapes",slug:"custom-shapes",demo:o(32)},{name:"Bridge using Distance joint",slug:"distance-joint",demo:o(33)},{name:"Vehicle using Revolute joint",slug:"revolute-joint",demo:o(35)}]},{name:"Autonomous Agents",samples:[{name:"Steering Behavior: Flow field following",slug:"flow-field-following",demo:o(7)},{name:"Simple Path Follower",slug:"simple-path-follower",demo:o(9)},{name:"Complex Path Follower",slug:"complex-path-follower",demo:o(6)},{name:"Group Steering behavior: Separation",slug:"group-steering-behavior",demo:o(8)},{name:"Combining Steering behaviors",slug:"combinig-steering-behaviors",demo:o(5)}]},{name:"Cellular Automata",samples:[{name:"Wolfram Elementary Cellular automata",slug:"wolfram-elementarty-ca",demo:o(11)},{name:"Game of Life",slug:"game-of-life",demo:o(10)}]},{name:"Fractals",samples:[{name:"Snow Flakes using Koch Curve",slug:"koch-curve",demo:o(18)},{name:"Fractal Tree",slug:"tree",demo:o(20)},{name:"L-System",slug:"l-system",demo:o(19)}]},{name:"The Evolution of Code",samples:[{name:"Evolving Shakespeare",slug:"shakespeare",demo:o(21)}]}];t.default=i},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n){i(this,t),this.loc=new e.createVector(o,n),this.maxSpeed=6,this.maxForce=.1,this.vel=new e.createVector(e.random(-1,1),e.random(-1,1)),this.acc=new e.createVector(0,0)}return n(t,[{key:"draw",value:function(){e.fill(233,30,99),e.stroke(233,30,99),e.push(),e.translate(this.loc.x,this.loc.y),e.rotate(this.vel.heading()),e.triangle(-5,-5,-5,5,10,0),e.pop()}},{key:"update",value:function(){this.vel.add(this.acc),this.vel.limit(this.maxSpeed),this.loc.add(this.vel),this.acc.mult(0)}},{key:"run",value:function(){this.draw(),this.update()}},{key:"applyForce",value:function(e){this.acc.add(e)}},{key:"combinedBehavior",value:function(t){var o=this.separate(t);o.mult(1),this.applyForce(o);var i=this.seek(e.createVector(e.mouseX,e.mouseY));i.mult(1),this.applyForce(i)}},{key:"seek",value:function(e){var t=p5.Vector.sub(e,this.loc);t.setMag(this.maxSpeed);var o=p5.Vector.sub(t,this.vel);return o.limit(this.maxForce),o}},{key:"separate",value:function(t){for(var o=e.createVector(0,0),i=0,n=0;n<t.length;n++){var r=p5.Vector.dist(this.loc,t[n].loc);if(r>0&&r<50){var s=p5.Vector.sub(this.loc,t[n].loc);s.setMag(1/r),o.add(s),i++}}return i>0&&(o.div(i),o.setMag(this.maxSpeed),o.sub(this.vel),o.limit(this.maxForce)),o}},{key:"edge",value:function(t){this.loc.x>e.width?this.loc.x=0:this.loc.x<0&&(this.loc.x=e.width),this.loc.y>e.height?this.loc.y=0:this.loc.y<0&&(this.loc.y=e.height)}}]),t}(),o=[],r=void 0,s=!1;e.setup=function(){e.createCanvas(600,600);for(var i=0;i<30;i++)o.push(new t(e.random(0,e.width),e.random(0,e.height)))},e.draw=function(){e.background(255),r=e.createVector(e.mouseX,e.mouseY);for(var t=0;t<o.length;t++)o[t].combinedBehavior(o),o[t].edge(),o[t].run();e.fill(0),e.noStroke(),e.text("Everything gets separated and seeked towards mouse",150,15)},e.mousePressed=function(){o.push(new t(e.mouseX,e.mouseY))},e.keyPressed=function(){return" "==e.key&&(s=!s),!1}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n){i(this,t),this.loc=new e.createVector(o,n),this.maxSpeed=6,this.maxForce=.5,this.vel=new e.createVector(e.random(),e.random()),this.acc=new e.createVector(0,0)}return n(t,[{key:"draw",value:function(){e.fill(233,30,99),e.stroke(233,30,99),e.push(),e.translate(this.loc.x,this.loc.y),e.rotate(this.vel.heading()),e.triangle(-5,-5,-5,5,10,0),e.pop()}},{key:"update",value:function(){this.vel.add(this.acc),this.vel.limit(this.maxSpeed),this.loc.add(this.vel),this.acc.mult(0)}},{key:"run",value:function(){this.draw(),this.update()}},{key:"applyForce",value:function(e){this.acc.add(e)}},{key:"seek",value:function(e){var t=p5.Vector.sub(e,this.loc);t.setMag(this.maxSpeed);var o=p5.Vector.sub(t,this.vel);o.limit(this.maxForce),this.applyForce(o)}},{key:"follow",value:function(t){var o=this.vel.copy();o.setMag(50);for(var i=p5.Vector.add(this.loc,o),n=void 0,r=999999,s=void 0,a=0;a<t.vertex.length-1;a++){var h=p5.Vector.sub(i,t.vertex[a]),p=p5.Vector.sub(t.vertex[a+1],t.vertex[a]);p.normalize();var c=p.mult(h.dot(p)),u=p5.Vector.add(t.vertex[a],c);(u.x>t.vertex[a+1].x||u.x<t.vertex[a].x)&&(u=t.vertex[a+1].copy());var m=p5.Vector.sub(u,i).mag();m<r&&(r=m,n=u,p.setMag(10),s=p5.Vector.add(n,p))}if(r>t.radius&&void 0!=s&&this.seek(s),l){e.stroke(0);this.vel.copy().mult(50);e.push(),e.translate(this.loc.x,this.loc.y),e.line(0,0,o.x,o.y),e.pop(),e.strokeWeight(10),e.stroke(233,30,99,100),e.point(n.x,n.y),e.strokeWeight(1)}}},{key:"edge",value:function(e){this.loc.x>e.vertex[e.vertex.length-1].x+e.radius&&(this.loc.x=e.vertex[0].x-e.radius,this.loc.y=e.vertex[0].y)}}]),t}(),o=function(){function t(o,n,r,s){i(this,t),this.radius=20,this.vertex=[],this.vertex.push(e.createVector(20,300)),this.vertex.push(e.createVector(200,150)),this.vertex.push(e.createVector(350,300)),this.vertex.push(e.createVector(450,200)),this.vertex.push(e.createVector(700,400))}return n(t,[{key:"draw",value:function(){e.strokeWeight(2*this.radius),e.stroke(200,100);for(var t=0;t<this.vertex.length-1;t++)e.line(this.vertex[t].x,this.vertex[t].y,this.vertex[t+1].x,this.vertex[t+1].y);e.strokeWeight(1),e.stroke(0);for(var o=0;o<this.vertex.length-1;o++)e.line(this.vertex[o].x,this.vertex[o].y,this.vertex[o+1].x,this.vertex[o+1].y);e.fill(0),e.stroke(0,0)}}]),t}(),r=[],s=void 0,a=void 0,l=!1;e.setup=function(){e.createCanvas(600,600);for(var i=0;i<30;i++)r.push(new t(e.random(0,e.width),e.random(0,e.height)));a=new o(0,100,e.width,e.height-300)},e.draw=function(){e.background(255),s=e.createVector(e.mouseX,e.mouseY);for(var t=0;t<r.length;t++)r[t].follow(a),r[t].edge(a),r[t].run();a.draw()},e.mousePressed=function(){r.push(new t(e.mouseX,e.mouseY))},e.keyPressed=function(){return" "==e.key&&(l=!l),!1}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n){i(this,t),this.loc=new e.createVector(o,n),this.maxSpeed=6,this.maxForce=.1,this.vel=new e.createVector(e.random(),e.random()),this.acc=new e.createVector(0,0)}return n(t,[{key:"draw",value:function(){e.fill(233,30,99),e.stroke(233,30,99),e.push(),e.translate(this.loc.x,this.loc.y),e.rotate(this.vel.heading()),e.triangle(-5,-5,-5,5,10,0),e.pop()}},{key:"update",value:function(){this.vel.add(this.acc),this.vel.limit(this.maxSpeed),this.loc.add(this.vel),this.acc.mult(0)}},{key:"run",value:function(){this.draw(),this.update(),this.edge()}},{key:"applyForce",value:function(e){this.acc.add(e)}},{key:"follow",value:function(e){var t=e.lookup(this.loc);t.setMag(this.maxSpeed);var o=p5.Vector.sub(t,this.vel);o.limit(this.maxForce),this.applyForce(o)}},{key:"edge",value:function(){this.loc.x<0?this.loc.x=e.width:this.loc.x>e.width&&(this.loc.x=0),this.loc.y<0?this.loc.y=e.height:this.loc.y>e.height&&(this.loc.y=0)}}]),t}(),o=function(){function t(){i(this,t),this.resolution=50,this.row=e.height/this.resolution,this.col=e.width/this.resolution;var o=0,n=0;this.field=[];for(var r=0;r<this.col;r++){o=0,this.field[r]=[];for(var s=0;s<this.row;s++){var a=e.map(e.noise(o,n),0,1,0,e.TWO_PI);this.field[r][s]=e.createVector(e.cos(a),e.sin(a)),o+=.1}n+=.1}}return n(t,[{key:"lookup",value:function(t){var o=e.floor(e.constrain(t.x/this.resolution,0,this.col-1)),i=e.floor(e.constrain(t.y/this.resolution,0,this.row-1));return this.field[o][i].copy()}},{key:"draw",value:function(){e.stroke(103,58,183);for(var t=0;t<this.col;t++)for(var o=0;o<this.row;o++)e.push(),e.translate(this.resolution*t+this.resolution/2,this.resolution*o+this.resolution/2),e.rotate(this.field[t][o].heading()),e.line(-10,0,10,0),e.line(10,0,7,-3),e.line(10,0,7,3),e.pop()}}]),t}(),r=[],s=void 0,a=void 0,l=!1;e.setup=function(){e.createCanvas(600,600);for(var i=0;i<50;i++)r.push(new t(e.random(0,e.width),e.random(0,e.height)));a=new o},e.draw=function(){e.background(255),s=e.createVector(e.mouseX,e.mouseY);for(var t=r.length-1;t>=0;t--)r[t].follow(a),r[t].run();l&&a.draw()},e.mousePressed=function(){l=!l,r.push(new t(e.mouseX,e.mouseY))}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n){i(this,t),this.loc=new e.createVector(o,n),this.maxSpeed=6,this.maxForce=.1,this.vel=new e.createVector(e.random(-1,1),e.random(-1,1)),this.acc=new e.createVector(0,0)}return n(t,[{key:"draw",value:function(){e.fill(233,30,99),e.stroke(233,30,99),e.push(),e.translate(this.loc.x,this.loc.y),e.rotate(this.vel.heading()),e.triangle(-5,-5,-5,5,10,0),e.pop()}},{key:"update",value:function(){this.vel.add(this.acc),this.vel.limit(this.maxSpeed),this.loc.add(this.vel),this.acc.mult(0)}},{key:"run",value:function(){this.draw(),this.update()}},{key:"applyForce",value:function(e){this.acc.add(e)}},{key:"seek",value:function(e){var t=p5.Vector.sub(e,this.loc);t.setMag(this.maxSpeed);var o=p5.Vector.sub(t,this.vel);o.limit(this.maxForce),this.applyForce(o)}},{key:"separate",value:function(t){for(var o=e.createVector(0,0),i=0,n=0;n<t.length;n++){var r=p5.Vector.dist(this.loc,t[n].loc);if(r>0&&r<50){var s=p5.Vector.sub(this.loc,t[n].loc);s.setMag(1/r),o.add(s),i++}}if(i>0){o.div(i),o.setMag(this.maxSpeed);var a=p5.Vector.sub(o,this.vel);a.limit(this.maxForce),this.applyForce(a)}}},{key:"edge",value:function(t){this.loc.x>e.width?this.loc.x=0:this.loc.x<0&&(this.loc.x=e.width),this.loc.y>e.height?this.loc.y=0:this.loc.y<0&&(this.loc.y=e.height)}}]),t}(),o=[],r=void 0,s=!1;e.setup=function(){e.createCanvas(600,600);for(var i=0;i<30;i++)o.push(new t(e.random(0,e.width),e.random(0,e.height)))},e.draw=function(){e.background(255),r=e.createVector(e.mouseX,e.mouseY);for(var t=0;t<o.length;t++)o[t].separate(o),o[t].edge(),o[t].run()},e.mousePressed=function(){o.push(new t(e.mouseX,e.mouseY))},e.keyPressed=function(){return" "==e.key&&(s=!s),!1}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n){i(this,t),this.loc=new e.createVector(o,n),this.maxSpeed=6,this.maxForce=.1,this.vel=new e.createVector(e.random(),e.random()),this.acc=new e.createVector(0,0)}return n(t,[{key:"draw",value:function(){e.fill(233,30,99),e.stroke(233,30,99),e.push(),e.translate(this.loc.x,this.loc.y),e.rotate(this.vel.heading()),e.triangle(-5,-5,-5,5,10,0),e.pop()}},{key:"update",value:function(){this.vel.add(this.acc),this.vel.limit(this.maxSpeed),this.loc.add(this.vel),this.acc.mult(0)}},{key:"run",value:function(){this.draw(),this.update()}},{key:"applyForce",value:function(e){this.acc.add(e)}},{key:"seek",value:function(e){var t=p5.Vector.sub(e,this.loc);t.setMag(this.maxSpeed);var o=p5.Vector.sub(t,this.vel);o.limit(this.maxForce),this.applyForce(o)}},{key:"follow",value:function(t){var o=this.vel.copy();o.setMag(50);var i=p5.Vector.add(this.loc,o),n=p5.Vector.sub(i,t.start),r=p5.Vector.sub(t.end,t.start);r.normalize();var s=r.mult(n.dot(r)),a=p5.Vector.add(t.start,s);if(p5.Vector.sub(a,i).mag()>t.radius){r.setMag(10);var h=p5.Vector.add(a,r);this.seek(h)}if(l){e.stroke(0);this.vel.copy().mult(50);e.push(),e.translate(this.loc.x,this.loc.y),e.line(0,0,o.x,o.y),e.pop(),e.strokeWeight(10),e.stroke(233,30,99,100),e.point(a.x,a.y),e.strokeWeight(1)}}},{key:"edge",value:function(e){this.loc.x>e.end.x+e.radius&&(this.loc.x=e.start.x-e.radius,this.loc.y=e.start.y+this.loc.y-e.end.y)}}]),t}(),o=function(){function t(o,n,r,s){i(this,t),this.radius=20,this.start=e.createVector(o,n),this.end=e.createVector(r,s)}return n(t,[{key:"draw",value:function(){e.strokeWeight(2*this.radius),e.stroke(200,100),e.line(this.start.x,this.start.y,this.end.x,this.end.y),e.strokeWeight(1),e.stroke(0),e.line(this.start.x,this.start.y,this.end.x,this.end.y),e.fill(0),e.stroke(0,0)}}]),t}(),r=[],s=void 0,a=void 0,l=!1;e.setup=function(){e.createCanvas(600,600);for(var i=0;i<30;i++)r.push(new t(e.random(0,e.width),e.random(0,e.height)));a=new o(0,100,e.width,e.height-300)},e.draw=function(){e.background(255),s=e.createVector(e.mouseX,e.mouseY);for(var t=0;t<r.length;t++)r[t].follow(a),r[t].edge(a),r[t].run();a.draw()},e.mousePressed=function(){r.push(new t(e.mouseX,e.mouseY))},e.keyPressed=function(){return" "==e.key&&(l=!l),!1}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(){i(this,t),this.res=5,this.row=e.width/this.res,this.col=e.height/this.res,this.cells=[];for(var o=0;o<this.row;o++){this.cells[o]=[];for(var n=0;n<this.col;n++)this.cells[o][n]=e.floor(e.random(0,2))}}return n(t,[{key:"generate",value:function(){for(var e=[],t=0;t<this.row;t++){e[t]=[];for(var o=0;o<this.col;o++){for(var i=0,n=-1;n<2;n++)for(var r=-1;r<2;r++)i+=this.cells[(t+n+this.row)%this.row][(o+r+this.col)%this.col];i-=this.cells[t][o],1==this.cells[t][o]&&(i>3||i<2)?e[t][o]=0:0==this.cells[t][o]&&3===i?e[t][o]=1:e[t][o]=this.cells[t][o]}}this.cells=e}},{key:"draw",value:function(){e.stroke(0,50);for(var t=0;t<this.row;t++)for(var o=0;o<this.col;o++)e.fill(255),1==this.cells[t][o]&&e.fill(0),e.rect(t*this.res,o*this.res,this.res,this.res)}}]),t}(),o=void 0;e.setup=function(){e.createCanvas(400,400),e.frameRate(5),o=new t},e.draw=function(){e.background(255),o.draw(),o.generate()}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o){i(this,t),this.ruleset=o,this.len=150,this.gen=0,this.res=e.width/this.len,this.cells=new Array(this.len);for(var n=0;n<this.cells.length;n++)this.cells[n]=0;this.cells[e.floor(this.len/2)]=1}return n(t,[{key:"draw",value:function(){for(var t=0;t<this.cells.length;t++)e.noStroke(0),0==this.cells[t]?e.fill(255):e.fill(0),e.rect(t*this.res,this.gen*this.res,this.res,this.res)}},{key:"generate",value:function(){for(var e=new Array(this.cells.length),t=0;t<this.cells.length;t++){var o=t-1;0==t&&(o=this.cells.length-1);var i=t+1;t==this.cells.length-1&&(i=0);var n=this.cells[o],r=this.cells[t],s=this.cells[i],a=parseInt(""+n+r+s,2);e[t]=this.ruleset[7-a]}this.cells=e,this.gen++}},{key:"reset",value:function(){this.gen=0;for(var t=0;t<this.cells.length;t++)this.cells[t]=0;this.cells[e.floor(this.len/2)]=1}},{key:"randomRuleset",value:function(){for(var t=0;t<this.cells.length;t++)this.ruleset[t]=e.floor(e.random(0,2))}}]),t}(),o=void 0;e.setup=function(){e.createCanvas(500,500),e.background(255),o=new t([0,0,0,1,1,1,1,0])},e.draw=function(){o.draw(),o.generate()},e.mousePressed=function(){e.background(255),o.reset(),o.randomRuleset()}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n,r){i(this,t),this.loc=e.createVector(o,n),this.vel=e.createVector(0,0),this.acc=e.createVector(0,0),this.mass=r,this.radius=15*r/2}return n(t,[{key:"move",value:function(){this.vel.add(this.acc),this.loc.add(this.vel),this.acc.mult(0)}},{key:"applyForce",value:function(e){var t=p5.Vector.div(e,this.mass);this.acc.add(t)}},{key:"draw",value:function(){e.fill(255),e.ellipse(this.loc.x,this.loc.y,15*this.mass)}},{key:"bounce",value:function(){this.loc.x>e.width-this.radius?(this.vel.x*=-1,this.loc.x=e.width-this.radius):this.loc.x<this.radius&&(this.vel.x*=-1,this.loc.x=this.radius),this.loc.y>e.height-this.radius?(this.vel.y*=-1,this.loc.y=e.height-this.radius):this.loc.y<this.radius&&(this.vel.y*=-1,this.loc.y=this.radius)}}]),t}(),o=function(){function t(e,o,n,r,s){i(this,t),this.x=e,this.y=o,this.w=n,this.h=r,this.c=s}return n(t,[{key:"draw",value:function(){e.rect(this.x,this.y,this.w,this.h)}},{key:"contains",value:function(e,t){return e>this.x&&e<this.x+this.w&&t>this.y&&t<this.y+this.h}},{key:"getDragForce",value:function(e){var t=e.copy();return t.normalize(),t.mult(-1*this.c*e.mag()*e.mag()),t}}]),t}(),r=new Array,s=new Array;e.setup=function(){e.createCanvas(500,500),r.push(new t(e.width/4,15,3)),r.push(new t(3*e.width/4,15,3)),s.push(new o(0,e.height/2,e.width/2,e.height/2,.2)),s.push(new o(e.width/2,e.height/2,e.width/2,e.height/2,.01))},e.draw=function(){e.background(0,100,200);for(var t=e.createVector(0,.4),o=0;o<r.length;o++)0==o?e.fill(0):e.fill(127),s[o].draw(),r[o].applyForce(t),e.fill(255),r[o].move(),r[o].bounce(),r[o].draw(),s[o].contains(r[o].loc.x,r[o].loc.y)&&r[o].applyForce(s[o].getDragForce(r[o].vel))}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n,r){i(this,t),this.loc=e.createVector(o,n),this.vel=e.createVector(0,0),this.acc=e.createVector(0,0),this.mass=r,this.radius=15*r/2,this.path=new Array,window.q=this.path}return n(t,[{key:"move",value:function(){this.vel.add(this.acc),this.loc.add(this.vel),this.acc.mult(0)}},{key:"applyForce",value:function(e){var t=p5.Vector.div(e,this.mass);this.acc.add(t)}},{key:"draw",value:function(){e.ellipse(this.loc.x,this.loc.y,15*this.mass);for(var t=0;t<this.path.length;t++)e.point(this.path[t].x,this.path[t].y)}},{key:"bounce",value:function(){this.loc.x>e.width-this.radius?(this.vel.x*=-1,this.loc.x=e.width-this.radius):this.loc.x<this.radius&&(this.vel.x*=-1,this.loc.x=this.radius),this.loc.y>e.height-this.radius?(this.vel.y*=-1,this.loc.y=e.height-this.radius):this.loc.y<this.radius&&(this.vel.y*=-1,this.loc.y=this.radius)}},{key:"attract",value:function(t){var o=p5.Vector.sub(this.loc,t.loc),i=o.mag();i=e.constrain(i,5,25),o.normalize();var n=1*this.mass*t.mass/(i*i);o.mult(n),t.applyForce(o)}}]),t}(),o=void 0,r=new Array;e.setup=function(){e.createCanvas(500,500),o=new t(e.width/2,e.height/2,5),r.push(new t(e.width/2+75,e.height/2,.5)),r.push(new t(e.width/2+150,e.height/2,1)),r.push(new t(e.width/2+200,e.height/2,2)),r[0].vel=e.createVector(0,1),r[1].vel=e.createVector(0,-1),r[2].vel=e.createVector(.5,-1.25)},e.draw=function(){e.background(255),e.fill(255,100,10),o.move(),o.draw(),e.fill(127);for(var t=0;t<r.length;t++)o.attract(r[t]),r[t].move(),r[t].draw()}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n,r){i(this,t),this.loc=e.createVector(o,n),this.size=r,this.vel=e.createVector(0,0),this.radius=r/2,this.force=e.createVector(0,0)}return n(t,[{key:"move",value:function(){this.vel.add(this.force),this.loc.add(this.vel),this.loc.x=e.constrain(this.loc.x,this.radius,e.width-this.radius),this.loc.y=e.constrain(this.loc.y,this.radius,e.height-this.radius),this.force.mult(0)}},{key:"bounce",value:function(){(this.loc.x>=e.width-this.radius||this.loc.x<=this.radius)&&(this.vel.x*=-.2),(this.loc.y>=e.height-this.radius||this.loc.y<=this.radius)&&(this.vel.y*=-.2)}},{key:"draw",value:function(){e.fill(233,30,99),e.line(this.loc.x,this.loc.y,this.loc.x,this.loc.y+100),e.ellipse(this.loc.x,this.loc.y,this.size)}},{key:"applyForces",value:function(e){this.force.add(e)}}]),t}(),o=new Array,r=new Array;e.setup=function(){e.createCanvas(600,600);for(var i=0;i<20;i++)o.push(new t(e.random(0,e.width),e.height/2,60)),r.push(e.createVector(0,e.random(-.4,-.31)))};var s=e.createVector(0,.3),a=0;e.draw=function(){e.background(238),a+=.1;for(var t=e.map(e.noise(a),0,1,-.001,.001),i=e.createVector(t,0),n=0;n<20;n++)o[n].applyForces(r[n]),o[n].applyForces(i),o[n].applyForces(s),o[n].move(),o[n].bounce(),o[n].draw()}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n,r){i(this,t),this.loc=e.createVector(o,n),this.vel=e.createVector(0,0),this.acc=e.createVector(0,0),this.mass=r,this.radius=15*r/2}return n(t,[{key:"move",value:function(){this.vel.add(this.acc),this.loc.add(this.vel),this.acc.mult(0)}},{key:"applyForce",value:function(e){var t=p5.Vector.div(e,this.mass);this.acc.add(t)}},{key:"draw",value:function(){e.fill(255),e.ellipse(this.loc.x,this.loc.y,15*this.mass)}},{key:"bounce",value:function(){this.loc.x>e.width-this.radius?(this.vel.x*=-1,this.loc.x=e.width-this.radius):this.loc.x<this.radius&&(this.vel.x*=-1,this.loc.x=this.radius),this.loc.y>e.height/2-this.radius?(this.vel.y*=-1,this.loc.y=e.height/2-this.radius):this.loc.y<this.radius&&(this.vel.y*=-1,this.loc.y=this.radius)}},{key:"isGoingThrough",value:function(e,t,o,i){return this.loc.x>e&&this.loc.x<e+o||this.loc.y>t&&this.loc.y<t+i}}]),t}(),o=void 0,r=void 0;e.setup=function(){e.createCanvas(500,500),o=new t(e.width/2,e.height/2,3)},e.draw=function(){e.background(200),r===e.RIGHT_ARROW&&o.applyForce(e.createVector(.5,0)),r===e.LEFT_ARROW&&o.applyForce(e.createVector(-.5,0));var t=e.createVector(0,.4);if(o.applyForce(t),o.isGoingThrough(170,e.height/2,50,10)){var i=o.vel.copy();i.normalize(),i.mult(-1),o.applyForce(i)}else{var n=o.vel.copy();n.normalize(),n.mult(-.1),o.applyForce(n)}o.move(),o.bounce(),o.draw(),e.fill(0),e.rect(0,e.height/2,e.width,e.height),e.fill(255,0,0),e.rect(170,e.height/2,50,10)},e.keyPressed=function(){return r=e.keyCode,!1},e.keyReleased=function(){return r=0,!1}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n,r){i(this,t),this.loc=e.createVector(o,n),this.mass=r,this.vel=e.createVector(0,0),this.acc=e.createVector(0,0)}return n(t,[{key:"move",value:function(){this.vel.add(this.acc),this.loc.add(this.vel),this.acc.mult(0)}},{key:"applyForces",value:function(e){var t=p5.Vector.div(e,this.mass);this.acc.add(t)}},{key:"draw",value:function(){e.ellipse(this.loc.x,this.loc.y,this.mass)}},{key:"bounce",value:function(){this.loc.x>e.width?(this.vel.x*=-1,this.loc.x=e.width):this.loc.x<0&&(this.vel.x*=-1,this.loc.x=0),this.loc.y>e.height?(this.vel.y*=-1,this.loc.y=e.height):this.loc.y<0&&(this.vel.y*=-1,this.loc.y=0)}}]),t}(),o=new Array;e.setup=function(){e.createCanvas(400,400);for(var i=0;i<10;i++)o.push(new t(0,0,e.random(20,70)))},e.draw=function(){e.background(255),e.fill(127,100);for(var t=0;t<10;t++){var i=e.createVector(0,.3);i.mult(o[t].mass),o[t].applyForces(i);var n=e.createVector(.3,0);o[t].applyForces(n),o[t].move(),o[t].bounce(),o[t].draw()}}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n,r){i(this,t),this.loc=e.createVector(o,n),this.mass=r,this.vel=e.createVector(0,0),this.acc=e.createVector(0,0),this.radius=10*this.mass}return n(t,[{key:"draw",value:function(){e.ellipse(this.loc.x,this.loc.y,20*this.mass)}},{key:"move",value:function(){this.vel.add(this.acc),this.loc.add(this.vel),this.acc.mult(0)}},{key:"applyForce",value:function(e){var t=p5.Vector.div(e,this.mass);this.acc.add(t)}},{key:"attract",value:function(t){var o=p5.Vector.sub(this.loc,t.loc),i=o.mag();i=e.constrain(i,1,5),o.normalize();var n=.1*this.mass*t.mass/(i*i);o.mult(n),t.applyForce(o)}}]),t}(),o=void 0,r=void 0;e.setup=function(){e.createCanvas(600,600),o=new t(e.width/2,e.height/2,5),r=new t(e.width/2,e.height/2-52,.25)};var s=void 0;e.draw=function(){e.background(255),e.fill(0,100,255),e.stroke(0,100,255),o.draw(),s===e.LEFT_ARROW&&(r.acc.x-=.1),s===e.RIGHT_ARROW&&(r.acc.x+=.1),s===e.UP_ARROW&&(r.acc.y-=.1),s===e.DOWN_ARROW&&(r.acc.y+=.1);var t=p5.Vector.sub(o.loc,r.loc).mag();if(t<20*o.mass+15+r.radius){var i=r.vel.copy();i.normalize(),i.mult(-.01*r.vel.mag()*r.vel.mag()),r.applyForce(i),t<o.radius+r.radius?r.vel.mult(-1):o.attract(r),e.fill(0,100,255,50)}else o.attract(r),e.fill(0,100,255,30);e.stroke(0,100,255,30),e.ellipse(o.loc.x,o.loc.y,20*o.mass+150),e.fill(255,0,0),e.stroke(255,0,0),r.draw(),r.move(),a()},e.keyPressed=function(){return s=e.keyCode,!1},e.keyReleased=function(){return s=0,!1};var a=function(){e.fill(0,100,255),e.stroke(0,100,255),e.ellipse(10,10,10),e.stroke(255),e.fill(127),e.text("Earth",20,14),e.fill(0,100,255,30),e.stroke(0,100,255,30),e.ellipse(100,10,10),e.stroke(255),e.fill(127),e.text("Earth's Atomsphere",110,14),e.fill(255,0,0),e.stroke(255,0,0),e.ellipse(240,10,10),e.stroke(255),e.fill(127),e.text("Satellite",250,14),e.text("Use Keyboard arrows to control satellite's acceleration",150,e.height-20),e.text("Satellite's velocity : "+parseFloat(r.vel.mag()).toPrecision(2),e.width-130,14)}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(e,o){i(this,t),this.start=e,this.end=o}return n(t,[{key:"pointA",value:function(){return this.start}},{key:"pointB",value:function(){var e=p5.Vector.sub(this.end,this.start);return e.div(3),e.add(this.start),e}},{key:"pointC",value:function(){var t=p5.Vector.sub(this.end,this.start);return t.div(3),t.rotate(-e.PI/3),t.add(this.pointB()),t}},{key:"pointD",value:function(){var e=p5.Vector.sub(this.end,this.start);return e.mult(2/3),e.add(this.start),e}},{key:"pointE",value:function(){return this.end}}]),t}(),o=function(){function o(t,n,r,s){i(this,o),this.start=e.createVector(t,n),this.end=e.createVector(r,s),this.points=[this.start,this.end]}return n(o,[{key:"generate",value:function(){for(var e=[],o=0;o<this.points.length-1;o++){var i=new t(this.points[o],this.points[o+1]);e.push(i.pointA()),e.push(i.pointB()),e.push(i.pointC()),e.push(i.pointD()),e.push(i.pointE())}this.points=e}},{key:"draw",value:function(){for(var t=0;t<this.points.length-1;t++)e.line(this.points[t].x,this.points[t].y,this.points[t+1].x,this.points[t+1].y)}}]),o}(),r=function(){function t(n,r){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;i(this,t),this.kLines=[];for(var a=0;a<360;a+=60)this.kLines.push(new o(n+s*e.cos(e.radians(a+60)),r+s*e.sin(e.radians(a+60)),n+s*e.cos(e.radians(a)),r+s*e.sin(e.radians(a))))}return n(t,[{key:"generate",value:function(){for(var e=0;e<this.kLines.length;e++)this.kLines[e].generate()}},{key:"draw",value:function(){for(var e=0;e<this.kLines.length;e++)this.kLines[e].draw()}}]),t}(),s=void 0,a=0;e.setup=function(){e.createCanvas(600,600),s=new r(e.width/2,e.height/2,200);for(var t=0;t<3;t++)s.generate()},e.draw=function(){e.background(200),a+=.01,e.push(),e.translate(e.width/2,e.height/2),e.rotate(a),e.translate(-e.width/2,-e.height/2),s.draw(),e.pop()}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function e(t,o){i(this,e),this.sentence=t,this.ruleset=o,this.gen=0}return n(e,[{key:"generate",value:function(){for(var e="",t=0;t<this.sentence.length;t++)for(var o=0;o<this.ruleset.length;o++)this.sentence.charAt(t)===this.ruleset[o].a?e+=this.ruleset[o].b:e+=this.sentence.charAt(t);this.sentence=e,this.gen++}},{key:"getSentence",value:function(){return this.sentence}},{key:"getGen",value:function(){return this.gen}}]),e}(),o=function(){function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;i(this,t),this.sentence=e,this.len=o}return n(t,[{key:"setSentence",value:function(e){this.sentence=e,this.len*=.65}},{key:"draw",value:function(){for(var t=0;t<this.sentence.length;t++)switch(this.sentence.charAt(t)){case"F":e.line(0,0,0,-this.len),e.translate(0,-this.len);break;case"+":e.rotate(e.PI/6);break;case"-":e.rotate(-e.PI/6);break;case"[":e.push();break;case"]":e.pop()}}}]),t}(),r=void 0,s=void 0;e.setup=function(){e.createCanvas(600,600),s=new t("F",[{a:"F",b:"FF+[+F-F-F]-[-F+F+F]"}]),r=new o(s.getSentence())},e.draw=function(){e.background(255),e.stroke(0,0),e.fill(0),e.text("Click to generate",5,15),e.translate(e.width/2,e.height),e.stroke(0,100),r.draw()},e.mousePressed=function(){s.generate(),r.setSentence(s.getSentence())}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n){i(this,t),this.x=o,this.y=n,this.len=100,this.theta=e.PI/14}return n(t,[{key:"branch",value:function(t){e.strokeWeight(.1*t),e.line(0,0,0,-t),e.translate(0,-t),(t*=.6)>2&&(e.push(),e.rotate(this.theta),this.branch(t),e.pop(),e.push(),e.rotate(-this.theta),this.branch(t),e.pop())}},{key:"draw",value:function(){e.push(),e.translate(this.x,this.y),this.branch(this.len),e.pop()}}]),t}(),o=void 0,r=0;e.setup=function(){e.createCanvas(600,600),o=new t(e.width/2,e.height/2+100)},e.draw=function(){e.background(255,152,0),r+=.001;var t=e.map(e.noise(r),0,1,e.PI/15,e.PI/4);o.theta=t,o.draw(),e.fill(0),e.rect(0,e.height/2+100,e.width,e.height/2-100)}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=void 0,o=void 0,r=void 0,s=void 0,a=void 0,l=void 0,h=function(){t=document.createElement("span"),o=document.createElement("span"),r=document.createElement("span"),s=document.createElement("span"),a=document.createElement("h1");var i=document.createElement("div");i.className="info",i.insertAdjacentHTML("beforeend","<strong>Best Phrase:</strong>"),i.append(a),i.insertAdjacentHTML("beforeend","Total Generations: "),i.append(t),i.insertAdjacentHTML("beforeend","<br/>Average Fitness: "),i.append(o),i.insertAdjacentHTML("beforeend","<br/>Total Population: "),i.append(r),i.insertAdjacentHTML("beforeend","<br/>Mutation Rate: "),i.append(s),l=document.createElement("p"),l.className="phrases",e._userNode.append(i),e._userNode.append(l)},p=function(){function t(e){i(this,t),this.genes=[],this.fitness=0;for(var o=0;o<e;o++)this.genes[o]=this.randChar()}return n(t,[{key:"crossover",value:function(o){for(var i=new t(this.genes.length),n=e.random(i.genes.length),r=0;r<i.genes.length;r++)i.genes[r]=r<n?o.genes[r]:this.genes[r];return i}},{key:"mutate",value:function(t){for(var o=0;o<this.genes.length;o++)e.random()<t&&(this.genes[o]=this.randChar())}},{key:"calcFitness",value:function(e){for(var t=0,o=0;o<this.genes.length;o++)this.genes[o]===e[o]&&t++;this.fitness=t/e.length}},{key:"toString",value:function(){return this.genes.join("")}},{key:"randChar",value:function(){var t="abcdefghijklmnopqrstuvwxyz ABCDEFGHIJKLMNOPQRSTUVWXYZ";return t.charAt(e.random(t.length))}}]),t}(),c=function(){function t(e,o,n){i(this,t),this.target=e,this.mutationRate=o,this.organisms=[],this.generation=0,this.averageFitness=0,this.best="",this.matingPool=[],this.finish=!1;for(var r=0;r<n;r++)this.organisms.push(new p(e.length))}return n(t,[{key:"calcFitness",value:function(){for(var e=0,t=0;t<this.organisms.length;t++){var o=this.organisms[t];o.calcFitness(this.target),1==o.fitness&&(this.finish=!0),o.fitness>this.organisms[e].fitness&&(e=t),this.averageFitness+=o.fitness}this.averageFitness/=this.organisms.length,this.best=this.organisms[e]}},{key:"naturalSelection",value:function(){this.matingPool=[];for(var t=0;t<this.organisms.length;t++)for(var o=e.floor(100*this.organisms[t].fitness),i=0;i<o;i++)this.matingPool.push(this.organisms[t]);for(var n=0;n<this.organisms.length;n++){var r=e.floor(e.random(this.matingPool.length)),s=e.floor(e.random(this.matingPool.length)),a=this.matingPool[r],l=this.matingPool[s],h=a.crossover(l);h.mutate(this.mutationRate),this.organisms[n]=h}this.generation++}},{key:"finished",value:function(){return this.finish}},{key:"getBest",value:function(){return this.best}},{key:"getGeneration",value:function(){return this.generation}},{key:"getMutationRate",value:function(){return this.mutationRate}},{key:"getPopulationCount",value:function(){return this.organisms.length}},{key:"getAverageFitness",value:function(){return this.averageFitness}},{key:"getOrganisms",value:function(){for(var t="",o=0;o<e.min(this.organisms.length,10);o++)t+=this.organisms[o]+"<br/>";return t}}]),t}(),u=void 0;e.setup=function(){e.noCanvas(),h();u=new c("Hello World",.01,100)},e.draw=function(){u.calcFitness(),u.naturalSelection(),u.finished()&&e.noLoop(),t.innerHTML=u.getGeneration(),o.innerHTML=u.getAverageFitness(),r.innerHTML=u.getPopulationCount(),s.innerHTML=u.getMutationRate(),a.innerHTML=u.getBest(),l.innerHTML=u.getOrganisms()}}},function(e,t,o){"use strict";e.exports=function(e){e.setup=function(){e.createCanvas(600,600),e.pixelDensity(1),e.loadPixels();for(var t=0,o=0,i=0;i<e.width;i++){t=0;for(var n=0;n<e.height;n++){var r=4*(i+n*e.width),s=255*e.noise(t,o);e.pixels[r]=s,e.pixels[r+1]=s,e.pixels[r+2]=s,e.pixels[r+3]=255,t+=.01}o+=.01}e.updatePixels()},e.draw=function(){}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(e,o){i(this,t),this.x=e,this.y=o,this.tx=0,this.ty=1e3}return n(t,[{key:"step",value:function(){this.x=e.map(e.noise(this.tx),0,1,0,e.width),this.y=e.map(e.noise(this.ty),0,1,0,e.height),this.x=e.constrain(this.x,0,e.width-1),this.y=e.constrain(this.y,0,e.height-1),this.tx+=.001,this.ty+=.001}},{key:"render",value:function(){e.point(this.x,this.y,50,50)}}]),t}(),o=void 0;e.setup=function(){e.createCanvas(600,600),o=new t(e.width/2,e.height/2)},e.draw=function(){o.step(),o.render()}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(e,o){i(this,t),this.x=e,this.y=o,this.pr=.25,this.pb=.25}return n(t,[{key:"step",value:function(){var t=e.random();this.pr=.25+(e.mouseX-this.x)/(4*e.width),this.pb=.25+(e.mouseY-this.y)/(4*e.height),t<this.pr?this.x++:t<this.pr+this.pb?this.y++:t<this.pb+.5?this.x--:this.y--,this.x=e.constrain(this.x,0,e.width-1),this.y=e.constrain(this.y,0,e.height-1)}},{key:"render",value:function(){e.point(this.x,this.y)}}]),t}(),o=void 0;e.setup=function(){e.createCanvas(600,600),e.background(255),o=new t(e.width/2,e.height/2)},e.draw=function(){o.step(),o.render()}}},function(e,t,o){"use strict";e.exports=function(e){var t=0,o=0;e.setup=function(){e.createCanvas(600,600)},e.draw=function(){t+=.1;var i=30+e.random(0,50);e.point(t,i);var n=20*e.randomGaussian()+200;e.point(t,n),o+=.01;var r=e.noise(o);r=330+e.map(r,0,1,0,100),e.point(t,r)}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){function t(){e.fill(255),e.text("Use LEFT and RIGHT arrows to rotate cannon chase. Hold UP arrow to adjust power and relese to fire",25,20),e.text("Use mouse to control cannon's location",200,40)}var o=function(){function t(o,n,r,s){i(this,t),this.loc=e.createVector(o,n),this.mass=s,this.radius=r/2,this.acceleration=e.createVector(0,0),this.velocity=e.createVector(0,0)}return n(t,[{key:"draw",value:function(){e.fill(0),e.ellipse(this.loc.x,this.loc.y,2*this.radius)}},{key:"update",value:function(){this.velocity.add(this.acceleration),this.loc.add(this.velocity),this.acceleration.mult(0),(this.loc.x-this.radius<0||this.loc.x+this.radius>e.width)&&this.velocity.mult(-1)}},{key:"applyForce",value:function(e){var t=p5.Vector.div(e,this.mass);this.acceleration.add(t)}},{key:"checkCollision",value:function(e,t,o,i){this.loc.y+this.radius>t&&this.loc.x-this.radius<e+o&&(this.loc.y=t-this.radius,this.velocity.mult(-1))}}]),t}(),r=function(){function t(o,n){i(this,t),this.loc=e.createVector(o,n),this.bodyRadius=20,this.pipeRadius=10,this.pipeLength=40,this.angle=0,this.angularVelociy=0,this.angularAcceleration=0,this.force=10,this.ball=new Array}return n(t,[{key:"draw",value:function(){for(var t=0;t<this.ball.length;t++){this.ball[t].draw(),this.ball[t].update();p5.Vector.sub(this.loc,this.ball[t].loc).mag()>this.bodyRadius+this.pipeLength-this.ball[t].radius&&(this.ball[t].outside=!0)}e.fill(191,54,12),e.push(),e.translate(this.loc.x,this.loc.y),e.rotate(e.radians(this.angle)),e.rect(0,-this.pipeRadius,this.pipeLength,2*this.pipeRadius),e.pop(),e.fill(251,140,0),e.ellipse(this.loc.x,this.loc.y,2*this.bodyRadius),e.fill(10),e.push(),e.translate(this.loc.x,this.loc.y),e.rotate(e.radians(this.angle)),e.ellipse(-this.force/10,0,this.pipeRadius),e.line(-this.force/10,0,0,0),e.pop()}},{key:"update",value:function(){this.angle+=this.angularVelociy,this.angularVelociy+=this.angularAcceleration,this.angle=e.constrain(this.angle,-180,0);var t=this.ball.length-1;0===this.ball.length&&(t=0),this.ball[t]=new o(this.loc.x,this.loc.y,2*this.pipeRadius-1,10)}},{key:"shoot",value:function(){var t=this.ball[this.ball.length-1],i=e.createVector(e.cos(e.radians(this.angle)),e.sin(e.radians(this.angle)));return i.mult(this.force),t.applyForce(i),this.ball.push(new o(this.loc.x,this.loc.y,2*this.pipeRadius-1,10)),this.force=10,t}},{key:"trigger",value:function(t){this.force+=t,this.force=e.constrain(this.force,10,250)}}]),t}(),s=void 0,a=new Array,l=e.createVector(0,.5),h=!1;e.setup=function(){e.createCanvas(600,600),s=new r(300,2*e.height/3+5)},e.draw=function(){e.background(3,169,244),e.stroke(0,0),e.fill(93,64,55),e.rect(0,2*e.height/3+20,2*e.width/3,e.height/3);var o=e.constrain(e.mouseX,s.bodyRadius,2*e.width/3-s.bodyRadius);s.loc.x=o,s.draw(),s.update();for(var i=0;i<a.length;i++)if(a[i].outside){var n=a[i].velocity.copy();n.normalize();var r=a[i].velocity.mag();n.mult(-.1*r*r),a[i].applyForce(n),a[i].applyForce(l),a[i].checkCollision(0,2*e.height/3+20,2*e.width/3,e.height/3)}h&&s.trigger(5),t()},e.keyPressed=function(){return e.keyCode===e.LEFT_ARROW&&(s.angularAcceleration=-.1),e.keyCode===e.RIGHT_ARROW&&(s.angularAcceleration=.1),e.keyCode===e.UP_ARROW&&(h=!0),!1},e.keyReleased=function(){return e.keyCode===e.UP_ARROW&&(h=!1,a.push(s.shoot())),s.angularAcceleration=0,s.angularVelociy=0,!1}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n,r,s){i(this,t),this.len=r,this.mass=s,this.angle=0,this.aVelocity=0,this.aAcceleration=0,this.origin=e.createVector(o,n),this.bob=e.createVector(this.origin.x+r*e.sin(this.angle),this.origin.y+r*e.cos(this.angle)),this.drag=!1}return n(t,[{key:"draw",value:function(){if(this.draggable()?e.fill(175):e.fill(255),this.drag){var t=p5.Vector.sub(this.origin,e.createVector(e.mouseX,e.mouseY));this.angle=-t.heading()-e.radians(90)}e.line(this.origin.x,this.origin.y,this.bob.x,this.bob.y),e.ellipse(this.bob.x,this.bob.y,10*this.mass)}},{key:"update",value:function(){this.bob=e.createVector(this.origin.x+this.len*e.sin(this.angle),this.origin.y+this.len*e.cos(this.angle)),this.aAcceleration=-.6/this.len*e.sin(this.angle),this.aVelocity+=this.aAcceleration,this.aVelocity*=.99,this.angle+=this.aVelocity}},{key:"draggable",value:function(){var t=e.createVector(e.mouseX,e.mouseY);return p5.Vector.sub(t,this.bob).mag()<5*this.mass}},{key:"startDrag",value:function(){this.draggable()&&(this.drag=!0)}},{key:"stopDrag",value:function(){this.drag=!1}}]),t}(),o=new Array;e.setup=function(){e.createCanvas(600,600);for(var i=0;i<10;i++)o.push(new t(i*e.width/10+25,0,e.random(10,400),4))},e.draw=function(){e.background(250),e.stroke(0),e.fill(255,200);for(var t=0;t<o.length;t++)o[t].draw(),o[t].update()},e.mousePressed=function(){for(var e=0;e<o.length;e++)o[e].startDrag()},e.mouseReleased=function(){for(var e=0;e<o.length;e++)o[e].stopDrag()}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n){i(this,t),this.loc=e.createVector(o,n),this.acc=e.createVector(0,0),this.vel=e.createVector(0,0),this.tail=new Array}return n(t,[{key:"draw",value:function(){e.push(),e.translate(this.loc.x,this.loc.y),e.rotate(this.vel.heading()),e.triangle(5,-10,25,0,5,10),e.pop();for(var t=0;t<this.tail.length;t++)e.ellipse(this.tail[t].x,this.tail[t].y,5)}},{key:"update",value:function(){this.vel.add(this.acc),this.vel.limit(7),this.loc.add(this.vel);var t=e.createVector(e.mouseX,e.mouseY),o=p5.Vector.sub(t,this.loc);o.normalize(),this.acc=o,this.tail.push(e.createVector(this.loc.x,this.loc.y)),this.tail.length>10&&this.tail.shift()}}]),t}(),o=void 0;e.setup=function(){e.createCanvas(600,600),o=new t(e.width/2,e.height/2)},e.draw=function(){e.background(3,169,244),e.fill(255),e.stroke(255),o.draw(),o.update()}}},function(e,t,o){"use strict";function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o){r(this,t),this.lifeSpan=255,this.velocity=e.createVector(e.random(-1.5,1.5),e.random(-2,0)),this.acceleration=e.createVector(0,.04),this.loc=o.copy()}return s(t,[{key:"draw",value:function(){e.fill(33,150,243,this.lifeSpan),e.stroke(33,150,243,this.lifeSpan),e.ellipse(this.loc.x,this.loc.y,10)}},{key:"update",value:function(){this.lifeSpan-=2,this.velocity.add(this.acceleration),this.loc.add(this.velocity)}},{key:"run",value:function(){this.update(),this.draw()}},{key:"isDead",value:function(){return this.lifeSpan<0}},{key:"applyForce",value:function(e){this.acceleration.add(e)}}]),t}(),o=function(t){function o(){return r(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,t),s(o,[{key:"draw",value:function(){e.fill(205,220,57,this.lifeSpan),e.stroke(205,220,57,this.lifeSpan),e.rect(this.loc.x,this.loc.y,10,10)}}]),o}(t),a=function(t){function o(){return r(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,t),s(o,[{key:"draw",value:function(){e.fill(233,30,99,this.lifeSpan),e.stroke(233,30,99,this.lifeSpan),e.triangle(this.loc.x,this.loc.y,this.loc.x-5,this.loc.y+10,this.loc.x+5,this.loc.y+10)}}]),o}(t),l=function(){function i(t,o){r(this,i),this.loc=e.createVector(t,o),this.particles=new Array,this.vel=e.createVector(0,0),this.acc=e.createVector(0,0)}return s(i,[{key:"run",value:function(){var i=p5.Vector.sub(e.createVector(e.mouseX,e.mouseY),this.loc).normalize();this.acc=i,this.vel.add(this.acc),this.vel.limit(5),this.loc.add(this.vel);var n=e.random(),r=void 0;r=n<.35?new o(this.loc):n<.7?new a(this.loc):new t(this.loc),this.particles.push(r);for(var s=0;s<this.particles.length;s++)this.particles[s].isDead()&&this.particles.splice(s,1),this.particles[s].run()}}]),i}(),h=void 0;e.setup=function(){e.createCanvas(600,600),h=new l(e.width/2,100)},e.draw=function(){e.background(255),h.run()}}},function(e,t,o){"use strict";function i(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}return Array.from(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o){n(this,t),this.loc=o.copy(),this.vel=e.createVector(e.random(-1,1),e.random(-1,0)),this.acc=e.createVector(0,0),this.color=[e.random(0,255),e.random(0,255),e.random(0,255)],this.life=255}return r(t,[{key:"draw",value:function(){e.fill.apply(e,i(this.color).concat([this.life])),e.stroke.apply(e,i(this.color).concat([this.life])),e.ellipse(this.loc.x,this.loc.y,10)}},{key:"update",value:function(){this.vel.add(this.acc),this.loc.add(this.vel),this.acc.mult(0),this.life-=1}},{key:"run",value:function(){this.draw(),this.update()}},{key:"isDead",value:function(){return this.life<0}},{key:"applyForce",value:function(e){this.acc.add(e)}}]),t}(),o=function(){function o(e){n(this,o),this.loc=e.copy(),this.particles=new Array,window.ps=this.particles}return r(o,[{key:"run",value:function(){this.particles.push(new t(e.createVector(e.width/2,100)));for(var o=0;o<this.particles.length;o++){var i=this.particles[o];i.run(),i.isDead()&&this.particles.splice(o,1)}}},{key:"applyForce",value:function(e){for(var t=0;t<this.particles.length;t++)this.particles[t].applyForce(e)}},{key:"applyRepeller",value:function(e){for(var t=0;t<this.particles.length;t++)this.particles[t].applyForce(e.repell(this.particles[t]))}}]),o}(),s=function(){function t(){n(this,t),this.loc=e.createVector(300,200),this.radius=10}return r(t,[{key:"draw",value:function(){this.loc=e.createVector(e.mouseX,e.mouseY),e.ellipse(this.loc.x,this.loc.y,5*this.radius)}},{key:"repell",value:function(t){var o=p5.Vector.sub(this.loc,t.loc),i=o.mag();return i=e.constrain(i,1,1e3),o.normalize(),o.mult(-100/(i*i)),o}}]),t}(),a=void 0,l=void 0,h=void 0;e.setup=function(){e.createCanvas(600,600),a=new o(e.createVector(e.width/2,100)),l=e.createVector(0,.02),h=new s},e.draw=function(){e.background(255),a.applyForce(l),a.applyRepeller(h),a.run(),e.fill(233,30,99),e.stroke(233,30,99),h.draw()}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),r=o(0);e.exports=function(e){var t=void 0,o=function(){function o(e,n){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;i(this,o),this.w=s,this.h=s;var a=new box2d.b2BodyDef;a.type=box2d.b2BodyType.b2_dynamicBody,a.position=(0,r.scaleToWorld)(e,n);var l=new box2d.b2FixtureDef;l.shape=new box2d.b2PolygonShape,l.shape.SetAsBox((0,r.scaleToWorld)(this.w/2),(0,r.scaleToWorld)(this.h/2)),l.density=1,l.friction=.3,l.restitution=.1,this.body=t.CreateBody(a),this.body.CreateFixture(l)}return n(o,[{key:"draw",value:function(){e.fill(255),e.stroke(255);var t=(0,r.scaleToPixels)(this.body.GetPosition()),o=this.body.GetAngleRadians();e.push(),e.translate(t.x,t.y),e.rotate(o),e.rect(0,0,this.w,this.h),e.pop()}},{key:"kill",value:function(){t.DestroyBody(this)}},{key:"done",value:function(){var t=(0,r.scaleToPixels)(this.body.GetTransform().p);return(t.x>e.width||t.x<0||t.y>e.height)&&(this.kill(),!0)}}]),o}(),s=function(){function o(){i(this,o),this.outline=new Array,this.outline.push((0,r.scaleToWorld)(new box2d.b2Vec2(0,e.height))),this.outline.push((0,r.scaleToWorld)(new box2d.b2Vec2(0,e.height-100)));for(var n=0;n<e.PI;n+=.5){var s=400*e.noise(n);this.outline.push((0,r.scaleToWorld)(new box2d.b2Vec2(100*n,s+250)))}this.outline.push((0,r.scaleToWorld)(new box2d.b2Vec2(e.width,e.height-100))),this.outline.push((0,r.scaleToWorld)(new box2d.b2Vec2(e.width,e.height)));var a=new box2d.b2ChainShape;a.CreateChain(this.outline,this.outline.length);var l=new box2d.b2BodyDef;this.body=t.CreateBody(l);var h=new box2d.b2FixtureDef;h.shape=a,h.density=1,h.friction=1,h.restitution=.1,this.body.CreateFixture(h)}return n(o,[{key:"draw",value:function(){e.fill(70,200),e.stroke(70),e.beginShape();for(var t=0;t<this.outline.length;t++){var o=(0,r.scaleToPixels)(this.outline[t]);e.vertex(o.x,o.y)}e.endShape()}}]),o}(),a=new Array,l=new Array;e.setup=function(){e.createCanvas(500,500),e.rectMode(e.CENTER);var o=new box2d.b2Vec2(0,9.8);t=new box2d.b2World(o,!0),a.push(new s(20,250))},e.draw=function(){e.background(33,150,243),t.Step(1/30,10,10);for(var i=0;i<a.length;i++)a[i].draw();for(var n=l.length-1;n>=0;n--)l[n].draw(),l[n].done()&&l.splice(n,1);l.length<=50&&l.push(new o(300,0,e.random(10,30)))},e.mousePressed=function(){l.push(new o(e.mouseX,e.mouseY,e.random(10,30)))}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),r=o(0);e.exports=function(e){var t=void 0,o=function(){function o(e,n){i(this,o),this.w=20,this.h=20,this.vertices=[],this.vertices.push((0,r.scaleToWorld)(15,-15)),this.vertices.push((0,r.scaleToWorld)(10,5)),this.vertices.push((0,r.scaleToWorld)(-15,15)),this.vertices.push((0,r.scaleToWorld)(-10,-5));var s=new box2d.b2BodyDef;s.type=box2d.b2BodyType.b2_dynamicBody,s.position=(0,r.scaleToWorld)(e,n);var a=new box2d.b2FixtureDef;a.shape=new box2d.b2PolygonShape,a.shape.SetAsArray(this.vertices,this.vertices.length),a.density=1,a.friction=.3,a.restitution=.1,this.body=t.CreateBody(s),this.body.CreateFixture(a)}return n(o,[{key:"draw",value:function(){e.fill(255,193,7),e.stroke(255,193,7);var t=(0,r.scaleToPixels)(this.body.GetPosition()),o=this.body.GetAngleRadians();e.push(),e.translate(t.x,t.y),e.rotate(o),e.beginShape();for(var i=this.vertices.length-1;i>=0;i--){var n=(0,r.scaleToPixels)(this.vertices[i]);e.vertex(n.x,n.y)}e.endShape(),e.pop()}}]),o}(),s=function(){function o(e,n){i(this,o),this.w=20,this.h=20,this.vertices=[],this.vertices.push((0,r.scaleToWorld)(15,0)),this.vertices.push((0,r.scaleToWorld)(0,25)),this.vertices.push((0,r.scaleToWorld)(-15,0));var s=new box2d.b2BodyDef;s.type=box2d.b2BodyType.b2_dynamicBody,s.position=(0,r.scaleToWorld)(e,n);var a=new box2d.b2FixtureDef;a.shape=new box2d.b2PolygonShape,a.shape.SetAsArray(this.vertices,this.vertices.length),a.density=1,a.friction=.3,a.restitution=.1;var l=new box2d.b2FixtureDef;l.shape=new box2d.b2CircleShape,l.shape.m_radius=(0,r.scaleToWorld)(10),l.shape.m_p=(0,r.scaleToWorld)(0,-10),l.density=1,l.friction=.3,l.restitution=.1,this.body=t.CreateBody(s),this.body.CreateFixture(a),this.body.CreateFixture(l)}return n(o,[{key:"draw",value:function(){e.fill(233,30,99),e.stroke(233,30,99);var t=(0,r.scaleToPixels)(this.body.GetPosition()),o=this.body.GetAngleRadians();e.push(),e.translate(t.x,t.y),e.rotate(o),e.beginShape();for(var i=this.vertices.length-1;i>=0;i--){var n=(0,r.scaleToPixels)(this.vertices[i]);e.vertex(n.x,n.y)}e.endShape(),e.fill(233,30,99),e.stroke(233,30,99),e.ellipse(0,-10,20),e.pop()}}]),o}(),a=function(){function o(e,n,s,a){i(this,o),this.w=s,this.h=a,this.x=e,this.y=n;var l=new box2d.b2BodyDef;l.type=box2d.b2BodyType.b2_staticBody,l.position=(0,r.scaleToWorld)(e,n);var h=new box2d.b2FixtureDef;h.shape=new box2d.b2PolygonShape,h.shape.SetAsBox((0,r.scaleToWorld)(this.w/2),(0,r.scaleToWorld)(this.h/2)),h.density=1,h.friction=.6,h.restitution=.1,this.body=t.CreateBody(l),this.body.CreateFixture(h)}return n(o,[{key:"draw",value:function(){e.fill(70),e.stroke(70);var t=(0,r.scaleToPixels)(this.body.GetPosition());e.push(),e.translate(t.x,t.y),e.rect(0,0,this.w,this.h),e.pop()}}]),o}(),l=new Array,h=new Array;e.setup=function(){e.createCanvas(500,500),e.rectMode(e.CENTER);var o=new box2d.b2Vec2(0,9.8);t=new box2d.b2World(o,!0),l.push(new a(160,400,300,10)),l.push(new a(e.width-110,300,200,10))},e.draw=function(){e.background(255),t.Step(1/30,10,10);for(var o=0;o<l.length;o++)l[o].draw();for(var i=0;i<h.length;i++)h[i].draw();e.fill(0),e.stroke(255),e.text("Click to add shapes",200,15)},e.mousePressed=function(){e.mouseX>e.width/2?h.push(new o(e.mouseX,e.mouseY)):h.push(new s(e.mouseX,e.mouseY))}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),r=o(0);e.exports=function(e){var t=void 0,o=function(){function o(e,n){i(this,o),this.w=20,this.h=20,this.x=e,this.y=n;var s=new box2d.b2BodyDef;s.type=box2d.b2BodyType.b2_dynamicBody,s.position=(0,r.scaleToWorld)(e,n);var a=new box2d.b2FixtureDef;a.shape=new box2d.b2CircleShape,a.shape.m_radius=(0,r.scaleToWorld)(10),a.density=1,a.friction=.3,a.restitution=.1,this.body=t.CreateBody(s),this.body.CreateFixture(a)}return n(o,[{key:"draw",value:function(){e.fill(255),e.stroke(0);var t=(0,r.scaleToPixels)(this.body.GetPosition()),o=this.body.GetAngleRadians();e.push(),e.translate(t.x,t.y),e.rotate(o),e.ellipse(0,0,20),e.line(0,0,10,0),e.pop()}}]),o}(),s=function(){function o(e,n,s,a){i(this,o),this.w=s,this.h=a,this.x=e,this.y=n;var l=new box2d.b2BodyDef;l.type=box2d.b2BodyType.b2_staticBody,l.position=(0,r.scaleToWorld)(e,n);var h=new box2d.b2FixtureDef;h.shape=new box2d.b2PolygonShape,h.shape.SetAsBox((0,r.scaleToWorld)(this.w/2),(0,r.scaleToWorld)(this.h/2)),h.density=1,h.friction=.6,h.restitution=.1,this.body=t.CreateBody(l),this.body.CreateFixture(h)}return n(o,[{key:"draw",value:function(){e.fill(70),e.stroke(70);var t=(0,r.scaleToPixels)(this.body.GetPosition());e.push(),e.translate(t.x,t.y),e.rect(0,0,this.w,this.h),e.pop()}}]),o}(),a=function(){function e(n,a,l,h){i(this,e),this.len=1,this.wall1=new s(n,a,10,10),this.wall2=new s(l,h,10,10),this.points=[];for(var p=(l-n)/20,c=0;c<=p;c++){c!==p&&this.points.push(new o(n+this.len,a));var u=new box2d.b2DistanceJointDef;0==c?(u.bodyA=this.wall1.body,u.bodyB=this.points[c].body):c==p?(u.bodyA=this.points[c-1].body,u.bodyB=this.wall2.body):(u.bodyA=this.points[c-1].body,u.bodyB=this.points[c].body),u.length=(0,r.scaleToWorld)(this.len),u.frequencyHz=3,u.dampingRatio=.4,t.CreateJoint(u)}}return n(e,[{key:"draw",value:function(){this.wall1.draw(),this.wall2.draw();for(var e=0;e<this.points.length;e++)this.points[e].draw()}}]),e}(),l=new Array,h=void 0;e.setup=function(){e.createCanvas(500,500),e.rectMode(e.CENTER);var o=new box2d.b2Vec2(0,9.8);t=new box2d.b2World(o,!0),h=new a(20,e.height/2,e.width-20,e.height/2)},e.draw=function(){e.background(33,150,243),t.Step(1/30,10,10),h.draw();for(var o=0;o<l.length;o++)l[o].draw()},e.mousePressed=function(){l.push(new o(e.mouseX,e.mouseY))}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),r=o(0);e.exports=function(e){var t=void 0,o=function(){function o(e,n){i(this,o),this.w=20,this.h=20,this.x=e,this.y=n;var s=new box2d.b2BodyDef;s.type=box2d.b2BodyType.b2_dynamicBody,s.position=(0,r.scaleToWorld)(e,n);var a=new box2d.b2FixtureDef;a.shape=new box2d.b2PolygonShape,a.shape.SetAsBox((0,r.scaleToWorld)(this.w/2),(0,r.scaleToWorld)(this.h/2)),a.density=1,a.friction=.3,a.restitution=.1,this.body=t.CreateBody(s),this.body.CreateFixture(a)}return n(o,[{key:"draw",value:function(){e.fill(255),e.stroke(255);var t=(0,r.scaleToPixels)(this.body.GetPosition()),o=this.body.GetAngleRadians();e.push(),e.translate(t.x,t.y),e.rotate(o),e.rect(0,0,this.w,this.h),e.pop()}}]),o}(),s=function(){function o(e,n,s,a){i(this,o),this.w=s,this.h=a,this.x=e,this.y=n;var l=new box2d.b2BodyDef;l.type=box2d.b2BodyType.b2_staticBody,l.position=(0,r.scaleToWorld)(e,n);var h=new box2d.b2FixtureDef;h.shape=new box2d.b2PolygonShape,h.shape.SetAsBox((0,r.scaleToWorld)(this.w/2),(0,r.scaleToWorld)(this.h/2)),h.density=1,h.friction=.6,h.restitution=.1,this.body=t.CreateBody(l),this.body.CreateFixture(h)}return n(o,[{key:"draw",value:function(){e.fill(70),e.stroke(70);var t=(0,r.scaleToPixels)(this.body.GetPosition());e.push(),e.translate(t.x,t.y),e.rect(0,0,this.w,this.h),e.pop()}}]),o}(),a=new Array,l=new Array;e.setup=function(){e.createCanvas(500,500),e.rectMode(e.CENTER);var o=new box2d.b2Vec2(0,9.8);t=new box2d.b2World(o,!0),a.push(new s(160,400,300,10)),a.push(new s(e.width-110,300,200,10))},e.draw=function(){e.background(33,150,243),t.Step(1/30,10,10);for(var i=0;i<a.length;i++)a[i].draw();for(var n=0;n<l.length;n++)l[n].draw();l.length<=50&&l.push(new o(e.random(250,300),0))},e.mousePressed=function(){l.push(new o(e.mouseX,e.mouseY))}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),r=o(0);e.exports=function(e){var t=void 0,o=function(){function o(e,n,s,a){i(this,o),this.w=s,this.h=a,this.x=e,this.y=n;var l=new box2d.b2BodyDef;l.type=box2d.b2BodyType.b2_dynamicBody,l.position=(0,r.scaleToWorld)(e,n);var h=new box2d.b2FixtureDef;h.shape=new box2d.b2PolygonShape,h.shape.SetAsBox((0,r.scaleToWorld)(this.w/2),(0,r.scaleToWorld)(this.h/2)),h.density=1,h.friction=.3,h.restitution=.1,this.body=t.CreateBody(l),this.body.CreateFixture(h)}return n(o,[{key:"draw",value:function(){e.fill(255),e.stroke(0);var t=(0,r.scaleToPixels)(this.body.GetPosition()),o=this.body.GetAngleRadians();e.push(),e.translate(t.x,t.y),e.rotate(o),e.rect(0,0,this.w,this.h),e.pop()}}]),o}(),s=function(){function o(e,n,s){i(this,o),this.x=e,this.y=n,this.r=s;var a=new box2d.b2BodyDef;a.type=box2d.b2BodyType.b2_dynamicBody,a.position=(0,r.scaleToWorld)(e,n),this.body=t.CreateBody(a);var l=new box2d.b2FixtureDef;l.shape=new box2d.b2CircleShape,l.shape.m_radius=(0,r.scaleToWorld)(this.r),l.density=1,l.friction=.3,l.restitution=.1,this.body.CreateFixture(l)}return n(o,[{key:"draw",value:function(){e.fill(255),e.stroke(0);var t=(0,r.scaleToPixels)(this.body.GetPosition()),o=this.body.GetAngleRadians();e.push(),e.translate(t.x,t.y),e.rotate(o),e.ellipse(0,0,2*this.r),e.line(0,0,this.r,0),e.pop()}}]),o}(),a=function(){function r(e,n){i(this,r),this.wheel1=new s(e+13,n+13,5),this.wheel2=new s(e-13,n+13,5),this.chasis=new o(e,n,50,25);var a=new box2d.b2RevoluteJointDef;a.Initialize(this.chasis.body,this.wheel1.body,this.wheel1.body.GetWorldCenter()),a.enableMotor=!1,this.joint1=t.CreateJoint(a);var l=new box2d.b2RevoluteJointDef;l.Initialize(this.chasis.body,this.wheel2.body,this.wheel2.body.GetWorldCenter()),l.enableMotor=!1,this.joint2=t.CreateJoint(l)}return n(r,[{key:"draw",value:function(){e.push(),this.chasis.draw(),this.wheel1.draw(),this.wheel2.draw(),e.pop()}}]),r}(),l=function(){function o(){i(this,o),this.outline=new Array,this.outline.push((0,r.scaleToWorld)(new box2d.b2Vec2(0,e.height))),this.outline.push((0,r.scaleToWorld)(new box2d.b2Vec2(0,e.height-100))),this.outline.push((0,r.scaleToWorld)(new box2d.b2Vec2(100,350))),this.outline.push((0,r.scaleToWorld)(new box2d.b2Vec2(e.width,e.height-100))),this.outline.push((0,r.scaleToWorld)(new box2d.b2Vec2(e.width,e.height)));var n=new box2d.b2ChainShape;n.CreateChain(this.outline,this.outline.length);var s=new box2d.b2BodyDef;this.body=t.CreateBody(s);var a=new box2d.b2FixtureDef;a.shape=n,a.density=1,a.friction=1,a.restitution=.1,this.body.CreateFixture(a)}return n(o,[{key:"draw",value:function(){e.fill(70,200),e.stroke(70),e.beginShape();for(var t=0;t<this.outline.length;t++){var o=(0,r.scaleToPixels)(this.outline[t]);e.vertex(o.x,o.y)}e.endShape()}}]),o}(),h=new Array,p=new Array;e.setup=function(){e.createCanvas(500,500),e.rectMode(e.CENTER);var o=new box2d.b2Vec2(0,9.8);t=new box2d.b2World(o,!0),h.push(new l(160,400,300,10)),h.push(new l(e.width-110,300,200,10))},e.draw=function(){e.background(33,150,243),t.Step(1/30,10,10);for(var o=0;o<h.length;o++)h[o].draw();for(var i=0;i<p.length;i++)p[i].draw()},e.mousePressed=function(){p.push(new a(e.mouseX,e.mouseY))}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n,r){i(this,t),this.loc=e.createVector(o,n),this.size=r,this.vel=e.createVector(0,0),this.radius=r/2,this.gravity=e.createVector(0,1)}return n(t,[{key:"move",value:function(){this.acc=p5.Vector.random2D(),this.vel.add(this.acc),this.vel.add(this.gravity),this.vel.limit(20),this.loc.add(this.vel),this.loc.x=e.constrain(this.loc.x,this.radius,e.width-this.radius),this.loc.y=e.constrain(this.loc.y,this.radius,e.height-this.radius)}},{key:"bounce",value:function(){(this.loc.x>=e.width-this.radius||this.loc.x<=this.radius)&&(this.vel.x*=-1),(this.loc.y>=e.height-this.radius||this.loc.y<=this.radius)&&(this.vel.y*=-1)}},{key:"draw",value:function(){e.ellipse(this.loc.x,this.loc.y,this.size)}}]),t}(),o=void 0;e.setup=function(){e.createCanvas(400,400),o=new t(e.width/2,e.height/2,30)},e.draw=function(){e.background(200),o.move(),o.bounce(),o.draw()}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n,r){i(this,t),this.loc=e.createVector(o,n),this.size=r,this.vel=e.createVector(0,0),this.radius=r/2}return n(t,[{key:"move",value:function(){this.acc=e.createVector(e.random(-1,1),e.random(-1,1)),this.vel.add(this.acc),this.vel.limit(25),this.loc.add(this.vel),this.loc.x=e.constrain(this.loc.x,this.radius,e.width-this.radius),this.loc.y=e.constrain(this.loc.y,this.radius,e.height-this.radius)}},{key:"bounce",value:function(){(this.loc.x>=e.width-this.radius||this.loc.x<=this.radius)&&(this.vel.x*=-1),(this.loc.y>=e.height-this.radius||this.loc.y<=this.radius)&&(this.vel.y*=-1)}},{key:"draw",value:function(){e.ellipse(this.loc.x,this.loc.y,this.size)}}]),t}(),o=void 0;e.setup=function(){e.createCanvas(400,400),o=new t(e.width/2,e.height/2,30)},e.draw=function(){e.background(200),o.move(),o.bounce(),o.draw()}}},function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}();e.exports=function(e){var t=function(){function t(o,n,r){i(this,t),this.loc=e.createVector(o,n),this.size=r,this.vel=e.createVector(2,-3),this.radius=r/2}return n(t,[{key:"move",value:function(){this.loc.add(this.vel);var t=this.size/2;this.loc.x=e.constrain(this.loc.x,t,e.width-t),this.loc.y=e.constrain(this.loc.y,t,e.height-t)}},{key:"bounce",value:function(){(this.loc.x>=e.width-this.radius||this.loc.x<=this.radius)&&(this.vel.x*=-1),(this.loc.y>=e.height-this.radius||this.loc.y<=this.radius)&&(this.vel.y*=-1)}},{key:"draw",value:function(){e.ellipse(this.loc.x,this.loc.y,this.size)}}]),t}(),o=void 0;e.setup=function(){e.createCanvas(600,600),o=new t(e.width/2,e.height/2,30)},e.draw=function(){e.background(200),o.move(),o.bounce(),o.draw()}}},function(e,t,o){t=e.exports=o(40)(void 0),t.push([e.i,"body{background:#eee;font-family:sans-serif;font-weight:100}header .main{background:#e91e63;color:#fff;padding:20px}header h1{margin:10px 0;font-weight:100}header .breadcrumb{background:#333;padding:8px 20px;color:#fff}main{padding:20px}main canvas{display:block;margin:auto}main .info,main .phrases{float:left;padding:10px}main .phrases{display:block;text-align:right;width:50%}footer{background:#37474f;padding:30px;text-align:center;clear:both}footer,footer a{color:#fff}",""])},function(e,t){function o(e,t){var o=e[1]||"",n=e[3];if(!n)return o;if(t&&"function"==typeof btoa){var r=i(n);return[o].concat(n.sources.map(function(e){return"/*# sourceURL="+n.sourceRoot+e+" */"})).concat([r]).join("\n")}return[o].join("\n")}function i(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var i=o(t,e);return t[2]?"@media "+t[2]+"{"+i+"}":i}).join("")},t.i=function(e,o){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},n=0;n<this.length;n++){var r=this[n][0];"number"==typeof r&&(i[r]=!0)}for(n=0;n<e.length;n++){var s=e[n];"number"==typeof s[0]&&i[s[0]]||(o&&!s[2]?s[2]=o:o&&(s[2]="("+s[2]+") and ("+o+")"),t.push(s))}},t}},function(e,t){e.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},function(e,t,o){(function(t){var o,o;/*! p5.js v0.5.11 June 01, 2017 */!function(t){e.exports=t()}(function(){var e;return function e(t,i,n){function r(a,l){if(!i[a]){if(!t[a]){var h="function"==typeof o&&o;if(!l&&h)return o(a,!0);if(s)return s(a,!0);var p=new Error("Cannot find module '"+a+"'");throw p.code="MODULE_NOT_FOUND",p}var c=i[a]={exports:{}};t[a][0].call(c.exports,function(e){var o=t[a][1][e];return r(o||e)},c,c.exports,e,t,i,n)}return i[a].exports}for(var s="function"==typeof o&&o,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(e,t,o){},{}],2:[function(o,i,n){(function(t,r){!function(t,o){"object"==typeof n&&void 0!==i?i.exports=o():"function"==typeof e&&e.amd?e(o):t.ES6Promise=o()}(this,function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function i(e){return"function"==typeof e}function n(e){q=e}function s(e){j=e}function a(){return void 0!==z?function(){z(h)}:l()}function l(){var e=setTimeout;return function(){return e(h,1)}}function h(){for(var e=0;e<U;e+=2)(0,Q[e])(Q[e+1]),Q[e]=void 0,Q[e+1]=void 0;U=0}function p(e,t){var o=arguments,i=this,n=new this.constructor(u);void 0===n[ee]&&R(n);var r=i._state;return r?function(){var e=o[r-1];j(function(){return M(r,n,e,i._result)})}():C(i,n,e,t),n}function c(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var o=new t(u);return g(o,e),o}function u(){}function m(){return new TypeError("You cannot resolve a promise with itself")}function d(){return new TypeError("A promises callback cannot return that same promise.")}function y(e){try{return e.then}catch(e){return ne.error=e,ne}}function b(e,t,o,i){try{e.call(t,o,i)}catch(e){return e}}function f(e,t,o){j(function(e){var i=!1,n=b(o,t,function(o){i||(i=!0,t!==o?g(e,o):S(e,o))},function(t){i||(i=!0,A(e,t))},"Settle: "+(e._label||" unknown promise"));!i&&n&&(i=!0,A(e,n))},e)}function _(e,t){t._state===oe?S(e,t._result):t._state===ie?A(e,t._result):C(t,void 0,function(t){return g(e,t)},function(t){return A(e,t)})}function v(e,t,o){t.constructor===e.constructor&&o===p&&t.constructor.resolve===c?_(e,t):o===ne?A(e,ne.error):void 0===o?S(e,t):i(o)?f(e,t,o):S(e,t)}function g(t,o){t===o?A(t,m()):e(o)?v(t,o,y(o)):S(t,o)}function x(e){e._onerror&&e._onerror(e._result),w(e)}function S(e,t){e._state===te&&(e._result=t,e._state=oe,0!==e._subscribers.length&&j(w,e))}function A(e,t){e._state===te&&(e._state=ie,e._result=t,j(x,e))}function C(e,t,o,i){var n=e._subscribers,r=n.length;e._onerror=null,n[r]=t,n[r+oe]=o,n[r+ie]=i,0===r&&e._state&&j(w,e)}function w(e){var t=e._subscribers,o=e._state;if(0!==t.length){for(var i=void 0,n=void 0,r=e._result,s=0;s<t.length;s+=3)i=t[s],n=t[s+o],i?M(o,i,n,r):n(r);e._subscribers.length=0}}function V(){this.error=null}function B(e,t){try{return e(t)}catch(e){return re.error=e,re}}function M(e,t,o,n){var r=i(o),s=void 0,a=void 0,l=void 0,h=void 0;if(r){if(s=B(o,n),s===re?(h=!0,a=s.error,s=null):l=!0,t===s)return void A(t,d())}else s=n,l=!0;t._state!==te||(r&&l?g(t,s):h?A(t,a):e===oe?S(t,s):e===ie&&A(t,s))}function T(e,t){try{t(function(t){g(e,t)},function(t){A(e,t)})}catch(t){A(e,t)}}function P(){return se++}function R(e){e[ee]=se++,e._state=void 0,e._result=void 0,e._subscribers=[]}function E(e,t){this._instanceConstructor=e,this.promise=new e(u),this.promise[ee]||R(this.promise),W(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&S(this.promise,this._result))):A(this.promise,I())}function I(){return new Error("Array Methods must be provided an Array")}function D(e){return new E(this,e).promise}function L(e){var t=this;return new t(W(e)?function(o,i){for(var n=e.length,r=0;r<n;r++)t.resolve(e[r]).then(o,i)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function F(e){var t=this,o=new t(u);return A(o,e),o}function k(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function J(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function G(e){this[ee]=P(),this._result=this._state=void 0,this._subscribers=[],u!==e&&("function"!=typeof e&&k(),this instanceof G?T(this,e):J())}function O(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var o=null;try{o=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===o&&!t.cast)return}e.Promise=G}var N=void 0;N=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var W=N,U=0,z=void 0,q=void 0,j=function(e,t){Q[U]=e,Q[U+1]=t,2===(U+=2)&&(q?q(h):$())},H="undefined"!=typeof window?window:void 0,X=H||{},Y=X.MutationObserver||X.WebKitMutationObserver,Z="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),K="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Q=new Array(1e3),$=void 0;$=Z?function(){return function(){return t.nextTick(h)}}():Y?function(){var e=0,t=new Y(h),o=document.createTextNode("");return t.observe(o,{characterData:!0}),function(){o.data=e=++e%2}}():K?function(){var e=new MessageChannel;return e.port1.onmessage=h,function(){return e.port2.postMessage(0)}}():void 0===H&&"function"==typeof o?function(){try{var e=o,t=e("vertx");return z=t.runOnLoop||t.runOnContext,a()}catch(e){return l()}}():l();var ee=Math.random().toString(36).substring(16),te=void 0,oe=1,ie=2,ne=new V,re=new V,se=0;return E.prototype._enumerate=function(){for(var e=this.length,t=this._input,o=0;this._state===te&&o<e;o++)this._eachEntry(t[o],o)},E.prototype._eachEntry=function(e,t){var o=this._instanceConstructor,i=o.resolve;if(i===c){var n=y(e);if(n===p&&e._state!==te)this._settledAt(e._state,t,e._result);else if("function"!=typeof n)this._remaining--,this._result[t]=e;else if(o===G){var r=new o(u);v(r,e,n),this._willSettleAt(r,t)}else this._willSettleAt(new o(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},E.prototype._settledAt=function(e,t,o){var i=this.promise;i._state===te&&(this._remaining--,e===ie?A(i,o):this._result[t]=o),0===this._remaining&&S(i,this._result)},E.prototype._willSettleAt=function(e,t){var o=this;C(e,void 0,function(e){return o._settledAt(oe,t,e)},function(e){return o._settledAt(ie,t,e)})},G.all=D,G.race=L,G.resolve=c,G.reject=F,G._setScheduler=n,G._setAsap=s,G._asap=j,G.prototype={constructor:G,then:p,catch:function(e){return this.then(null,e)}},G.polyfill=O,G.Promise=G,G})}).call(this,o("_process"),void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:31}],3:[function(t,o,i){!function(t,n){if("function"==typeof e&&e.amd)e(["exports","module"],n);else if(void 0!==i&&void 0!==o)n(i,o);else{var r={exports:{}};n(r.exports,r),t.fetchJsonp=r.exports}}(this,function(e,t){"use strict";function o(){return"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random())}function i(e){try{delete window[e]}catch(t){window[e]=void 0}}function n(e){var t=document.getElementById(e);document.getElementsByTagName("head")[0].removeChild(t)}function r(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=e,a=t.timeout||s.timeout,l=t.jsonpCallback||s.jsonpCallback,h=void 0;return new Promise(function(s,p){var c=t.jsonpCallbackFunction||o(),u=l+"_"+c;window[c]=function(e){s({ok:!0,json:function(){return Promise.resolve(e)}}),h&&clearTimeout(h),n(u),i(c)},r+=-1===r.indexOf("?")?"?":"&";var m=document.createElement("script");m.setAttribute("src",""+r+l+"="+c),m.id=u,document.getElementsByTagName("head")[0].appendChild(m),h=setTimeout(function(){p(new Error("JSONP request to "+e+" timed out")),i(c),n(u)},a)})}var s={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};t.exports=r})},{}],4:[function(e,t,o){"use strict";o.argument=function(e,t){if(!e)throw new Error(t)},o.assert=o.argument},{}],5:[function(e,t,o){"use strict";function i(e,t,o,i,n){e.beginPath(),e.moveTo(t,o),e.lineTo(i,n),e.stroke()}o.line=i},{}],6:[function(e,t,o){"use strict";function i(e){this.font=e}function n(e){this.cmap=e}function r(e,t){this.encoding=e,this.charset=t}function s(e){var t;switch(e.version){case 1:this.names=o.standardNames.slice();break;case 2:for(this.names=new Array(e.numberOfGlyphs),t=0;t<e.numberOfGlyphs;t++)e.glyphNameIndex[t]<o.standardNames.length?this.names[t]=o.standardNames[e.glyphNameIndex[t]]:this.names[t]=e.names[e.glyphNameIndex[t]-o.standardNames.length];break;case 2.5:for(this.names=new Array(e.numberOfGlyphs),t=0;t<e.numberOfGlyphs;t++)this.names[t]=o.standardNames[t+e.glyphNameIndex[t]];break;case 3:this.names=[]}}function a(e){for(var t,o=e.tables.cmap.glyphIndexMap,i=Object.keys(o),n=0;n<i.length;n+=1){var r=i[n],s=o[r];t=e.glyphs.get(s),t.addUnicode(parseInt(r))}for(n=0;n<e.glyphs.length;n+=1)t=e.glyphs.get(n),e.cffEncoding?t.name=e.cffEncoding.charset[n]:t.name=e.glyphNames.glyphIndexToName(n)}var l=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],h=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],p=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],c=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];i.prototype.charToGlyphIndex=function(e){var t=e.charCodeAt(0),o=this.font.glyphs;if(!o)return null;for(var i=0;i<o.length;i+=1)for(var n=o.get(i),r=0;r<n.unicodes.length;r+=1)if(n.unicodes[r]===t)return i},n.prototype.charToGlyphIndex=function(e){return this.cmap.glyphIndexMap[e.charCodeAt(0)]||0},r.prototype.charToGlyphIndex=function(e){var t=e.charCodeAt(0),o=this.encoding[t];return this.charset.indexOf(o)},s.prototype.nameToGlyphIndex=function(e){return this.names.indexOf(e)},s.prototype.glyphIndexToName=function(e){return this.names[e]},o.cffStandardStrings=l,o.cffStandardEncoding=h,o.cffExpertEncoding=p,o.standardNames=c,o.DefaultEncoding=i,o.CmapEncoding=n,o.CffEncoding=r,o.GlyphNames=s,o.addGlyphNames=a},{}],7:[function(e,t,o){"use strict";function i(e){e=e||{},this.names={fontFamily:{en:e.familyName||" "},fontSubfamily:{en:e.styleName||" "},designer:{en:e.designer||" "},designerURL:{en:e.designerURL||" "},manufacturer:{en:e.manufacturer||" "},manufacturerURL:{en:e.manufacturerURL||" "},license:{en:e.license||" "},licenseURL:{en:e.licenseURL||" "},version:{en:e.version||"Version 0.1"},description:{en:e.description||" "},copyright:{en:e.copyright||" "},trademark:{en:e.trademark||" "}},this.unitsPerEm=e.unitsPerEm||1e3,this.ascender=e.ascender,this.descender=e.descender,this.supported=!0,this.glyphs=new a.GlyphSet(this,e.glyphs||[]),this.encoding=new s.DefaultEncoding(this),this.tables={}}var n=e("./path"),r=e("./tables/sfnt"),s=e("./encoding"),a=e("./glyphset");i.prototype.hasChar=function(e){return null!==this.encoding.charToGlyphIndex(e)},i.prototype.charToGlyphIndex=function(e){return this.encoding.charToGlyphIndex(e)},i.prototype.charToGlyph=function(e){var t=this.charToGlyphIndex(e),o=this.glyphs.get(t);return o||(o=this.glyphs.get(0)),o},i.prototype.stringToGlyphs=function(e){for(var t=[],o=0;o<e.length;o+=1){var i=e[o];t.push(this.charToGlyph(i))}return t},i.prototype.nameToGlyphIndex=function(e){return this.glyphNames.nameToGlyphIndex(e)},i.prototype.nameToGlyph=function(e){var t=this.nametoGlyphIndex(e),o=this.glyphs.get(t);return o||(o=this.glyphs.get(0)),o},i.prototype.glyphIndexToName=function(e){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(e):""},i.prototype.getKerningValue=function(e,t){e=e.index||e,t=t.index||t;var o=this.getGposKerningValue;return o?o(e,t):this.kerningPairs[e+","+t]||0},i.prototype.forEachGlyph=function(e,t,o,i,n,r){t=void 0!==t?t:0,o=void 0!==o?o:0,i=void 0!==i?i:72,n=n||{};for(var s=void 0===n.kerning||n.kerning,a=1/this.unitsPerEm*i,l=this.stringToGlyphs(e),h=0;h<l.length;h+=1){var p=l[h];r(p,t,o,i,n),p.advanceWidth&&(t+=p.advanceWidth*a),s&&h<l.length-1&&(t+=this.getKerningValue(p,l[h+1])*a)}},i.prototype.getPath=function(e,t,o,i,r){var s=new n.Path;return this.forEachGlyph(e,t,o,i,r,function(e,t,o,i){var n=e.getPath(t,o,i);s.extend(n)}),s},i.prototype.draw=function(e,t,o,i,n,r){this.getPath(t,o,i,n,r).draw(e)},i.prototype.drawPoints=function(e,t,o,i,n,r){this.forEachGlyph(t,o,i,n,r,function(t,o,i,n){t.drawPoints(e,o,i,n)})},i.prototype.drawMetrics=function(e,t,o,i,n,r){this.forEachGlyph(t,o,i,n,r,function(t,o,i,n){t.drawMetrics(e,o,i,n)})},i.prototype.getEnglishName=function(e){var t=this.names[e];if(t)return t.en},i.prototype.validate=function(){function e(e,t){e||o.push(t)}function t(t){var o=i.getEnglishName(t);e(o&&o.trim().length>0,"No English "+t+" specified.")}var o=[],i=this;t("fontFamily"),t("weightName"),t("manufacturer"),t("copyright"),t("version"),e(this.unitsPerEm>0,"No unitsPerEm specified.")},i.prototype.toTables=function(){return r.fontToTable(this)},i.prototype.toBuffer=function(){for(var e=this.toTables(),t=e.encode(),o=new ArrayBuffer(t.length),i=new Uint8Array(o),n=0;n<t.length;n++)i[n]=t[n];return o},i.prototype.download=function(){var e=this.getEnglishName("fontFamily"),t=this.getEnglishName("fontSubfamily"),o=e.replace(/\s/g,"")+"-"+t+".otf",i=this.toBuffer();window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(window.TEMPORARY,i.byteLength,function(e){e.root.getFile(o,{create:!0},function(e){e.createWriter(function(t){var o=new DataView(i),n=new Blob([o],{type:"font/opentype"});t.write(n),t.addEventListener("writeend",function(){location.href=e.toURL()},!1)})})},function(e){throw e})},o.Font=i},{"./encoding":6,"./glyphset":9,"./path":12,"./tables/sfnt":29}],8:[function(e,t,o){"use strict";function i(e,t){var o=t||{commands:[]};return{configurable:!0,get:function(){return"function"==typeof o&&(o=o()),o},set:function(e){o=e}}}function n(e){this.bindConstructorValues(e)}var r=e("./check"),s=e("./draw"),a=e("./path");n.prototype.bindConstructorValues=function(e){this.index=e.index||0,this.name=e.name||null,this.unicode=e.unicode||void 0,this.unicodes=e.unicodes||void 0!==e.unicode?[e.unicode]:[],e.xMin&&(this.xMin=e.xMin),e.yMin&&(this.yMin=e.yMin),e.xMax&&(this.xMax=e.xMax),e.yMax&&(this.yMax=e.yMax),e.advanceWidth&&(this.advanceWidth=e.advanceWidth),Object.defineProperty(this,"path",i(this,e.path))},n.prototype.addUnicode=function(e){0===this.unicodes.length&&(this.unicode=e),this.unicodes.push(e)},n.prototype.getPath=function(e,t,o){e=void 0!==e?e:0,t=void 0!==t?t:0,o=void 0!==o?o:72;for(var i=1/this.path.unitsPerEm*o,n=new a.Path,r=this.path.commands,s=0;s<r.length;s+=1){var l=r[s];"M"===l.type?n.moveTo(e+l.x*i,t+-l.y*i):"L"===l.type?n.lineTo(e+l.x*i,t+-l.y*i):"Q"===l.type?n.quadraticCurveTo(e+l.x1*i,t+-l.y1*i,e+l.x*i,t+-l.y*i):"C"===l.type?n.curveTo(e+l.x1*i,t+-l.y1*i,e+l.x2*i,t+-l.y2*i,e+l.x*i,t+-l.y*i):"Z"===l.type&&n.closePath()}return n},n.prototype.getContours=function(){if(void 0===this.points)return[];for(var e=[],t=[],o=0;o<this.points.length;o+=1){var i=this.points[o];t.push(i),i.lastPointOfContour&&(e.push(t),t=[])}return r.argument(0===t.length,"There are still points left in the current contour."),e},n.prototype.getMetrics=function(){for(var e=this.path.commands,t=[],o=[],i=0;i<e.length;i+=1){var n=e[i];"Z"!==n.type&&(t.push(n.x),o.push(n.y)),"Q"!==n.type&&"C"!==n.type||(t.push(n.x1),o.push(n.y1)),"C"===n.type&&(t.push(n.x2),o.push(n.y2))}var r={xMin:Math.min.apply(null,t),yMin:Math.min.apply(null,o),xMax:Math.max.apply(null,t),yMax:Math.max.apply(null,o),leftSideBearing:0};return isFinite(r.xMin)||(r.xMin=0),isFinite(r.xMax)||(r.xMax=this.advanceWidth),isFinite(r.yMin)||(r.yMin=0),isFinite(r.yMax)||(r.yMax=0),r.rightSideBearing=this.advanceWidth-r.leftSideBearing-(r.xMax-r.xMin),r},n.prototype.draw=function(e,t,o,i){this.getPath(t,o,i).draw(e)},n.prototype.drawPoints=function(e,t,o,i){function n(t,o,i,n){var r=2*Math.PI;e.beginPath();for(var s=0;s<t.length;s+=1)e.moveTo(o+t[s].x*n,i+t[s].y*n),e.arc(o+t[s].x*n,i+t[s].y*n,2,0,r,!1);e.closePath(),e.fill()}t=void 0!==t?t:0,o=void 0!==o?o:0,i=void 0!==i?i:24;for(var r=1/this.path.unitsPerEm*i,s=[],a=[],l=this.path,h=0;h<l.commands.length;h+=1){var p=l.commands[h];void 0!==p.x&&s.push({x:p.x,y:-p.y}),void 0!==p.x1&&a.push({x:p.x1,y:-p.y1}),void 0!==p.x2&&a.push({x:p.x2,y:-p.y2})}e.fillStyle="blue",n(s,t,o,r),e.fillStyle="red",n(a,t,o,r)},n.prototype.drawMetrics=function(e,t,o,i){var n;t=void 0!==t?t:0,o=void 0!==o?o:0,i=void 0!==i?i:24,n=1/this.path.unitsPerEm*i,e.lineWidth=1,e.strokeStyle="black",s.line(e,t,-1e4,t,1e4),s.line(e,-1e4,o,1e4,o);var r=this.xMin||0,a=this.yMin||0,l=this.xMax||0,h=this.yMax||0,p=this.advanceWidth||0;e.strokeStyle="blue",s.line(e,t+r*n,-1e4,t+r*n,1e4),s.line(e,t+l*n,-1e4,t+l*n,1e4),s.line(e,-1e4,o+-a*n,1e4,o+-a*n),s.line(e,-1e4,o+-h*n,1e4,o+-h*n),e.strokeStyle="green",s.line(e,t+p*n,-1e4,t+p*n,1e4)},o.Glyph=n},{"./check":4,"./draw":5,"./path":12}],9:[function(e,t,o){"use strict";function i(e,t){if(this.font=e,this.glyphs={},Array.isArray(t))for(var o=0;o<t.length;o++)this.glyphs[o]=t[o];this.length=t&&t.length||0}function n(e,t){return new a.Glyph({index:t,font:e})}function r(e,t,o,i,n,r){return function(){var s=new a.Glyph({index:t,font:e});return s.path=function(){o(s,i,n);var t=r(e.glyphs,s);return t.unitsPerEm=e.unitsPerEm,t},s}}function s(e,t,o,i){return function(){var n=new a.Glyph({index:t,font:e});return n.path=function(){var t=o(e,n,i);return t.unitsPerEm=e.unitsPerEm,t},n}}var a=e("./glyph");i.prototype.get=function(e){return"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]()),this.glyphs[e]},i.prototype.push=function(e,t){this.glyphs[e]=t,this.length++},o.GlyphSet=i,o.glyphLoader=n,o.ttfGlyphLoader=r,o.cffGlyphLoader=s},{"./glyph":8}],10:[function(e,t,o){"use strict";function i(e){for(var t=new ArrayBuffer(e.length),o=new Uint8Array(t),i=0;i<e.length;i+=1)o[i]=e[i];return t}function n(t,o){e("fs").readFile(t,function(e,t){if(e)return o(e.message);o(null,i(t))})}function r(e,t){var o=new XMLHttpRequest;o.open("get",e,!0),o.responseType="arraybuffer",o.onload=function(){return 200!==o.status?t("Font could not be loaded: "+o.statusText):t(null,o.response)},o.send()}function s(e){var t,o,i,n,r,s,a,l,c,m,T=new p.Font,P=new DataView(e,0),R=u.getFixed(P,0);if(1===R)T.outlinesFormat="truetype";else{if("OTTO"!==(R=u.getTag(P,0)))throw new Error("Unsupported OpenType version "+R);T.outlinesFormat="cff"}for(var E=u.getUShort(P,4),I=12,D=0;D<E;D+=1){var L=u.getTag(P,I),F=u.getULong(P,I+8);switch(L){case"cmap":T.tables.cmap=d.parse(P,F),T.encoding=new h.CmapEncoding(T.tables.cmap);break;case"fvar":n=F;break;case"head":T.tables.head=v.parse(P,F),T.unitsPerEm=T.tables.head.unitsPerEm,t=T.tables.head.indexToLocFormat;break;case"hhea":T.tables.hhea=g.parse(P,F),T.ascender=T.tables.hhea.ascender,T.descender=T.tables.hhea.descender,T.numberOfHMetrics=T.tables.hhea.numberOfHMetrics;break;case"hmtx":a=F;break;case"ltag":o=A.parse(P,F);break;case"maxp":T.tables.maxp=w.parse(P,F),T.numGlyphs=T.tables.maxp.numGlyphs;break;case"name":m=F;break;case"OS/2":T.tables.os2=B.parse(P,F);break;case"post":T.tables.post=M.parse(P,F),T.glyphNames=new h.GlyphNames(T.tables.post);break;case"glyf":r=F;break;case"loca":c=F;break;case"CFF ":i=F;break;case"kern":l=F;break;case"GPOS":s=F}I+=16}if(T.tables.name=V.parse(P,m,o),T.names=T.tables.name,r&&c){var k=0===t,J=C.parse(P,c,T.numGlyphs,k);T.glyphs=f.parse(P,r,J,T)}else{if(!i)throw new Error("Font doesn't contain TrueType or CFF outlines.");y.parse(P,i,T)}return x.parse(P,a,T.numberOfHMetrics,T.numGlyphs,T.glyphs),h.addGlyphNames(T),T.kerningPairs=l?S.parse(P,l):{},s&&_.parse(P,s,T),n&&(T.tables.fvar=b.parse(P,n,T.names)),T}function a(e,t){("undefined"==typeof window?n:r)(e,function(e,o){return e?t(e):t(null,s(o))})}function l(t){return s(i(e("fs").readFileSync(t)))}var h=e("./encoding"),p=e("./font"),c=e("./glyph"),u=e("./parse"),m=e("./path"),d=e("./tables/cmap"),y=e("./tables/cff"),b=e("./tables/fvar"),f=e("./tables/glyf"),_=e("./tables/gpos"),v=e("./tables/head"),g=e("./tables/hhea"),x=e("./tables/hmtx"),S=e("./tables/kern"),A=e("./tables/ltag"),C=e("./tables/loca"),w=e("./tables/maxp"),V=e("./tables/name"),B=e("./tables/os2"),M=e("./tables/post");o._parse=u,o.Font=p.Font,o.Glyph=c.Glyph,o.Path=m.Path,o.parse=s,o.load=a,o.loadSync=l},{"./encoding":6,"./font":7,"./glyph":8,"./parse":11,"./path":12,"./tables/cff":14,"./tables/cmap":15,"./tables/fvar":16,"./tables/glyf":17,"./tables/gpos":18,"./tables/head":19,"./tables/hhea":20,"./tables/hmtx":21,"./tables/kern":22,"./tables/loca":23,"./tables/ltag":24,"./tables/maxp":25,"./tables/name":26,"./tables/os2":27,"./tables/post":28,fs:1}],11:[function(e,t,o){"use strict";function i(e,t){this.data=e,this.offset=t,this.relativeOffset=0}o.getByte=function(e,t){return e.getUint8(t)},o.getCard8=o.getByte,o.getUShort=function(e,t){return e.getUint16(t,!1)},o.getCard16=o.getUShort,o.getShort=function(e,t){return e.getInt16(t,!1)},o.getULong=function(e,t){return e.getUint32(t,!1)},o.getFixed=function(e,t){return e.getInt16(t,!1)+e.getUint16(t+2,!1)/65535},o.getTag=function(e,t){for(var o="",i=t;i<t+4;i+=1)o+=String.fromCharCode(e.getInt8(i));return o},o.getOffset=function(e,t,o){for(var i=0,n=0;n<o;n+=1)i<<=8,i+=e.getUint8(t+n);return i},o.getBytes=function(e,t,o){for(var i=[],n=t;n<o;n+=1)i.push(e.getUint8(n));return i},o.bytesToString=function(e){for(var t="",o=0;o<e.length;o+=1)t+=String.fromCharCode(e[o]);return t};var n={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};i.prototype.parseByte=function(){var e=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},i.prototype.parseChar=function(){var e=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},i.prototype.parseCard8=i.prototype.parseByte,i.prototype.parseUShort=function(){var e=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},i.prototype.parseCard16=i.prototype.parseUShort,i.prototype.parseSID=i.prototype.parseUShort,i.prototype.parseOffset16=i.prototype.parseUShort,i.prototype.parseShort=function(){var e=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},i.prototype.parseF2Dot14=function(){var e=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,e},i.prototype.parseULong=function(){var e=o.getULong(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},i.prototype.parseFixed=function(){var e=o.getFixed(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},i.prototype.parseOffset16List=i.prototype.parseUShortList=function(e){for(var t=new Array(e),i=this.data,n=this.offset+this.relativeOffset,r=0;r<e;r++)t[r]=o.getUShort(i,n),n+=2;return this.relativeOffset+=2*e,t},i.prototype.parseString=function(e){var t=this.data,o=this.offset+this.relativeOffset,i="";this.relativeOffset+=e;for(var n=0;n<e;n++)i+=String.fromCharCode(t.getUint8(o+n));return i},i.prototype.parseTag=function(){return this.parseString(4)},i.prototype.parseLongDateTime=function(){var e=o.getULong(this.data,this.offset+this.relativeOffset+4);return this.relativeOffset+=8,e},i.prototype.parseFixed=function(){var e=o.getULong(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e/65536},i.prototype.parseVersion=function(){var e=o.getUShort(this.data,this.offset+this.relativeOffset),t=o.getUShort(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,e+t/4096/10},i.prototype.skip=function(e,t){void 0===t&&(t=1),this.relativeOffset+=n[e]*t},o.Parser=i},{}],12:[function(e,t,o){"use strict";function i(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}i.prototype.moveTo=function(e,t){this.commands.push({type:"M",x:e,y:t})},i.prototype.lineTo=function(e,t){this.commands.push({type:"L",x:e,y:t})},i.prototype.curveTo=i.prototype.bezierCurveTo=function(e,t,o,i,n,r){this.commands.push({type:"C",x1:e,y1:t,x2:o,y2:i,x:n,y:r})},i.prototype.quadTo=i.prototype.quadraticCurveTo=function(e,t,o,i){this.commands.push({type:"Q",x1:e,y1:t,x:o,y:i})},i.prototype.close=i.prototype.closePath=function(){this.commands.push({type:"Z"})},i.prototype.extend=function(e){e.commands&&(e=e.commands),Array.prototype.push.apply(this.commands,e)},i.prototype.draw=function(e){e.beginPath();for(var t=0;t<this.commands.length;t+=1){var o=this.commands[t];"M"===o.type?e.moveTo(o.x,o.y):"L"===o.type?e.lineTo(o.x,o.y):"C"===o.type?e.bezierCurveTo(o.x1,o.y1,o.x2,o.y2,o.x,o.y):"Q"===o.type?e.quadraticCurveTo(o.x1,o.y1,o.x,o.y):"Z"===o.type&&e.closePath()}this.fill&&(e.fillStyle=this.fill,e.fill()),this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.strokeWidth,e.stroke())},i.prototype.toPathData=function(e){function t(t){return Math.round(t)===t?""+Math.round(t):t.toFixed(e)}function o(){for(var e="",o=0;o<arguments.length;o+=1){var i=arguments[o];i>=0&&o>0&&(e+=" "),e+=t(i)}return e}e=void 0!==e?e:2;for(var i="",n=0;n<this.commands.length;n+=1){var r=this.commands[n];"M"===r.type?i+="M"+o(r.x,r.y):"L"===r.type?i+="L"+o(r.x,r.y):"C"===r.type?i+="C"+o(r.x1,r.y1,r.x2,r.y2,r.x,r.y):"Q"===r.type?i+="Q"+o(r.x1,r.y1,r.x,r.y):"Z"===r.type&&(i+="Z")}return i},i.prototype.toSVG=function(e){var t='<path d="';return t+=this.toPathData(e),t+='"',this.fill&"black"!==this.fill&&(t+=null===this.fill?' fill="none"':' fill="'+this.fill+'"'),this.stroke&&(t+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),t+="/>"},o.Path=i},{}],13:[function(e,t,o){"use strict";function i(e,t,o){var i;for(i=0;i<t.length;i+=1){var n=t[i];this[n.name]=n.value}if(this.tableName=e,this.fields=t,o){var r=Object.keys(o);for(i=0;i<r.length;i+=1){var s=r[i],a=o[s];void 0!==this[s]&&(this[s]=a)}}}var n=e("./check"),r=e("./types").encode,s=e("./types").sizeOf;i.prototype.sizeOf=function(){for(var e=0,t=0;t<this.fields.length;t+=1){var o=this.fields[t],i=this[o.name];if(void 0===i&&(i=o.value),"function"==typeof i.sizeOf)e+=i.sizeOf();else{var r=s[o.type];n.assert("function"==typeof r,"Could not find sizeOf function for field"+o.name),e+=r(i)}}return e},i.prototype.encode=function(){return r.TABLE(this)},o.Table=i},{"./check":4,"./types":30}],14:[function(e,t,o){"use strict";function i(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var o=0;o<e.length;o+=1)if(!i(e[o],t[o]))return!1;return!0}return!1}function n(e,t,o){var i,n,r,s=[],a=[],l=L.getCard16(e,t);if(0!==l){var h=L.getByte(e,t+2);n=t+(l+1)*h+2;var p=t+3;for(i=0;i<l+1;i+=1)s.push(L.getOffset(e,p,h)),p+=h;r=n+s[l]}else r=t+2;for(i=0;i<s.length-1;i+=1){var c=L.getBytes(e,n+s[i],n+s[i+1]);o&&(c=o(c)),a.push(c)}return{objects:a,startOffset:t,endOffset:r}}function r(e){for(var t="",o=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var i=e.parseByte(),n=i>>4,r=15&i;if(15===n)break;if(t+=o[n],15===r)break;t+=o[r]}return parseFloat(t)}function s(e,t){var o,i,n,s;if(28===t)return o=e.parseByte(),i=e.parseByte(),o<<8|i;if(29===t)return o=e.parseByte(),i=e.parseByte(),n=e.parseByte(),s=e.parseByte(),o<<24|i<<16|n<<8|s;if(30===t)return r(e);if(t>=32&&t<=246)return t-139;if(t>=247&&t<=250)return o=e.parseByte(),256*(t-247)+o+108;if(t>=251&&t<=254)return o=e.parseByte(),256*-(t-251)-o-108;throw new Error("Invalid b0 "+t)}function a(e){for(var t={},o=0;o<e.length;o+=1){var i,n=e[o][0],r=e[o][1];if(i=1===r.length?r[0]:r,t.hasOwnProperty(n))throw new Error("Object "+t+" already has key "+n);t[n]=i}return t}function l(e,t,o){t=void 0!==t?t:0;var i=new L.Parser(e,t),n=[],r=[];for(o=void 0!==o?o:e.length;i.relativeOffset<o;){var l=i.parseByte();l<=21?(12===l&&(l=1200+i.parseByte()),n.push([l,r]),r=[]):r.push(s(i,l))}return a(n)}function h(e,t){return t=t<=390?I.cffStandardStrings[t]:e[t-391]}function p(e,t,o){for(var i={},n=0;n<t.length;n+=1){var r=t[n],s=e[r.op];void 0===s&&(s=void 0!==r.value?r.value:null),"SID"===r.type&&(s=h(o,s)),i[r.name]=s}return i}function c(e,t){var o={};return o.formatMajor=L.getCard8(e,t),o.formatMinor=L.getCard8(e,t+1),o.size=L.getCard8(e,t+2),o.offsetSize=L.getCard8(e,t+3),o.startOffset=t,o.endOffset=t+4,o}function u(e,t){return p(l(e,0,e.byteLength),J,t)}function m(e,t,o,i){return p(l(e,t,o),G,i)}function d(e,t,o,i){var n,r,s,a=new L.Parser(e,t);o-=1;var l=[".notdef"],p=a.parseCard8();if(0===p)for(n=0;n<o;n+=1)r=a.parseSID(),l.push(h(i,r));else if(1===p)for(;l.length<=o;)for(r=a.parseSID(),s=a.parseCard8(),n=0;n<=s;n+=1)l.push(h(i,r)),r+=1;else{if(2!==p)throw new Error("Unknown charset format "+p);for(;l.length<=o;)for(r=a.parseSID(),s=a.parseCard16(),n=0;n<=s;n+=1)l.push(h(i,r)),r+=1}return l}function y(e,t,o){var i,n,r={},s=new L.Parser(e,t),a=s.parseCard8();if(0===a){var l=s.parseCard8();for(i=0;i<l;i+=1)n=s.parseCard8(),r[n]=i}else{if(1!==a)throw new Error("Unknown encoding format "+a);var h=s.parseCard8();for(n=1,i=0;i<h;i+=1)for(var p=s.parseCard8(),c=s.parseCard8(),u=p;u<=p+c;u+=1)r[u]=n,n+=1}return new I.CffEncoding(r,o)}function b(e,t,o){function i(e,t){y&&p.closePath(),p.moveTo(e,t),y=!0}function n(){var t;t=c.length%2!=0,t&&!m&&(d=c.shift()+e.nominalWidthX),u+=c.length>>1,c.length=0,m=!0}function r(o){for(var _,v,g,x,S,A,C,w,V,B,M,T,P=0;P<o.length;){var R=o[P];switch(P+=1,R){case 1:case 3:n();break;case 4:c.length>1&&!m&&(d=c.shift()+e.nominalWidthX,m=!0),f+=c.pop(),i(b,f);break;case 5:for(;c.length>0;)b+=c.shift(),f+=c.shift(),p.lineTo(b,f);break;case 6:for(;c.length>0&&(b+=c.shift(),p.lineTo(b,f),0!==c.length);)f+=c.shift(),p.lineTo(b,f);break;case 7:for(;c.length>0&&(f+=c.shift(),p.lineTo(b,f),0!==c.length);)b+=c.shift(),p.lineTo(b,f);break;case 8:for(;c.length>0;)s=b+c.shift(),a=f+c.shift(),l=s+c.shift(),h=a+c.shift(),b=l+c.shift(),f=h+c.shift(),p.curveTo(s,a,l,h,b,f);break;case 10:S=c.pop()+e.subrsBias,(A=e.subrs[S])&&r(A);break;case 11:return;case 12:switch(R=o[P],P+=1,R){case 35:s=b+c.shift(),a=f+c.shift(),l=s+c.shift(),h=a+c.shift(),C=l+c.shift(),w=h+c.shift(),V=C+c.shift(),B=w+c.shift(),M=V+c.shift(),T=B+c.shift(),b=M+c.shift(),f=T+c.shift(),c.shift(),p.curveTo(s,a,l,h,C,w),p.curveTo(V,B,M,T,b,f);break;case 34:s=b+c.shift(),a=f,l=s+c.shift(),h=a+c.shift(),C=l+c.shift(),w=h,V=C+c.shift(),B=h,M=V+c.shift(),T=f,b=M+c.shift(),p.curveTo(s,a,l,h,C,w),p.curveTo(V,B,M,T,b,f);break;case 36:s=b+c.shift(),a=f+c.shift(),l=s+c.shift(),h=a+c.shift(),C=l+c.shift(),w=h,V=C+c.shift(),B=h,M=V+c.shift(),T=B+c.shift(),b=M+c.shift(),p.curveTo(s,a,l,h,C,w),p.curveTo(V,B,M,T,b,f);break;case 37:s=b+c.shift(),a=f+c.shift(),l=s+c.shift(),h=a+c.shift(),C=l+c.shift(),w=h+c.shift(),V=C+c.shift(),B=w+c.shift(),M=V+c.shift(),T=B+c.shift(),Math.abs(M-b)>Math.abs(T-f)?b=M+c.shift():f=T+c.shift(),p.curveTo(s,a,l,h,C,w),p.curveTo(V,B,M,T,b,f);break;default:console.log("Glyph "+t.index+": unknown operator 1200"+R),c.length=0}break;case 14:c.length>0&&!m&&(d=c.shift()+e.nominalWidthX,m=!0),y&&(p.closePath(),y=!1);break;case 18:n();break;case 19:case 20:n(),P+=u+7>>3;break;case 21:c.length>2&&!m&&(d=c.shift()+e.nominalWidthX,m=!0),f+=c.pop(),b+=c.pop(),i(b,f);break;case 22:c.length>1&&!m&&(d=c.shift()+e.nominalWidthX,m=!0),b+=c.pop(),i(b,f);break;case 23:n();break;case 24:for(;c.length>2;)s=b+c.shift(),a=f+c.shift(),l=s+c.shift(),h=a+c.shift(),b=l+c.shift(),f=h+c.shift(),p.curveTo(s,a,l,h,b,f);b+=c.shift(),f+=c.shift(),p.lineTo(b,f);break;case 25:for(;c.length>6;)b+=c.shift(),f+=c.shift(),p.lineTo(b,f);s=b+c.shift(),a=f+c.shift(),l=s+c.shift(),h=a+c.shift(),b=l+c.shift(),f=h+c.shift(),p.curveTo(s,a,l,h,b,f);break;case 26:for(c.length%2&&(b+=c.shift());c.length>0;)s=b,a=f+c.shift(),l=s+c.shift(),h=a+c.shift(),b=l,f=h+c.shift(),p.curveTo(s,a,l,h,b,f);break;case 27:for(c.length%2&&(f+=c.shift());c.length>0;)s=b+c.shift(),a=f,l=s+c.shift(),h=a+c.shift(),b=l+c.shift(),f=h,p.curveTo(s,a,l,h,b,f);break;case 28:_=o[P],v=o[P+1],c.push((_<<24|v<<16)>>16),P+=2;break;case 29:S=c.pop()+e.gsubrsBias,(A=e.gsubrs[S])&&r(A);break;case 30:for(;c.length>0&&(s=b,a=f+c.shift(),l=s+c.shift(),h=a+c.shift(),b=l+c.shift(),f=h+(1===c.length?c.shift():0),p.curveTo(s,a,l,h,b,f),0!==c.length);)s=b+c.shift(),a=f,l=s+c.shift(),h=a+c.shift(),f=h+c.shift(),b=l+(1===c.length?c.shift():0),p.curveTo(s,a,l,h,b,f);break;case 31:for(;c.length>0&&(s=b+c.shift(),a=f,l=s+c.shift(),h=a+c.shift(),f=h+c.shift(),b=l+(1===c.length?c.shift():0),p.curveTo(s,a,l,h,b,f),0!==c.length);)s=b,a=f+c.shift(),l=s+c.shift(),h=a+c.shift(),b=l+c.shift(),f=h+(1===c.length?c.shift():0),p.curveTo(s,a,l,h,b,f);break;default:R<32?console.log("Glyph "+t.index+": unknown operator "+R):R<247?c.push(R-139):R<251?(_=o[P],P+=1,c.push(256*(R-247)+_+108)):R<255?(_=o[P],P+=1,c.push(256*-(R-251)-_-108)):(_=o[P],v=o[P+1],g=o[P+2],x=o[P+3],P+=4,c.push((_<<24|v<<16|g<<8|x)/65536))}}}var s,a,l,h,p=new F.Path,c=[],u=0,m=!1,d=e.defaultWidthX,y=!1,b=0,f=0;return r(o),t.advanceWidth=d,p}function f(e){return e.length<1240?107:e.length<33900?1131:32768}function _(e,t,o){o.tables.cff={};var i=c(e,t),r=n(e,i.endOffset,L.bytesToString),s=n(e,r.endOffset),a=n(e,s.endOffset,L.bytesToString),l=n(e,a.endOffset);o.gsubrs=l.objects,o.gsubrsBias=f(o.gsubrs);var h=new DataView(new Uint8Array(s.objects[0]).buffer),p=u(h,a.objects);o.tables.cff.topDict=p;var _=t+p.private[1],v=m(e,_,p.private[0],a.objects);if(o.defaultWidthX=v.defaultWidthX,o.nominalWidthX=v.nominalWidthX,0!==v.subrs){var g=_+v.subrs,x=n(e,g);o.subrs=x.objects,o.subrsBias=f(o.subrs)}else o.subrs=[],o.subrsBias=0;var S=n(e,t+p.charStrings);o.nGlyphs=S.objects.length;var A=d(e,t+p.charset,o.nGlyphs,a.objects);0===p.encoding?o.cffEncoding=new I.CffEncoding(I.cffStandardEncoding,A):1===p.encoding?o.cffEncoding=new I.CffEncoding(I.cffExpertEncoding,A):o.cffEncoding=y(e,t+p.encoding,A),o.encoding=o.encoding||o.cffEncoding,o.glyphs=new D.GlyphSet(o);for(var C=0;C<o.nGlyphs;C+=1){var w=S.objects[C];o.glyphs.push(C,D.cffGlyphLoader(o,C,b,w))}}function v(e,t){var o,i=I.cffStandardStrings.indexOf(e);return i>=0&&(o=i),i=t.indexOf(e),i>=0?o=i+I.cffStandardStrings.length:(o=I.cffStandardStrings.length+t.length,t.push(e)),o}function g(){return new k.Table("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function x(e){var t=new k.Table("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var o=0;o<e.length;o+=1)t.names.push({name:"name_"+o,type:"NAME",value:e[o]});return t}function S(e,t,o){for(var n={},r=0;r<e.length;r+=1){var s=e[r],a=t[s.name];void 0===a||i(a,s.value)||("SID"===s.type&&(a=v(a,o)),n[s.op]={name:s.name,type:s.type,value:a})}return n}function A(e,t){var o=new k.Table("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return o.dict=S(J,e,t),o}function C(e){var t=new k.Table("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return t.topDicts=[{name:"topDict_0",type:"TABLE",value:e}],t}function w(e){var t=new k.Table("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var o=0;o<e.length;o+=1)t.strings.push({name:"string_"+o,type:"STRING",value:e[o]});return t}function V(){return new k.Table("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function B(e,t){for(var o=new k.Table("Charsets",[{name:"format",type:"Card8",value:0}]),i=0;i<e.length;i+=1){var n=e[i],r=v(n,t);o.fields.push({name:"glyph_"+i,type:"SID",value:r})}return o}function M(e){var t=[],o=e.path;t.push({name:"width",type:"NUMBER",value:e.advanceWidth});for(var i=0,n=0,r=0;r<o.commands.length;r+=1){var s,a,l=o.commands[r];if("Q"===l.type){var h=1/3,p=2/3;l={type:"C",x:l.x,y:l.y,x1:h*i+p*l.x1,y1:h*n+p*l.y1,x2:h*l.x+p*l.x1,y2:h*l.y+p*l.y1}}if("M"===l.type)s=Math.round(l.x-i),a=Math.round(l.y-n),t.push({name:"dx",type:"NUMBER",value:s}),t.push({name:"dy",type:"NUMBER",value:a}),t.push({name:"rmoveto",type:"OP",value:21}),i=Math.round(l.x),n=Math.round(l.y);else if("L"===l.type)s=Math.round(l.x-i),a=Math.round(l.y-n),t.push({name:"dx",type:"NUMBER",value:s}),t.push({name:"dy",type:"NUMBER",value:a}),t.push({name:"rlineto",type:"OP",value:5}),i=Math.round(l.x),n=Math.round(l.y);else if("C"===l.type){var c=Math.round(l.x1-i),u=Math.round(l.y1-n),m=Math.round(l.x2-l.x1),d=Math.round(l.y2-l.y1);s=Math.round(l.x-l.x2),a=Math.round(l.y-l.y2),t.push({name:"dx1",type:"NUMBER",value:c}),t.push({name:"dy1",type:"NUMBER",value:u}),t.push({name:"dx2",type:"NUMBER",value:m}),t.push({name:"dy2",type:"NUMBER",value:d}),t.push({name:"dx",type:"NUMBER",value:s}),t.push({name:"dy",type:"NUMBER",value:a}),t.push({name:"rrcurveto",type:"OP",value:8}),i=Math.round(l.x),n=Math.round(l.y)}}return t.push({name:"endchar",type:"OP",value:14}),t}function T(e){for(var t=new k.Table("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),o=0;o<e.length;o+=1){var i=e.get(o),n=M(i);t.charStrings.push({name:i.name,type:"CHARSTRING",value:n})}return t}function P(e,t){var o=new k.Table("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return o.dict=S(G,e,t),o}function R(e){var t=new k.Table("Private DICT INDEX",[{name:"privateDicts",type:"INDEX",value:[]}]);return t.privateDicts=[{name:"privateDict_0",type:"TABLE",value:e}],t}function E(e,t){for(var o,i=new k.Table("CFF ",[{name:"header",type:"TABLE"},{name:"nameIndex",type:"TABLE"},{name:"topDictIndex",type:"TABLE"},{name:"stringIndex",type:"TABLE"},{name:"globalSubrIndex",type:"TABLE"},{name:"charsets",type:"TABLE"},{name:"charStringsIndex",type:"TABLE"},{name:"privateDictIndex",type:"TABLE"}]),n=1/t.unitsPerEm,r={version:t.version,fullName:t.fullName,familyName:t.familyName,weight:t.weightName,fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},s={},a=[],l=1;l<e.length;l+=1)o=e.get(l),a.push(o.name);var h=[];i.header=g(),i.nameIndex=x([t.postScriptName]);var p=A(r,h);i.topDictIndex=C(p),i.globalSubrIndex=V(),i.charsets=B(a,h),i.charStringsIndex=T(e);var c=P(s,h);i.privateDictIndex=R(c),i.stringIndex=w(h);var u=i.header.sizeOf()+i.nameIndex.sizeOf()+i.topDictIndex.sizeOf()+i.stringIndex.sizeOf()+i.globalSubrIndex.sizeOf();return r.charset=u,r.encoding=0,r.charStrings=r.charset+i.charsets.sizeOf(),r.private[1]=r.charStrings+i.charStringsIndex.sizeOf(),p=A(r,h),i.topDictIndex=C(p),i}var I=e("../encoding"),D=e("../glyphset"),L=e("../parse"),F=e("../path"),k=e("../table"),J=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]}],G=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];o.parse=_,o.make=E},{"../encoding":6,"../glyphset":9,"../parse":11,"../path":12,"../table":13}],15:[function(e,t,o){"use strict";function i(e,t){var o,i={};i.version=l.getUShort(e,t),a.argument(0===i.version,"cmap table version should be 0."),i.numTables=l.getUShort(e,t+2);var n=-1;for(o=0;o<i.numTables;o+=1){var r=l.getUShort(e,t+4+8*o),s=l.getUShort(e,t+4+8*o+2);if(3===r&&(1===s||0===s)){n=l.getULong(e,t+4+8*o+4);break}}if(-1===n)return null;var h=new l.Parser(e,t+n);i.format=h.parseUShort(),a.argument(4===i.format,"Only format 4 cmap tables are supported."),i.length=h.parseUShort(),i.language=h.parseUShort();var p;i.segCount=p=h.parseUShort()>>1,h.skip("uShort",3),i.glyphIndexMap={};var c=new l.Parser(e,t+n+14),u=new l.Parser(e,t+n+16+2*p),m=new l.Parser(e,t+n+16+4*p),d=new l.Parser(e,t+n+16+6*p),y=t+n+16+8*p;for(o=0;o<p-1;o+=1)for(var b,f=c.parseUShort(),_=u.parseUShort(),v=m.parseShort(),g=d.parseUShort(),x=_;x<=f;x+=1)0!==g?(y=d.offset+d.relativeOffset-2,y+=g,y+=2*(x-_),0!==(b=l.getUShort(e,y))&&(b=b+v&65535)):b=x+v&65535,i.glyphIndexMap[x]=b;return i}function n(e,t,o){e.segments.push({end:t,start:t,delta:-(t-o),offset:0})}function r(e){e.segments.push({end:65535,start:65535,delta:1,offset:0})}function s(e){var t,o=new h.Table("cmap",[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:1},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:12},{name:"format",type:"USHORT",value:4},{name:"length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);for(o.segments=[],t=0;t<e.length;t+=1){for(var i=e.get(t),s=0;s<i.unicodes.length;s+=1)n(o,i.unicodes[s],t);o.segments=o.segments.sort(function(e,t){return e.start-t.start})}r(o);var a;a=o.segments.length,o.segCountX2=2*a,o.searchRange=2*Math.pow(2,Math.floor(Math.log(a)/Math.log(2))),o.entrySelector=Math.log(o.searchRange/2)/Math.log(2),o.rangeShift=o.segCountX2-o.searchRange;var l=[],p=[],c=[],u=[],m=[];for(t=0;t<a;t+=1){var d=o.segments[t];l=l.concat({name:"end_"+t,type:"USHORT",value:d.end}),p=p.concat({name:"start_"+t,type:"USHORT",value:d.start}),c=c.concat({name:"idDelta_"+t,type:"SHORT",value:d.delta}),u=u.concat({name:"idRangeOffset_"+t,type:"USHORT",value:d.offset}),void 0!==d.glyphId&&(m=m.concat({name:"glyph_"+t,type:"USHORT",value:d.glyphId}))}return o.fields=o.fields.concat(l),o.fields.push({name:"reservedPad",type:"USHORT",value:0}),o.fields=o.fields.concat(p),o.fields=o.fields.concat(c),o.fields=o.fields.concat(u),o.fields=o.fields.concat(m),o.length=14+2*l.length+2+2*p.length+2*c.length+2*u.length+2*m.length,o}var a=e("../check"),l=e("../parse"),h=e("../table");o.parse=i,o.make=s},{"../check":4,"../parse":11,"../table":13}],16:[function(e,t,o){"use strict";function i(e,t){var o=JSON.stringify(e),i=256;for(var n in t){var r=parseInt(n);if(r&&!(r<256)){if(JSON.stringify(t[n])===o)return r;i<=r&&(i=r+1)}}return t[i]=e,i}function n(e,t){var o=i(e.name,t);return new u.Table("fvarAxis",[{name:"tag",type:"TAG",value:e.tag},{name:"minValue",type:"FIXED",value:e.minValue<<16},{name:"defaultValue",type:"FIXED",value:e.defaultValue<<16},{name:"maxValue",type:"FIXED",value:e.maxValue<<16},{name:"flags",type:"USHORT",value:0},{name:"nameID",type:"USHORT",value:o}])}function r(e,t,o){var i={},n=new c.Parser(e,t);return i.tag=n.parseTag(),i.minValue=n.parseFixed(),i.defaultValue=n.parseFixed(),i.maxValue=n.parseFixed(),n.skip("uShort",1),i.name=o[n.parseUShort()]||{},i}function s(e,t,o){for(var n=i(e.name,o),r=[{name:"nameID",type:"USHORT",value:n},{name:"flags",type:"USHORT",value:0}],s=0;s<t.length;++s){var a=t[s].tag;r.push({name:"axis "+a,type:"FIXED",value:e.coordinates[a]<<16})}return new u.Table("fvarInstance",r)}function a(e,t,o,i){var n={},r=new c.Parser(e,t);n.name=i[r.parseUShort()]||{},r.skip("uShort",1),n.coordinates={};for(var s=0;s<o.length;++s)n.coordinates[o[s].tag]=r.parseFixed();return n}function l(e,t){var o=new u.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:e.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:e.instances.length},{name:"instanceSize",type:"USHORT",value:4+4*e.axes.length}]);o.offsetToData=o.sizeOf();for(var i=0;i<e.axes.length;i++)o.fields.push({name:"axis "+i,type:"TABLE",value:n(e.axes[i],t)});for(var r=0;r<e.instances.length;r++)o.fields.push({name:"instance "+r,type:"TABLE",value:s(e.instances[r],e.axes,t)});return o}function h(e,t,o){var i=new c.Parser(e,t),n=i.parseULong();p.argument(65536===n,"Unsupported fvar table version.");var s=i.parseOffset16();i.skip("uShort",1);for(var l=i.parseUShort(),h=i.parseUShort(),u=i.parseUShort(),m=i.parseUShort(),d=[],y=0;y<l;y++)d.push(r(e,t+s+y*h,o));for(var b=[],f=t+s+l*h,_=0;_<u;_++)b.push(a(e,f+_*m,d,o));return{axes:d,instances:b}}var p=e("../check"),c=e("../parse"),u=e("../table");o.make=l,o.parse=h},{"../check":4,"../parse":11,"../table":13}],17:[function(e,t,o){"use strict";function i(e,t,o,i,n){var r;return(t&i)>0?(r=e.parseByte(),0==(t&n)&&(r=-r),r=o+r):r=(t&n)>0?o:o+e.parseShort(),r}function n(e,t,o){var n=new u.Parser(t,o);e.numberOfContours=n.parseShort(),e.xMin=n.parseShort(),e.yMin=n.parseShort(),e.xMax=n.parseShort(),e.yMax=n.parseShort();var r,s;if(e.numberOfContours>0){var a,l=e.endPointIndices=[];for(a=0;a<e.numberOfContours;a+=1)l.push(n.parseUShort());for(e.instructionLength=n.parseUShort(),e.instructions=[],a=0;a<e.instructionLength;a+=1)e.instructions.push(n.parseByte());var h=l[l.length-1]+1;for(r=[],a=0;a<h;a+=1)if(s=n.parseByte(),r.push(s),(8&s)>0)for(var c=n.parseByte(),m=0;m<c;m+=1)r.push(s),a+=1;if(p.argument(r.length===h,"Bad flags."),l.length>0){var d,y=[];if(h>0){for(a=0;a<h;a+=1)s=r[a],d={},d.onCurve=!!(1&s),d.lastPointOfContour=l.indexOf(a)>=0,y.push(d);var b=0;for(a=0;a<h;a+=1)s=r[a],d=y[a],d.x=i(n,s,b,2,16),b=d.x;var f=0;for(a=0;a<h;a+=1)s=r[a],d=y[a],d.y=i(n,s,f,4,32),f=d.y}e.points=y}else e.points=[]}else if(0===e.numberOfContours)e.points=[];else{e.isComposite=!0,e.points=[],e.components=[];for(var _=!0;_;){r=n.parseUShort();var v={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(1&r)>0?(v.dx=n.parseShort(),v.dy=n.parseShort()):(v.dx=n.parseChar(),v.dy=n.parseChar()),(8&r)>0?v.xScale=v.yScale=n.parseF2Dot14():(64&r)>0?(v.xScale=n.parseF2Dot14(),v.yScale=n.parseF2Dot14()):(128&r)>0&&(v.xScale=n.parseF2Dot14(),v.scale01=n.parseF2Dot14(),v.scale10=n.parseF2Dot14(),v.yScale=n.parseF2Dot14()),e.components.push(v),_=!!(32&r)}}}function r(e,t){for(var o=[],i=0;i<e.length;i+=1){var n=e[i],r={x:t.xScale*n.x+t.scale01*n.y+t.dx,y:t.scale10*n.x+t.yScale*n.y+t.dy,onCurve:n.onCurve,lastPointOfContour:n.lastPointOfContour};o.push(r)}return o}function s(e){for(var t=[],o=[],i=0;i<e.length;i+=1){var n=e[i];o.push(n),n.lastPointOfContour&&(t.push(o),o=[])}return p.argument(0===o.length,"There are still points left in the current contour."),t}function a(e){var t=new m.Path;if(!e)return t;for(var o=s(e),i=0;i<o.length;i+=1){var n,r,a=o[i],l=a[0],h=a[a.length-1];l.onCurve?(n=null,r=!0):(l=h.onCurve?h:{x:(l.x+h.x)/2,y:(l.y+h.y)/2},n=l,r=!1),t.moveTo(l.x,l.y);for(var p=r?1:0;p<a.length;p+=1){var c=a[p],u=0===p?l:a[p-1];if(u.onCurve&&c.onCurve)t.lineTo(c.x,c.y);else if(u.onCurve&&!c.onCurve)n=c;else if(u.onCurve||c.onCurve){if(u.onCurve||!c.onCurve)throw new Error("Invalid state.");t.quadraticCurveTo(n.x,n.y,c.x,c.y),n=null}else{var d={x:(u.x+c.x)/2,y:(u.y+c.y)/2};t.quadraticCurveTo(u.x,u.y,d.x,d.y),n=c}}l!==h&&(n?t.quadraticCurveTo(n.x,n.y,l.x,l.y):t.lineTo(l.x,l.y))}return t.closePath(),t}function l(e,t){if(t.isComposite)for(var o=0;o<t.components.length;o+=1){var i=t.components[o],n=e.get(i.glyphIndex);if(n.getPath(),n.points){var s=r(n.points,i);t.points=t.points.concat(s)}}return a(t.points)}function h(e,t,o,i){var r,s=new c.GlyphSet(i);for(r=0;r<o.length-1;r+=1){var a=o[r];a!==o[r+1]?s.push(r,c.ttfGlyphLoader(i,r,n,e,t+a,l)):s.push(r,c.glyphLoader(i,r))}return s}var p=e("../check"),c=e("../glyphset"),u=e("../parse"),m=e("../path");o.parse=h},{"../check":4,"../glyphset":9,"../parse":11,"../path":12}],18:[function(e,t,o){"use strict";function i(e,t){for(var o=new p.Parser(e,t),i=o.parseUShort(),n=[],r=0;r<i;r++)n[o.parseTag()]={offset:o.parseUShort()};return n}function n(e,t){var o=new p.Parser(e,t),i=o.parseUShort(),n=o.parseUShort();if(1===i)return o.parseUShortList(n);if(2===i){for(var r=[];n--;)for(var s=o.parseUShort(),a=o.parseUShort(),l=o.parseUShort(),h=s;h<=a;h++)r[l++]=h;return r}}function r(e,t){var o=new p.Parser(e,t),i=o.parseUShort();if(1===i){var n=o.parseUShort(),r=o.parseUShort(),s=o.parseUShortList(r);return function(e){return s[e-n]||0}}if(2===i){for(var a=o.parseUShort(),l=[],h=[],c=[],u=0;u<a;u++)l[u]=o.parseUShort(),h[u]=o.parseUShort(),c[u]=o.parseUShort();return function(e){for(var t=0,o=l.length-1;t<o;){var i=t+o+1>>1;e<l[i]?o=i-1:t=i}return l[t]<=e&&e<=h[t]?c[t]||0:0}}}function s(e,t){var o,i=new p.Parser(e,t),s=i.parseUShort(),a=i.parseUShort(),l=n(e,t+a),h=i.parseUShort(),c=i.parseUShort();if(4===h&&0===c){var u={};if(1===s){for(var m=i.parseUShort(),d=[],y=i.parseOffset16List(m),b=0;b<m;b++){var f=y[b],_=u[f];if(!_){_={},i.relativeOffset=f;for(var v=i.parseUShort();v--;){var g=i.parseUShort();h&&(o=i.parseShort()),c&&i.parseShort(),_[g]=o}}d[l[b]]=_}return function(e,t){var o=d[e];if(o)return o[t]}}if(2===s){for(var x=i.parseUShort(),S=i.parseUShort(),A=i.parseUShort(),C=i.parseUShort(),w=r(e,t+x),V=r(e,t+S),B=[],M=0;M<A;M++)for(var T=B[M]=[],P=0;P<C;P++)h&&(o=i.parseShort()),c&&i.parseShort(),T[P]=o;var R={};for(M=0;M<l.length;M++)R[l[M]]=1;return function(e,t){if(R[e]){var o=w(e),i=V(t),n=B[o];return n?n[i]:void 0}}}}}function a(e,t){var o=new p.Parser(e,t),i=o.parseUShort(),n=o.parseUShort(),r=16&n,a=o.parseUShort(),l=o.parseOffset16List(a),h={lookupType:i,lookupFlag:n,markFilteringSet:r?o.parseUShort():-1};if(2===i){for(var c=[],u=0;u<a;u++)c.push(s(e,t+l[u]));h.getKerningValue=function(e,t){for(var o=c.length;o--;){var i=c[o](e,t);if(void 0!==i)return i}return 0}}return h}function l(e,t,o){var n=new p.Parser(e,t),r=n.parseFixed();h.argument(1===r,"Unsupported GPOS table version."),i(e,t+n.parseUShort()),i(e,t+n.parseUShort());var s=n.parseUShort();n.relativeOffset=s;for(var l=n.parseUShort(),c=n.parseOffset16List(l),u=t+s,m=0;m<l;m++){var d=a(e,u+c[m]);2!==d.lookupType||o.getGposKerningValue||(o.getGposKerningValue=d.getKerningValue)}}var h=e("../check"),p=e("../parse");o.parse=l},{"../check":4,"../parse":11}],19:[function(e,t,o){"use strict";function i(e,t){var o={},i=new s.Parser(e,t);return o.version=i.parseVersion(),o.fontRevision=Math.round(1e3*i.parseFixed())/1e3,o.checkSumAdjustment=i.parseULong(),o.magicNumber=i.parseULong(),r.argument(1594834165===o.magicNumber,"Font header has wrong magic number."),o.flags=i.parseUShort(),o.unitsPerEm=i.parseUShort(),o.created=i.parseLongDateTime(),o.modified=i.parseLongDateTime(),o.xMin=i.parseShort(),o.yMin=i.parseShort(),o.xMax=i.parseShort(),o.yMax=i.parseShort(),o.macStyle=i.parseUShort(),o.lowestRecPPEM=i.parseUShort(),o.fontDirectionHint=i.parseShort(),o.indexToLocFormat=i.parseShort(),o.glyphDataFormat=i.parseShort(),o}function n(e){return new a.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:0},{name:"modified",type:"LONGDATETIME",value:0},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],e)}var r=e("../check"),s=e("../parse"),a=e("../table");o.parse=i,o.make=n},{"../check":4,"../parse":11,"../table":13}],20:[function(e,t,o){"use strict";function i(e,t){var o={},i=new r.Parser(e,t);return o.version=i.parseVersion(),o.ascender=i.parseShort(),o.descender=i.parseShort(),o.lineGap=i.parseShort(),o.advanceWidthMax=i.parseUShort(),o.minLeftSideBearing=i.parseShort(),o.minRightSideBearing=i.parseShort(),o.xMaxExtent=i.parseShort(),o.caretSlopeRise=i.parseShort(),o.caretSlopeRun=i.parseShort(),o.caretOffset=i.parseShort(),i.relativeOffset+=8,o.metricDataFormat=i.parseShort(),o.numberOfHMetrics=i.parseUShort(),o}function n(e){return new s.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],e)}var r=e("../parse"),s=e("../table");o.parse=i,o.make=n},{"../parse":11,"../table":13}],21:[function(e,t,o){"use strict";function i(e,t,o,i,n){for(var s,a,l=new r.Parser(e,t),h=0;h<i;h+=1){h<o&&(s=l.parseUShort(),a=l.parseShort());var p=n.get(h);p.advanceWidth=s,p.leftSideBearing=a}}function n(e){for(var t=new s.Table("hmtx",[]),o=0;o<e.length;o+=1){var i=e.get(o),n=i.advanceWidth||0,r=i.leftSideBearing||0;t.fields.push({name:"advanceWidth_"+o,type:"USHORT",value:n}),t.fields.push({name:"leftSideBearing_"+o,type:"SHORT",value:r})}return t}var r=e("../parse"),s=e("../table");o.parse=i,o.make=n},{"../parse":11,"../table":13}],22:[function(e,t,o){"use strict";function i(e,t){var o={},i=new r.Parser(e,t),s=i.parseUShort();n.argument(0===s,"Unsupported kern table version."),i.skip("uShort",1);var a=i.parseUShort();n.argument(0===a,"Unsupported kern sub-table version."),i.skip("uShort",2);var l=i.parseUShort();i.skip("uShort",3);for(var h=0;h<l;h+=1){var p=i.parseUShort(),c=i.parseUShort(),u=i.parseShort();o[p+","+c]=u}return o}var n=e("../check"),r=e("../parse");o.parse=i},{"../check":4,"../parse":11}],23:[function(e,t,o){"use strict";function i(e,t,o,i){for(var r=new n.Parser(e,t),s=i?r.parseUShort:r.parseULong,a=[],l=0;l<o+1;l+=1){var h=s.call(r);i&&(h*=2),a.push(h)}return a}var n=e("../parse");o.parse=i},{"../parse":11}],24:[function(e,t,o){"use strict";function i(e){for(var t=new a.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:e.length}]),o="",i=12+4*e.length,n=0;n<e.length;++n){var r=o.indexOf(e[n]);r<0&&(r=o.length,o+=e[n]),t.fields.push({name:"offset "+n,type:"USHORT",value:i+r}),t.fields.push({name:"length "+n,type:"USHORT",value:e[n].length})}return t.fields.push({name:"stringPool",type:"CHARARRAY",value:o}),t}function n(e,t){var o=new s.Parser(e,t),i=o.parseULong();r.argument(1===i,"Unsupported ltag table version."),o.skip("uLong",1);for(var n=o.parseULong(),a=[],l=0;l<n;l++){for(var h="",p=t+o.parseUShort(),c=o.parseUShort(),u=p;u<p+c;++u)h+=String.fromCharCode(e.getInt8(u));a.push(h)}return a}var r=e("../check"),s=e("../parse"),a=e("../table");o.make=i,o.parse=n},{"../check":4,"../parse":11,"../table":13}],25:[function(e,t,o){"use strict";function i(e,t){var o={},i=new r.Parser(e,t);return o.version=i.parseVersion(),o.numGlyphs=i.parseUShort(),1===o.version&&(o.maxPoints=i.parseUShort(),o.maxContours=i.parseUShort(),o.maxCompositePoints=i.parseUShort(),o.maxCompositeContours=i.parseUShort(),o.maxZones=i.parseUShort(),o.maxTwilightPoints=i.parseUShort(),o.maxStorage=i.parseUShort(),o.maxFunctionDefs=i.parseUShort(),o.maxInstructionDefs=i.parseUShort(),o.maxStackElements=i.parseUShort(),o.maxSizeOfInstructions=i.parseUShort(),o.maxComponentElements=i.parseUShort(),o.maxComponentDepth=i.parseUShort()),o}function n(e){return new s.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:e}])}var r=e("../parse"),s=e("../table");o.parse=i,o.make=n},{"../parse":11,"../table":13}],26:[function(e,t,o){"use strict";function i(e,t,o){switch(e){case 0:if(65535===t)return"und";if(o)return o[t];break;case 1:return f[t];case 3:return v[t]}}function n(e,t,o){switch(e){case 0:return g;case 1:return S[o]||x[t];case 3:if(1===t||10===t)return g}}function r(e,t,o){for(var r={},s=new d.Parser(e,t),a=s.parseUShort(),l=s.parseUShort(),h=s.offset+s.parseUShort(),p=0;p<l;p++){var c=s.parseUShort(),m=s.parseUShort(),y=s.parseUShort(),f=s.parseUShort(),_=b[f]||f,v=s.parseUShort(),x=s.parseUShort(),S=i(c,y,o),A=n(c,m,y);if(void 0!==A&&void 0!==S){var C;if(C=A===g?u.UTF16(e,h+x,v):u.MACSTRING(e,h+x,v,A)){var w=r[_];void 0===w&&(w=r[_]={}),w[S]=C}}}return 1===a&&s.parseUShort(),r}function s(e){var t={};for(var o in e)t[e[o]]=parseInt(o);return t}function a(e,t,o,i,n,r){return new y.Table("NameRecord",[{name:"platformID",type:"USHORT",value:e},{name:"encodingID",type:"USHORT",value:t},{name:"languageID",type:"USHORT",value:o},{name:"nameID",type:"USHORT",value:i},{name:"length",type:"USHORT",value:n},{name:"offset",type:"USHORT",value:r}])}function l(e,t){var o=e.length,i=t.length-o+1;e:for(var n=0;n<i;n++)for(;n<i;n++){for(var r=0;r<o;r++)if(t[n+r]!==e[r])continue e;return n}return-1}function h(e,t){var o=l(e,t);if(o<0){o=t.length;for(var i=0,n=e.length;i<n;++i)t.push(e[i])}return o}function p(e,t){var o,i=[],r={},l=s(b);for(var p in e){var c=l[p];void 0===c&&(c=p),o=parseInt(c),r[o]=e[p],i.push(o)}for(var u=s(f),d=s(v),g=[],x=[],S=0;S<i.length;S++){o=i[S];var A=r[o];for(var C in A){var w=A[C],V=1,B=u[C],M=_[B],T=n(V,M,B),P=m.MACSTRING(w,T);void 0===P&&(V=0,B=t.indexOf(C),B<0&&(B=t.length,t.push(C)),M=4,P=m.UTF16(w));var R=h(P,x);g.push(a(V,M,B,o,P.length,R));var E=d[C];if(void 0!==E){var I=m.UTF16(w),D=h(I,x);g.push(a(3,1,E,o,I.length,D))}}}g.sort(function(e,t){return e.platformID-t.platformID||e.encodingID-t.encodingID||e.languageID-t.languageID||e.nameID-t.nameID});for(var L=new y.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:g.length},{name:"stringOffset",type:"USHORT",value:6+12*g.length}]),F=0;F<g.length;F++)L.fields.push({name:"record_"+F,type:"TABLE",value:g[F]});return L.fields.push({name:"strings",type:"LITERAL",value:x}),L}var c=e("../types"),u=c.decode,m=c.encode,d=e("../parse"),y=e("../table"),b=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","licence","licenceURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],f={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},_={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},v={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"},g="utf-16",x={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},S={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};o.parse=r,o.make=p},{"../parse":11,"../table":13,"../types":30}],27:[function(e,t,o){"use strict";function i(e){for(var t=0;t<l.length;t+=1){var o=l[t];if(e>=o.begin&&e<o.end)return t}return-1}function n(e,t){var o={},i=new s.Parser(e,t);o.version=i.parseUShort(),o.xAvgCharWidth=i.parseShort(),o.usWeightClass=i.parseUShort(),o.usWidthClass=i.parseUShort(),o.fsType=i.parseUShort(),o.ySubscriptXSize=i.parseShort(),o.ySubscriptYSize=i.parseShort(),o.ySubscriptXOffset=i.parseShort(),o.ySubscriptYOffset=i.parseShort(),o.ySuperscriptXSize=i.parseShort(),o.ySuperscriptYSize=i.parseShort(),o.ySuperscriptXOffset=i.parseShort(),o.ySuperscriptYOffset=i.parseShort(),o.yStrikeoutSize=i.parseShort(),o.yStrikeoutPosition=i.parseShort(),o.sFamilyClass=i.parseShort(),o.panose=[];for(var n=0;n<10;n++)o.panose[n]=i.parseByte();return o.ulUnicodeRange1=i.parseULong(),o.ulUnicodeRange2=i.parseULong(),o.ulUnicodeRange3=i.parseULong(),o.ulUnicodeRange4=i.parseULong(),o.achVendID=String.fromCharCode(i.parseByte(),i.parseByte(),i.parseByte(),i.parseByte()),o.fsSelection=i.parseUShort(),o.usFirstCharIndex=i.parseUShort(),o.usLastCharIndex=i.parseUShort(),o.sTypoAscender=i.parseShort(),o.sTypoDescender=i.parseShort(),o.sTypoLineGap=i.parseShort(),o.usWinAscent=i.parseUShort(),o.usWinDescent=i.parseUShort(),o.version>=1&&(o.ulCodePageRange1=i.parseULong(),o.ulCodePageRange2=i.parseULong()),o.version>=2&&(o.sxHeight=i.parseShort(),o.sCapHeight=i.parseShort(),o.usDefaultChar=i.parseUShort(),o.usBreakChar=i.parseUShort(),o.usMaxContent=i.parseUShort()),o}function r(e){return new a.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],e)}var s=e("../parse"),a=e("../table"),l=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];o.unicodeRanges=l,o.getUnicodeRange=i,o.parse=n,o.make=r},{"../parse":11,"../table":13}],28:[function(e,t,o){"use strict";function i(e,t){var o,i={},n=new s.Parser(e,t);switch(i.version=n.parseVersion(),i.italicAngle=n.parseFixed(),i.underlinePosition=n.parseShort(),i.underlineThickness=n.parseShort(),i.isFixedPitch=n.parseULong(),i.minMemType42=n.parseULong(),i.maxMemType42=n.parseULong(),i.minMemType1=n.parseULong(),i.maxMemType1=n.parseULong(),i.version){case 1:i.names=r.standardNames.slice();break;case 2:for(i.numberOfGlyphs=n.parseUShort(),i.glyphNameIndex=new Array(i.numberOfGlyphs),o=0;o<i.numberOfGlyphs;o++)i.glyphNameIndex[o]=n.parseUShort();for(i.names=[],o=0;o<i.numberOfGlyphs;o++)if(i.glyphNameIndex[o]>=r.standardNames.length){var a=n.parseChar();i.names.push(n.parseString(a))}break;case 2.5:for(i.numberOfGlyphs=n.parseUShort(),i.offset=new Array(i.numberOfGlyphs),o=0;o<i.numberOfGlyphs;o++)i.offset[o]=n.parseChar()}return i}function n(){return new a.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var r=e("../encoding"),s=e("../parse"),a=e("../table");o.parse=i,o.make=n},{"../encoding":6,"../parse":11,"../table":13}],29:[function(e,t,o){"use strict";function i(e){return Math.log(e)/Math.log(2)|0}function n(e){for(;e.length%4!=0;)e.push(0);for(var t=0,o=0;o<e.length;o+=4)t+=(e[o]<<24)+(e[o+1]<<16)+(e[o+2]<<8)+e[o+3];return t%=Math.pow(2,32)}function r(e,t,o,i){return new c.Table("Table Record",[{name:"tag",type:"TAG",value:void 0!==e?e:""},{name:"checkSum",type:"ULONG",value:void 0!==t?t:0},{name:"offset",type:"ULONG",value:void 0!==o?o:0},{name:"length",type:"ULONG",value:void 0!==i?i:0}])}function s(e){var t=new c.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);t.tables=e,t.numTables=e.length;var o=Math.pow(2,i(t.numTables));t.searchRange=16*o,t.entrySelector=i(o),t.rangeShift=16*t.numTables-t.searchRange;for(var s=[],a=[],l=t.sizeOf()+r().sizeOf()*t.numTables;l%4!=0;)l+=1,a.push({name:"padding",type:"BYTE",value:0});for(var h=0;h<e.length;h+=1){var u=e[h];p.argument(4===u.tableName.length,"Table name"+u.tableName+" is invalid.");var m=u.sizeOf(),d=r(u.tableName,n(u.encode()),l,m);for(s.push({name:d.tag+" Table Record",type:"TABLE",value:d}),a.push({name:u.tableName+" table",type:"TABLE",value:u}),l+=m,p.argument(!isNaN(l),"Something went wrong calculating the offset.");l%4!=0;)l+=1,a.push({name:"padding",type:"BYTE",value:0})}return s.sort(function(e,t){return e.value.tag>t.value.tag?1:-1}),t.fields=t.fields.concat(s),t.fields=t.fields.concat(a),t}function a(e,t,o){for(var i=0;i<t.length;i+=1){var n=e.charToGlyphIndex(t[i]);if(n>0)return e.glyphs.get(n).getMetrics()}return o}function l(e){for(var t=0,o=0;o<e.length;o+=1)t+=e[o];return t/e.length}function h(e){for(var t,o=[],i=[],r=[],h=[],p=[],c=[],S=[],A=0,C=0,w=0,V=0,B=0,M=0;M<e.glyphs.length;M+=1){var T=e.glyphs.get(M),P=0|T.unicode;(t>P||null===t)&&(t=P),A<P&&(A=P);var R=g.getUnicodeRange(P);if(R<32)C|=1<<R;else if(R<64)w|=1<<R-32;else if(R<96)V|=1<<R-64;else{if(!(R<123))throw new Error("Unicode ranges bits > 123 are reserved for internal usage");B|=1<<R-96}if(".notdef"!==T.name){var E=T.getMetrics();o.push(E.xMin),i.push(E.yMin),r.push(E.xMax),h.push(E.yMax),c.push(E.leftSideBearing),S.push(E.rightSideBearing),p.push(T.advanceWidth)}}var I={xMin:Math.min.apply(null,o),yMin:Math.min.apply(null,i),xMax:Math.max.apply(null,r),yMax:Math.max.apply(null,h),advanceWidthMax:Math.max.apply(null,p),advanceWidthAvg:l(p),minLeftSideBearing:Math.min.apply(null,c),maxLeftSideBearing:Math.max.apply(null,c),minRightSideBearing:Math.min.apply(null,S)};I.ascender=void 0!==e.ascender?e.ascender:I.yMax,I.descender=void 0!==e.descender?e.descender:I.yMin;var D=d.make({unitsPerEm:e.unitsPerEm,xMin:I.xMin,yMin:I.yMin,xMax:I.xMax,yMax:I.yMax}),L=y.make({ascender:I.ascender,descender:I.descender,advanceWidthMax:I.advanceWidthMax,minLeftSideBearing:I.minLeftSideBearing,minRightSideBearing:I.minRightSideBearing,xMaxExtent:I.maxLeftSideBearing+(I.xMax-I.xMin),numberOfHMetrics:e.glyphs.length}),F=_.make(e.glyphs.length),k=g.make({xAvgCharWidth:Math.round(I.advanceWidthAvg),usWeightClass:500,usWidthClass:5,usFirstCharIndex:t,usLastCharIndex:A,ulUnicodeRange1:C,ulUnicodeRange2:w,ulUnicodeRange3:V,ulUnicodeRange4:B,sTypoAscender:I.ascender,sTypoDescender:I.descender,sTypoLineGap:0,usWinAscent:I.ascender,usWinDescent:-I.descender,sxHeight:a(e,"xyvw",{yMax:0}).yMax,sCapHeight:a(e,"HIKLEFJMNTZBDPRAGOQSUVWXY",I).yMax,usBreakChar:e.hasChar(" ")?32:0}),J=b.make(e.glyphs),G=u.make(e.glyphs),O=e.getEnglishName("fontFamily"),N=e.getEnglishName("fontSubfamily"),W=O+" "+N,U=e.getEnglishName("postScriptName");U||(U=O.replace(/\s/g,"")+"-"+N);var z={};for(var q in e.names)z[q]=e.names[q];z.uniqueID||(z.uniqueID={en:e.getEnglishName("manufacturer")+":"+W}),z.postScriptName||(z.postScriptName={en:U}),z.preferredFamily||(z.preferredFamily=e.names.fontFamily),z.preferredSubfamily||(z.preferredSubfamily=e.names.fontSubfamily);var j=[],H=v.make(z,j),X=j.length>0?f.make(j):void 0,Y=x.make(),Z=m.make(e.glyphs,{version:e.getEnglishName("version"),fullName:W,familyName:O,weightName:N,postScriptName:U,unitsPerEm:e.unitsPerEm}),K=[D,L,F,k,H,G,Y,Z,J];X&&K.push(X);var Q=s(K),$=Q.encode(),ee=n($),te=Q.fields,oe=!1;for(M=0;M<te.length;M+=1)if("head table"===te[M].name){te[M].value.checkSumAdjustment=2981146554-ee,oe=!0;break}if(!oe)throw new Error("Could not find head table with checkSum to adjust.");return Q}var p=e("../check"),c=e("../table"),u=e("./cmap"),m=e("./cff"),d=e("./head"),y=e("./hhea"),b=e("./hmtx"),f=e("./ltag"),_=e("./maxp"),v=e("./name"),g=e("./os2"),x=e("./post");o.computeCheckSum=n,o.make=s,o.fontToTable=h},{"../check":4,"../table":13,"./cff":14,"./cmap":15,"./head":19,"./hhea":20,"./hmtx":21,"./ltag":24,"./maxp":25,"./name":26,"./os2":27,"./post":28}],30:[function(e,t,o){"use strict";function i(e){return function(){return e}}var n=e("./check"),r=2147483648,s={},a={},l={};a.BYTE=function(e){return n.argument(e>=0&&e<=255,"Byte value should be between 0 and 255."),[e]},l.BYTE=i(1),a.CHAR=function(e){return[e.charCodeAt(0)]},l.CHAR=i(1),a.CHARARRAY=function(e){for(var t=[],o=0;o<e.length;o+=1)t.push(e.charCodeAt(o));return t},l.CHARARRAY=function(e){return e.length},a.USHORT=function(e){return[e>>8&255,255&e]},l.USHORT=i(2),a.SHORT=function(e){return e>=32768&&(e=-(65536-e)),[e>>8&255,255&e]},l.SHORT=i(2),a.UINT24=function(e){return[e>>16&255,e>>8&255,255&e]},l.UINT24=i(3),a.ULONG=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]},l.ULONG=i(4),a.LONG=function(e){return e>=r&&(e=-(2*r-e)),[e>>24&255,e>>16&255,e>>8&255,255&e]},l.LONG=i(4),a.FIXED=a.ULONG,l.FIXED=l.ULONG,a.FWORD=a.SHORT,l.FWORD=l.SHORT,a.UFWORD=a.USHORT,l.UFWORD=l.USHORT,a.LONGDATETIME=function(){return[0,0,0,0,0,0,0,0]},l.LONGDATETIME=i(8),a.TAG=function(e){return n.argument(4===e.length,"Tag should be exactly 4 ASCII characters."),[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]},l.TAG=i(4),a.Card8=a.BYTE,l.Card8=l.BYTE,a.Card16=a.USHORT,l.Card16=l.USHORT,a.OffSize=a.BYTE,l.OffSize=l.BYTE,a.SID=a.USHORT,l.SID=l.USHORT,a.NUMBER=function(e){return e>=-107&&e<=107?[e+139]:e>=108&&e<=1131?(e-=108,[247+(e>>8),255&e]):e>=-1131&&e<=-108?(e=-e-108,[251+(e>>8),255&e]):e>=-32768&&e<=32767?a.NUMBER16(e):a.NUMBER32(e)},l.NUMBER=function(e){return a.NUMBER(e).length},a.NUMBER16=function(e){return[28,e>>8&255,255&e]},l.NUMBER16=i(3),a.NUMBER32=function(e){return[29,e>>24&255,e>>16&255,e>>8&255,255&e]},l.NUMBER32=i(5),a.REAL=function(e){var t=e.toString(),o=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(t);if(o){var i=parseFloat("1e"+((o[2]?+o[2]:0)+o[1].length));t=(Math.round(e*i)/i).toString()}var n,r,s="";for(n=0,r=t.length;n<r;n+=1){var a=t[n];s+="e"===a?"-"===t[++n]?"c":"b":"."===a?"a":"-"===a?"e":a}s+=1&s.length?"f":"ff";var l=[30];for(n=0,r=s.length;n<r;n+=2)l.push(parseInt(s.substr(n,2),16));return l},l.REAL=function(e){return a.REAL(e).length},a.NAME=a.CHARARRAY,l.NAME=l.CHARARRAY,a.STRING=a.CHARARRAY,l.STRING=l.CHARARRAY,s.UTF16=function(e,t,o){for(var i=[],n=o/2,r=0;r<n;r++,t+=2)i[r]=e.getUint16(t);return String.fromCharCode.apply(null,i)},a.UTF16=function(e){for(var t=[],o=0;o<e.length;o+=1){var i=e.charCodeAt(o);t.push(i>>8&255),t.push(255&i)}return t},l.UTF16=function(e){return 2*e.length};var h={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};s.MACSTRING=function(e,t,o,i){var n=h[i];if(void 0!==n){for(var r="",s=0;s<o;s++){var a=e.getUint8(t+s);r+=a<=127?String.fromCharCode(a):n[127&a]}return r}};var p,c="function"==typeof WeakMap&&new WeakMap,u=function(e){if(!p){p={};for(var t in h)p[t]=new String(t)}var o=p[e];if(void 0!==o){if(c){var i=c.get(o);if(void 0!==i)return i}var n=h[e];if(void 0!==n){for(var r={},s=0;s<n.length;s++)r[n.charCodeAt(s)]=s+128;return c&&c.set(o,r),r}}};a.MACSTRING=function(e,t){var o=u(t);if(void 0!==o){for(var i=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r>=128&&void 0===(r=o[r]))return;i.push(r)}return i}},l.MACSTRING=function(e,t){var o=a.MACSTRING(e,t);return void 0!==o?o.length:0},a.INDEX=function(e){var t,o=1,i=[o],n=[],r=0;for(t=0;t<e.length;t+=1){var s=a.OBJECT(e[t]);Array.prototype.push.apply(n,s),r+=s.length,o+=s.length,i.push(o)}if(0===n.length)return[0,0];var l=[],h=1+Math.floor(Math.log(r)/Math.log(2))/8|0,p=[void 0,a.BYTE,a.USHORT,a.UINT24,a.ULONG][h];for(t=0;t<i.length;t+=1){var c=p(i[t]);Array.prototype.push.apply(l,c)}return Array.prototype.concat(a.Card16(e.length),a.OffSize(h),l,n)},l.INDEX=function(e){return a.INDEX(e).length},a.DICT=function(e){for(var t=[],o=Object.keys(e),i=o.length,n=0;n<i;n+=1){var r=parseInt(o[n],0),s=e[r];t=t.concat(a.OPERAND(s.value,s.type)),t=t.concat(a.OPERATOR(r))}return t},l.DICT=function(e){return a.DICT(e).length},a.OPERATOR=function(e){return e<1200?[e]:[12,e-1200]},a.OPERAND=function(e,t){var o=[];if(Array.isArray(t))for(var i=0;i<t.length;i+=1)n.argument(e.length===t.length,"Not enough arguments given for type"+t),o=o.concat(a.OPERAND(e[i],t[i]));else if("SID"===t)o=o.concat(a.NUMBER(e));else if("offset"===t)o=o.concat(a.NUMBER32(e));else if("number"===t)o=o.concat(a.NUMBER(e));else{if("real"!==t)throw new Error("Unknown operand type "+t);o=o.concat(a.REAL(e))}return o},a.OP=a.BYTE,l.OP=l.BYTE;var m="function"==typeof WeakMap&&new WeakMap;a.CHARSTRING=function(e){if(m){var t=m.get(e);if(void 0!==t)return t}for(var o=[],i=e.length,n=0;n<i;n+=1){var r=e[n];o=o.concat(a[r.type](r.value))}return m&&m.set(e,o),o},l.CHARSTRING=function(e){return a.CHARSTRING(e).length},a.OBJECT=function(e){var t=a[e.type];return n.argument(void 0!==t,"No encoding function for type "+e.type),t(e.value)},l.OBJECT=function(e){var t=l[e.type];return n.argument(void 0!==t,"No sizeOf function for type "+e.type),t(e.value)},a.TABLE=function(e){for(var t=[],o=e.fields.length,i=0;i<o;i+=1){var r=e.fields[i],s=a[r.type];n.argument(void 0!==s,"No encoding function for field type "+r.type);var l=e[r.name];void 0===l&&(l=r.value);var h=s(l);t=t.concat(h)}return t},l.TABLE=function(e){for(var t=0,o=e.fields.length,i=0;i<o;i+=1){var r=e.fields[i],s=l[r.type];n.argument(void 0!==s,"No sizeOf function for field type "+r.type);var a=e[r.name];void 0===a&&(a=r.value),t+=s(a)}return t},a.LITERAL=function(e){return e},l.LITERAL=function(e){return e.length},o.decode=s,o.encode=a,o.sizeOf=l},{"./check":4}],31:[function(e,t,o){function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function r(e){if(c===setTimeout)return setTimeout(e,0);if((c===i||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function s(e){if(u===clearTimeout)return clearTimeout(e);if((u===n||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{return u(e)}catch(t){try{return u.call(null,e)}catch(t){return u.call(this,e)}}}function a(){b&&d&&(b=!1,d.length?y=d.concat(y):f=-1,y.length&&l())}function l(){if(!b){var e=r(a);b=!0;for(var t=y.length;t;){for(d=y,y=[];++f<t;)d&&d[f].run();f=-1,t=y.length}d=null,b=!1,s(e)}}function h(e,t){this.fun=e,this.array=t}function p(){}var c,u,m=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:i}catch(e){c=i}try{u="function"==typeof clearTimeout?clearTimeout:n}catch(e){u=n}}();var d,y=[],b=!1,f=-1;m.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];y.push(new h(e,t)),1!==y.length||b||r(l)},h.prototype.run=function(){this.fun.apply(null,this.array)},m.title="browser",m.browser=!0,m.env={},m.argv=[],m.version="",m.versions={},m.on=p,m.addListener=p,m.once=p,m.off=p,m.removeListener=p,m.removeAllListeners=p,m.emit=p,m.binding=function(e){throw new Error("process.binding is not supported")},m.cwd=function(){return"/"},m.chdir=function(e){throw new Error("process.chdir is not supported")},m.umask=function(){return 0}},{}],32:[function(e,t,o){!function(e){"use strict";function t(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function o(e){return"string"!=typeof e&&(e=String(e)),e}function i(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return f.iterable&&(t[Symbol.iterator]=function(){return t}),t}function n(e){this.map={},e instanceof n?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function r(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function s(e){return new Promise(function(t,o){e.onload=function(){t(e.result)},e.onerror=function(){o(e.error)}})}function a(e){var t=new FileReader,o=s(t);return t.readAsArrayBuffer(e),o}function l(e){var t=new FileReader,o=s(t);return t.readAsText(e),o}function h(e){for(var t=new Uint8Array(e),o=new Array(t.length),i=0;i<t.length;i++)o[i]=String.fromCharCode(t[i]);return o.join("")}function p(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function c(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(f.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(f.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(f.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(f.arrayBuffer&&f.blob&&v(e))this._bodyArrayBuffer=p(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!f.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!g(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=p(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):f.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},f.blob&&(this.blob=function(){var e=r(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?r(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var e=r(this);if(e)return e;if(this._bodyBlob)return l(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(h(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},f.formData&&(this.formData=function(){return this.text().then(d)}),this.json=function(){return this.text().then(JSON.parse)},this}function u(e){var t=e.toUpperCase();return x.indexOf(t)>-1?t:e}function m(e,t){t=t||{};var o=t.body;if(e instanceof m){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new n(e.headers)),this.method=e.method,this.mode=e.mode,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new n(t.headers)),this.method=u(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function d(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var o=e.split("="),i=o.shift().replace(/\+/g," "),n=o.join("=").replace(/\+/g," ");t.append(decodeURIComponent(i),decodeURIComponent(n))}}),t}function y(e){var t=new n;return e.split(/\r?\n/).forEach(function(e){var o=e.split(":"),i=o.shift().trim();if(i){var n=o.join(":").trim();t.append(i,n)}}),t}function b(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new n(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var f={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(f.arrayBuffer)var _=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],v=function(e){return e&&DataView.prototype.isPrototypeOf(e)},g=ArrayBuffer.isView||function(e){return e&&_.indexOf(Object.prototype.toString.call(e))>-1};n.prototype.append=function(e,i){e=t(e),i=o(i);var n=this.map[e];this.map[e]=n?n+","+i:i},n.prototype.delete=function(e){delete this.map[t(e)]},n.prototype.get=function(e){return e=t(e),this.has(e)?this.map[e]:null},n.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},n.prototype.set=function(e,i){this.map[t(e)]=o(i)},n.prototype.forEach=function(e,t){for(var o in this.map)this.map.hasOwnProperty(o)&&e.call(t,this.map[o],o,this)},n.prototype.keys=function(){var e=[];return this.forEach(function(t,o){e.push(o)}),i(e)},n.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),i(e)},n.prototype.entries=function(){var e=[];return this.forEach(function(t,o){e.push([o,t])}),i(e)},f.iterable&&(n.prototype[Symbol.iterator]=n.prototype.entries);var x=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];m.prototype.clone=function(){return new m(this,{body:this._bodyInit})},c.call(m.prototype),c.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new n(this.headers),url:this.url})},b.error=function(){var e=new b(null,{status:0,statusText:""});return e.type="error",e};var S=[301,302,303,307,308];b.redirect=function(e,t){if(-1===S.indexOf(t))throw new RangeError("Invalid status code");return new b(null,{status:t,headers:{location:e}})},e.Headers=n,e.Request=m,e.Response=b,e.fetch=function(e,t){return new Promise(function(o,i){var n=new m(e,t),r=new XMLHttpRequest;r.onload=function(){var e={status:r.status,statusText:r.statusText,headers:y(r.getAllResponseHeaders()||"")};e.url="responseURL"in r?r.responseURL:e.headers.get("X-Request-URL"),o(new b("response"in r?r.response:r.responseText,e))},r.onerror=function(){i(new TypeError("Network request failed"))},r.ontimeout=function(){i(new TypeError("Network request failed"))},r.open(n.method,n.url,!0),"include"===n.credentials&&(r.withCredentials=!0),"responseType"in r&&f.blob&&(r.responseType="blob"),n.headers.forEach(function(e,t){r.setRequestHeader(t,e)}),r.send(void 0===n._bodyInit?null:n._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)},{}],33:[function(e,t,o){"use strict";var i=e("./core/core");e("./color/p5.Color"),e("./core/p5.Element"),e("./typography/p5.Font"),e("./core/p5.Graphics"),e("./core/p5.Renderer2D"),e("./image/p5.Image"),e("./math/p5.Vector"),e("./io/p5.TableRow"),e("./io/p5.Table"),e("./io/p5.XML"),e("./color/creating_reading"),e("./color/setting"),e("./core/constants"),e("./utilities/conversion"),e("./utilities/array_functions"),e("./utilities/string_functions"),e("./core/environment"),e("./image/image"),e("./image/loading_displaying"),e("./image/pixels"),e("./io/files"),e("./events/keyboard"),e("./events/acceleration"),e("./events/mouse"),e("./utilities/time_date"),e("./events/touch"),e("./math/math"),e("./math/calculation"),e("./math/random"),e("./math/noise"),e("./math/trigonometry"),e("./core/rendering"),e("./core/2d_primitives"),e("./core/attributes"),e("./core/curves"),e("./core/vertex"),e("./core/structure"),e("./core/transform"),e("./typography/attributes"),e("./typography/loading_displaying"),e("./webgl/p5.RendererGL"),e("./webgl/p5.Geometry"),e("./webgl/p5.RendererGL.Retained"),e("./webgl/p5.RendererGL.Immediate"),e("./webgl/primitives"),e("./webgl/loading"),e("./webgl/p5.Matrix"),e("./webgl/material"),e("./webgl/light"),e("./webgl/shader"),e("./webgl/camera"),e("./webgl/interaction");var n=function(){window.PHANTOMJS||window.mocha||(window.setup&&"function"==typeof window.setup||window.draw&&"function"==typeof window.draw)&&!i.instance&&new i};"complete"===document.readyState?n():window.addEventListener("load",n,!1),t.exports=i},{"./color/creating_reading":35,"./color/p5.Color":36,"./color/setting":37,"./core/2d_primitives":38,"./core/attributes":39,"./core/constants":41,"./core/core":42,"./core/curves":43,"./core/environment":44,"./core/p5.Element":46,"./core/p5.Graphics":47,"./core/p5.Renderer2D":49,"./core/rendering":50,"./core/structure":52,"./core/transform":53,"./core/vertex":54,"./events/acceleration":55,"./events/keyboard":56,"./events/mouse":57,"./events/touch":58,"./image/image":60,"./image/loading_displaying":61,"./image/p5.Image":62,"./image/pixels":63,"./io/files":64,"./io/p5.Table":65,"./io/p5.TableRow":66,"./io/p5.XML":67,"./math/calculation":68,"./math/math":69,"./math/noise":70,"./math/p5.Vector":71,"./math/random":73,"./math/trigonometry":74,"./typography/attributes":75,"./typography/loading_displaying":76,"./typography/p5.Font":77,"./utilities/array_functions":78,"./utilities/conversion":79,"./utilities/string_functions":80,"./utilities/time_date":81,"./webgl/camera":82,"./webgl/interaction":83,"./webgl/light":84,"./webgl/loading":85,"./webgl/material":86,"./webgl/p5.Geometry":87,"./webgl/p5.Matrix":88,"./webgl/p5.RendererGL":91,"./webgl/p5.RendererGL.Immediate":89,"./webgl/p5.RendererGL.Retained":90,"./webgl/primitives":92,"./webgl/shader":93}],34:[function(e,t,o){"use strict";var i=e("../core/core");i.ColorConversion={},i.ColorConversion._hsbaToHSLA=function(e){var t=e[0],o=e[1],i=e[2],n=(2-o)*i/2;return 0!==n&&(1===n?o=0:n<.5?o/=2-o:o=o*i/(2-2*n)),[t,o,n,e[3]]},i.ColorConversion._hsbaToRGBA=function(e){var t=6*e[0],o=e[1],i=e[2],n=[];if(0===o)n=[i,i,i,e[3]];else{var r,s,a,l=Math.floor(t),h=i*(1-o),p=i*(1-o*(t-l)),c=i*(1-o*(1+l-t));1===l?(r=p,s=i,a=h):2===l?(r=h,s=i,a=c):3===l?(r=h,s=p,a=i):4===l?(r=c,s=h,a=i):5===l?(r=i,s=h,a=p):(r=i,s=c,a=h),n=[r,s,a,e[3]]}return n},i.ColorConversion._hslaToHSBA=function(e){var t,o=e[0],i=e[1],n=e[2];return t=n<.5?(1+i)*n:n+i-n*i,i=2*(t-n)/t,[o,i,t,e[3]]},i.ColorConversion._hslaToRGBA=function(e){var t=6*e[0],o=e[1],i=e[2],n=[];if(0===o)n=[i,i,i,e[3]];else{var r;r=i<.5?(1+o)*i:i+o-i*o;var s=2*i-r,a=function(e,t,o){return e<0?e+=6:e>=6&&(e-=6),e<1?t+(o-t)*e:e<3?o:e<4?t+(o-t)*(4-e):t};n=[a(t+2,s,r),a(t,s,r),a(t-2,s,r),e[3]]}return n},i.ColorConversion._rgbaToHSBA=function(e){var t,o,i=e[0],n=e[1],r=e[2],s=Math.max(i,n,r),a=s-Math.min(i,n,r);return 0===a?(t=0,o=0):(o=a/s,i===s?t=(n-r)/a:n===s?t=2+(r-i)/a:r===s&&(t=4+(i-n)/a),t<0?t+=6:t>=6&&(t-=6)),[t/6,o,s,e[3]]},i.ColorConversion._rgbaToHSLA=function(e){var t,o,i=e[0],n=e[1],r=e[2],s=Math.max(i,n,r),a=Math.min(i,n,r),l=s+a,h=s-a;return 0===h?(t=0,o=0):(o=l<1?h/l:h/(2-l),i===s?t=(n-r)/h:n===s?t=2+(r-i)/h:r===s&&(t=4+(i-n)/h),t<0?t+=6:t>=6&&(t-=6)),[t/6,o,l/2,e[3]]},t.exports=i.ColorConversion},{"../core/core":42}],35:[function(e,t,o){"use strict";var i=e("../core/core"),n=e("../core/constants");e("./p5.Color"),i.prototype.alpha=function(e){if(e instanceof i.Color||e instanceof Array)return this.color(e)._getAlpha();throw new Error("Needs p5.Color or pixel array as argument.")},i.prototype.blue=function(e){if(e instanceof i.Color||e instanceof Array)return this.color(e)._getBlue();throw new Error("Needs p5.Color or pixel array as argument.")},i.prototype.brightness=function(e){if(e instanceof i.Color||e instanceof Array)return this.color(e)._getBrightness();throw new Error("Needs p5.Color or pixel array as argument.")},i.prototype.color=function(){return arguments[0]instanceof i.Color?arguments[0]:arguments[0]instanceof Array?this instanceof i.Renderer?new i.Color(this,arguments[0]):new i.Color(this._renderer,arguments[0]):this instanceof i.Renderer?new i.Color(this,arguments):new i.Color(this._renderer,arguments)},i.prototype.green=function(e){if(e instanceof i.Color||e instanceof Array)return this.color(e)._getGreen();throw new Error("Needs p5.Color or pixel array as argument.")},i.prototype.hue=function(e){if(e instanceof i.Color||e instanceof Array)return this.color(e)._getHue();throw new Error("Needs p5.Color or pixel array as argument.")},i.prototype.lerpColor=function(e,t,o){var i,r,s,a,l,h,p=this._renderer._colorMode,c=this._renderer._colorMaxes;if(p===n.RGB)l=e.levels.map(function(e){return e/255}),h=t.levels.map(function(e){return e/255});else if(p===n.HSB)e._getBrightness(),t._getBrightness(),l=e.hsba,h=t.hsba;else{if(p!==n.HSL)throw new Error(p+"cannot be used for interpolation.");e._getLightness(),t._getLightness(),l=e.hsla,h=t.hsla}return o=Math.max(Math.min(o,1),0),i=this.lerp(l[0],h[0],o),r=this.lerp(l[1],h[1],o),s=this.lerp(l[2],h[2],o),a=this.lerp(l[3],h[3],o),i*=c[p][0],r*=c[p][1],s*=c[p][2],a*=c[p][3],this.color(i,r,s,a)},i.prototype.lightness=function(e){if(e instanceof i.Color||e instanceof Array)return this.color(e)._getLightness();throw new Error("Needs p5.Color or pixel array as argument.")},i.prototype.red=function(e){if(e instanceof i.Color||e instanceof Array)return this.color(e)._getRed();throw new Error("Needs p5.Color or pixel array as argument.")},i.prototype.saturation=function(e){if(e instanceof i.Color||e instanceof Array)return this.color(e)._getSaturation();throw new Error("Needs p5.Color or pixel array as argument.")},t.exports=i},{"../core/constants":41,"../core/core":42,"./p5.Color":36}],36:[function(e,t,o){var i=e("../core/core"),n=e("../core/constants"),r=e("./color_conversion");i.Color=function(e,t){if(this.mode=e._colorMode,this.maxes=e._colorMaxes,this.mode!==n.RGB&&this.mode!==n.HSL&&this.mode!==n.HSB)throw new Error(this.mode+" is an invalid colorMode.");return this._array=i.Color._parseInputs.apply(e,t),this.levels=this._array.map(function(e){return Math.round(255*e)}),this},i.Color.prototype.toString=function(){var e=this.levels,t=this._array[3];return"rgba("+e[0]+","+e[1]+","+e[2]+","+t+")"},i.Color.prototype._getAlpha=function(){return this._array[3]*this.maxes[this.mode][3]},i.Color.prototype._getBlue=function(){return this._array[2]*this.maxes[n.RGB][2]},i.Color.prototype._getBrightness=function(){return this.hsba||(this.hsba=r._rgbaToHSBA(this._array)),this.hsba[2]*this.maxes[n.HSB][2]},i.Color.prototype._getGreen=function(){return this._array[1]*this.maxes[n.RGB][1]},i.Color.prototype._getHue=function(){return this.mode===n.HSB?(this.hsba||(this.hsba=r._rgbaToHSBA(this._array)),this.hsba[0]*this.maxes[n.HSB][0]):(this.hsla||(this.hsla=r._rgbaToHSLA(this._array)),this.hsla[0]*this.maxes[n.HSL][0])},i.Color.prototype._getLightness=function(){return this.hsla||(this.hsla=r._rgbaToHSLA(this._array)),this.hsla[2]*this.maxes[n.HSL][2]},i.Color.prototype._getRed=function(){return this._array[0]*this.maxes[n.RGB][0]},i.Color.prototype._getSaturation=function(){return this.mode===n.HSB?(this.hsba||(this.hsba=r._rgbaToHSBA(this._array)),this.hsba[1]*this.maxes[n.HSB][1]):(this.hsla||(this.hsla=r._rgbaToHSLA(this._array)),this.hsla[1]*this.maxes[n.HSL][1])};var s={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},a=/\s*/,l=/(\d{1,3})/,h=/((?:\d+(?:\.\d+)?)|(?:\.\d+))/,p=new RegExp(h.source+"%"),c={HEX3:/^#([a-f0-9])([a-f0-9])([a-f0-9])$/i,HEX6:/^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i,RGB:new RegExp(["^rgb\\(",l.source,",",l.source,",",l.source,"\\)$"].join(a.source),"i"),RGB_PERCENT:new RegExp(["^rgb\\(",p.source,",",p.source,",",p.source,"\\)$"].join(a.source),"i"),RGBA:new RegExp(["^rgba\\(",l.source,",",l.source,",",l.source,",",h.source,"\\)$"].join(a.source),"i"),RGBA_PERCENT:new RegExp(["^rgba\\(",p.source,",",p.source,",",p.source,",",h.source,"\\)$"].join(a.source),"i"),HSL:new RegExp(["^hsl\\(",l.source,",",p.source,",",p.source,"\\)$"].join(a.source),"i"),HSLA:new RegExp(["^hsla\\(",l.source,",",p.source,",",p.source,",",h.source,"\\)$"].join(a.source),"i"),HSB:new RegExp(["^hsb\\(",l.source,",",p.source,",",p.source,"\\)$"].join(a.source),"i"),HSBA:new RegExp(["^hsba\\(",l.source,",",p.source,",",p.source,",",h.source,"\\)$"].join(a.source),"i")};i.Color._parseInputs=function(){var e=arguments.length,t=this._colorMode,o=this._colorMaxes,a=[];if(e>=3)return a[0]=arguments[0]/o[t][0],a[1]=arguments[1]/o[t][1],a[2]=arguments[2]/o[t][2],"number"==typeof arguments[3]?a[3]=arguments[3]/o[t][3]:a[3]=1,a=a.map(function(e){return Math.max(Math.min(e,1),0)}),t===n.HSL?r._hslaToRGBA(a):t===n.HSB?r._hsbaToRGBA(a):a;if(1===e&&"string"==typeof arguments[0]){var l=arguments[0].trim().toLowerCase();if(s[l])return i.Color._parseInputs.apply(this,[s[l]]);if(c.HEX3.test(l))return a=c.HEX3.exec(l).slice(1).map(function(e){return parseInt(e+e,16)/255}),a[3]=1,a;if(c.HEX6.test(l))return a=c.HEX6.exec(l).slice(1).map(function(e){return parseInt(e,16)/255}),a[3]=1,a;if(c.RGB.test(l))return a=c.RGB.exec(l).slice(1).map(function(e){return e/255}),a[3]=1,a;if(c.RGB_PERCENT.test(l))return a=c.RGB_PERCENT.exec(l).slice(1).map(function(e){return parseFloat(e)/100}),a[3]=1,a;if(c.RGBA.test(l))return a=c.RGBA.exec(l).slice(1).map(function(e,t){return 3===t?parseFloat(e):e/255});if(c.RGBA_PERCENT.test(l))return a=c.RGBA_PERCENT.exec(l).slice(1).map(function(e,t){return 3===t?parseFloat(e):parseFloat(e)/100});if(c.HSL.test(l)?(a=c.HSL.exec(l).slice(1).map(function(e,t){return 0===t?parseInt(e,10)/360:parseInt(e,10)/100}),a[3]=1):c.HSLA.test(l)&&(a=c.HSLA.exec(l).slice(1).map(function(e,t){return 0===t?parseInt(e,10)/360:3===t?parseFloat(e):parseInt(e,10)/100})),a=a.map(function(e){return Math.max(Math.min(e,1),0)}),a.length)return r._hslaToRGBA(a);if(c.HSB.test(l)?(a=c.HSB.exec(l).slice(1).map(function(e,t){return 0===t?parseInt(e,10)/360:parseInt(e,10)/100}),a[3]=1):c.HSBA.test(l)&&(a=c.HSBA.exec(l).slice(1).map(function(e,t){return 0===t?parseInt(e,10)/360:3===t?parseFloat(e):parseInt(e,10)/100})),a=a.map(function(e){return Math.max(Math.min(e,1),0)}),a.length)return r._hsbaToRGBA(a);a=[1,1,1,1]}else{if(1!==e&&2!==e||"number"!=typeof arguments[0])throw new Error(arguments+"is not a valid color representation.");a[0]=arguments[0]/o[t][2],a[1]=arguments[0]/o[t][2],a[2]=arguments[0]/o[t][2],"number"==typeof arguments[1]?a[3]=arguments[1]/o[t][3]:a[3]=1,a=a.map(function(e){return Math.max(Math.min(e,1),0)})}return a},t.exports=i.Color},{"../core/constants":41,"../core/core":42,"./color_conversion":34}],37:[function(e,t,o){"use strict";var i=e("../core/core"),n=e("../core/constants");e("./p5.Color"),i.prototype.background=function(){return arguments[0]instanceof i.Image?this.image(arguments[0],0,0,this.width,this.height):this._renderer.background.apply(this._renderer,arguments),this},i.prototype.clear=function(){return this._renderer.clear(),this},i.prototype.colorMode=function(){if(arguments[0]===n.RGB||arguments[0]===n.HSB||arguments[0]===n.HSL){this._renderer._colorMode=arguments[0];var e=this._renderer._colorMaxes[this._renderer._colorMode];2===arguments.length?(e[0]=arguments[1],e[1]=arguments[1],e[2]=arguments[1],e[3]=arguments[1]):4===arguments.length?(e[0]=arguments[1],e[1]=arguments[2],e[2]=arguments[3]):5===arguments.length&&(e[0]=arguments[1],e[1]=arguments[2],e[2]=arguments[3],e[3]=arguments[4])}return this},i.prototype.fill=function(){return this._renderer._setProperty("_fillSet",!0),this._renderer._setProperty("_doFill",!0),this._renderer.fill.apply(this._renderer,arguments),this},i.prototype.noFill=function(){return this._renderer._setProperty("_doFill",!1),this},i.prototype.noStroke=function(){return this._renderer._setProperty("_doStroke",!1),this},i.prototype.stroke=function(){return this._renderer._setProperty("_strokeSet",!0),this._renderer._setProperty("_doStroke",!0),this._renderer.stroke.apply(this._renderer,arguments),this},t.exports=i},{"../core/constants":41,"../core/core":42,"./p5.Color":36}],38:[function(e,t,o){"use strict";var i=e("./core"),n=e("./constants"),r=e("./canvas");e("./error_helpers"),i.prototype.arc=function(e,t,o,i,r,s,a){for(var l=new Array(arguments.length),h=0;h<l.length;++h)l[h]=arguments[h];if(!this._renderer._doStroke&&!this._renderer._doFill)return this;for(this._angleMode===n.DEGREES&&(r=this.radians(r),s=this.radians(s));r<0;)r+=n.TWO_PI;for(;s<0;)s+=n.TWO_PI;return r%=n.TWO_PI,s%=n.TWO_PI,s===r&&(s+=n.TWO_PI),r=r<=n.HALF_PI?Math.atan(o/i*Math.tan(r)):r>n.HALF_PI&&r<=3*n.HALF_PI?Math.atan(o/i*Math.tan(r))+n.PI:Math.atan(o/i*Math.tan(r))+n.TWO_PI,s=s<=n.HALF_PI?Math.atan(o/i*Math.tan(s)):s>n.HALF_PI&&s<=3*n.HALF_PI?Math.atan(o/i*Math.tan(s))+n.PI:Math.atan(o/i*Math.tan(s))+n.TWO_PI,r>s&&(s+=n.TWO_PI),o=Math.abs(o),i=Math.abs(i),this._renderer.arc(e,t,o,i,r,s,a),this},i.prototype.ellipse=function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];if(3===e.length&&e.push(e[2]),e[2]<0&&(e[2]=Math.abs(e[2])),e[3]<0&&(e[3]=Math.abs(e[3])),!this._renderer._doStroke&&!this._renderer._doFill)return this;var o=r.modeAdjust(e[0],e[1],e[2],e[3],this._renderer._ellipseMode);return e[0]=o.x,e[1]=o.y,e[2]=o.w,e[3]=o.h,this._renderer.ellipse(e),this},i.prototype.line=function(){if(!this._renderer._doStroke)return this;for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];return this._renderer.isP3D?this._renderer.line(e[0],e[1],e[2],e[3],e[4],e[5]):this._renderer.line(e[0],e[1],e[2],e[3]),this},i.prototype.point=function(){if(!this._renderer._doStroke)return this;for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];return this._renderer.isP3D?this._renderer.point(e[0],e[1],e[2]):this._renderer.point(e[0],e[1]),this},i.prototype.quad=function(){if(!this._renderer._doStroke&&!this._renderer._doFill)return this;for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];return this._renderer.isP3D?this._renderer.quad(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11]):this._renderer.quad(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]),this},i.prototype.rect=function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];if(this._renderer._doStroke||this._renderer._doFill){var o=r.modeAdjust(e[0],e[1],e[2],e[3],this._renderer._rectMode);return e[0]=o.x,e[1]=o.y,e[2]=o.w,e[3]=o.h,this._renderer.rect(e),this}},i.prototype.triangle=function(){if(!this._renderer._doStroke&&!this._renderer._doFill)return this;for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];return this._renderer.triangle(e),this},t.exports=i},{"./canvas":40,"./constants":41,"./core":42,"./error_helpers":45}],39:[function(e,t,o){"use strict";var i=e("./core"),n=e("./constants");i.prototype.ellipseMode=function(e){return e!==n.CORNER&&e!==n.CORNERS&&e!==n.RADIUS&&e!==n.CENTER||(this._renderer._ellipseMode=e),this},i.prototype.noSmooth=function(){return this._renderer.noSmooth(),this},i.prototype.rectMode=function(e){return e!==n.CORNER&&e!==n.CORNERS&&e!==n.RADIUS&&e!==n.CENTER||(this._renderer._rectMode=e),this},i.prototype.smooth=function(){return this._renderer.smooth(),this},i.prototype.strokeCap=function(e){return e!==n.ROUND&&e!==n.SQUARE&&e!==n.PROJECT||this._renderer.strokeCap(e),this},i.prototype.strokeJoin=function(e){return e!==n.ROUND&&e!==n.BEVEL&&e!==n.MITER||this._renderer.strokeJoin(e),this},i.prototype.strokeWeight=function(e){return this._renderer.strokeWeight(e),this},t.exports=i},{"./constants":41,"./core":42}],40:[function(e,t,o){var i=e("./constants");t.exports={modeAdjust:function(e,t,o,n,r){return r===i.CORNER?{x:e,y:t,w:o,h:n}:r===i.CORNERS?{x:e,y:t,w:o-e,h:n-t}:r===i.RADIUS?{x:e-o,y:t-n,w:2*o,h:2*n}:r===i.CENTER?{x:e-.5*o,y:t-.5*n,w:o,h:n}:void 0},arcModeAdjust:function(e,t,o,n,r){return r===i.CORNER?{x:e+.5*o,y:t+.5*n,w:o,h:n}:r===i.CORNERS?{x:e,y:t,w:o+e,h:n+t}:r===i.RADIUS?{x:e,y:t,w:2*o,h:2*n}:r===i.CENTER?{x:e,y:t,w:o,h:n}:void 0}}},{"./constants":41}],41:[function(e,t,o){var i=Math.PI;t.exports={P2D:"p2d",WEBGL:"webgl",ARROW:"default",CROSS:"crosshair",HAND:"pointer",MOVE:"move",TEXT:"text",WAIT:"wait",HALF_PI:i/2,PI:i,QUARTER_PI:i/4,TAU:2*i,TWO_PI:2*i,DEGREES:"degrees",RADIANS:"radians",CORNER:"corner",CORNERS:"corners",RADIUS:"radius",RIGHT:"right",LEFT:"left",CENTER:"center",TOP:"top",BOTTOM:"bottom",BASELINE:"alphabetic",POINTS:0,LINES:1,LINE_STRIP:3,LINE_LOOP:2,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,QUADS:"quads",QUAD_STRIP:"quad_strip",CLOSE:"close",OPEN:"open",CHORD:"chord",PIE:"pie",PROJECT:"square",SQUARE:"butt",ROUND:"round",BEVEL:"bevel",MITER:"miter",RGB:"rgb",HSB:"hsb",HSL:"hsl",AUTO:"auto",ALT:18,BACKSPACE:8,CONTROL:17,DELETE:46,DOWN_ARROW:40,ENTER:13,ESCAPE:27,LEFT_ARROW:37,OPTION:18,RETURN:13,RIGHT_ARROW:39,SHIFT:16,TAB:9,UP_ARROW:38,BLEND:"source-over",ADD:"lighter",DARKEST:"darken",LIGHTEST:"lighten",DIFFERENCE:"difference",EXCLUSION:"exclusion",MULTIPLY:"multiply",SCREEN:"screen",REPLACE:"copy",OVERLAY:"overlay",HARD_LIGHT:"hard-light",SOFT_LIGHT:"soft-light",DODGE:"color-dodge",BURN:"color-burn",THRESHOLD:"threshold",GRAY:"gray",OPAQUE:"opaque",INVERT:"invert",POSTERIZE:"posterize",DILATE:"dilate",ERODE:"erode",BLUR:"blur",NORMAL:"normal",ITALIC:"italic",BOLD:"bold",_DEFAULT_TEXT_FILL:"#000000",_DEFAULT_LEADMULT:1.25,_CTX_MIDDLE:"middle",LINEAR:"linear",QUADRATIC:"quadratic",BEZIER:"bezier",CURVE:"curve",_DEFAULT_STROKE:"#000000",_DEFAULT_FILL:"#FFFFFF"}},{}],42:[function(e,t,o){"use strict";e("./shim");var i=e("./constants"),n=function(e,t,o){2===arguments.length&&"boolean"==typeof t&&(o=t,t=void 0),this._setupDone=!1,this._pixelDensity=Math.ceil(window.devicePixelRatio)||1,this._userNode=t,this._curElement=null,this._elements=[],this._requestAnimId=0,this._preloadCount=0,this._isGlobal=!1,this._loop=!0,this._styles=[],this._defaultCanvasSize={width:100,height:100},this._events={mousemove:null,mousedown:null,mouseup:null,dragend:null,dragover:null,click:null,mouseover:null,mouseout:null,keydown:null,keyup:null,keypress:null,touchstart:null,touchmove:null,touchend:null,resize:null,blur:null},this._events.wheel=null,this._loadingScreenId="p5_loading",window.DeviceOrientationEvent&&(this._events.deviceorientation=null),window.DeviceMotionEvent&&!window._isNodeWebkit&&(this._events.devicemotion=null),this._start=function(){this._userNode&&"string"==typeof this._userNode&&(this._userNode=document.getElementById(this._userNode));var e=this.preload||window.preload;if(e){var t=document.getElementById(this._loadingScreenId);t||(t=document.createElement("div"),t.innerHTML="Loading...",t.style.position="absolute",t.id=this._loadingScreenId,(this._userNode||document.body).appendChild(t));for(var o in this._preloadMethods){this._preloadMethods[o]=this._preloadMethods[o]||n;var i=this._preloadMethods[o];i!==n.prototype&&i!==n||(i=this._isGlobal?window:this),this._registeredPreloadMethods[o]=i[o],i[o]=this._wrapPreload(i,o)}e(),this._runIfPreloadsAreDone()}else this._setup(),this._runFrames(),this._draw()}.bind(this),this._runIfPreloadsAreDone=function(){var e=this._isGlobal?window:this;if(0===e._preloadCount){var t=document.getElementById(e._loadingScreenId);t&&t.parentNode.removeChild(t),e._setup(),e._runFrames(),e._draw()}},this._decrementPreload=function(){var e=this._isGlobal?window:this;e._setProperty("_preloadCount",e._preloadCount-1),e._runIfPreloadsAreDone()},this._wrapPreload=function(e,t){return function(){this._incrementPreload();for(var o=new Array(arguments.length),i=0;i<o.length;++i)o[i]=arguments[i];return o.push(this._decrementPreload.bind(this)),this._registeredPreloadMethods[t].apply(e,o)}.bind(this)},this._incrementPreload=function(){var e=this._isGlobal?window:this;e._setProperty("_preloadCount",e._preloadCount+1)},this._setup=function(){this.createCanvas(this._defaultCanvasSize.width,this._defaultCanvasSize.height,"p2d",!0);var e=this._isGlobal?window:this;if("function"==typeof e.preload)for(var t in this._preloadMethods)e[t]=this._preloadMethods[t][t],e[t]&&this&&(e[t]=e[t].bind(this));"function"==typeof e.setup&&e.setup();for(var o=document.getElementsByTagName("canvas"),i=0;i<o.length;i++){var n=o[i];"true"===n.dataset.hidden&&(n.style.visibility="",delete n.dataset.hidden)}this._setupDone=!0}.bind(this),this._draw=function(){var e=window.performance.now(),t=e-this._lastFrameTime,o=1e3/this._targetFrameRate;(!this._loop||t>=o-5)&&(this._setProperty("frameCount",this.frameCount+1),this.redraw(),this._updateMouseCoords(),this._frameRate=1e3/(e-this._lastFrameTime),this._lastFrameTime=e),this._loop&&(this._requestAnimId=window.requestAnimationFrame(this._draw))}.bind(this),this._runFrames=function(){this._updateInterval&&clearInterval(this._updateInterval)}.bind(this),this._setProperty=function(e,t){this[e]=t,this._isGlobal&&(window[e]=t)}.bind(this),this.remove=function(){if(this._curElement){this._loop=!1,this._requestAnimId&&window.cancelAnimationFrame(this._requestAnimId);for(var e in this._events)window.removeEventListener(e,this._events[e]);for(var t=0;t<this._elements.length;t++){var o=this._elements[t];o.elt.parentNode&&o.elt.parentNode.removeChild(o.elt);for(var i in o._events)o.elt.removeEventListener(i,o._events[i])}var r=this;if(this._registeredMethods.remove.forEach(function(e){void 0!==e&&e.call(r)}),this._isGlobal){for(var s in n.prototype)try{delete window[s]}catch(e){window[s]=void 0}for(var a in this)if(this.hasOwnProperty(a))try{delete window[a]}catch(e){window[a]=void 0}}}}.bind(this),this._registeredMethods.init.forEach(function(e){void 0!==e&&e.call(this)},this);var i=this._createFriendlyGlobalFunctionBinder();if(e)e(this);else{this._isGlobal=!0,n.instance=this;for(var r in n.prototype)if("function"==typeof n.prototype[r]){var s=r.substring(2);this._events.hasOwnProperty(s)||(Math.hasOwnProperty(r)&&Math[r]===n.prototype[r]?i(r,n.prototype[r]):i(r,n.prototype[r].bind(this)))}else i(r,n.prototype[r]);for(var a in this)this.hasOwnProperty(a)&&i(a,this[a])}for(var l in this._events){var h=this["_on"+l];if(h){var p=h.bind(this);window.addEventListener(l,p,{passive:!1}),this._events[l]=p}}var c=function(){this._setProperty("focused",!0)}.bind(this),u=function(){this._setProperty("focused",!1)}.bind(this);window.addEventListener("focus",c),window.addEventListener("blur",u),this.registerMethod("remove",function(){window.removeEventListener("focus",c),window.removeEventListener("blur",u)}),o?this._start():"complete"===document.readyState?this._start():window.addEventListener("load",this._start.bind(this),!1)};n.instance=null,n.disableFriendlyErrors=!1;for(var r in i)n.prototype[r]=i[r];n.prototype._preloadMethods={loadJSON:n.prototype,loadImage:n.prototype,loadStrings:n.prototype,loadXML:n.prototype,loadShape:n.prototype,loadTable:n.prototype,loadFont:n.prototype,loadModel:n.prototype},n.prototype._registeredMethods={init:[],pre:[],post:[],remove:[]},n.prototype._registeredPreloadMethods={},n.prototype.registerPreloadMethod=function(e,t){n.prototype._preloadMethods.hasOwnProperty(e)||(n.prototype._preloadMethods[e]=t)},n.prototype.registerMethod=function(e,t){n.prototype._registeredMethods.hasOwnProperty(e)||(n.prototype._registeredMethods[e]=[]),n.prototype._registeredMethods[e].push(t)},n.prototype._createFriendlyGlobalFunctionBinder=function(e){e=e||{};var t=e.globalObject||window,o=e.log||console.log.bind(console),i={print:!0};return function(e,r){if(n.disableFriendlyErrors,1)t[e]=r;else try{if(e in t&&!(e in i))throw new Error('global "'+e+'" already exists');Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return r},set:function(i){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}),o('You just changed the value of "'+e+"\", which was a p5 function. This could cause problems later if you're not careful.")}})}catch(i){o('p5 had problems creating the global function "'+e+'", possibly because your code is already using that name as a variable. You may want to rename your variable to something else.'),t[e]=r}}},t.exports=n},{"./constants":41,"./shim":51}],43:[function(e,t,o){"use strict";var i=e("./core");e("./error_helpers");var n=20,r=20;i.prototype.bezier=function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];return this._renderer._doStroke||this._renderer._doFill?(this._renderer.isP3D?(e.push(n),this._renderer.bezier(e)):this._renderer.bezier(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]),this):this},i.prototype.bezierDetail=function(e){return n=e,this},i.prototype.bezierPoint=function(e,t,o,i,n){var r=1-n;return Math.pow(r,3)*e+3*Math.pow(r,2)*n*t+3*r*Math.pow(n,2)*o+Math.pow(n,3)*i},i.prototype.bezierTangent=function(e,t,o,i,n){var r=1-n;return 3*i*Math.pow(n,2)-3*o*Math.pow(n,2)+6*o*r*n-6*t*r*n+3*t*Math.pow(r,2)-3*e*Math.pow(r,2)},i.prototype.curve=function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];return this._renderer._doStroke?(this._renderer.isP3D?(e.push(r),this._renderer.curve(e)):this._renderer.curve(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]),this):this},i.prototype.curveDetail=function(e){return r=e,this},i.prototype.curveTightness=function(e){this._renderer._curveTightness=e},i.prototype.curvePoint=function(e,t,o,i,n){var r=n*n*n,s=n*n;return e*(-.5*r+s-.5*n)+t*(1.5*r-2.5*s+1)+o*(-1.5*r+2*s+.5*n)+i*(.5*r-.5*s)},i.prototype.curveTangent=function(e,t,o,i,n){var r=n*n;return e*(-3*r/2+2*n-.5)+t*(9*r/2-5*n)+o*(-9*r/2+4*n+.5)+i*(3*r/2-n)},t.exports=i},{"./core":42,"./error_helpers":45}],44:[function(e,t,o){"use strict";function i(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth||0}function n(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight||0}function r(e){if(!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled))throw new Error("Fullscreen not enabled in this browser.");e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function s(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}var a=e("./core"),l=e("./constants"),h=[l.ARROW,l.CROSS,l.HAND,l.MOVE,l.TEXT,l.WAIT];a.prototype._frameRate=0,a.prototype._lastFrameTime=window.performance.now(),a.prototype._targetFrameRate=60;var p=window.print;window.console&&console.log?a.prototype.print=function(e){try{if(0===arguments.length)p();else if(arguments.length>1)console.log.apply(console,arguments);else{var t=JSON.parse(JSON.stringify(e));"{}"===JSON.stringify(t)?console.log(e):console.log(t)}}catch(t){console.log(e)}}:a.prototype.print=function(){},a.prototype.frameCount=0,a.prototype.focused=document.hasFocus(),a.prototype.cursor=function(e,t,o){var i="auto",n=this._curElement.elt;if(h.indexOf(e)>-1)i=e;else if("string"==typeof e){var r="";t&&o&&"number"==typeof t&&"number"==typeof o&&(r=t+" "+o),i="http://"===e.substring(0,7)||"https://"===e.substring(0,8)?"url("+e+") "+r+", auto":/\.(cur|jpg|jpeg|gif|png|CUR|JPG|JPEG|GIF|PNG)$/.test(e)?"url("+e+") "+r+", auto":e}n.style.cursor=i},a.prototype.frameRate=function(e){return"number"!=typeof e||e<=0?this._frameRate:(this._setProperty("_targetFrameRate",e),this._runFrames(),this)},a.prototype.getFrameRate=function(){return this.frameRate()},a.prototype.setFrameRate=function(e){return this.frameRate(e)},a.prototype.noCursor=function(){this._curElement.elt.style.cursor="none"},a.prototype.displayWidth=screen.width,a.prototype.displayHeight=screen.height,a.prototype.windowWidth=i(),a.prototype.windowHeight=n(),a.prototype._onresize=function(e){this._setProperty("windowWidth",i()),this._setProperty("windowHeight",n());var t,o=this._isGlobal?window:this;"function"==typeof o.windowResized&&(void 0===(t=o.windowResized(e))||t||e.preventDefault())},a.prototype.width=0,a.prototype.height=0,a.prototype.fullscreen=function(e){if(void 0===e)return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;e?r(document.documentElement):s()},a.prototype.pixelDensity=function(e){if("number"!=typeof e)return this._pixelDensity;this._pixelDensity=e,this.resizeCanvas(this.width,this.height,!0)},a.prototype.displayDensity=function(){return window.devicePixelRatio},a.prototype.getURL=function(){return location.href},a.prototype.getURLPath=function(){return location.pathname.split("/").filter(function(e){return""!==e})},a.prototype.getURLParams=function(){for(var e,t=/[?&]([^&=]+)(?:[&=])([^&=]+)/gim,o={};null!=(e=t.exec(location.search));)e.index===t.lastIndex&&t.lastIndex++,o[e[1]]=e[2];return o},t.exports=a},{"./constants":41,"./core":42}],45:[function(e,t,o){"use strict";function i(e,t,o){l&&(n(),l=!1),"undefined"===m(o)?o="#B40033":"number"===m(o)&&(o=d[o])}function n(){console.log("%c    _ \n /\\| |/\\ \n \\ ` ' /  \n / , . \\  \n \\/|_|\\/ \n\n%c> p5.js says: Welcome! This is your friendly debugger. To turn me off switch to using p5.min.js.","background-color:transparent;color:#ED225D;","background-color:#ED225D;color:white;")}function r(){var t={},o=function(e){return Object.getOwnPropertyNames(e).filter(function(e){return!("_"===e[0]||e in t||(t[e]=!0,0))}).map(function(t){var o;return o="function"==typeof e[t]?"function":t===t.toUpperCase()?"constant":"variable",{name:t,type:o}})};b=[].concat(o(a.prototype),o(e("./constants"))),b.sort(function(e,t){return t.name.length-e.name.length})}function s(e,t){t||(t=console.log.bind(console)),b||r(),b.some(function(o){if(e.message&&null!==e.message.match("\\W?"+o.name+"\\W"))return t("%cDid you just try to use p5.js's "+o.name+("function"===o.type?"() ":" ")+o.type+"? If so, you may want to move it into your sketch's setup() function.\n\nFor more details, see: "+f,"color: #B40033"),!0})}for(var a=e("./core"),l=!1,h={},p=h.toString,c=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],u=0;u<c.length;u++)h["[object "+c[u]+"]"]=c[u].toLowerCase();var m=function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?h[p.call(e)]||"object":typeof e},d=["#2D7BB6","#EE9900","#4DB200","#C83C00"],y={0:{fileType:"image",method:"loadImage",message:" hosting the image online,"},1:{fileType:"XML file",method:"loadXML"},2:{fileType:"table file",method:"loadTable"},3:{fileType:"text file",method:"loadStrings"},4:{fileType:"font",method:"loadFont",message:" hosting the font online,"}};a._friendlyFileLoadError=function(e,t){var o=y[e];i("It looks like there was a problem loading your "+o.fileType+". Try checking if the file path%c ["+t+"] %cis correct,"+(o.message||"")+" or running a local server.",o.method,3)};var b=null,f="https://github.com/processing/p5.js/wiki/Frequently-Asked-Questions#why-cant-i-assign-variables-using-p5-functions-and-variables-before-setup";a.prototype._helpForMisusedAtTopLevelCode=s,"complete"!==document.readyState&&(window.addEventListener("error",s,!1),window.addEventListener("load",function(){window.removeEventListener("error",s,!1)})),t.exports=a},{"./constants":41,"./core":42}],46:[function(e,t,o){function i(e,t,o){var i=t.bind(o);o.elt.addEventListener(e,i,!1),o._events[e]=i}var n=e("./core");n.Element=function(e,t){this.elt=e,this._pInst=t,this._events={},this.width=this.elt.offsetWidth,this.height=this.elt.offsetHeight},n.Element.prototype.parent=function(e){return 0===arguments.length?this.elt.parentNode:("string"==typeof e?("#"===e[0]&&(e=e.substring(1)),e=document.getElementById(e)):e instanceof n.Element&&(e=e.elt),e.appendChild(this.elt),this)},n.Element.prototype.id=function(e){return 0===arguments.length?this.elt.id:(this.elt.id=e,this.width=this.elt.offsetWidth,this.height=this.elt.offsetHeight,this)},n.Element.prototype.class=function(e){return 0===arguments.length?this.elt.className:(this.elt.className=e,this)},n.Element.prototype.mousePressed=function(e){return i("mousedown",e,this),i("touchstart",e,this),this},n.Element.prototype.mouseWheel=function(e){return i("wheel",e,this),this},n.Element.prototype.mouseReleased=function(e){return i("mouseup",e,this),i("touchend",e,this),this},n.Element.prototype.mouseClicked=function(e){return i("click",e,this),this},n.Element.prototype.mouseMoved=function(e){return i("mousemove",e,this),i("touchmove",e,this),this},n.Element.prototype.mouseOver=function(e){return i("mouseover",e,this),this},n.Element.prototype.changed=function(e){return i("change",e,this),this},n.Element.prototype.input=function(e){return i("input",e,this),this},n.Element.prototype.mouseOut=function(e){return i("mouseout",e,this),this},n.Element.prototype.touchStarted=function(e){return i("touchstart",e,this),i("mousedown",e,this),this},n.Element.prototype.touchMoved=function(e){return i("touchmove",e,this),i("mousemove",e,this),this},n.Element.prototype.touchEnded=function(e){return i("touchend",e,this),i("mouseup",e,this),this},n.Element.prototype.dragOver=function(e){return i("dragover",e,this),this},n.Element.prototype.dragLeave=function(e){return i("dragleave",e,this),this},n.Element.prototype.drop=function(e,t){function o(t){var o=new n.File(t);return function(t){o.data=t.target.result,e(o)}}return window.File&&window.FileReader&&window.FileList&&window.Blob?(i("dragover",function(e){e.stopPropagation(),e.preventDefault()},this),i("dragleave",function(e){e.stopPropagation(),e.preventDefault()},this),arguments.length>1&&i("drop",t,this),i("drop",function(e){e.stopPropagation(),e.preventDefault();for(var t=e.dataTransfer.files,i=0;i<t.length;i++){var n=t[i],r=new FileReader;r.onload=o(n),n.type.indexOf("text")>-1?r.readAsText(n):r.readAsDataURL(n)}},this)):console.log("The File APIs are not fully supported in this browser."),this},n.Element.prototype._setProperty=function(e,t){this[e]=t},t.exports=n.Element},{"./core":42}],47:[function(e,t,o){var i=e("./core"),n=e("./constants");i.Graphics=function(e,t,o,r){var s=o||n.P2D;this.canvas=document.createElement("canvas"),(this._userNode||document.body).appendChild(this.canvas),i.Element.call(this,this.canvas,r,!1),this._styles=[],this.width=e,this.height=t,this._pixelDensity=r._pixelDensity,s===n.WEBGL?this._renderer=new i.RendererGL(this.canvas,this,!1):this._renderer=new i.Renderer2D(this.canvas,this,!1),this._renderer.resize(e,t),this._renderer._applyDefaults(),r._elements.push(this);for(var a in i.prototype)this[a]||("function"==typeof i.prototype[a]?this[a]=i.prototype[a].bind(this):this[a]=i.prototype[a]);return this},i.Graphics.prototype=Object.create(i.Element.prototype),i.Graphics.prototype.remove=function(){this.elt.parentNode&&this.elt.parentNode.removeChild(this.elt);for(var e in this._events)this.elt.removeEventListener(e,this._events[e])},t.exports=i.Graphics},{"./constants":41,"./core":42}],48:[function(e,t,o){function i(e){var t=0,o=0;if(e.offsetParent)do{t+=e.offsetLeft,o+=e.offsetTop}while(e=e.offsetParent);else t+=e.offsetLeft,o+=e.offsetTop;return[t,o]}var n=e("./core"),r=e("../core/constants");n.Renderer=function(e,t,o){n.Element.call(this,e,t),this.canvas=e,this._pInst=t,o?(this._isMainCanvas=!0,this._pInst._setProperty("_curElement",this),this._pInst._setProperty("canvas",this.canvas),this._pInst._setProperty("width",this.width),this._pInst._setProperty("height",this.height)):(this.canvas.style.display="none",this._styles=[]),this._textSize=12,this._textLeading=15,this._textFont="sans-serif",this._textStyle=r.NORMAL,this._textAscent=null,this._textDescent=null,this._rectMode=r.CORNER,this._ellipseMode=r.CENTER,this._curveTightness=0,this._imageMode=r.CORNER,this._tint=null,this._doStroke=!0,this._doFill=!0,this._strokeSet=!1,this._fillSet=!1,this._colorMode=r.RGB,this._colorMaxes={rgb:[255,255,255,255],hsb:[360,100,100,1],hsl:[360,100,100,1]}},n.Renderer.prototype=Object.create(n.Element.prototype),n.Renderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.elt.width=e*this._pInst._pixelDensity,this.elt.height=t*this._pInst._pixelDensity,this.elt.style.width=e+"px",this.elt.style.height=t+"px",this._isMainCanvas&&(this._pInst._setProperty("width",this.width),this._pInst._setProperty("height",this.height))},n.Renderer.prototype.textLeading=function(e){return arguments.length&&arguments[0]?(this._setProperty("_textLeading",e),this):this._textLeading},n.Renderer.prototype.textSize=function(e){return arguments.length&&arguments[0]?(this._setProperty("_textSize",e),this._setProperty("_textLeading",e*r._DEFAULT_LEADMULT),this._applyTextProperties()):this._textSize},n.Renderer.prototype.textStyle=function(e){return arguments.length&&arguments[0]?(e!==r.NORMAL&&e!==r.ITALIC&&e!==r.BOLD||this._setProperty("_textStyle",e),this._applyTextProperties()):this._textStyle},n.Renderer.prototype.textAscent=function(){return null===this._textAscent&&this._updateTextMetrics(),this._textAscent},n.Renderer.prototype.textDescent=function(){return null===this._textDescent&&this._updateTextMetrics(),this._textDescent},n.Renderer.prototype._applyDefaults=function(){return this},n.Renderer.prototype._isOpenType=function(e){return"object"==typeof(e=e||this._textFont)&&e.font&&e.font.supported},n.Renderer.prototype._updateTextMetrics=function(){if(this._isOpenType())return this._setProperty("_textAscent",this._textFont._textAscent()),this._setProperty("_textDescent",this._textFont._textDescent()),this;var e=document.createElement("span");e.style.fontFamily=this._textFont,e.style.fontSize=this._textSize+"px",e.innerHTML="ABCjgq|";var t=document.createElement("div");t.style.display="inline-block",t.style.width="1px",t.style.height="0px";var o=document.createElement("div");o.appendChild(e),o.appendChild(t),o.style.height="0px",o.style.overflow="hidden",document.body.appendChild(o),t.style.verticalAlign="baseline";var n=i(t),r=i(e),s=n[1]-r[1];t.style.verticalAlign="bottom",n=i(t),r=i(e);var a=n[1]-r[1],l=a-s;return document.body.removeChild(o),this._setProperty("_textAscent",s),this._setProperty("_textDescent",l),this},t.exports=n.Renderer},{"../core/constants":41,"./core":42}],49:[function(e,t,o){var i=e("./core"),n=e("./canvas"),r=e("./constants"),s=e("../image/filters");e("./p5.Renderer");var a="rgba(0,0,0,0)";i.Renderer2D=function(e,t,o){return i.Renderer.call(this,e,t,o),this.drawingContext=this.canvas.getContext("2d"),this._pInst._setProperty("drawingContext",this.drawingContext),this},i.Renderer2D.prototype=Object.create(i.Renderer.prototype),i.Renderer2D.prototype._applyDefaults=function(){this.drawingContext.fillStyle=r._DEFAULT_FILL,this.drawingContext.strokeStyle=r._DEFAULT_STROKE,this.drawingContext.lineCap=r.ROUND,this.drawingContext.font="normal 12px sans-serif"},i.Renderer2D.prototype.resize=function(e,t){i.Renderer.prototype.resize.call(this,e,t),this.drawingContext.scale(this._pInst._pixelDensity,this._pInst._pixelDensity)},i.Renderer2D.prototype.background=function(){if(this.drawingContext.save(),this.drawingContext.setTransform(1,0,0,1,0,0),this.drawingContext.scale(this._pInst._pixelDensity,this._pInst._pixelDensity),arguments[0]instanceof i.Image)this._pInst.image(arguments[0],0,0,this.width,this.height);else{var e=this.drawingContext.fillStyle,t=this._pInst.color.apply(this,arguments),o=t.toString();this.drawingContext.fillStyle=o,this.drawingContext.fillRect(0,0,this.width,this.height),this.drawingContext.fillStyle=e}this.drawingContext.restore()},i.Renderer2D.prototype.clear=function(){this.drawingContext.clearRect(0,0,this.width,this.height)},i.Renderer2D.prototype.fill=function(){var e=this.drawingContext,t=this._pInst.color.apply(this,arguments);e.fillStyle=t.toString()},i.Renderer2D.prototype.stroke=function(){var e=this.drawingContext,t=this._pInst.color.apply(this,arguments);e.strokeStyle=t.toString()},i.Renderer2D.prototype.image=function(e,t,o,n,r,s,a,l,h){var p;try{this._tint&&(i.MediaElement&&e instanceof i.MediaElement&&e.loadPixels(),e.canvas&&(p=this._getTintedImageCanvas(e))),p||(p=e.canvas||e.elt),this.drawingContext.drawImage(p,t,o,n,r,s,a,l,h)}catch(e){if("NS_ERROR_NOT_AVAILABLE"!==e.name)throw e}},i.Renderer2D.prototype._getTintedImageCanvas=function(e){if(!e.canvas)return e;var t=s._toPixels(e.canvas),o=document.createElement("canvas");o.width=e.canvas.width,o.height=e.canvas.height;for(var i=o.getContext("2d"),n=i.createImageData(e.canvas.width,e.canvas.height),r=n.data,a=0;a<t.length;a+=4){var l=t[a],h=t[a+1],p=t[a+2],c=t[a+3];r[a]=l*this._tint[0]/255,r[a+1]=h*this._tint[1]/255,r[a+2]=p*this._tint[2]/255,r[a+3]=c*this._tint[3]/255}return i.putImageData(n,0,0),o},i.Renderer2D.prototype.blendMode=function(e){this.drawingContext.globalCompositeOperation=e},i.Renderer2D.prototype.blend=function(){var e=this.drawingContext.globalCompositeOperation,t=arguments[arguments.length-1],o=Array.prototype.slice.call(arguments,0,arguments.length-1);this.drawingContext.globalCompositeOperation=t,this._pInst?this._pInst.copy.apply(this._pInst,o):this.copy.apply(this,o),this.drawingContext.globalCompositeOperation=e},i.Renderer2D.prototype.copy=function(){var e,t,o,n,r,s,a,l,h;if(9===arguments.length)e=arguments[0],t=arguments[1],o=arguments[2],n=arguments[3],r=arguments[4],s=arguments[5],a=arguments[6],l=arguments[7],h=arguments[8];else{if(8!==arguments.length)throw new Error("Signature not supported");e=this._pInst,t=arguments[0],o=arguments[1],n=arguments[2],r=arguments[3],s=arguments[4],a=arguments[5],l=arguments[6],h=arguments[7]}i.Renderer2D._copyHelper(e,t,o,n,r,s,a,l,h)},i.Renderer2D._copyHelper=function(e,t,o,i,n,r,s,a,l){e.loadPixels();var h=e.canvas.width/e.width;this.drawingContext.drawImage(e.canvas,h*t,h*o,h*i,h*n,r,s,a,l)},i.Renderer2D.prototype.get=function(e,t,o,n){if(void 0===e&&void 0===t&&void 0===o&&void 0===n?(e=0,t=0,o=this.width,n=this.height):void 0===o&&void 0===n&&(o=1,n=1),e+o<0||t+n<0||e>this.width||t>this.height)return[0,0,0,255];var r=this._pInst||this;r.loadPixels();var s=r._pixelDensity;e=Math.floor(e),t=Math.floor(t),o=Math.floor(o),n=Math.floor(n);var a=e*s,l=t*s;if(1===o&&1===n){var h=this.drawingContext.getImageData(a,l,1,1).data;return[h[0],h[1],h[2],h[3]]}var p=Math.min(o,r.width),c=Math.min(n,r.height),u=p*s,m=c*s,d=new i.Image(p,c);return d.canvas.getContext("2d").drawImage(this.canvas,a,l,u,m,0,0,p,c),d},i.Renderer2D.prototype.loadPixels=function(){var e=this._pixelDensity||this._pInst._pixelDensity,t=this.width*e,o=this.height*e,i=this.drawingContext.getImageData(0,0,t,o);this._pInst?(this._pInst._setProperty("imageData",i),this._pInst._setProperty("pixels",i.data)):(this._setProperty("imageData",i),this._setProperty("pixels",i.data))},i.Renderer2D.prototype.set=function(e,t,o){if(e=Math.floor(e),t=Math.floor(t),o instanceof i.Image)this.drawingContext.save(),this.drawingContext.setTransform(1,0,0,1,0,0),this.drawingContext.scale(this._pInst._pixelDensity,this._pInst._pixelDensity),this.drawingContext.drawImage(o.canvas,e,t),this.loadPixels.call(this._pInst),this.drawingContext.restore();else{var n=this._pInst||this,r=0,s=0,a=0,l=0,h=4*(t*n._pixelDensity*(this.width*n._pixelDensity)+e*n._pixelDensity);if(n.imageData||n.loadPixels.call(n),"number"==typeof o)h<n.pixels.length&&(r=o,s=o,a=o,l=255);else if(o instanceof Array){if(o.length<4)throw new Error("pixel array must be of the form [R, G, B, A]");h<n.pixels.length&&(r=o[0],s=o[1],a=o[2],l=o[3])}else o instanceof i.Color&&h<n.pixels.length&&(r=o.levels[0],s=o.levels[1],a=o.levels[2],l=o.levels[3]);for(var p=0;p<n._pixelDensity;p++)for(var c=0;c<n._pixelDensity;c++)h=4*((t*n._pixelDensity+c)*this.width*n._pixelDensity+(e*n._pixelDensity+p)),n.pixels[h]=r,n.pixels[h+1]=s,n.pixels[h+2]=a,n.pixels[h+3]=l}},i.Renderer2D.prototype.updatePixels=function(e,t,o,i){var n=this._pixelDensity||this._pInst._pixelDensity;void 0===e&&void 0===t&&void 0===o&&void 0===i&&(e=0,t=0,o=this.width,i=this.height),o*=n,i*=n,this._pInst?this.drawingContext.putImageData(this._pInst.imageData,e,t,0,0,o,i):this.drawingContext.putImageData(this.imageData,e,t,0,0,o,i)},i.Renderer2D.prototype._acuteArcToBezier=function(e,t){var o=t/2,i=Math.cos(o),n=Math.sin(o),r=1/Math.tan(o),s=e+o,a=Math.cos(s),l=Math.sin(s),h=(4-i)/3,p=n+(i-h)*r;return{ax:Math.cos(e),ay:Math.sin(e),bx:h*a+p*l,by:h*l-p*a,cx:h*a-p*l,cy:h*l+p*a,dx:Math.cos(e+t),dy:Math.sin(e+t)}},i.Renderer2D.prototype.arc=function(e,t,o,i,s,a,l){for(var h=this.drawingContext,p=n.arcModeAdjust(e,t,o,i,this._ellipseMode),c=p.w/2,u=p.h/2,m=0,d=[];a-s>1e-5;)m=Math.min(a-s,r.HALF_PI),d.push(this._acuteArcToBezier(s,m)),s+=m;return this._doFill&&(h.beginPath(),d.forEach(function(e,t){0===t&&h.moveTo(p.x+e.ax*c,p.y+e.ay*u),h.bezierCurveTo(p.x+e.bx*c,p.y+e.by*u,p.x+e.cx*c,p.y+e.cy*u,p.x+e.dx*c,p.y+e.dy*u)}),l!==r.PIE&&null!=l||h.lineTo(p.x,p.y),h.closePath(),h.fill()),this._doStroke&&(h.beginPath(),d.forEach(function(e,t){0===t&&h.moveTo(p.x+e.ax*c,p.y+e.ay*u),h.bezierCurveTo(p.x+e.bx*c,p.y+e.by*u,p.x+e.cx*c,p.y+e.cy*u,p.x+e.dx*c,p.y+e.dy*u)}),l===r.PIE?(h.lineTo(p.x,p.y),h.closePath()):l===r.CHORD&&h.closePath(),h.stroke()),this},i.Renderer2D.prototype.ellipse=function(e){var t=this.drawingContext,o=this._doFill,i=this._doStroke,n=e[0],r=e[1],s=e[2],l=e[3];if(o&&!i){if(t.fillStyle===a)return this}else if(!o&&i&&t.strokeStyle===a)return this;var h=.5522847498,p=s/2*h,c=l/2*h,u=n+s,m=r+l,d=n+s/2,y=r+l/2;t.beginPath(),t.moveTo(n,y),t.bezierCurveTo(n,y-c,d-p,r,d,r),t.bezierCurveTo(d+p,r,u,y-c,u,y),t.bezierCurveTo(u,y+c,d+p,m,d,m),t.bezierCurveTo(d-p,m,n,y+c,n,y),t.closePath(),o&&t.fill(),i&&t.stroke()},i.Renderer2D.prototype.line=function(e,t,o,i){var n=this.drawingContext;return this._doStroke?n.strokeStyle===a?this:(n.lineWidth%2==1&&n.translate(.5,.5),n.beginPath(),n.moveTo(e,t),n.lineTo(o,i),n.stroke(),n.lineWidth%2==1&&n.translate(-.5,-.5),this):this},i.Renderer2D.prototype.point=function(e,t){var o=this.drawingContext,i=o.strokeStyle,n=o.fillStyle;return this._doStroke?o.strokeStyle===a?this:(e=Math.round(e),t=Math.round(t),o.fillStyle=i,o.lineWidth>1?(o.beginPath(),o.arc(e,t,o.lineWidth/2,0,r.TWO_PI,!1),o.fill()):o.fillRect(e,t,1,1),void(o.fillStyle=n)):this},i.Renderer2D.prototype.quad=function(e,t,o,i,n,r,s,l){var h=this.drawingContext,p=this._doFill,c=this._doStroke;if(p&&!c){if(h.fillStyle===a)return this}else if(!p&&c&&h.strokeStyle===a)return this;return h.beginPath(),h.moveTo(e,t),h.lineTo(o,i),h.lineTo(n,r),h.lineTo(s,l),h.closePath(),p&&h.fill(),c&&h.stroke(),this},i.Renderer2D.prototype.rect=function(e){var t=e[0],o=e[1],i=e[2],n=e[3],r=e[4],s=e[5],l=e[6],h=e[7],p=this.drawingContext,c=this._doFill,u=this._doStroke;if(c&&!u){if(p.fillStyle===a)return this}else if(!c&&u&&p.strokeStyle===a)return this;if(this._doStroke&&p.lineWidth%2==1&&p.translate(.5,.5),p.beginPath(),void 0===r)p.rect(t,o,i,n);else{void 0===s&&(s=r),void 0===l&&(l=s),void 0===h&&(h=l);var m=i/2,d=n/2;i<2*r&&(r=m),n<2*r&&(r=d),i<2*s&&(s=m),n<2*s&&(s=d),i<2*l&&(l=m),n<2*l&&(l=d),i<2*h&&(h=m),n<2*h&&(h=d),p.beginPath(),p.moveTo(t+r,o),p.arcTo(t+i,o,t+i,o+n,s),p.arcTo(t+i,o+n,t,o+n,l),p.arcTo(t,o+n,t,o,h),p.arcTo(t,o,t+i,o,r),p.closePath()}return this._doFill&&p.fill(),this._doStroke&&p.stroke(),this._doStroke&&p.lineWidth%2==1&&p.translate(-.5,-.5),this},i.Renderer2D.prototype.triangle=function(e){var t=this.drawingContext,o=this._doFill,i=this._doStroke,n=e[0],r=e[1],s=e[2],l=e[3],h=e[4],p=e[5];if(o&&!i){if(t.fillStyle===a)return this}else if(!o&&i&&t.strokeStyle===a)return this;t.beginPath(),t.moveTo(n,r),t.lineTo(s,l),t.lineTo(h,p),t.closePath(),o&&t.fill(),i&&t.stroke()},i.Renderer2D.prototype.endShape=function(e,t,o,i,n,s,a){if(0===t.length)return this;if(!this._doStroke&&!this._doFill)return this;var l,h=e===r.CLOSE;h&&!s&&t.push(t[0]);var p,c,u=t.length;if(!o||a!==r.POLYGON&&null!==a)if(!i||a!==r.POLYGON&&null!==a)if(!n||a!==r.POLYGON&&null!==a)if(a===r.POINTS)for(p=0;p<u;p++)l=t[p],this._doStroke&&this._pInst.stroke(l[6]),this._pInst.point(l[0],l[1]);else if(a===r.LINES)for(p=0;p+1<u;p+=2)l=t[p],this._doStroke&&this._pInst.stroke(t[p+1][6]),this._pInst.line(l[0],l[1],t[p+1][0],t[p+1][1]);else if(a===r.TRIANGLES)for(p=0;p+2<u;p+=3)l=t[p],this.drawingContext.beginPath(),this.drawingContext.moveTo(l[0],l[1]),this.drawingContext.lineTo(t[p+1][0],t[p+1][1]),this.drawingContext.lineTo(t[p+2][0],t[p+2][1]),this.drawingContext.lineTo(l[0],l[1]),this._doFill&&(this._pInst.fill(t[p+2][5]),this.drawingContext.fill()),this._doStroke&&(this._pInst.stroke(t[p+2][6]),this.drawingContext.stroke()),this.drawingContext.closePath();else if(a===r.TRIANGLE_STRIP)for(p=0;p+1<u;p++)l=t[p],this.drawingContext.beginPath(),this.drawingContext.moveTo(t[p+1][0],t[p+1][1]),this.drawingContext.lineTo(l[0],l[1]),this._doStroke&&this._pInst.stroke(t[p+1][6]),this._doFill&&this._pInst.fill(t[p+1][5]),p+2<u&&(this.drawingContext.lineTo(t[p+2][0],t[p+2][1]),this._doStroke&&this._pInst.stroke(t[p+2][6]),this._doFill&&this._pInst.fill(t[p+2][5])),this._doFillStrokeClose();else if(a===r.TRIANGLE_FAN){if(u>2)for(this.drawingContext.beginPath(),this.drawingContext.moveTo(t[0][0],t[0][1]),this.drawingContext.lineTo(t[1][0],t[1][1]),this.drawingContext.lineTo(t[2][0],t[2][1]),this._doFill&&this._pInst.fill(t[2][5]),this._doStroke&&this._pInst.stroke(t[2][6]),this._doFillStrokeClose(),p=3;p<u;p++)l=t[p],this.drawingContext.beginPath(),this.drawingContext.moveTo(t[0][0],t[0][1]),this.drawingContext.lineTo(t[p-1][0],t[p-1][1]),this.drawingContext.lineTo(l[0],l[1]),this._doFill&&this._pInst.fill(l[5]),this._doStroke&&this._pInst.stroke(l[6]),this._doFillStrokeClose()}else if(a===r.QUADS)for(p=0;p+3<u;p+=4){for(l=t[p],this.drawingContext.beginPath(),this.drawingContext.moveTo(l[0],l[1]),c=1;c<4;c++)this.drawingContext.lineTo(t[p+c][0],t[p+c][1]);this.drawingContext.lineTo(l[0],l[1]),this._doFill&&this._pInst.fill(t[p+3][5]),this._doStroke&&this._pInst.stroke(t[p+3][6]),this._doFillStrokeClose()}else if(a===r.QUAD_STRIP){if(u>3)for(p=0;p+1<u;p+=2)l=t[p],this.drawingContext.beginPath(),p+3<u?(this.drawingContext.moveTo(t[p+2][0],t[p+2][1]),this.drawingContext.lineTo(l[0],l[1]),this.drawingContext.lineTo(t[p+1][0],t[p+1][1]),this.drawingContext.lineTo(t[p+3][0],t[p+3][1]),this._doFill&&this._pInst.fill(t[p+3][5]),this._doStroke&&this._pInst.stroke(t[p+3][6])):(this.drawingContext.moveTo(l[0],l[1]),this.drawingContext.lineTo(t[p+1][0],t[p+1][1])),this._doFillStrokeClose()}else{for(this.drawingContext.beginPath(),this.drawingContext.moveTo(t[0][0],t[0][1]),p=1;p<u;p++)l=t[p],l.isVert&&(l.moveTo?this.drawingContext.moveTo(l[0],l[1]):this.drawingContext.lineTo(l[0],l[1]));this._doFillStrokeClose()}else{for(this.drawingContext.beginPath(),p=0;p<u;p++)t[p].isVert?t[p].moveTo?this.drawingContext.moveTo([0],t[p][1]):this.drawingContext.lineTo(t[p][0],t[p][1]):this.drawingContext.quadraticCurveTo(t[p][0],t[p][1],t[p][2],t[p][3]);this._doFillStrokeClose()}else{for(this.drawingContext.beginPath(),p=0;p<u;p++)t[p].isVert?t[p].moveTo?this.drawingContext.moveTo(t[p][0],t[p][1]):this.drawingContext.lineTo(t[p][0],t[p][1]):this.drawingContext.bezierCurveTo(t[p][0],t[p][1],t[p][2],t[p][3],t[p][4],t[p][5]);this._doFillStrokeClose()}else if(u>3){var m=[],d=1-this._curveTightness;for(this.drawingContext.beginPath(),this.drawingContext.moveTo(t[1][0],t[1][1]),p=1;p+2<u;p++)l=t[p],m[0]=[l[0],l[1]],m[1]=[l[0]+(d*t[p+1][0]-d*t[p-1][0])/6,l[1]+(d*t[p+1][1]-d*t[p-1][1])/6],m[2]=[t[p+1][0]+(d*t[p][0]-d*t[p+2][0])/6,t[p+1][1]+(d*t[p][1]-d*t[p+2][1])/6],m[3]=[t[p+1][0],t[p+1][1]],this.drawingContext.bezierCurveTo(m[1][0],m[1][1],m[2][0],m[2][1],m[3][0],m[3][1]);h&&this.drawingContext.lineTo(t[p+1][0],t[p+1][1]),this._doFillStrokeClose()}return o=!1,i=!1,n=!1,s=!1,h&&t.pop(),this},i.Renderer2D.prototype.noSmooth=function(){return"imageSmoothingEnabled"in this.drawingContext?this.drawingContext.imageSmoothingEnabled=!1:"mozImageSmoothingEnabled"in this.drawingContext?this.drawingContext.mozImageSmoothingEnabled=!1:"webkitImageSmoothingEnabled"in this.drawingContext?this.drawingContext.webkitImageSmoothingEnabled=!1:"msImageSmoothingEnabled"in this.drawingContext&&(this.drawingContext.msImageSmoothingEnabled=!1),this},i.Renderer2D.prototype.smooth=function(){return"imageSmoothingEnabled"in this.drawingContext?this.drawingContext.imageSmoothingEnabled=!0:"mozImageSmoothingEnabled"in this.drawingContext?this.drawingContext.mozImageSmoothingEnabled=!0:"webkitImageSmoothingEnabled"in this.drawingContext?this.drawingContext.webkitImageSmoothingEnabled=!0:"msImageSmoothingEnabled"in this.drawingContext&&(this.drawingContext.msImageSmoothingEnabled=!0),this},i.Renderer2D.prototype.strokeCap=function(e){return e!==r.ROUND&&e!==r.SQUARE&&e!==r.PROJECT||(this.drawingContext.lineCap=e),this},i.Renderer2D.prototype.strokeJoin=function(e){return e!==r.ROUND&&e!==r.BEVEL&&e!==r.MITER||(this.drawingContext.lineJoin=e),this},i.Renderer2D.prototype.strokeWeight=function(e){return this.drawingContext.lineWidth=void 0===e||0===e?1e-4:e,this},i.Renderer2D.prototype._getFill=function(){return this.drawingContext.fillStyle},i.Renderer2D.prototype._getStroke=function(){return this.drawingContext.strokeStyle},i.Renderer2D.prototype.bezier=function(e,t,o,i,n,r,s,a){return this._pInst.beginShape(),this._pInst.vertex(e,t),this._pInst.bezierVertex(o,i,n,r,s,a),this._pInst.endShape(),this},i.Renderer2D.prototype.curve=function(e,t,o,i,n,r,s,a){return this._pInst.beginShape(),this._pInst.curveVertex(e,t),this._pInst.curveVertex(o,i),this._pInst.curveVertex(n,r),this._pInst.curveVertex(s,a),this._pInst.endShape(),this},i.Renderer2D.prototype._doFillStrokeClose=function(){this._doFill&&this.drawingContext.fill(),this._doStroke&&this.drawingContext.stroke(),this.drawingContext.closePath()},i.Renderer2D.prototype.applyMatrix=function(e,t,o,i,n,r){this.drawingContext.transform(e,t,o,i,n,r)},i.Renderer2D.prototype.resetMatrix=function(){return this.drawingContext.setTransform(1,0,0,1,0,0),this.drawingContext.scale(this._pInst._pixelDensity,this._pInst._pixelDensity),this},i.Renderer2D.prototype.rotate=function(e){this.drawingContext.rotate(e)},i.Renderer2D.prototype.scale=function(e,t){return this.drawingContext.scale(e,t),this},i.Renderer2D.prototype.shearX=function(e){return this._pInst._angleMode===r.DEGREES&&(e=this._pInst.degrees(e)),this.drawingContext.transform(1,0,this._pInst.tan(e),1,0,0),this},i.Renderer2D.prototype.shearY=function(e){return this._pInst._angleMode===r.DEGREES&&(e=this._pInst.degrees(e)),this.drawingContext.transform(1,this._pInst.tan(e),0,1,0,0),this},i.Renderer2D.prototype.translate=function(e,t){return this.drawingContext.translate(e,t),this},i.Renderer2D.prototype.text=function(e,t,o,i,n){var s,a,l,h,p,c,u,m,d,y,b=this._pInst,f=Number.MAX_VALUE;if(this._doFill||this._doStroke){if("string"!=typeof e&&(e=e.toString()),e=e.replace(/(\t)/g,"  "),s=e.split("\n"),void 0!==i){for(d=0,l=0;l<s.length;l++)for(p="",m=s[l].split(" "),a=0;a<m.length;a++)c=p+m[a]+" ",u=this.textWidth(c),u>i?(p=m[a]+" ",d+=b.textLeading()):p=c;switch(this._rectMode===r.CENTER&&(t-=i/2,o-=n/2),this.drawingContext.textAlign){case r.CENTER:t+=i/2;break;case r.RIGHT:t+=i}if(void 0!==n){switch(this.drawingContext.textBaseline){case r.BOTTOM:o+=n-d;break;case r._CTX_MIDDLE:o+=(n-d)/2;break;case r.BASELINE:y=!0,this.drawingContext.textBaseline=r.TOP}f=o+n-b.textAscent()}for(l=0;l<s.length;l++){for(p="",m=s[l].split(" "),a=0;a<m.length;a++)c=p+m[a]+" ",u=this.textWidth(c),u>i&&p.length>0?(this._renderText(b,p,t,o,f),p=m[a]+" ",o+=b.textLeading()):p=c;this._renderText(b,p,t,o,f),o+=b.textLeading()}}else{var _=0,v=b.textAlign().vertical;for(v===r.CENTER?_=(s.length-1)*b.textLeading()/2:v===r.BOTTOM&&(_=(s.length-1)*b.textLeading()),h=0;h<s.length;h++)this._renderText(b,s[h],t,o-_,f),o+=b.textLeading()}return y&&(this.drawingContext.textBaseline=r.BASELINE),b}},i.Renderer2D.prototype._renderText=function(e,t,o,i,n){if(!(i>=n))return e.push(),this._isOpenType()?this._textFont._renderPath(t,o,i,{renderer:this}):(this._doStroke&&this._strokeSet&&this.drawingContext.strokeText(t,o,i),this._doFill&&(this.drawingContext.fillStyle=this._fillSet?this.drawingContext.fillStyle:r._DEFAULT_TEXT_FILL,this.drawingContext.fillText(t,o,i))),e.pop(),e},i.Renderer2D.prototype.textWidth=function(e){return this._isOpenType()?this._textFont._textWidth(e,this._textSize):this.drawingContext.measureText(e).width},i.Renderer2D.prototype.textAlign=function(e,t){if(arguments.length)return e!==r.LEFT&&e!==r.RIGHT&&e!==r.CENTER||(this.drawingContext.textAlign=e),t!==r.TOP&&t!==r.BOTTOM&&t!==r.CENTER&&t!==r.BASELINE||(t===r.CENTER?this.drawingContext.textBaseline=r._CTX_MIDDLE:this.drawingContext.textBaseline=t),this._pInst;var o=this.drawingContext.textBaseline;return o===r._CTX_MIDDLE&&(o=r.CENTER),{horizontal:this.drawingContext.textAlign,vertical:o}},i.Renderer2D.prototype._applyTextProperties=function(){var e,t=this._pInst;return this._setProperty("_textAscent",null),this._setProperty("_textDescent",null),e=this._textFont,this._isOpenType()&&(e=this._textFont.font.familyName,this._setProperty("_textStyle",this._textFont.font.styleName)),this.drawingContext.font=this._textStyle+" "+this._textSize+"px "+e,t},i.Renderer2D.prototype.push=function(){this.drawingContext.save()},i.Renderer2D.prototype.pop=function(){this.drawingContext.restore()},t.exports=i.Renderer2D},{"../image/filters":59,"./canvas":40,"./constants":41,"./core":42,"./p5.Renderer":48}],50:[function(e,t,o){var i=e("./core"),n=e("./constants");e("./p5.Graphics"),e("./p5.Renderer2D"),e("../webgl/p5.RendererGL");var r="defaultCanvas0";i.prototype.createCanvas=function(e,t,o){var s,a,l=o||n.P2D;if(arguments[3]&&(s="boolean"==typeof arguments[3]&&arguments[3]),l===n.WEBGL)a=document.getElementById(r),a&&a.parentNode.removeChild(a),a=document.createElement("canvas"),a.id=r;else if(s){a=document.createElement("canvas");for(var h=0;document.getElementById("defaultCanvas"+h);)h++;r="defaultCanvas"+h,a.id=r}else a=this.canvas;return this._setupDone||(a.dataset.hidden=!0,a.style.visibility="hidden"),this._userNode?this._userNode.appendChild(a):document.body.appendChild(a),l===n.WEBGL?(this._setProperty("_renderer",new i.RendererGL(a,this,!0)),this._isdefaultGraphics=!0):this._isdefaultGraphics||(this._setProperty("_renderer",new i.Renderer2D(a,this,!0)),this._isdefaultGraphics=!0),this._renderer.resize(e,t),this._renderer._applyDefaults(),s&&this._elements.push(this._renderer),this._renderer},i.prototype.resizeCanvas=function(e,t,o){if(this._renderer){var i={};for(var n in this.drawingContext){var r=this.drawingContext[n];"object"!=typeof r&&"function"!=typeof r&&(i[n]=r)}this._renderer.resize(e,t);for(var s in i)this.drawingContext[s]=i[s];o||this.redraw()}},i.prototype.noCanvas=function(){this.canvas&&this.canvas.parentNode.removeChild(this.canvas)},i.prototype.createGraphics=function(e,t,o){return new i.Graphics(e,t,o,this)},i.prototype.blendMode=function(e){if(e!==n.BLEND&&e!==n.DARKEST&&e!==n.LIGHTEST&&e!==n.DIFFERENCE&&e!==n.MULTIPLY&&e!==n.EXCLUSION&&e!==n.SCREEN&&e!==n.REPLACE&&e!==n.OVERLAY&&e!==n.HARD_LIGHT&&e!==n.SOFT_LIGHT&&e!==n.DODGE&&e!==n.BURN&&e!==n.ADD&&e!==n.NORMAL)throw new Error("Mode "+e+" not recognized.");this._renderer.blendMode(e)},t.exports=i},{"../webgl/p5.RendererGL":91,"./constants":41,"./core":42,"./p5.Graphics":47,"./p5.Renderer2D":49}],51:[function(e,t,o){window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}(),window.performance=window.performance||{},window.performance.now=function(){var e=Date.now();return window.performance.now||window.performance.mozNow||window.performance.msNow||window.performance.oNow||window.performance.webkitNow||function(){return Date.now()-e}}(),function(){"use strict";"undefined"==typeof Uint8ClampedArray||Uint8ClampedArray.prototype.slice||Object.defineProperty(Uint8ClampedArray.prototype,"slice",{value:Array.prototype.slice,writable:!0,configurable:!0,enumerable:!1})}()},{}],52:[function(e,t,o){"use strict";var i=e("./core");i.prototype.exit=function(){throw"exit() not implemented, see remove()"},i.prototype.noLoop=function(){this._loop=!1},i.prototype.loop=function(){this._loop=!0,this._draw()},i.prototype.push=function(){this._renderer.push(),this._styles.push({_doStroke:this._renderer._doStroke,_strokeSet:this._renderer._strokeSet,_doFill:this._renderer._doFill,_fillSet:this._renderer._fillSet,_tint:this._renderer._tint,_imageMode:this._renderer._imageMode,_rectMode:this._renderer._rectMode,_ellipseMode:this._renderer._ellipseMode,_colorMode:this._renderer._colorMode,_textFont:this._renderer._textFont,_textLeading:this._renderer._textLeading,_textSize:this._renderer._textSize,_textStyle:this._renderer._textStyle})},i.prototype.pop=function(){this._renderer.pop();var e=this._styles.pop();for(var t in e)this._renderer[t]=e[t]},i.prototype.pushStyle=function(){throw new Error("pushStyle() not used, see push()")},i.prototype.popStyle=function(){throw new Error("popStyle() not used, see pop()")},i.prototype.redraw=function(){this.resetMatrix(),this._renderer.isP3D&&this._renderer._update();var e=1;if(1===arguments.length)try{parseInt(arguments[0])>1&&(e=parseInt(arguments[0]))}catch(e){}var t=this.setup||window.setup,o=this.draw||window.draw;if("function"==typeof o){void 0===t&&this.scale(this._pixelDensity,this._pixelDensity);for(var i=this,n=function(e){e.call(i)},r=0;r<e;r++)this._registeredMethods.pre.forEach(n),o(),this._registeredMethods.post.forEach(n)}},i.prototype.size=function(){var e="size() is not a valid p5 function, to set the size of the ";throw e+="drawing canvas, please use createCanvas() instead"},t.exports=i},{"./core":42}],53:[function(e,t,o){"use strict";var i=e("./core"),n=e("./constants");i.prototype.applyMatrix=function(e,t,o,i,n,r){return this._renderer.applyMatrix(e,t,o,i,n,r),this},i.prototype.popMatrix=function(){throw new Error("popMatrix() not used, see pop()")},i.prototype.printMatrix=function(){throw new Error("printMatrix() not implemented")},i.prototype.pushMatrix=function(){throw new Error("pushMatrix() not used, see push()")},i.prototype.resetMatrix=function(){return this._renderer.resetMatrix(),this},i.prototype.rotate=function(){for(var e,t=new Array(arguments.length),o=0;o<t.length;++o)t[o]=arguments[o];return this._angleMode===n.DEGREES?e=this.radians(t[0]):this._angleMode===n.RADIANS&&(e=t[0]),t.length>1?this._renderer.rotate(e,t[1]):this._renderer.rotate(e),this},i.prototype.rotateX=function(e){if(!this._renderer.isP3D)throw"not supported in p2d. Please use webgl mode";return this._renderer.rotateX(e),this},i.prototype.rotateY=function(e){if(!this._renderer.isP3D)throw"not supported in p2d. Please use webgl mode";return this._renderer.rotateY(e),this},i.prototype.rotateZ=function(e){if(!this._renderer.isP3D)throw"not supported in p2d. Please use webgl mode";return this._renderer.rotateZ(e),this},i.prototype.scale=function(){for(var e,t,o,n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return n[0]instanceof i.Vector?(e=n[0].x,t=n[0].y,o=n[0].z):n[0]instanceof Array?(e=n[0][0],t=n[0][1],o=n[0][2]||1):1===n.length?e=t=o=n[0]:(e=n[0],t=n[1],o=n[2]||1),this._renderer.isP3D?this._renderer.scale.call(this._renderer,e,t,o):this._renderer.scale.call(this._renderer,e,t),this},i.prototype.shearX=function(e){return this._angleMode===n.DEGREES&&(e=this.radians(e)),this._renderer.shearX(e),this},i.prototype.shearY=function(e){return this._angleMode===n.DEGREES&&(e=this.radians(e)),this._renderer.shearY(e),this},i.prototype.translate=function(e,t,o){return this._renderer.isP3D?this._renderer.translate(e,t,o):this._renderer.translate(e,t),this},t.exports=i},{"./constants":41,"./core":42}],54:[function(e,t,o){"use strict";var i=e("./core"),n=e("./constants"),r=null,s=[],a=[],l=!1,h=!1,p=!1,c=!1,u=!0;i.prototype.beginContour=function(){return a=[],c=!0,this},i.prototype.beginShape=function(e){return r=e===n.POINTS||e===n.LINES||e===n.TRIANGLES||e===n.TRIANGLE_FAN||e===n.TRIANGLE_STRIP||e===n.QUADS||e===n.QUAD_STRIP?e:null,this._renderer.isP3D?this._renderer.beginShape(e):(s=[],a=[]),this},i.prototype.bezierVertex=function(e,t,o,i,n,r){if(0===s.length)throw"vertex() must be used once before calling bezierVertex()";l=!0;for(var h=[],p=0;p<arguments.length;p++)h[p]=arguments[p];return h.isVert=!1,c?a.push(h):s.push(h),this},i.prototype.curveVertex=function(e,t){return h=!0,this.vertex(e,t),this},i.prototype.endContour=function(){var e=a[0].slice();e.isVert=a[0].isVert,e.moveTo=!1,a.push(e),u&&(s.push(s[0]),u=!1);for(var t=0;t<a.length;t++)s.push(a[t]);return this},i.prototype.endShape=function(e){if(this._renderer.isP3D)this._renderer.endShape(e,h,l,p,c,r);else{if(0===s.length)return this;if(!this._renderer._doStroke&&!this._renderer._doFill)return this;var t=e===n.CLOSE;t&&!c&&s.push(s[0]),this._renderer.endShape(e,s,h,l,p,c,r),h=!1,l=!1,p=!1,c=!1,u=!0,t&&s.pop()}return this},i.prototype.quadraticVertex=function(e,t,o,i){if(this._contourInited){var r={};return r.x=e,r.y=t,r.x3=o,r.y3=i,r.type=n.QUADRATIC,this._contourVertices.push(r),this}if(!(s.length>0))throw"vertex() must be used once before calling quadraticVertex()";p=!0;for(var l=[],h=0;h<arguments.length;h++)l[h]=arguments[h];return l.isVert=!1,c?a.push(l):s.push(l),this},i.prototype.vertex=function(e,t,o){if(this._renderer.isP3D)this._renderer.vertex(e,t,o);else{var i=[];i.isVert=!0,i[0]=e,i[1]=t,i[2]=0,i[3]=0,i[4]=0,i[5]=this._renderer._getFill(),i[6]=this._renderer._getStroke(),o&&(i.moveTo=o),c?(0===a.length&&(i.moveTo=!0),a.push(i)):s.push(i)}return this},t.exports=i},{"./constants":41,"./core":42}],55:[function(e,t,o){"use strict";var i=e("../core/core");i.prototype.deviceOrientation=void 0,i.prototype.accelerationX=0,i.prototype.accelerationY=0,i.prototype.accelerationZ=0,i.prototype.pAccelerationX=0,i.prototype.pAccelerationY=0,i.prototype.pAccelerationZ=0,i.prototype._updatePAccelerations=function(){this._setProperty("pAccelerationX",this.accelerationX),this._setProperty("pAccelerationY",this.accelerationY),this._setProperty("pAccelerationZ",this.accelerationZ)},i.prototype.rotationX=0,i.prototype.rotationY=0,i.prototype.rotationZ=0,i.prototype.pRotationX=0,i.prototype.pRotationY=0,i.prototype.pRotationZ=0;var n,r,s,a=0,l=0,h=0,p="clockwise",c="clockwise",u="clockwise";i.prototype._updatePRotations=function(){this._setProperty("pRotationX",this.rotationX),this._setProperty("pRotationY",this.rotationY),this._setProperty("pRotationZ",this.rotationZ)},i.prototype.turnAxis=void 0;var m=.5,d=30;i.prototype.setMoveThreshold=function(e){"number"==typeof e&&(m=e)},i.prototype.setShakeThreshold=function(e){"number"==typeof e&&(d=e)},i.prototype._ondeviceorientation=function(e){this._updatePRotations(),this._setProperty("rotationX",e.beta),this._setProperty("rotationY",e.gamma),this._setProperty("rotationZ",e.alpha),this._handleMotion()},i.prototype._ondevicemotion=function(e){this._updatePAccelerations(),this._setProperty("accelerationX",2*e.acceleration.x),this._setProperty("accelerationY",2*e.acceleration.y),this._setProperty("accelerationZ",2*e.acceleration.z),this._handleMotion()},i.prototype._handleMotion=function(){90===window.orientation||-90===window.orientation?this._setProperty("deviceOrientation","landscape"):0===window.orientation?this._setProperty("deviceOrientation","portrait"):void 0===window.orientation&&this._setProperty("deviceOrientation","undefined");var e=this.deviceMoved||window.deviceMoved;"function"==typeof e&&(Math.abs(this.accelerationX-this.pAccelerationX)>m||Math.abs(this.accelerationY-this.pAccelerationY)>m||Math.abs(this.accelerationZ-this.pAccelerationZ)>m)&&e();var t=this.deviceTurned||window.deviceTurned;if("function"==typeof t){var o=this.rotationX+180,i=this.pRotationX+180,y=a+180;o-i>0&&o-i<270||o-i<-270?p="clockwise":(o-i<0||o-i>270)&&(p="counter-clockwise"),p!==n&&(y=o),Math.abs(o-y)>90&&Math.abs(o-y)<270&&(y=o,this._setProperty("turnAxis","X"),t()),n=p,a=y-180;var b=this.rotationY+180,f=this.pRotationY+180,_=l+180;b-f>0&&b-f<270||b-f<-270?c="clockwise":(b-f<0||b-this.pRotationY>270)&&(c="counter-clockwise"),c!==r&&(_=b),Math.abs(b-_)>90&&Math.abs(b-_)<270&&(_=b,this._setProperty("turnAxis","Y"),t()),r=c,l=_-180,this.rotationZ-this.pRotationZ>0&&this.rotationZ-this.pRotationZ<270||this.rotationZ-this.pRotationZ<-270?u="clockwise":(this.rotationZ-this.pRotationZ<0||this.rotationZ-this.pRotationZ>270)&&(u="counter-clockwise"),u!==s&&(h=this.rotationZ),Math.abs(this.rotationZ-h)>90&&Math.abs(this.rotationZ-h)<270&&(h=this.rotationZ,this._setProperty("turnAxis","Z"),t()),s=u,this._setProperty("turnAxis",void 0)}var v=this.deviceShaken||window.deviceShaken;if("function"==typeof v){var g,x;null!==this.pAccelerationX&&(g=Math.abs(this.accelerationX-this.pAccelerationX),x=Math.abs(this.accelerationY-this.pAccelerationY)),g+x>d&&v()}},t.exports=i},{"../core/core":42}],56:[function(e,t,o){"use strict";function i(){for(var e in r)if(r.hasOwnProperty(e)&&!0===r[e])return!0;return!1}var n=e("../core/core"),r={};n.prototype.isKeyPressed=!1,n.prototype.keyIsPressed=!1,n.prototype.key="",n.prototype.keyCode=0,n.prototype._onkeydown=function(e){if(!r[e.which]){this._setProperty("isKeyPressed",!0),this._setProperty("keyIsPressed",!0),this._setProperty("keyCode",e.which),r[e.which]=!0;var t=String.fromCharCode(e.which);t||(t=e.which),this._setProperty("key",t);var o=this.keyPressed||window.keyPressed;"function"!=typeof o||e.charCode||!1===o(e)&&e.preventDefault()}},n.prototype._onkeyup=function(e){var t=this.keyReleased||window.keyReleased;r[e.which]=!1,i()||(this._setProperty("isKeyPressed",!1),this._setProperty("keyIsPressed",!1)),this._setProperty("_lastKeyCodeTyped",null);var o=String.fromCharCode(e.which);o||(o=e.which),this._setProperty("key",o),this._setProperty("keyCode",e.which),"function"==typeof t&&!1===t(e)&&e.preventDefault()},n.prototype._onkeypress=function(e){if(e.which!==this._lastKeyCodeTyped){this._setProperty("keyCode",e.which),this._setProperty("_lastKeyCodeTyped",e.which),this._setProperty("key",String.fromCharCode(e.which));var t=this.keyTyped||window.keyTyped;"function"==typeof t&&!1===t(e)&&e.preventDefault()}},n.prototype._onblur=function(e){r={}},n.prototype.keyIsDown=function(e){return r[e]},t.exports=n},{"../core/core":42}],57:[function(e,t,o){"use strict";function i(e,t,o,i){i&&!i.clientX&&(i.touches?i=i.touches[0]:i.changedTouches&&(i=i.changedTouches[0]));var n=e.getBoundingClientRect(),r=e.scrollWidth/t,s=e.scrollHeight/o;return{x:(i.clientX-n.left)/r,y:(i.clientY-n.top)/s,winX:i.clientX,winY:i.clientY,id:i.identifier}}var n=e("../core/core"),r=e("../core/constants");n.prototype._hasMouseInteracted=!1,n.prototype.mouseX=0,n.prototype.mouseY=0,n.prototype.pmouseX=0,n.prototype.pmouseY=0,n.prototype.winMouseX=0,n.prototype.winMouseY=0,n.prototype.pwinMouseX=0,n.prototype.pwinMouseY=0,n.prototype.mouseButton=0,n.prototype.mouseIsPressed=!1,n.prototype._updateNextMouseCoords=function(e){if(null!==this._curElement&&(!e.touches||e.touches.length>0)){var t=i(this._curElement.elt,this.width,this.height,e);this._setProperty("mouseX",t.x),this._setProperty("mouseY",t.y),this._setProperty("winMouseX",t.winX),this._setProperty("winMouseY",t.winY)}this._hasMouseInteracted||(this._updateMouseCoords(),this._setProperty("_hasMouseInteracted",!0))},n.prototype._updateMouseCoords=function(){this._setProperty("pmouseX",this.mouseX),this._setProperty("pmouseY",this.mouseY),this._setProperty("pwinMouseX",this.winMouseX),this._setProperty("pwinMouseY",this.winMouseY)},n.prototype._setMouseButton=function(e){1===e.button?this._setProperty("mouseButton",r.CENTER):2===e.button?this._setProperty("mouseButton",r.RIGHT):this._setProperty("mouseButton",r.LEFT)},n.prototype._onmousemove=function(e){var t=this._isGlobal?window:this;this._updateNextMouseCoords(e),this.mouseIsPressed?"function"==typeof t.mouseDragged?!1===t.mouseDragged(e)&&e.preventDefault():"function"==typeof t.touchMoved&&!1===t.touchMoved(e)&&e.preventDefault():"function"==typeof t.mouseMoved&&!1===t.mouseMoved(e)&&e.preventDefault()},n.prototype._onmousedown=function(e){var t=this._isGlobal?window:this;this._setProperty("mouseIsPressed",!0),this._setMouseButton(e),this._updateNextMouseCoords(e),"function"==typeof t.mousePressed?!1===t.mousePressed(e)&&e.preventDefault():"function"==typeof t.touchStarted&&!1===t.touchStarted(e)&&e.preventDefault()},n.prototype._onmouseup=function(e){var t=this._isGlobal?window:this;this._setProperty("mouseIsPressed",!1),"function"==typeof t.mouseReleased?!1===t.mouseReleased(e)&&e.preventDefault():"function"==typeof t.touchEnded&&!1===t.touchEnded(e)&&e.preventDefault()},n.prototype._ondragend=n.prototype._onmouseup,n.prototype._ondragover=n.prototype._onmousemove,n.prototype._onclick=function(e){var t=this._isGlobal?window:this;"function"==typeof t.mouseClicked&&!1===t.mouseClicked(e)&&e.preventDefault()},n.prototype._onwheel=function(e){var t=this._isGlobal?window:this;"function"==typeof t.mouseWheel&&(e.delta=e.deltaY,!1===t.mouseWheel(e)&&e.preventDefault())},t.exports=n},{"../core/constants":41,"../core/core":42}],58:[function(e,t,o){"use strict";function i(e,t,o,i,n){n=n||0;var r=e.getBoundingClientRect(),s=e.scrollWidth/t,a=e.scrollHeight/o,l=i.touches[n]||i.changedTouches[n];return{x:(l.clientX-r.left)/s,y:(l.clientY-r.top)/a,winX:l.clientX,winY:l.clientY,id:l.identifier}}var n=e("../core/core");n.prototype.touches=[],n.prototype._updateTouchCoords=function(e){if(null!==this._curElement){for(var t=[],o=0;o<e.touches.length;o++)t[o]=i(this._curElement.elt,this.width,this.height,e,o);this._setProperty("touches",t)}},n.prototype._ontouchstart=function(e){var t=this._isGlobal?window:this;this._setProperty("mouseIsPressed",!0),this._updateTouchCoords(e),this._updateNextMouseCoords(e),"function"==typeof t.touchStarted?!1===t.touchStarted(e)&&e.preventDefault():"function"==typeof t.mousePressed&&!1===t.mousePressed(e)&&e.preventDefault()},n.prototype._ontouchmove=function(e){var t=this._isGlobal?window:this;this._updateTouchCoords(e),this._updateNextMouseCoords(e),"function"==typeof t.touchMoved?!1===t.touchMoved(e)&&e.preventDefault():"function"==typeof t.mouseDragged&&!1===t.mouseDragged(e)&&e.preventDefault()},n.prototype._ontouchend=function(e){this._setProperty("mouseIsPressed",!1),this._updateTouchCoords(e),this._updateNextMouseCoords(e);var t=this._isGlobal?window:this;"function"==typeof t.touchEnded?!1===t.touchEnded(e)&&e.preventDefault():"function"==typeof t.mouseReleased&&!1===t.mouseReleased(e)&&e.preventDefault()},t.exports=n},{"../core/core":42}],59:[function(e,t,o){"use strict";function i(e){var t=3.5*e|0;if(t=t<1?1:t<248?t:248,s!==t){s=t,a=1+s<<1,l=new Int32Array(a),h=new Array(a);for(var o=0;o<a;o++)h[o]=new Int32Array(256);for(var i,n,r,p,c=1,u=t-1;c<t;c++){l[t+c]=l[u]=n=u*u,r=h[t+c],p=h[u--];for(var m=0;m<256;m++)r[m]=p[m]=n*m}i=l[t]=t*t,r=h[t];for(var d=0;d<256;d++)r[d]=i*d}}function n(e,t){for(var o=r._toPixels(e),n=e.width,p=e.height,c=n*p,u=new Int32Array(c),m=0;m<c;m++)u[m]=r._getARGB(o,m);var d,y,b,f,_,v,g,x,S,A,C=new Int32Array(c),w=new Int32Array(c),V=new Int32Array(c),B=new Int32Array(c),M=0;i(t);var T,P,R,E;for(P=0;P<p;P++){for(T=0;T<n;T++){if(f=b=y=_=d=0,(v=T-s)<0)A=-v,v=0;else{if(v>=n)break;A=0}for(R=A;R<a&&!(v>=n);R++){var I=u[v+M];E=h[R],_+=E[(-16777216&I)>>>24],y+=E[(16711680&I)>>16],b+=E[(65280&I)>>8],f+=E[255&I],d+=l[R],v++}g=M+T,C[g]=_/d,w[g]=y/d,V[g]=b/d,B[g]=f/d}M+=n}for(M=0,x=-s,S=x*n,P=0;P<p;P++){for(T=0;T<n;T++){if(f=b=y=_=d=0,x<0)A=g=-x,v=T;else{if(x>=p)break;A=0,g=x,v=T+S}for(R=A;R<a&&!(g>=p);R++)E=h[R],_+=E[C[v]],y+=E[w[v]],b+=E[V[v]],f+=E[B[v]],d+=l[R],g++,v+=n;u[T+M]=_/d<<24|y/d<<16|b/d<<8|f/d}M+=n,S+=n,x++}r._setPixels(o,u)}var r={};r._toPixels=function(e){return e instanceof ImageData?e.data:e.getContext("2d").getImageData(0,0,e.width,e.height).data},r._getARGB=function(e,t){var o=4*t;return e[o+3]<<24&4278190080|e[o]<<16&16711680|e[o+1]<<8&65280|255&e[o+2]},r._setPixels=function(e,t){for(var o=0,i=0,n=e.length;i<n;i++)o=4*i,e[o+0]=(16711680&t[i])>>>16,e[o+1]=(65280&t[i])>>>8,e[o+2]=255&t[i],e[o+3]=(4278190080&t[i])>>>24},r._toImageData=function(e){return e instanceof ImageData?e:e.getContext("2d").getImageData(0,0,e.width,e.height)},r._createImageData=function(e,t){return r._tmpCanvas=document.createElement("canvas"),r._tmpCtx=r._tmpCanvas.getContext("2d"),this._tmpCtx.createImageData(e,t)},r.apply=function(e,t,o){var i=e.getContext("2d"),n=i.getImageData(0,0,e.width,e.height),r=t(n,o);r instanceof ImageData?i.putImageData(r,0,0,0,0,e.width,e.height):i.putImageData(n,0,0,0,0,e.width,e.height)},r.threshold=function(e,t){var o=r._toPixels(e);void 0===t&&(t=.5);for(var i=Math.floor(255*t),n=0;n<o.length;n+=4){var s;s=.2126*o[n]+.7152*o[n+1]+.0722*o[n+2]>=i?255:0,o[n]=o[n+1]=o[n+2]=s}},r.gray=function(e){for(var t=r._toPixels(e),o=0;o<t.length;o+=4){var i=t[o],n=t[o+1],s=t[o+2],a=.2126*i+.7152*n+.0722*s;t[o]=t[o+1]=t[o+2]=a}},r.opaque=function(e){for(var t=r._toPixels(e),o=0;o<t.length;o+=4)t[o+3]=255;return t},r.invert=function(e){for(var t=r._toPixels(e),o=0;o<t.length;o+=4)t[o]=255-t[o],t[o+1]=255-t[o+1],t[o+2]=255-t[o+2]},r.posterize=function(e,t){var o=r._toPixels(e);if(t<2||t>255)throw new Error("Level must be greater than 2 and less than 255 for posterize");for(var i=t-1,n=0;n<o.length;n+=4){var s=o[n],a=o[n+1],l=o[n+2];o[n]=255*(s*t>>8)/i,o[n+1]=255*(a*t>>8)/i,o[n+2]=255*(l*t>>8)/i}},r.dilate=function(e){for(var t,o,i,n,s,a,l,h,p,c,u,m,d,y,b,f,_,v=r._toPixels(e),g=0,x=v.length?v.length/4:0,S=new Int32Array(x);g<x;)for(t=g,o=g+e.width;g<o;)i=n=r._getARGB(v,g),l=g-1,a=g+1,h=g-e.width,p=g+e.width,l<t&&(l=g),a>=o&&(a=g),h<0&&(h=0),p>=x&&(p=g),m=r._getARGB(v,h),u=r._getARGB(v,l),d=r._getARGB(v,p),c=r._getARGB(v,a),s=77*(i>>16&255)+151*(i>>8&255)+28*(255&i),b=77*(u>>16&255)+151*(u>>8&255)+28*(255&u),y=77*(c>>16&255)+151*(c>>8&255)+28*(255&c),f=77*(m>>16&255)+151*(m>>8&255)+28*(255&m),_=77*(d>>16&255)+151*(d>>8&255)+28*(255&d),b>s&&(n=u,s=b),y>s&&(n=c,s=y),f>s&&(n=m,s=f),_>s&&(n=d,s=_),S[g++]=n;r._setPixels(v,S)},r.erode=function(e){for(var t,o,i,n,s,a,l,h,p,c,u,m,d,y,b,f,_,v=r._toPixels(e),g=0,x=v.length?v.length/4:0,S=new Int32Array(x);g<x;)for(t=g,o=g+e.width;g<o;)i=n=r._getARGB(v,g),l=g-1,a=g+1,h=g-e.width,p=g+e.width,l<t&&(l=g),a>=o&&(a=g),h<0&&(h=0),p>=x&&(p=g),m=r._getARGB(v,h),u=r._getARGB(v,l),d=r._getARGB(v,p),c=r._getARGB(v,a),s=77*(i>>16&255)+151*(i>>8&255)+28*(255&i),b=77*(u>>16&255)+151*(u>>8&255)+28*(255&u),y=77*(c>>16&255)+151*(c>>8&255)+28*(255&c),f=77*(m>>16&255)+151*(m>>8&255)+28*(255&m),_=77*(d>>16&255)+151*(d>>8&255)+28*(255&d),b<s&&(n=u,s=b),y<s&&(n=c,s=y),f<s&&(n=m,s=f),_<s&&(n=d,s=_),S[g++]=n;r._setPixels(v,S)};var s,a,l,h;r.blur=function(e,t){n(e,t)},t.exports=r},{}],60:[function(e,t,o){"use strict";var i=e("../core/core"),n=[];i.prototype.createImage=function(e,t){return new i.Image(e,t)},i.prototype.saveCanvas=function(){var e,t,o;if(3===arguments.length?(e=arguments[0],t=arguments[1],o=arguments[2]):2===arguments.length?"object"==typeof arguments[0]?(e=arguments[0],t=arguments[1]):(t=arguments[0],o=arguments[1]):1===arguments.length&&("object"==typeof arguments[0]?e=arguments[0]:t=arguments[0]),e instanceof i.Element&&(e=e.elt),e instanceof HTMLCanvasElement||(e=null),o||""===(o=i.prototype._checkFileExtension(t,o)[1])&&(o="png"),e||this._curElement&&this._curElement.elt&&(e=this._curElement.elt),i.prototype._isSafari()){var n="Hello, Safari user!\n";n+="Now capturing a screenshot...\n",n+="To save this image,\n",n+="go to File --\x3e Save As.\n",alert(n),window.location.href=e.toDataURL()}else{var r;if(void 0===o)o="png",r="image/png";else switch(o){case"png":r="image/png";break;case"jpeg":case"jpg":r="image/jpeg";break;default:r="image/png"}var s=e.toDataURL(r);s=s.replace(r,"image/octet-stream"),i.prototype.downloadFile(s,t,o)}},i.prototype.saveFrames=function(e,t,o,r,s){var a=o||3;a=i.prototype.constrain(a,0,15),a*=1e3;var l=r||15;l=i.prototype.constrain(l,0,22);var h=0,p=i.prototype._makeFrame,c=this._curElement.elt,u=setInterval(function(){p(e+h,t,c),h++},1e3/l);setTimeout(function(){if(clearInterval(u),s)s(n);else for(var e=0;e<n.length;e++){var t=n[e];i.prototype.downloadFile(t.imageData,t.filename,t.ext)}n=[]},a+.01)},i.prototype._makeFrame=function(e,t,o){var i;i=this?this._curElement.elt:o;var r;if(t)switch(t.toLowerCase()){case"png":r="image/png";break;case"jpeg":case"jpg":r="image/jpeg";break;default:r="image/png"}else t="png",r="image/png";var s=i.toDataURL(r);s=s.replace(r,"image/octet-stream");var a={};a.imageData=s,a.filename=e,a.ext=t,n.push(a)},t.exports=i},{"../core/core":42}],61:[function(e,t,o){"use strict";function i(e,t){return e>0&&e<t?e:t}var n=e("../core/core"),r=e("./filters"),s=e("../core/canvas"),a=e("../core/constants");e("../core/error_helpers"),n.prototype.loadImage=function(e,t,o){var i=new Image,r=new n.Image(1,1,this),s=n._getDecrementPreload.apply(this,arguments);return i.onload=function(){r.width=r.canvas.width=i.width,r.height=r.canvas.height=i.height,r.drawingContext.drawImage(i,0,0),"function"==typeof t&&t(r),s&&t!==s&&s()},i.onerror=function(e){n._friendlyFileLoadError(0,i.src),"function"==typeof o&&o!==s&&o(e)},0!==e.indexOf("data:image/")&&(i.crossOrigin="Anonymous"),i.src=e,r},n.prototype.image=function(e,t,o,n,r,a,l,h,p){var c=e.width,u=e.height;e.elt&&e.elt.videoWidth&&!e.canvas&&(c=e.elt.videoWidth,u=e.elt.videoHeight);var m=t,d=o,y=n||c,b=r||u,f=a||0,_=l||0,v=h||c,g=p||u;v=i(v,c),g=i(g,u);var x=1;e.elt&&!e.canvas&&e.elt.style.width&&(x=e.elt.videoWidth&&!n?e.elt.videoWidth:e.elt.width,x/=parseInt(e.elt.style.width,10)),f*=x,_*=x,g*=x,v*=x;var S=s.modeAdjust(m,d,y,b,this._renderer._imageMode);this._renderer.image(e,f,_,v,g,S.x,S.y,S.w,S.h)},n.prototype.tint=function(){var e=this.color.apply(this,arguments);this._renderer._tint=e.levels},n.prototype.noTint=function(){this._renderer._tint=null},n.prototype._getTintedImageCanvas=function(e){if(!e.canvas)return e;var t=r._toPixels(e.canvas),o=document.createElement("canvas");o.width=e.canvas.width,o.height=e.canvas.height;for(var i=o.getContext("2d"),n=i.createImageData(e.canvas.width,e.canvas.height),s=n.data,a=0;a<t.length;a+=4){var l=t[a],h=t[a+1],p=t[a+2],c=t[a+3];s[a]=l*this._renderer._tint[0]/255,s[a+1]=h*this._renderer._tint[1]/255,s[a+2]=p*this._renderer._tint[2]/255,s[a+3]=c*this._renderer._tint[3]/255}return i.putImageData(n,0,0),o},n.prototype.imageMode=function(e){e!==a.CORNER&&e!==a.CORNERS&&e!==a.CENTER||(this._renderer._imageMode=e)},t.exports=n},{"../core/canvas":40,"../core/constants":41,"../core/core":42,"../core/error_helpers":45,"./filters":59}],62:[function(e,t,o){"use strict";var i=e("../core/core"),n=e("./filters");i.Image=function(e,t){this.width=e,this.height=t,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.drawingContext=this.canvas.getContext("2d"),this._pixelDensity=1,this.isTexture=!1,this.pixels=[]},i.Image.prototype._setProperty=function(e,t){this[e]=t},i.Image.prototype.loadPixels=function(){i.Renderer2D.prototype.loadPixels.call(this)},i.Image.prototype.updatePixels=function(e,t,o,n){i.Renderer2D.prototype.updatePixels.call(this,e,t,o,n)},i.Image.prototype.get=function(e,t,o,n){return i.Renderer2D.prototype.get.call(this,e,t,o,n)},i.Image.prototype.set=function(e,t,o){i.Renderer2D.prototype.set.call(this,e,t,o)},i.Image.prototype.resize=function(e,t){0===e&&0===t?(e=this.canvas.width,t=this.canvas.height):0===e?e=this.canvas.width*t/this.canvas.height:0===t&&(t=this.canvas.height*e/this.canvas.width),e=Math.floor(e),t=Math.floor(t);var o=document.createElement("canvas");o.width=e,o.height=t,o.getContext("2d").drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,o.width,o.height),this.canvas.width=this.width=e,this.canvas.height=this.height=t,this.drawingContext.drawImage(o,0,0,e,t,0,0,e,t),this.pixels.length>0&&this.loadPixels()},i.Image.prototype.copy=function(){i.prototype.copy.apply(this,arguments)},i.Image.prototype.mask=function(e){void 0===e&&(e=this);var t=this.drawingContext.globalCompositeOperation,o=1;e instanceof i.Renderer&&(o=e._pInst._pixelDensity);var n=[e,0,0,o*e.width,o*e.height,0,0,this.width,this.height];this.drawingContext.globalCompositeOperation="destination-in",i.Image.prototype.copy.apply(this,n),this.drawingContext.globalCompositeOperation=t},i.Image.prototype.filter=function(e,t){n.apply(this.canvas,n[e.toLowerCase()],t)},i.Image.prototype.blend=function(){i.prototype.blend.apply(this,arguments)},i.Image.prototype.save=function(e,t){var o;if(t)switch(t.toLowerCase()){case"png":o="image/png";break;case"jpeg":case"jpg":o="image/jpeg";break;default:o="image/png"}else t="png",o="image/png";var n=this.canvas.toDataURL(o);n=n.replace(o,"image/octet-stream"),i.prototype.downloadFile(n,e,t)},t.exports=i.Image},{"../core/core":42,"./filters":59}],63:[function(e,t,o){"use strict";var i=e("../core/core"),n=e("./filters");e("../color/p5.Color"),i.prototype.pixels=[],i.prototype.blend=function(){this._renderer?this._renderer.blend.apply(this._renderer,arguments):i.Renderer2D.prototype.blend.apply(this,arguments)},i.prototype.copy=function(){i.Renderer2D._copyHelper.apply(this,arguments)},i.prototype.filter=function(e,t){void 0!==this.canvas?n.apply(this.canvas,n[e.toLowerCase()],t):n.apply(this.elt,n[e.toLowerCase()],t)},i.prototype.get=function(e,t,o,i){return this._renderer.get(e,t,o,i)},i.prototype.loadPixels=function(){this._renderer.loadPixels()},i.prototype.set=function(e,t,o){this._renderer.set(e,t,o)},i.prototype.updatePixels=function(e,t,o,i){0!==this.pixels.length&&this._renderer.updatePixels(e,t,o,i)},t.exports=i},{"../color/p5.Color":36,"../core/core":42,"./filters":59}],64:[function(e,t,o){"use strict";function i(e,t){var o={};if(void 0===(t=t||[]))for(var i=0;i<e.length;i++)t[i.toString()]=i;for(var n=0;n<t.length;n++){var r=t[n],s=e[n];o[r]=s}return o}function n(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function r(e,t){t&&!0!==t&&"true"!==t||(t=""),e||(e="untitled");var o="";return e&&e.indexOf(".")>-1&&(o=e.split(".").pop()),t&&o!==t&&(o=t,e=e+"."+o),[e,o]}function s(e){document.body.removeChild(e.target)}var a=e("../core/core"),l=e("opentype.js");e("whatwg-fetch"),e("es6-promise").polyfill();var h=e("fetch-jsonp");e("../core/error_helpers"),a._getDecrementPreload=function(){var e=arguments[arguments.length-1];return(window.preload||this&&this.preload)&&"function"==typeof e?e:null},a.prototype.loadFont=function(e,t,o){var i=new a.Font(this),n=a._getDecrementPreload.apply(this,arguments);return l.load(e,function(r,s){if(r)return void 0!==o&&o!==n?o(r):(a._friendlyFileLoadError(4,e),void console.error(r,e));i.font=s,void 0!==t&&t(i),n&&t!==n&&n();var l,h,p=["ttf","otf","woff","woff2"],c=e.split("\\").pop().split("/").pop(),u=c.lastIndexOf("."),m=u<1?null:c.substr(u+1);p.indexOf(m)>-1&&(l=c.substr(0,u),h=document.createElement("style"),h.appendChild(document.createTextNode("\n@font-face {\nfont-family: "+l+";\nsrc: url("+e+");\n}\n")),document.head.appendChild(h))}),i},a.prototype.loadJSON=function(){for(var e,t,o,i=arguments[0],n=a._getDecrementPreload.apply(this,arguments),r={},s="json",l=1;l<arguments.length;l++){var h=arguments[l];"string"==typeof h?"jsonp"!==h&&"json"!==h||(s=h):"function"==typeof h&&h!==n?e?t=h:e=h:"object"==typeof h&&h.hasOwnProperty("jsonpCallback")&&(s="jsonp",o=h)}return a.prototype.httpDo(i,"GET",o,s,function(t){for(var o in t)r[o]=t[o];void 0!==e&&e(t),n&&e!==n&&n()},t),r},a.prototype.loadStrings=function(){for(var e,t,o=[],i=a._getDecrementPreload.apply(this,arguments),n=1;n<arguments.length;n++){var r=arguments[n];"function"==typeof r&&r!==i&&(void 0===e?e=r:t=r)}return a.prototype.httpDo(arguments[0],"GET","text",function(t){var n=t.match(/[^\r\n]+/g);for(var r in n)o[r]=n[r];void 0!==e&&e(o),i&&e!==i&&i()},t),o},a.prototype.loadTable=function(e){var t=null,o=null,n=[],r=!1,s=e.substring(e.lastIndexOf(".")+1,e.length),l=",",h=!1,p=a._getDecrementPreload.apply(this,arguments);"tsv"===s&&(l="\t");for(var c=1;c<arguments.length;c++)if("function"==typeof arguments[c]&&arguments[c]!==p)t?o=arguments[c]:t=arguments[c];else if("string"==typeof arguments[c])if(n.push(arguments[c]),"header"===arguments[c]&&(r=!0),"csv"===arguments[c]){if(h)throw new Error("Cannot set multiple separator types.");l=",",h=!0}else if("tsv"===arguments[c]){if(h)throw new Error("Cannot set multiple separator types.");l="\t",h=!0}var u=new a.Table;return a.prototype.httpDo(e,"GET","text",function(e){for(var o,n={},s='"',h=[],m=0,d=null,y=function(){n.currentState=0,n.token=""},b=function(){d.push(n.token),y()},f=function(){n.currentState=4,h.push(d),d=null};;){if(null==(o=e[m++])){if(n.escaped)throw new Error("Unclosed quote in file.");if(d){b(),f();break}}if(null===d&&function(){n.escaped=!1,d=[],y()}(),0===n.currentState){if(o===s){n.escaped=!0,n.currentState=1;continue}n.currentState=1}1===n.currentState&&n.escaped?o===s?e[m]===s?(n.token+=s,m++):(n.escaped=!1,n.currentState=2):n.token+=o:"\r"===o?("\n"===e[m]&&m++,b(),f()):"\n"===o?(b(),f()):o===l?b():1===n.currentState&&(n.token+=o)}if(r)u.columns=h.shift();else for(c=0;c<h[0].length;c++)u.columns[c]="null";var _;for(c=0;c<h.length;c++)(1!==h[c].length||"undefined"!==h[c][0]&&""!==h[c][0])&&(_=new a.TableRow,_.arr=h[c],_.obj=i(h[c],u.columns),u.addRow(_));null!==t&&t(u),p&&t!==p&&p()},function(t){if(a._friendlyFileLoadError(2,e),!o)throw t;o(t)}),u},a.prototype.parseXML=function(e){var t,o=new a.XML;if(e.children.length){for(t=0;t<e.children.length;t++){var i=parseXML(e.children[t]);o.addChild(i)}o.setName(e.nodeName),o._setCont(e.textContent),o._setAttributes(e);for(var n=0;n<o.children.length;n++)o.children[n].parent=o;return o}return o.setName(e.nodeName),o._setCont(e.textContent),o._setAttributes(e),o},a.prototype.loadXML=function(){for(var e,t,o={},i=a._getDecrementPreload.apply(this,arguments),n=1;n<arguments.length;n++){var r=arguments[n];"function"==typeof r&&r!==i&&(void 0===e?e=r:t=r)}return a.prototype.httpDo(arguments[0],"GET","xml",function(t){for(var n in t)o[n]=t[n];void 0!==e&&e(o),i&&e!==i&&i()},t),o},a.prototype.httpGet=function(){var e=Array.prototype.slice.call(arguments);e.splice(1,0,"GET"),a.prototype.httpDo.apply(this,e)},a.prototype.httpPost=function(){var e=Array.prototype.slice.call(arguments);e.splice(1,0,"POST"),a.prototype.httpDo.apply(this,e)},a.prototype.httpDo=function(){for(var e,t,o,i="",n={},r=0,s="text/plain",a=arguments.length-1;a>0&&"function"==typeof arguments[a];a--)r++;if(2==arguments.length-r&&"string"==typeof arguments[0]&&"object"==typeof arguments[1])o=new Request(arguments[0],arguments[1]),e=arguments[2],t=arguments[3],""===i&&(i=-1!==o.url.indexOf("json")?"json":-1!==o.url.indexOf("xml")?"xml":"text");else{for(var l,p=arguments[0],c="GET",u=1;u<arguments.length;u++){var m=arguments[u];if("string"==typeof m)"GET"===m||"POST"===m||"PUT"===m||"DELETE"===m?c=m:"json"===m||"jsonp"===m||"xml"===m||"text"===m?i=m:l=m;else if("number"==typeof m)l=m.toString();else if("object"==typeof m)if(m.hasOwnProperty("jsonpCallback"))for(var d in m)n[d]=m[d];else l=JSON.stringify(m),s="application/json";else"function"==typeof m&&(e?t=m:e=m)}""===i&&(i=-1!==p.indexOf("json")?"json":-1!==p.indexOf("xml")?"xml":"text"),o=new Request(p,{method:c,mode:"cors",body:l,headers:new Headers({"Content-Type":s})})}"jsonp"===i?h(arguments[0],n).then(function(e){if(e.ok)return e.json();throw e}).then(function(t){e(t)}).catch(function(e){if(!t)throw e;t(e)}):fetch(o).then(function(e){if(e.ok)return"json"===i?e.json():e.text();throw e}).then(function(t){"xml"===i&&(t=(new DOMParser).parseFromString(t,"text/xml"),t=parseXML(t.documentElement)),e(t)}).catch(function(e,o){if(!t)throw e;t(e)})},window.URL=window.URL||window.webkitURL,a.prototype._pWriters=[],a.prototype.createWriter=function(e,t){var o;for(var i in a.prototype._pWriters)if(a.prototype._pWriters[i].name===e)return o=new a.PrintWriter(e+window.millis(),t),a.prototype._pWriters.push(o),o;return o=new a.PrintWriter(e,t),a.prototype._pWriters.push(o),o},a.PrintWriter=function(e,t){var o=this;this.name=e,this.content="",this.write=function(e){this.content+=e},this.print=function(e){this.content+=e+"\n"},this.flush=function(){this.content=""},this.close=function(){var i=[];i.push(this.content),a.prototype.writeFile(i,e,t);for(var n in a.prototype._pWriters)a.prototype._pWriters[n].name===this.name&&a.prototype._pWriters.splice(n,1);o.flush(),o={}}},a.prototype.save=function(e,t,o){var i=arguments,n=this._curElement.elt;if(0===i.length)return void a.prototype.saveCanvas(n);if(i[0]instanceof a.Renderer||i[0]instanceof a.Graphics)return void a.prototype.saveCanvas(i[0].elt,i[1],i[2]);if(1===i.length&&"string"==typeof i[0])a.prototype.saveCanvas(n,i[0]);else switch(r(i[1],i[2])[1]){case"json":return void a.prototype.saveJSON(i[0],i[1],i[2]);case"txt":return void a.prototype.saveStrings(i[0],i[1],i[2]);default:i[0]instanceof Array?a.prototype.saveStrings(i[0],i[1],i[2]):i[0]instanceof a.Table?a.prototype.saveTable(i[0],i[1],i[2],i[3]):i[0]instanceof a.Image?a.prototype.saveCanvas(i[0].canvas,i[1]):i[0]instanceof a.SoundFile&&a.prototype.saveSound(i[0],i[1],i[2],i[3])}},a.prototype.saveJSON=function(e,t,o){var i;i=o?JSON.stringify(e):JSON.stringify(e,void 0,2),this.saveStrings(i.split("\n"),t,"json")},a.prototype.saveJSONObject=a.prototype.saveJSON,a.prototype.saveJSONArray=a.prototype.saveJSON,a.prototype.saveStrings=function(e,t,o){for(var i=o||"txt",n=this.createWriter(t,i),r=0;r<e.length;r++)e.length,n.print(e[r]);n.close(),n.flush()},a.prototype.saveTable=function(e,t,o){var i;i=void 0===o?t.substring(t.lastIndexOf(".")+1,t.length):o;var r=this.createWriter(t,i),s=e.columns,a=",";if("tsv"===i&&(a="\t"),"html"!==i){if("0"!==s[0]){for(var l=0;l<s.length;l++)l<s.length-1?r.write(s[l]+a):r.write(s[l]);r.write("\n")}for(var h=0;h<e.rows.length;h++){var p;for(p=0;p<e.rows[h].arr.length;p++)p<e.rows[h].arr.length-1?r.write(e.rows[h].arr[p]+a):(e.rows.length,r.write(e.rows[h].arr[p]));r.write("\n")}}else{r.print("<html>"),r.print("<head>");var c='  <meta http-equiv="content-type" content';if(c+='="text/html;charset=utf-8" />',r.print(c),r.print("</head>"),r.print("<body>"),r.print("  <table>"),"0"!==s[0]){r.print("    <tr>");for(var u=0;u<s.length;u++){var m=n(s[u]);r.print("      <td>"+m),r.print("      </td>")}r.print("    </tr>")}for(var d=0;d<e.rows.length;d++){r.print("    <tr>");for(var y=0;y<e.columns.length;y++){var b=e.rows[d].getString(y),f=n(b);r.print("      <td>"+f),r.print("      </td>")}r.print("    </tr>")}r.print("  </table>"),r.print("</body>"),r.print("</html>")}r.close(),r.flush()},a.prototype.writeFile=function(e,t,o){var i="application/octet-stream";a.prototype._isSafari()&&(i="text/plain");var n=new Blob(e,{type:i}),r=window.URL.createObjectURL(n);a.prototype.downloadFile(r,t,o)},a.prototype.downloadFile=function(e,t,o){var i=r(t,o),n=i[0],l=i[1],h=document.createElement("a");if(h.href=e,h.download=n,h.onclick=function(e){s(e),e.stopPropagation()},h.style.display="none",document.body.appendChild(h),a.prototype._isSafari()){var p="Hello, Safari user! To download this file...\n";p+="1. Go to File --\x3e Save As.\n",p+='2. Choose "Page Source" as the Format.\n',p+='3. Name it with this extension: ."'+l+'"',alert(p)}h.click(),e=null},a.prototype._checkFileExtension=r,a.prototype._isSafari=function(){return Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0},t.exports=a},{"../core/core":42,"../core/error_helpers":45,"es6-promise":2,"fetch-jsonp":3,"opentype.js":10,"whatwg-fetch":32}],65:[function(e,t,o){"use strict";var i=e("../core/core");i.Table=function(e){this.columns=[],this.rows=[]},i.Table.prototype.addRow=function(e){var t=e||new i.TableRow;if(void 0===t.arr||void 0===t.obj)throw"invalid TableRow: "+t;return t.table=this,this.rows.push(t),t},i.Table.prototype.removeRow=function(e){this.rows[e].table=null;var t=this.rows.splice(e+1,this.rows.length);this.rows.pop(),this.rows=this.rows.concat(t)},i.Table.prototype.getRow=function(e){return this.rows[e]},i.Table.prototype.getRows=function(){return this.rows},i.Table.prototype.findRow=function(e,t){if("string"==typeof t){for(var o=0;o<this.rows.length;o++)if(this.rows[o].obj[t]===e)return this.rows[o]}else for(var i=0;i<this.rows.length;i++)if(this.rows[i].arr[t]===e)return this.rows[i];return null},i.Table.prototype.findRows=function(e,t){var o=[];if("string"==typeof t)for(var i=0;i<this.rows.length;i++)this.rows[i].obj[t]===e&&o.push(this.rows[i]);else for(var n=0;n<this.rows.length;n++)this.rows[n].arr[t]===e&&o.push(this.rows[n]);return o},i.Table.prototype.matchRow=function(e,t){if("number"==typeof t){for(var o=0;o<this.rows.length;o++)if(this.rows[o].arr[t].match(e))return this.rows[o]}else for(var i=0;i<this.rows.length;i++)if(this.rows[i].obj[t].match(e))return this.rows[i];return null},i.Table.prototype.matchRows=function(e,t){var o=[];if("number"==typeof t)for(var i=0;i<this.rows.length;i++)this.rows[i].arr[t].match(e)&&o.push(this.rows[i]);else for(var n=0;n<this.rows.length;n++)this.rows[n].obj[t].match(e)&&o.push(this.rows[n]);return o},i.Table.prototype.getColumn=function(e){var t=[];if("string"==typeof e)for(var o=0;o<this.rows.length;o++)t.push(this.rows[o].obj[e]);else for(var i=0;i<this.rows.length;i++)t.push(this.rows[i].arr[e]);return t},i.Table.prototype.clearRows=function(){delete this.rows,this.rows=[]},i.Table.prototype.addColumn=function(e){var t=e||null;this.columns.push(t)},i.Table.prototype.getColumnCount=function(){return this.columns.length},i.Table.prototype.getRowCount=function(){return this.rows.length},i.Table.prototype.removeTokens=function(e,t){for(var o=[],i=0;i<e.length;i++)o.push(function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}(e.charAt(i)));var n=new RegExp(o.join("|"),"g");if(void 0===t)for(var r=0;r<this.columns.length;r++)for(var s=0;s<this.rows.length;s++){var a=this.rows[s].arr[r];a=a.replace(n,""),this.rows[s].arr[r]=a,this.rows[s].obj[this.columns[r]]=a}else if("string"==typeof t)for(var l=0;l<this.rows.length;l++){var h=this.rows[l].obj[t];h=h.replace(n,""),this.rows[l].obj[t]=h;var p=this.columns.indexOf(t);this.rows[l].arr[p]=h}else for(var c=0;c<this.rows.length;c++){var u=this.rows[c].arr[t];u=u.replace(n,""),this.rows[c].arr[t]=u,this.rows[c].obj[this.columns[t]]=u}},i.Table.prototype.trim=function(e){var t=new RegExp(" ","g");if(void 0===e)for(var o=0;o<this.columns.length;o++)for(var i=0;i<this.rows.length;i++){var n=this.rows[i].arr[o];n=n.replace(t,""),this.rows[i].arr[o]=n,this.rows[i].obj[this.columns[o]]=n}else if("string"==typeof e)for(var r=0;r<this.rows.length;r++){var s=this.rows[r].obj[e];s=s.replace(t,""),this.rows[r].obj[e]=s;var a=this.columns.indexOf(e);this.rows[r].arr[a]=s}else for(var l=0;l<this.rows.length;l++){var h=this.rows[l].arr[e];h=h.replace(t,""),this.rows[l].arr[e]=h,this.rows[l].obj[this.columns[e]]=h}},i.Table.prototype.removeColumn=function(e){var t,o;"string"==typeof e?(t=e,o=this.columns.indexOf(e),console.log("string")):(o=e,t=this.columns[e]);var i=this.columns.splice(o+1,this.columns.length);this.columns.pop(),this.columns=this.columns.concat(i);for(var n=0;n<this.rows.length;n++){var r=this.rows[n].arr,s=r.splice(o+1,r.length);r.pop(),this.rows[n].arr=r.concat(s),delete this.rows[n].obj[t]}},i.Table.prototype.set=function(e,t,o){this.rows[e].set(t,o)},i.Table.prototype.setNum=function(e,t,o){this.rows[e].setNum(t,o)},i.Table.prototype.setString=function(e,t,o){this.rows[e].setString(t,o)},i.Table.prototype.get=function(e,t){return this.rows[e].get(t)},i.Table.prototype.getNum=function(e,t){return this.rows[e].getNum(t)},i.Table.prototype.getString=function(e,t){return this.rows[e].getString(t)},i.Table.prototype.getObject=function(e){for(var t,o,i={},n=0;n<this.rows.length;n++)if(t=this.rows[n].obj,"string"==typeof e){if(!(this.columns.indexOf(e)>=0))throw'This table has no column named "'+e+'"';o=t[e],i[o]=t}else i[n]=this.rows[n].obj;return i},i.Table.prototype.getArray=function(){for(var e=[],t=0;t<this.rows.length;t++)e.push(this.rows[t].arr);return e},t.exports=i.Table},{"../core/core":42}],66:[function(e,t,o){"use strict";var i=e("../core/core");i.TableRow=function(e,t){var o=[],i={};e&&(t=t||",",o=e.split(t));for(var n=0;n<o.length;n++){var r=n,s=o[n];i[r]=s}this.arr=o,this.obj=i,this.table=null},i.TableRow.prototype.set=function(e,t){if("string"==typeof e){var o=this.table.columns.indexOf(e);if(!(o>=0))throw'This table has no column named "'+e+'"';this.obj[e]=t,this.arr[o]=t}else{if(!(e<this.table.columns.length))throw"Column #"+e+" is out of the range of this table";this.arr[e]=t;var i=this.table.columns[e];this.obj[i]=t}},i.TableRow.prototype.setNum=function(e,t){var o=parseFloat(t,10);this.set(e,o)},i.TableRow.prototype.setString=function(e,t){var o=t.toString();this.set(e,o)},i.TableRow.prototype.get=function(e){return"string"==typeof e?this.obj[e]:this.arr[e]},i.TableRow.prototype.getNum=function(e){var t;if(t="string"==typeof e?parseFloat(this.obj[e],10):parseFloat(this.arr[e],10),"NaN"===t.toString())throw"Error: "+this.obj[e]+" is NaN (Not a Number)";return t},i.TableRow.prototype.getString=function(e){return"string"==typeof e?this.obj[e].toString():this.arr[e].toString()},t.exports=i.TableRow},{"../core/core":42}],67:[function(e,t,o){"use strict";var i=e("../core/core");i.XML=function(){this.name=null,this.attributes={},this.children=[],this.parent=null,this.content=null},i.XML.prototype.getParent=function(){return this.parent},i.XML.prototype.getName=function(){return this.name},i.XML.prototype.setName=function(e){this.name=e},i.XML.prototype.hasChildren=function(){return this.children.length>0},i.XML.prototype.listChildren=function(){return this.children.map(function(e){return e.name})},i.XML.prototype.getChildren=function(e){return e?this.children.filter(function(t){return t.name===e}):this.children},i.XML.prototype.getChild=function(e){return"string"==typeof e?this.children.find(function(t){return t.name===e}):this.children[e]},i.XML.prototype.addChild=function(e){e instanceof i.XML&&this.children.push(e)},i.XML.prototype.removeChild=function(e){var t=-1;if("string"==typeof e){for(var o=0;o<this.children.length;o++)if(this.children[o].name===e){t=o;break}}else t=e;-1!==t&&this.children.splice(t,1)},i.XML.prototype.getAttributeCount=function(){return Object.keys(this.attributes).length},i.XML.prototype.listAttributes=function(){return Object.keys(this.attributes)},i.XML.prototype.hasAttribute=function(e){return!!this.attributes[e]},i.XML.prototype.getNum=function(e,t){return Number(this.attributes[e])||t||0},i.XML.prototype.getString=function(e,t){return String(this.attributes[e])||t||null},i.XML.prototype.setAttribute=function(e,t){this.attributes[e]&&(this.attributes[e]=t)},i.XML.prototype.getContent=function(e){return this.content||e||null},i.XML.prototype.setContent=function(e){this.children.length||(this.content=e)},i.XML.prototype._setCont=function(e){var t;t=e,t=t.replace(/\s\s+/g,","),this.content=t},i.XML.prototype._setAttributes=function(e){var t,o={};for(t=0;t<e.attributes.length;t++)o[e.attributes[t].nodeName]=e.attributes[t].nodeValue;this.attributes=o},t.exports=i.XML},{"../core/core":42}],68:[function(e,t,o){"use strict";function i(e,t,o){if("function"==typeof Math.hypot)return Math.hypot.apply(null,arguments);for(var i=arguments.length,n=[],r=0,s=0;s<i;s++){var a=arguments[s];if((a=+a)==1/0||a===-1/0)return 1/0;a=Math.abs(a),a>r&&(r=a),n[s]=a}0===r&&(r=1);for(var l=0,h=0,p=0;p<i;p++){var c=n[p]/r,u=c*c-h,m=l+u;h=m-l-u,l=m}return Math.sqrt(l)*r}var n=e("../core/core");n.prototype.abs=Math.abs,n.prototype.ceil=Math.ceil,n.prototype.constrain=function(e,t,o){return Math.max(Math.min(e,o),t)},n.prototype.dist=function(e,t,o,n,r,s){return 4===arguments.length?i(o-e,n-t):6===arguments.length?i(n-e,r-t,s-o):void 0},n.prototype.exp=Math.exp,n.prototype.floor=Math.floor,n.prototype.lerp=function(e,t,o){return o*(t-e)+e},n.prototype.log=Math.log,n.prototype.mag=function(e,t){return i(e,t)},n.prototype.map=function(e,t,o,i,n){return(e-t)/(o-t)*(n-i)+i},n.prototype.max=function(){return arguments[0]instanceof Array?Math.max.apply(null,arguments[0]):Math.max.apply(null,arguments)},n.prototype.min=function(){return arguments[0]instanceof Array?Math.min.apply(null,arguments[0]):Math.min.apply(null,arguments)},n.prototype.norm=function(e,t,o){return this.map(e,t,o,0,1)},n.prototype.pow=Math.pow,n.prototype.round=Math.round,n.prototype.sq=function(e){return e*e},n.prototype.sqrt=Math.sqrt,t.exports=n},{"../core/core":42}],69:[function(e,t,o){"use strict";var i=e("../core/core");i.prototype.createVector=function(e,t,o){return this instanceof i?new i.Vector(this,arguments):new i.Vector(e,t,o)},t.exports=i},{"../core/core":42}],70:[function(e,t,o){"use strict";var i,n=e("../core/core"),r=4095,s=4,a=.5,l=function(e){return.5*(1-Math.cos(e*Math.PI))};n.prototype.noise=function(e,t,o){if(t=t||0,o=o||0,null==i){i=new Array(r+1);for(var n=0;n<r+1;n++)i[n]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),o<0&&(o=-o);for(var h,p,c,u,m,d=Math.floor(e),y=Math.floor(t),b=Math.floor(o),f=e-d,_=t-y,v=o-b,g=0,x=.5,S=0;S<s;S++){var A=d+(y<<4)+(b<<8);h=l(f),p=l(_),c=i[A&r],c+=h*(i[A+1&r]-c),u=i[A+16&r],u+=h*(i[A+16+1&r]-u),c+=p*(u-c),A+=256,u=i[A&r],u+=h*(i[A+1&r]-u),m=i[A+16&r],m+=h*(i[A+16+1&r]-m),u+=p*(m-u),c+=l(v)*(u-c),g+=c*x,x*=a,d<<=1,f*=2,y<<=1,_*=2,b<<=1,v*=2,f>=1&&(d++,f--),_>=1&&(y++,_--),v>=1&&(b++,v--)}return g},n.prototype.noiseDetail=function(e,t){e>0&&(s=e),t>0&&(a=t)},n.prototype.noiseSeed=function(e){var t=function(){var e,t,o=4294967296;return{setSeed:function(i){t=e=(null==i?Math.random()*o:i)>>>0},getSeed:function(){return e},rand:function(){return(t=(1664525*t+1013904223)%o)/o}}}();t.setSeed(e),i=new Array(r+1);for(var o=0;o<r+1;o++)i[o]=t.rand()},t.exports=n},{"../core/core":42}],71:[function(e,t,o){"use strict";var i=e("../core/core"),n=e("./polargeometry"),r=e("../core/constants");i.Vector=function(){var e,t,o;arguments[0]instanceof i?(this.p5=arguments[0],e=arguments[1][0]||0,t=arguments[1][1]||0,o=arguments[1][2]||0):(e=arguments[0]||0,t=arguments[1]||0,o=arguments[2]||0),this.x=e,this.y=t,this.z=o},i.Vector.prototype.toString=function(){return"p5.Vector Object : ["+this.x+", "+this.y+", "+this.z+"]"},i.Vector.prototype.set=function(e,t,o){return e instanceof i.Vector?(this.x=e.x||0,this.y=e.y||0,this.z=e.z||0,this):e instanceof Array?(this.x=e[0]||0,this.y=e[1]||0,this.z=e[2]||0,this):(this.x=e||0,this.y=t||0,this.z=o||0,this)},i.Vector.prototype.copy=function(){return this.p5?new i.Vector(this.p5,[this.x,this.y,this.z]):new i.Vector(this.x,this.y,this.z)},i.Vector.prototype.add=function(e,t,o){return e instanceof i.Vector?(this.x+=e.x||0,this.y+=e.y||0,this.z+=e.z||0,this):e instanceof Array?(this.x+=e[0]||0,this.y+=e[1]||0,this.z+=e[2]||0,this):(this.x+=e||0,this.y+=t||0,this.z+=o||0,this)},i.Vector.prototype.sub=function(e,t,o){return e instanceof i.Vector?(this.x-=e.x||0,this.y-=e.y||0,this.z-=e.z||0,this):e instanceof Array?(this.x-=e[0]||0,this.y-=e[1]||0,this.z-=e[2]||0,this):(this.x-=e||0,this.y-=t||0,this.z-=o||0,this)},i.Vector.prototype.mult=function(e){return this.x*=e||0,this.y*=e||0,this.z*=e||0,this},i.Vector.prototype.div=function(e){return this.x/=e,this.y/=e,this.z/=e,this},i.Vector.prototype.mag=function(){return Math.sqrt(this.magSq())},i.Vector.prototype.magSq=function(){var e=this.x,t=this.y,o=this.z;return e*e+t*t+o*o},i.Vector.prototype.dot=function(e,t,o){return e instanceof i.Vector?this.dot(e.x,e.y,e.z):this.x*(e||0)+this.y*(t||0)+this.z*(o||0)},i.Vector.prototype.cross=function(e){var t=this.y*e.z-this.z*e.y,o=this.z*e.x-this.x*e.z,n=this.x*e.y-this.y*e.x;return this.p5?new i.Vector(this.p5,[t,o,n]):new i.Vector(t,o,n)},i.Vector.prototype.dist=function(e){return e.copy().sub(this).mag()},i.Vector.prototype.normalize=function(){return 0===this.mag()?this:this.div(this.mag())},i.Vector.prototype.limit=function(e){var t=this.magSq();return t>e*e&&(this.div(Math.sqrt(t)),this.mult(e)),this},i.Vector.prototype.setMag=function(e){return this.normalize().mult(e)},i.Vector.prototype.heading=function(){var e=Math.atan2(this.y,this.x);return this.p5?this.p5._angleMode===r.RADIANS?e:n.radiansToDegrees(e):e},i.Vector.prototype.rotate=function(e){var t=this.heading()+e;this.p5&&this.p5._angleMode===r.DEGREES&&(t=n.degreesToRadians(t));var o=this.mag();return this.x=Math.cos(t)*o,this.y=Math.sin(t)*o,this},i.Vector.prototype.angleBetween=function(e){var t=Math.acos(this.dot(e)/(this.mag()*e.mag()));return this.p5&&this.p5._angleMode===r.DEGREES&&(t=n.radiansToDegrees(t)),t},i.Vector.prototype.lerp=function(e,t,o,n){return e instanceof i.Vector?this.lerp(e.x,e.y,e.z,t):(this.x+=(e-this.x)*n||0,this.y+=(t-this.y)*n||0,this.z+=(o-this.z)*n||0,this)},i.Vector.prototype.array=function(){return[this.x||0,this.y||0,this.z||0]},i.Vector.prototype.equals=function(e,t,o){var n,r,s;return e instanceof i.Vector?(n=e.x||0,r=e.y||0,s=e.z||0):e instanceof Array?(n=e[0]||0,r=e[1]||0,s=e[2]||0):(n=e||0,r=t||0,s=o||0),this.x===n&&this.y===r&&this.z===s},i.Vector.fromAngle=function(e){return this.p5&&this.p5._angleMode===r.DEGREES&&(e=n.degreesToRadians(e)),this.p5?new i.Vector(this.p5,[Math.cos(e),Math.sin(e),0]):new i.Vector(Math.cos(e),Math.sin(e),0)},i.Vector.random2D=function(){var e;return e=this.p5?this.p5._angleMode===r.DEGREES?this.p5.random(360):this.p5.random(r.TWO_PI):Math.random()*Math.PI*2,this.fromAngle(e)},i.Vector.random3D=function(){var e,t;this.p5?(e=this.p5.random(0,r.TWO_PI),t=this.p5.random(-1,1)):(e=Math.random()*Math.PI*2,t=2*Math.random()-1);var o=Math.sqrt(1-t*t)*Math.cos(e),n=Math.sqrt(1-t*t)*Math.sin(e);return this.p5?new i.Vector(this.p5,[o,n,t]):new i.Vector(o,n,t)},i.Vector.add=function(e,t,o){return o?o.set(e):o=e.copy(),o.add(t),o},i.Vector.sub=function(e,t,o){return o?o.set(e):o=e.copy(),o.sub(t),o},i.Vector.mult=function(e,t,o){return o?o.set(e):o=e.copy(),o.mult(t),o},i.Vector.div=function(e,t,o){return o?o.set(e):o=e.copy(),o.div(t),o},i.Vector.dot=function(e,t){return e.dot(t)},i.Vector.cross=function(e,t){return e.cross(t)},i.Vector.dist=function(e,t){return e.dist(t)},i.Vector.lerp=function(e,t,o,i){return i?i.set(e):i=e.copy(),i.lerp(t,o),i},i.Vector.mag=function(e){var t=e.x,o=e.y,i=e.z,n=t*t+o*o+i*i;return Math.sqrt(n)},t.exports=i.Vector},{"../core/constants":41,"../core/core":42,"./polargeometry":72}],72:[function(e,t,o){t.exports={degreesToRadians:function(e){return 2*Math.PI*e/360},radiansToDegrees:function(e){return 360*e/(2*Math.PI)}}},{}],73:[function(e,t,o){"use strict";var i=e("../core/core"),n=!1,r=!1,s=0,a=function(){var e,t,o=4294967296;return{setSeed:function(i){t=e=(null==i?Math.random()*o:i)>>>0},getSeed:function(){return e},rand:function(){return(t=(1664525*t+1013904223)%o)/o}}}();i.prototype.randomSeed=function(e){a.setSeed(e),n=!0,r=!1},i.prototype.random=function(e,t){var o;if(o=n?a.rand():Math.random(),void 0===e)return o;if(void 0===t)return e instanceof Array?e[Math.floor(o*e.length)]:o*e;if(e>t){var i=e;e=t,t=i}return o*(t-e)+e},i.prototype.randomGaussian=function(e,t){var o,i,n,a;if(r)o=s,r=!1;else{do{i=this.random(2)-1,n=this.random(2)-1,a=i*i+n*n}while(a>=1);a=Math.sqrt(-2*Math.log(a)/a),o=i*a,s=n*a,r=!0}var l=e||0;return o*(t||1)+l},t.exports=i},{"../core/core":42}],74:[function(e,t,o){"use strict";var i=e("../core/core"),n=e("./polargeometry"),r=e("../core/constants");i.prototype._angleMode=r.RADIANS,i.prototype.acos=function(e){return this._angleMode===r.RADIANS?Math.acos(e):n.radiansToDegrees(Math.acos(e))},i.prototype.asin=function(e){return this._angleMode===r.RADIANS?Math.asin(e):n.radiansToDegrees(Math.asin(e))},i.prototype.atan=function(e){return this._angleMode===r.RADIANS?Math.atan(e):n.radiansToDegrees(Math.atan(e))},i.prototype.atan2=function(e,t){return this._angleMode===r.RADIANS?Math.atan2(e,t):n.radiansToDegrees(Math.atan2(e,t))},i.prototype.cos=function(e){return this._angleMode===r.RADIANS?Math.cos(e):Math.cos(this.radians(e))},i.prototype.sin=function(e){return this._angleMode===r.RADIANS?Math.sin(e):Math.sin(this.radians(e))},i.prototype.tan=function(e){return this._angleMode===r.RADIANS?Math.tan(e):Math.tan(this.radians(e))},i.prototype.degrees=function(e){return n.radiansToDegrees(e)},i.prototype.radians=function(e){return n.degreesToRadians(e)},i.prototype.angleMode=function(e){e!==r.DEGREES&&e!==r.RADIANS||(this._angleMode=e)},t.exports=i},{"../core/constants":41,"../core/core":42,"./polargeometry":72}],75:[function(e,t,o){"use strict";var i=e("../core/core");i.prototype.textAlign=function(e,t){return this._renderer.textAlign.apply(this._renderer,arguments)},i.prototype.textLeading=function(e){return this._renderer.textLeading.apply(this._renderer,arguments)},i.prototype.textSize=function(e){return this._renderer.textSize.apply(this._renderer,arguments)},i.prototype.textStyle=function(e){return this._renderer.textStyle.apply(this._renderer,arguments)},i.prototype.textWidth=function(e){return 0===e.length?0:this._renderer.textWidth.apply(this._renderer,arguments)},i.prototype.textAscent=function(){return this._renderer.textAscent()},i.prototype.textDescent=function(){return this._renderer.textDescent()},i.prototype._updateTextMetrics=function(){return this._renderer._updateTextMetrics()},t.exports=i},{"../core/core":42}],76:[function(e,t,o){"use strict";var i=e("../core/core"),n=e("../core/constants");e("../core/error_helpers"),i.prototype.text=function(e,t,o,i,n){return this._renderer._doFill||this._renderer._doStroke?this._renderer.text.apply(this._renderer,arguments):this},i.prototype.textFont=function(e,t){if(arguments.length){if(!e)throw Error("null font passed to textFont");return this._renderer._setProperty("_textFont",e),t&&(this._renderer._setProperty("_textSize",t),this._renderer._setProperty("_textLeading",t*n._DEFAULT_LEADMULT)),this._renderer._applyTextProperties()}return this._renderer._textFont},t.exports=i},{"../core/constants":41,"../core/core":42,"../core/error_helpers":45}],77:[function(e,t,o){"use strict";function i(e,t){for(var o=a(t,{sampleFactor:.1,simplifyThreshold:0}),i=m(e,0,1),r=i/(i*o.sampleFactor),s=[],l=0;l<i;l+=r)s.push(m(e,l));return o.simplifyThreshold&&n(s,o.simplifyThreshold),s}function n(e,t){t=void 0===t?0:t;for(var o=0,i=e.length-1;e.length>3&&i>=0;--i)h(l(e,i-1),l(e,i),l(e,i+1),t)&&(e.splice(i%e.length,1),o++);return o}function r(e){for(var t,o=[],i=0;i<e.length;i++)"M"===e[i].type&&(t&&o.push(t),t=[]),t.push(s(e[i]));return o.push(t),o}function s(e){var t=[e.type];return"M"===e.type||"L"===e.type?t.push(e.x,e.y):"C"===e.type?t.push(e.x1,e.y1,e.x2,e.y2,e.x,e.y):"Q"===e.type&&t.push(e.x1,e.y1,e.x,e.y),t}function a(e,t){if("object"!=typeof e)e=t;else for(var o in t)void 0===e[o]&&(e[o]=t[o]);return e}function l(e,t){var o=e.length;return e[t<0?t%o+o:t%o]}function h(e,t,o,i){if(!i)return 0===p(e,t,o);void 0===h.tmpPoint1&&(h.tmpPoint1=[],h.tmpPoint2=[]);var n=h.tmpPoint1,r=h.tmpPoint2;n.x=t.x-e.x,n.y=t.y-e.y,r.x=o.x-t.x,r.y=o.y-t.y;var s=n.x*r.x+n.y*r.y,a=Math.sqrt(n.x*n.x+n.y*n.y),l=Math.sqrt(r.x*r.x+r.y*r.y);return Math.acos(s/(a*l))<i}function p(e,t,o){return(t[0]-e[0])*(o[1]-e[1])-(o[0]-e[0])*(t[1]-e[1])}function c(e,t,o,i,n,r,s,a,l){var h=1-l,p=Math.pow(h,3),c=Math.pow(h,2),u=l*l,m=u*l,d=p*e+3*c*l*o+3*h*l*l*n+m*s,y=p*t+3*c*l*i+3*h*l*l*r+m*a,b=e+2*l*(o-e)+u*(n-2*o+e),f=t+2*l*(i-t)+u*(r-2*i+t),_=o+2*l*(n-o)+u*(s-2*n+o),v=i+2*l*(r-i)+u*(a-2*r+i),g=h*e+l*o,x=h*t+l*i,S=h*n+l*s,A=h*r+l*a,C=90-180*Math.atan2(b-_,f-v)/Math.PI;return(b>_||f<v)&&(C+=180),{x:d,y:y,m:{x:b,y:f},n:{x:_,y:v},start:{x:g,y:x},end:{x:S,y:A},alpha:C}}function u(e,t,o,i,n,r,s,a,l){return null==l?g(e,t,o,i,n,r,s,a):c(e,t,o,i,n,r,s,a,x(e,t,o,i,n,r,s,a,l))}function m(e,t,o){e=y(e);for(var i,n,r,s,a,l="",h={},p=0,m=0,d=e.length;m<d;m++){if(r=e[m],"M"===r[0])i=+r[1],n=+r[2];else{if(s=u(i,n,r[1],r[2],r[3],r[4],r[5],r[6]),p+s>t&&!o)return a=u(i,n,r[1],r[2],r[3],r[4],r[5],r[6],t-p),{x:a.x,y:a.y,alpha:a.alpha};p+=s,i=+r[5],n=+r[6]}l+=r.shift()+r}return h.end=l,a=o?p:c(i,n,r[0],r[1],r[2],r[3],r[4],r[5],1),a.alpha&&(a={x:a.x,y:a.y,alpha:a.alpha}),a}function d(e){var t=[],o=0,i=0,n=0,r=0,s=0;"M"===e[0][0]&&(o=+e[0][1],i=+e[0][2],n=o,r=i,s++,t[0]=["M",o,i]);for(var a,l,h,p=3===e.length&&"M"===e[0][0]&&"R"===e[1][0].toUpperCase()&&"Z"===e[2][0].toUpperCase(),c=s,u=e.length;c<u;c++){if(t.push(l=[]),h=e[c],h[0]!==String.prototype.toUpperCase.call(h[0]))switch(l[0]=String.prototype.toUpperCase.call(h[0]),l[0]){case"A":l[1]=h[1],l[2]=h[2],l[3]=h[3],l[4]=h[4],l[5]=h[5],l[6]=+(h[6]+o),l[7]=+(h[7]+i);break;case"V":l[1]=+h[1]+i;break;case"H":l[1]=+h[1]+o;break;case"R":a=[o,i].concat(h.slice(1));for(var m=2,d=a.length;m<d;m++)a[m]=+a[m]+o,a[++m]=+a[m]+i;t.pop(),t=t.concat(f(a,p));break;case"M":n=+h[1]+o,r=+h[2]+i;break;default:for(m=1,d=h.length;m<d;m++)l[m]=+h[m]+(m%2?o:i)}else if("R"===h[0])a=[o,i].concat(h.slice(1)),t.pop(),t=t.concat(f(a,p)),l=["R"].concat(h.slice(-2));else for(var y=0,b=h.length;y<b;y++)l[y]=h[y];switch(l[0]){case"Z":o=n,i=r;break;case"H":o=l[1];break;case"V":i=l[1];break;case"M":n=l[l.length-2],r=l[l.length-1];break;default:o=l[l.length-2],i=l[l.length-1]}}return t}function y(e,t){for(var o=d(e),i=t&&d(t),n={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},r={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},s=(function(e,t,o){var i,n,r={T:1,Q:1};if(!e)return["C",t.x,t.y,t.x,t.y,t.x,t.y];switch(e[0]in r||(t.qx=t.qy=null),e[0]){case"M":t.X=e[1],t.Y=e[2];break;case"A":e=["C"].concat(b.apply(0,[t.x,t.y].concat(e.slice(1))));break;case"S":"C"===o||"S"===o?(i=2*t.x-t.bx,n=2*t.y-t.by):(i=t.x,n=t.y),e=["C",i,n].concat(e.slice(1));break;case"T":"Q"===o||"T"===o?(t.qx=2*t.x-t.qx,t.qy=2*t.y-t.qy):(t.qx=t.x,t.qy=t.y),e=["C"].concat(v(t.x,t.y,t.qx,t.qy,e[1],e[2]));break;case"Q":t.qx=e[1],t.qy=e[2],e=["C"].concat(v(t.x,t.y,e[1],e[2],e[3],e[4]));break;case"L":e=["C"].concat(_(t.x,t.y,e[1],e[2]));break;case"H":e=["C"].concat(_(t.x,t.y,e[1],t.y));break;case"V":e=["C"].concat(_(t.x,t.y,t.x,e[1]));break;case"Z":e=["C"].concat(_(t.x,t.y,t.X,t.Y))}return e}),a=function(e,t){if(e[t].length>7){e[t].shift();for(var n=e[t];n.length;)h[t]="A",i&&(p[t]="A"),e.splice(t++,0,["C"].concat(n.splice(0,6)));e.splice(t,1),y=Math.max(o.length,i&&i.length||0)}},l=function(e,t,n,r,s){e&&t&&"M"===e[s][0]&&"M"!==t[s][0]&&(t.splice(s,0,["M",r.x,r.y]),n.bx=0,n.by=0,n.x=e[s][1],n.y=e[s][2],y=Math.max(o.length,i&&i.length||0))},h=[],p=[],c="",u="",m=0,y=Math.max(o.length,i&&i.length||0);m<y;m++){o[m]&&(c=o[m][0]),"C"!==c&&(h[m]=c,m&&(u=h[m-1])),o[m]=s(o[m],n,u),"A"!==h[m]&&"C"===c&&(h[m]="C"),a(o,m),i&&(i[m]&&(c=i[m][0]),"C"!==c&&(p[m]=c,m&&(u=p[m-1])),i[m]=s(i[m],r,u),"A"!==p[m]&&"C"===c&&(p[m]="C"),a(i,m)),l(o,i,n,r,m),l(i,o,r,n,m);var f=o[m],g=i&&i[m],x=f.length,S=i&&g.length;n.x=f[x-2],n.y=f[x-1],n.bx=parseFloat(f[x-4])||n.x,n.by=parseFloat(f[x-3])||n.y,r.bx=i&&(parseFloat(g[S-4])||r.x),r.by=i&&(parseFloat(g[S-3])||r.y),r.x=i&&g[S-2],r.y=i&&g[S-1]}return i?[o,i]:o}function b(e,t,o,i,n,r,s,a,l,h){var p,c,u,m,d,y=Math.PI,f=120*y/180,_=y/180*(+n||0),v=[],g=function(e,t,o){return{x:e*Math.cos(o)-t*Math.sin(o),y:e*Math.sin(o)+t*Math.cos(o)}};if(h)p=h[0],c=h[1],u=h[2],m=h[3];else{d=g(e,t,-_),e=d.x,t=d.y,d=g(a,l,-_),a=d.x,l=d.y;var x=(e-a)/2,S=(t-l)/2,A=x*x/(o*o)+S*S/(i*i);A>1&&(A=Math.sqrt(A),o*=A,i*=A);var C=o*o,w=i*i,V=(r===s?-1:1)*Math.sqrt(Math.abs((C*w-C*S*S-w*x*x)/(C*S*S+w*x*x)));u=V*o*S/i+(e+a)/2,m=V*-i*x/o+(t+l)/2,p=Math.asin(((t-m)/i).toFixed(9)),c=Math.asin(((l-m)/i).toFixed(9)),p=e<u?y-p:p,c=a<u?y-c:c,p<0&&(p=2*y+p),c<0&&(c=2*y+c),s&&p>c&&(p-=2*y),!s&&c>p&&(c-=2*y)}var B=c-p;if(Math.abs(B)>f){var M=c,T=a,P=l;c=p+f*(s&&c>p?1:-1),a=u+o*Math.cos(c),l=m+i*Math.sin(c),v=b(a,l,o,i,n,0,s,T,P,[c,M,u,m])}B=c-p;var R=Math.cos(p),E=Math.sin(p),I=Math.cos(c),D=Math.sin(c),L=Math.tan(B/4),F=4/3*o*L,k=4/3*i*L,J=[e,t],G=[e+F*E,t-k*R],O=[a+F*D,l-k*I],N=[a,l];if(G[0]=2*J[0]-G[0],G[1]=2*J[1]-G[1],h)return[G,O,N].concat(v);v=[G,O,N].concat(v).join().split(",");for(var W=[],U=0,z=v.length;U<z;U++)W[U]=U%2?g(v[U-1],v[U],_).y:g(v[U],v[U+1],_).x;return W}function f(e,t){for(var o=[],i=0,n=e.length;n-2*!t>i;i+=2){var r=[{x:+e[i-2],y:+e[i-1]},{x:+e[i],y:+e[i+1]},{x:+e[i+2],y:+e[i+3]},{x:+e[i+4],y:+e[i+5]}];t?i?n-4===i?r[3]={x:+e[0],y:+e[1]}:n-2===i&&(r[2]={x:+e[0],y:+e[1]},r[3]={x:+e[2],y:+e[3]}):r[0]={x:+e[n-2],y:+e[n-1]}:n-4===i?r[3]=r[2]:i||(r[0]={x:+e[i],y:+e[i+1]}),o.push(["C",(-r[0].x+6*r[1].x+r[2].x)/6,(-r[0].y+6*r[1].y+r[2].y)/6,(r[1].x+6*r[2].x-r[3].x)/6,(r[1].y+6*r[2].y-r[3].y)/6,r[2].x,r[2].y])}return o}function _(e,t,o,i){return[e,t,o,i,o,i]}function v(e,t,o,i,n,r){var s=1/3,a=2/3;return[s*e+a*o,s*t+a*i,s*n+a*o,s*r+a*i,n,r]}function g(e,t,o,i,n,r,s,a,l){null==l&&(l=1),l=l>1?1:l<0?0:l;for(var h=l/2,p=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],c=0,u=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],m=0;m<12;m++){var d=h*p[m]+h,y=S(d,e,o,n,s),b=S(d,t,i,r,a),f=y*y+b*b;c+=u[m]*Math.sqrt(f)}return h*c}function x(e,t,o,i,n,r,s,a,l){if(!(l<0||g(e,t,o,i,n,r,s,a)<l)){var h,p=.5,c=1-p;for(h=g(e,t,o,i,n,r,s,a,c);Math.abs(h-l)>.01;)p/=2,c+=(h<l?1:-1)*p,h=g(e,t,o,i,n,r,s,a,c);return c}}function S(e,t,o,i,n){return e*(e*(-3*t+9*o-9*i+3*n)+6*t-12*o+6*i)-3*t+3*o}function A(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];t=e.length;for(var o="";t--;)o+=e[t]===Object(e[t])?JSON.stringify(e[t]):e[t];return o}var C=e("../core/core"),w=e("../core/constants");C.Font=function(e){this.parent=e,this.cache={},this.font=void 0},C.Font.prototype.list=function(){throw"not yet implemented"},C.Font.prototype.textBounds=function(e,t,o,i,n){t=void 0!==t?t:0,o=void 0!==o?o:0,i=i||this.parent._renderer._textSize;var r=n&&n.renderer&&n.renderer._pInst||this.parent,s=r._renderer.drawingContext,a=s.textAlign||w.LEFT,l=s.textBaseline||w.BASELINE,h=this.cache[A("textBounds",e,t,o,i,a,l)];if(!h){var p,c,u,m,d=[],y=[],b=this,f=this._scale(i);this.font.forEachGlyph(e,t,o,i,n,function(e,t,o,n){d.push(t),y.push(o);var r=e.getMetrics();"space"!==e.name&&32!==e.unicode?(d.push(t+r.xMax*f),y.push(o+-r.yMin*f),y.push(o+-r.yMax*f)):d.push(t+b.font.charToGlyph(" ").advanceWidth*b._scale(i))}),p=Math.min.apply(null,d),c=Math.min.apply(null,y),u=Math.max.apply(null,d),m=Math.max.apply(null,y),h={x:p,y:c,h:m-c,w:u-p,advance:p-t};var _=h.w+h.advance,v=this._handleAlignment(r,s,e,h.x,h.y,_);h.x=v.x,h.y=v.y,this.cache[A("textBounds",e,t,o,i,a,l)]=h}return h},C.Font.prototype.textToPoints=function(e,t,o,n,s){var a=0,l=[],h=this._getGlyphs(e);n=n||this.parent._renderer._textSize;for(var p=0;p<h.length;p++){if("space"!==h[p].name)for(var c=h[p].getPath(t,o,n),u=r(c.commands),m=0;m<u.length;m++)for(var d=i(u[m],s),y=0;y<d.length;y++)d[y].x+=a,l.push(d[y]);a+=h[p].advanceWidth*this._scale(n)}return l},C.Font.prototype._getGlyphs=function(e){return this.font.stringToGlyphs(e)},C.Font.prototype._getPath=function(e,t,o,i){var n=i&&i.renderer&&i.renderer._pInst||this.parent,r=n._renderer.drawingContext,s=this._handleAlignment(n,r,e,t,o);return this.font.getPath(e,s.x,s.y,n._renderer._textSize,i)},C.Font.prototype._getPathData=function(e,t,o,i){var n=3;return"string"==typeof e&&arguments.length>2?e=this._getPath(e,t,o,i):"object"==typeof t&&(i=t),i&&"number"==typeof i.decimals&&(n=i.decimals),e.toPathData(n)},C.Font.prototype._getSVG=function(e,t,o,i){var n=3;return"string"==typeof e&&arguments.length>2?e=this._getPath(e,t,o,i):"object"==typeof t&&(i=t),i&&("number"==typeof i.decimals&&(n=i.decimals),"number"==typeof i.strokeWidth&&(e.strokeWidth=i.strokeWidth),void 0!==i.fill&&(e.fill=i.fill),void 0!==i.stroke&&(e.stroke=i.stroke)),e.toSVG(n)},C.Font.prototype._renderPath=function(e,t,o,i){var n,r=i&&i.renderer||this.parent._renderer,s=r.drawingContext;n="object"==typeof e&&e.commands?e.commands:this._getPath(e,t,o,i).commands,s.beginPath();for(var a=0;a<n.length;a+=1){var l=n[a];"M"===l.type?s.moveTo(l.x,l.y):"L"===l.type?s.lineTo(l.x,l.y):"C"===l.type?s.bezierCurveTo(l.x1,l.y1,l.x2,l.y2,l.x,l.y):"Q"===l.type?s.quadraticCurveTo(l.x1,l.y1,l.x,l.y):"Z"===l.type&&s.closePath()}return r._doStroke&&r._strokeSet&&s.stroke(),r._doFill&&(s.fillStyle=r._fillSet?s.fillStyle:w._DEFAULT_TEXT_FILL,s.fill()),this},C.Font.prototype._textWidth=function(e,t){if(" "===e)return this.font.charToGlyph(" ").advanceWidth*this._scale(t);var o=this.textBounds(e,0,0,t);return o.w+o.advance},C.Font.prototype._textAscent=function(e){return this.font.ascender*this._scale(e)},C.Font.prototype._textDescent=function(e){return-this.font.descender*this._scale(e)},C.Font.prototype._scale=function(e){return 1/this.font.unitsPerEm*(e||this.parent._renderer._textSize)},C.Font.prototype._handleAlignment=function(e,t,o,i,n,r){var s=e._renderer._textSize,a=this._textAscent(s),l=this._textDescent(s);return r=void 0!==r?r:this._textWidth(o,s),t.textAlign===w.CENTER?i-=r/2:t.textAlign===w.RIGHT&&(i-=r),t.textBaseline===w.TOP?n+=a:t.textBaseline===w._CTX_MIDDLE?n+=a/2:t.textBaseline===w.BOTTOM&&(n-=l),{x:i,y:n}},t.exports=C.Font},{"../core/constants":41,"../core/core":42}],78:[function(e,t,o){"use strict";var i=e("../core/core");i.prototype.append=function(e,t){return e.push(t),e},i.prototype.arrayCopy=function(e,t,o,i,n){var r,s;void 0!==n?(s=Math.min(n,e.length),r=i,e=e.slice(t,s+t)):(void 0!==o?(s=o,s=Math.min(s,e.length)):s=e.length,r=0,o=t,e=e.slice(0,s)),Array.prototype.splice.apply(o,[r,s].concat(e))},i.prototype.concat=function(e,t){return e.concat(t)},i.prototype.reverse=function(e){return e.reverse()},i.prototype.shorten=function(e){return e.pop(),e},i.prototype.shuffle=function(e,t){var o=ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e);e=t||o?e:e.slice();for(var i,n,r=e.length;r>1;)i=Math.random()*r|0,n=e[--r],e[r]=e[i],e[i]=n;return e},i.prototype.sort=function(e,t){var o=t?e.slice(0,Math.min(t,e.length)):e,i=t?e.slice(Math.min(t,e.length)):[];return o="string"==typeof o[0]?o.sort():o.sort(function(e,t){return e-t}),o.concat(i)},i.prototype.splice=function(e,t,o){return Array.prototype.splice.apply(e,[o,0].concat(t)),e},i.prototype.subset=function(e,t,o){return void 0!==o?e.slice(t,t+o):e.slice(t,e.length)},t.exports=i},{"../core/core":42}],79:[function(e,t,o){"use strict";var i=e("../core/core");i.prototype.float=function(e){return e instanceof Array?e.map(parseFloat):parseFloat(e)},i.prototype.int=function(e,t){return t=t||10,"string"==typeof e?parseInt(e,t):"number"==typeof e?0|e:"boolean"==typeof e?e?1:0:e instanceof Array?e.map(function(e){return i.prototype.int(e,t)}):void 0},i.prototype.str=function(e){return e instanceof Array?e.map(i.prototype.str):String(e)},i.prototype.boolean=function(e){return"number"==typeof e?0!==e:"string"==typeof e?"true"===e.toLowerCase():"boolean"==typeof e?e:e instanceof Array?e.map(i.prototype.boolean):void 0},i.prototype.byte=function(e){var t=i.prototype.int(e,10);return"number"==typeof t?(t+128)%256-128:t instanceof Array?t.map(i.prototype.byte):void 0},i.prototype.char=function(e){return"number"!=typeof e||isNaN(e)?e instanceof Array?e.map(i.prototype.char):"string"==typeof e?i.prototype.char(parseInt(e,10)):void 0:String.fromCharCode(e)},i.prototype.unchar=function(e){return"string"==typeof e&&1===e.length?e.charCodeAt(0):e instanceof Array?e.map(i.prototype.unchar):void 0},i.prototype.hex=function(e,t){if(t=void 0===t||null===t?t=8:t,e instanceof Array)return e.map(function(e){return i.prototype.hex(e,t)});if("number"==typeof e){e<0&&(e=4294967295+e+1);for(var o=Number(e).toString(16).toUpperCase();o.length<t;)o="0"+o;return o.length>=t&&(o=o.substring(o.length-t,o.length)),o}},i.prototype.unhex=function(e){return e instanceof Array?e.map(i.prototype.unhex):parseInt("0x"+e,16)},t.exports=i},{"../core/core":42}],80:[function(e,t,o){"use strict";function i(){var e=arguments[0],t=e<0,o=t?e.toString().substring(1):e.toString(),i=o.indexOf("."),n=-1!==i?o.substring(0,i):o,r=-1!==i?o.substring(i+1):"",s=t?"-":"";if(3===arguments.length){var a="";(-1!==i||arguments[2]-r.length>0)&&(a="."),r.length>arguments[2]&&(r=r.substring(0,arguments[2]));for(var l=0;l<arguments[1]-n.length;l++)s+="0";s+=n,s+=a,s+=r;for(var h=0;h<arguments[2]-r.length;h++)s+="0";return s}for(var p=0;p<Math.max(arguments[1]-n.length,0);p++)s+="0";return s+=o}function n(){var e=arguments[0].toString(),t=e.indexOf("."),o=-1!==t?e.substring(t):"",i=-1!==t?e.substring(0,t):e;if(i=i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),0===arguments[1])o="";else if(void 0!==arguments[1])if(arguments[1]>o.length){o+=-1===t?".":"";for(var n=arguments[1]-o.length+1,r=0;r<n;r++)o+="0"}else o=o.substring(0,arguments[1]+1);return i+o}function r(){return parseFloat(arguments[0])>0?"+"+arguments[0].toString():arguments[0].toString()}function s(){return parseFloat(arguments[0])>0?" "+arguments[0].toString():arguments[0].toString()}var a=e("../core/core");a.prototype.join=function(e,t){return e.join(t)},a.prototype.match=function(e,t){return e.match(t)},a.prototype.matchAll=function(e,t){for(var o=new RegExp(t,"g"),i=o.exec(e),n=[];null!==i;)n.push(i),i=o.exec(e);return n},a.prototype.nf=function(){if(arguments[0]instanceof Array){var e=arguments[1],t=arguments[2];return arguments[0].map(function(o){return i(o,e,t)})}return"[object Arguments]"===Object.prototype.toString.call(arguments[0])?3===arguments[0].length?this.nf(arguments[0][0],arguments[0][1],arguments[0][2]):2===arguments[0].length?this.nf(arguments[0][0],arguments[0][1]):this.nf(arguments[0][0]):i.apply(this,arguments)},a.prototype.nfc=function(){if(arguments[0]instanceof Array){var e=arguments[1];return arguments[0].map(function(t){return n(t,e)})}return n.apply(this,arguments)},a.prototype.nfp=function(){var e=this.nf.apply(this,arguments);return e instanceof Array?e.map(r):r(e)},a.prototype.nfs=function(){var e=this.nf.apply(this,arguments);return e instanceof Array?e.map(s):s(e)},a.prototype.split=function(e,t){return e.split(t)},a.prototype.splitTokens=function(){var e,t,o,i;return i=arguments[1],arguments.length>1?(o=/\]/g.exec(i),t=/\[/g.exec(i),t&&o?(i=i.slice(0,o.index)+i.slice(o.index+1),t=/\[/g.exec(i),i=i.slice(0,t.index)+i.slice(t.index+1),e=new RegExp("[\\["+i+"\\]]","g")):o?(i=i.slice(0,o.index)+i.slice(o.index+1),e=new RegExp("["+i+"\\]]","g")):t?(i=i.slice(0,t.index)+i.slice(t.index+1),e=new RegExp("["+i+"\\[]","g")):e=new RegExp("["+i+"]","g")):e=/\s/g,arguments[0].split(e).filter(function(e){return e})},a.prototype.trim=function(e){return e instanceof Array?e.map(this.trim):e.trim()},t.exports=a},{"../core/core":42}],81:[function(e,t,o){"use strict";var i=e("../core/core");i.prototype.day=function(){return(new Date).getDate()},i.prototype.hour=function(){return(new Date).getHours()},i.prototype.minute=function(){return(new Date).getMinutes()},i.prototype.millis=function(){return window.performance.now()},i.prototype.month=function(){return(new Date).getMonth()+1},i.prototype.second=function(){return(new Date).getSeconds()},i.prototype.year=function(){return(new Date).getFullYear()},t.exports=i},{"../core/core":42}],82:[function(e,t,o){"use strict";var i=e("../core/core");i.prototype.camera=function(e,t,o){this._renderer.translate(-e,-t,-o)},i.prototype.perspective=function(e,t,o,n){e=e||60/180*this.PI,t=t||this.width/this.height,o=o||this.height/2/this.tan(e/2)*.1,n=n||this.height/2/this.tan(e/2)*10,this._renderer.uPMatrix=i.Matrix.identity(),this._renderer.uPMatrix.perspective(e,t,o,n),this._renderer._curCamera="custom"},i.prototype.ortho=function(e,t,o,n,r,s){e=e||-this.width/2,t=t||this.width/2,o=o||-this.height/2,n=n||this.height/2,r=r||0,s=s||Math.max(this.width,this.height),this._renderer.uPMatrix=i.Matrix.identity(),this._renderer.uPMatrix.ortho(e,t,o,n,r,s),this._renderer._curCamera="custom"},t.exports=i},{"../core/core":42}],83:[function(e,t,o){"use strict";var i=e("../core/core");i.prototype.orbitControl=function(){return this.mouseIsPressed&&(this.rotateY((this.mouseX-this.width/2)/(this.width/2)),this.rotateX((this.mouseY-this.height/2)/(this.width/2))),this},t.exports=i},{"../core/core":42}],84:[function(e,t,o){"use strict";var i=e("../core/core");i.prototype.ambientLight=function(e,t,o,i){var n=this._renderer.GL,r=this._renderer._getShader("lightVert","lightTextureFrag");n.useProgram(r),r.uAmbientColor=n.getUniformLocation(r,"uAmbientColor["+this._renderer.ambientLightCount+"]");var s=this._renderer._pInst.color.apply(this._renderer._pInst,arguments),a=s._array;return n.uniform3f(r.uAmbientColor,a[0],a[1],a[2]),r.uMaterialColor=n.getUniformLocation(r,"uMaterialColor"),n.uniform4f(r.uMaterialColor,1,1,1,1),this._renderer.ambientLightCount++,r.uAmbientLightCount=n.getUniformLocation(r,"uAmbientLightCount"),n.uniform1i(r.uAmbientLightCount,this._renderer.ambientLightCount),this},i.prototype.directionalLight=function(e,t,o,i,n,r,s){var a=this._renderer.GL,l=this._renderer._getShader("lightVert","lightTextureFrag");a.useProgram(l),l.uDirectionalColor=a.getUniformLocation(l,"uDirectionalColor["+this._renderer.directionalLightCount+"]");var h=this._renderer._pInst.color.apply(this._renderer._pInst,[e,t,o]),p=h._array;a.uniform3f(l.uDirectionalColor,p[0],p[1],p[2]);for(var c,u,m,d=new Array(arguments.length),y=0;y<d.length;++y)d[y]=arguments[y];if("number"==typeof d[d.length-1])c=d[d.length-3],u=d[d.length-2],m=d[d.length-1];else try{c=d[d.length-1].x,u=d[d.length-1].y,m=d[d.length-1].z}catch(e){throw e}return l.uLightingDirection=a.getUniformLocation(l,"uLightingDirection["+this._renderer.directionalLightCount+"]"),a.uniform3f(l.uLightingDirection,c,u,m),l.uMaterialColor=a.getUniformLocation(l,"uMaterialColor"),a.uniform4f(l.uMaterialColor,1,1,1,1),this._renderer.directionalLightCount++,l.uDirectionalLightCount=a.getUniformLocation(l,"uDirectionalLightCount"),a.uniform1i(l.uDirectionalLightCount,this._renderer.directionalLightCount),this},i.prototype.pointLight=function(e,t,o,i,n,r,s){var a=this._renderer.GL,l=this._renderer._getShader("lightVert","lightTextureFrag");a.useProgram(l),l.uPointLightColor=a.getUniformLocation(l,"uPointLightColor["+this._renderer.pointLightCount+"]");var h=this._renderer._pInst.color.apply(this._renderer._pInst,[e,t,o]),p=h._array;a.uniform3f(l.uPointLightColor,p[0],p[1],p[2]);for(var c,u,m,d=new Array(arguments.length),y=0;y<d.length;++y)d[y]=arguments[y];if("number"==typeof d[d.length-1])c=d[d.length-3],u=d[d.length-2],m=d[d.length-1];else try{c=d[d.length-1].x,u=d[d.length-1].y,m=d[d.length-1].z}catch(e){throw e}return l.uPointLightLocation=a.getUniformLocation(l,"uPointLightLocation["+this._renderer.pointLightCount+"]"),a.uniform3f(l.uPointLightLocation,c,u,m),l.uMaterialColor=a.getUniformLocation(l,"uMaterialColor"),a.uniform4f(l.uMaterialColor,1,1,1,1),this._renderer.pointLightCount++,l.uPointLightCount=a.getUniformLocation(l,"uPointLightCount"),a.uniform1i(l.uPointLightCount,this._renderer.pointLightCount),this},t.exports=i},{"../core/core":42}],85:[function(e,t,o){"use strict";function i(e,t){for(var o={v:[],vt:[],vn:[]},i={},r=0;r<t.length;++r){var s=t[r].trim().split(/\b\s+/);if(s.length>0)if("v"===s[0]||"vn"===s[0]){var a=new n.Vector(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]));o[s[0]].push(a)}else if("vt"===s[0]){var l=[parseFloat(s[1]),parseFloat(s[2])];o[s[0]].push(l)}else if("f"===s[0])for(var h=3;h<s.length;++h){for(var p=[],c=[1,h-1,h],u=0;u<c.length;++u){var m=s[c[u]],d=0;if(void 0!==i[m])d=i[m];else{for(var y=m.split("/"),b=0;b<y.length;b++)y[b]=parseInt(y[b])-1;d=i[m]=e.vertices.length,e.vertices.push(o.v[y[0]].copy()),o.vt[y[1]]?e.uvs.push(o.vt[y[1]].slice()):e.uvs.push([0,0]),o.vn[y[2]]&&e.vertexNormals.push(o.vn[y[2]].copy())}p.push(d)}e.faces.push(p)}}return 0===e.vertexNormals.length&&e.computeNormals(),e}var n=e("../core/core");e("./p5.Geometry"),n.prototype.loadModel=function(){var e,t,o,r=arguments[0];"boolean"==typeof arguments[1]?(e=arguments[1],t=arguments[2],o=arguments[3]):(e=!1,t=arguments[1],o=arguments[2]);var s=new n.Geometry;return s.gid=r+"|"+e,this.loadStrings(r,function(o){i(s,o),e&&s.normalize(),"function"==typeof t&&t(s)}.bind(this),o),s},n.prototype.model=function(e){e.vertices.length>0&&(this._renderer.geometryInHash(e.gid)||this._renderer.createBuffers(e.gid,e),this._renderer.drawBuffers(e.gid))},t.exports=n},{"../core/core":42,"./p5.Geometry":87}],86:[function(e,t,o){"use strict";var i=e("../core/core");i.prototype.normalMaterial=function(){return this._renderer._getShader("normalVert","normalFrag"),this},i.prototype.texture=function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];var o=this._renderer.GL;this._renderer.drawMode="texture";var n=this._renderer._getShader("lightVert","lightTextureFrag");o.useProgram(n);var r;if(e[0].isTexture)e[0]instanceof i.Graphics||void 0!==i.MediaElement&&e[0]instanceof i.MediaElement?r=e[0].elt:e[0]instanceof i.Image&&(r=e[0].canvas),this._renderer._bind.call(this,e[0].tex,r);else{if(e[0]instanceof i.Image)r=e[0].canvas;else if(void 0!==i.MediaElement&&e[0]instanceof i.MediaElement){if(!e[0].loadedmetadata)return;r=e[0].elt}else e[0]instanceof i.Graphics&&(r=e[0].elt);var s=o.createTexture();e[0]._setProperty("tex",s),e[0]._setProperty("isTexture",!0),this._renderer._bind.call(this,s,r)}return o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,e[0].tex),o.uniform1i(o.getUniformLocation(n,"isTexture"),!0),o.uniform1i(o.getUniformLocation(n,"uSampler"),0),this},i.RendererGL.prototype._bind=function(e,t){var o=this._renderer.GL;o.bindTexture(o.TEXTURE_2D,e),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!0),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,t),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!0),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.bindTexture(o.TEXTURE_2D,null)},i.prototype.ambientMaterial=function(e,t,o,i){var n=this._renderer.GL,r=this._renderer._getShader("lightVert","lightTextureFrag");n.useProgram(r),r.uMaterialColor=n.getUniformLocation(r,"uMaterialColor");var s=this._renderer._applyColorBlend.apply(this._renderer,arguments);return n.uniform4f(r.uMaterialColor,s[0],s[1],s[2],s[3]),r.uSpecular=n.getUniformLocation(r,"uSpecular"),n.uniform1i(r.uSpecular,!1),n.uniform1i(n.getUniformLocation(r,"isTexture"),!1),this},i.prototype.specularMaterial=function(e,t,o,i){var n=this._renderer.GL,r=this._renderer._getShader("lightVert","lightTextureFrag");n.useProgram(r),n.uniform1i(n.getUniformLocation(r,"isTexture"),!1),r.uMaterialColor=n.getUniformLocation(r,"uMaterialColor");var s=this._renderer._applyColorBlend.apply(this._renderer,arguments);return n.uniform4f(r.uMaterialColor,s[0],s[1],s[2],s[3]),r.uSpecular=n.getUniformLocation(r,"uSpecular"),n.uniform1i(r.uSpecular,!0),this},i.RendererGL.prototype._applyColorBlend=function(e,t,o,i){var n=this.GL,r=this._pInst.color.apply(this._pInst,arguments),s=r._array;return s[s.length-1]<1?(n.depthMask(!1),n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA)):(n.depthMask(!0),n.disable(n.BLEND)),s},t.exports=i},{"../core/core":42}],87:[function(e,t,o){"use strict";var i=e("../core/core");i.Geometry=function(e,t,o){return this.vertices=[],this.vertexNormals=[],this.faces=[],this.uvs=[],this.detailX=void 0!==e?e:1,this.detailY=void 0!==t?t:1,o instanceof Function&&o.call(this),this},i.Geometry.prototype.computeFaces=function(){for(var e,t,o,i,n=this.detailX+1,r=0;r<this.detailY;r++)for(var s=0;s<this.detailX;s++)e=r*n+s,t=r*n+s+1,o=(r+1)*n+s+1,i=(r+1)*n+s,this.faces.push([e,t,i]),this.faces.push([i,t,o]);return this},i.Geometry.prototype._getFaceNormal=function(e,t){var o=this.faces[e],n=this.vertices[o[t%3]],r=this.vertices[o[(t+1)%3]],s=this.vertices[o[(t+2)%3]],a=i.Vector.cross(i.Vector.sub(r,n),i.Vector.sub(s,n)),l=i.Vector.mag(a)/(i.Vector.mag(i.Vector.sub(r,n))*i.Vector.mag(i.Vector.sub(s,n)));return a=a.normalize(),a.mult(Math.asin(l))},i.Geometry.prototype.computeNormals=function(){for(var e=0;e<this.vertices.length;e++){for(var t=new i.Vector,o=0;o<this.faces.length;o++)this.faces[o][0]!==e&&this.faces[o][1]!==e&&this.faces[o][2]!==e||(t=t.add(this._getFaceNormal(o,e)));t=t.normalize(),this.vertexNormals.push(t)}return this},i.Geometry.prototype.averageNormals=function(){for(var e=0;e<=this.detailY;e++){var t=this.detailX+1,o=i.Vector.add(this.vertexNormals[e*t],this.vertexNormals[e*t+this.detailX]);o=i.Vector.div(o,2),this.vertexNormals[e*t]=o,this.vertexNormals[e*t+this.detailX]=o}return this},i.Geometry.prototype.averagePoleNormals=function(){for(var e=new i.Vector(0,0,0),t=0;t<this.detailX;t++)e.add(this.vertexNormals[t]);for(e=i.Vector.div(e,this.detailX),t=0;t<this.detailX;t++)this.vertexNormals[t]=e;for(e=new i.Vector(0,0,0),t=this.vertices.length-1;t>this.vertices.length-1-this.detailX;t--)e.add(this.vertexNormals[t]);for(e=i.Vector.div(e,this.detailX),t=this.vertices.length-1;t>this.vertices.length-1-this.detailX;t--)this.vertexNormals[t]=e;return this},i.Geometry.prototype.normalize=function(){if(this.vertices.length>0){for(var e=this.vertices[0].copy(),t=this.vertices[0].copy(),o=0;o<this.vertices.length;o++)e.x=Math.max(e.x,this.vertices[o].x),t.x=Math.min(t.x,this.vertices[o].x),e.y=Math.max(e.y,this.vertices[o].y),t.y=Math.min(t.y,this.vertices[o].y),e.z=Math.max(e.z,this.vertices[o].z),t.z=Math.min(t.z,this.vertices[o].z);var n=i.Vector.lerp(e,t,.5),r=i.Vector.sub(e,t),s=Math.max(Math.max(r.x,r.y),r.z),a=200/s;for(o=0;o<this.vertices.length;o++)this.vertices[o].sub(n),this.vertices[o].mult(a)}return this},t.exports=i.Geometry},{"../core/core":42}],88:[function(e,t,o){"use strict";var i=e("../core/core"),n=e("../math/polargeometry"),r=e("../core/constants"),s="undefined"!=typeof Float32Array?Float32Array:Array;i.Matrix=function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];return e[0]instanceof i?(this.p5=e[0],"mat3"===e[1]?this.mat3=e[2]||new s([1,0,0,0,1,0,0,0,1]):this.mat4=e[1]||new s([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])):"mat3"===e[0]?this.mat3=e[1]||new s([1,0,0,0,1,0,0,0,1]):this.mat4=e[0]||new s([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this},i.Matrix.prototype.set=function(e){return e instanceof i.Matrix?(this.mat4=e.mat4,this):e instanceof s?(this.mat4=e,this):this},i.Matrix.prototype.get=function(){return new i.Matrix(this.mat4)},i.Matrix.prototype.copy=function(){var e=new i.Matrix;return e.mat4[0]=this.mat4[0],e.mat4[1]=this.mat4[1],e.mat4[2]=this.mat4[2],e.mat4[3]=this.mat4[3],e.mat4[4]=this.mat4[4],e.mat4[5]=this.mat4[5],e.mat4[6]=this.mat4[6],e.mat4[7]=this.mat4[7],e.mat4[8]=this.mat4[8],e.mat4[9]=this.mat4[9],e.mat4[10]=this.mat4[10],e.mat4[11]=this.mat4[11],e.mat4[12]=this.mat4[12],e.mat4[13]=this.mat4[13],e.mat4[14]=this.mat4[14],e.mat4[15]=this.mat4[15],e},i.Matrix.identity=function(){return new i.Matrix},i.Matrix.prototype.transpose=function(e){var t,o,n,r,a,l;return e instanceof i.Matrix?(t=e.mat4[1],o=e.mat4[2],n=e.mat4[3],r=e.mat4[6],a=e.mat4[7],l=e.mat4[11],this.mat4[0]=e.mat4[0],this.mat4[1]=e.mat4[4],this.mat4[2]=e.mat4[8],this.mat4[3]=e.mat4[12],this.mat4[4]=t,this.mat4[5]=e.mat4[5],this.mat4[6]=e.mat4[9],this.mat4[7]=e.mat4[13],this.mat4[8]=o,this.mat4[9]=r,this.mat4[10]=e.mat4[10],this.mat4[11]=e.mat4[14],this.mat4[12]=n,this.mat4[13]=a,this.mat4[14]=l,this.mat4[15]=e.mat4[15]):e instanceof s&&(t=e[1],o=e[2],n=e[3],r=e[6],a=e[7],l=e[11],this.mat4[0]=e[0],this.mat4[1]=e[4],this.mat4[2]=e[8],this.mat4[3]=e[12],this.mat4[4]=t,this.mat4[5]=e[5],this.mat4[6]=e[9],this.mat4[7]=e[13],this.mat4[8]=o,this.mat4[9]=r,this.mat4[10]=e[10],this.mat4[11]=e[14],this.mat4[12]=n,this.mat4[13]=a,this.mat4[14]=l,this.mat4[15]=e[15]),this},i.Matrix.prototype.invert=function(e){var t,o,n,r,a,l,h,p,c,u,m,d,y,b,f,_;e instanceof i.Matrix?(t=e.mat4[0],o=e.mat4[1],n=e.mat4[2],r=e.mat4[3],a=e.mat4[4],l=e.mat4[5],h=e.mat4[6],p=e.mat4[7],c=e.mat4[8],u=e.mat4[9],m=e.mat4[10],d=e.mat4[11],y=e.mat4[12],b=e.mat4[13],f=e.mat4[14],_=e.mat4[15]):e instanceof s&&(t=e[0],o=e[1],n=e[2],r=e[3],a=e[4],l=e[5],h=e[6],p=e[7],c=e[8],u=e[9],m=e[10],d=e[11],y=e[12],b=e[13],f=e[14],_=e[15]);var v=t*l-o*a,g=t*h-n*a,x=t*p-r*a,S=o*h-n*l,A=o*p-r*l,C=n*p-r*h,w=c*b-u*y,V=c*f-m*y,B=c*_-d*y,M=u*f-m*b,T=u*_-d*b,P=m*_-d*f,R=v*P-g*T+x*M+S*B-A*V+C*w;return R?(R=1/R,this.mat4[0]=(l*P-h*T+p*M)*R,this.mat4[1]=(n*T-o*P-r*M)*R,this.mat4[2]=(b*C-f*A+_*S)*R,this.mat4[3]=(m*A-u*C-d*S)*R,this.mat4[4]=(h*B-a*P-p*V)*R,this.mat4[5]=(t*P-n*B+r*V)*R,this.mat4[6]=(f*x-y*C-_*g)*R,this.mat4[7]=(c*C-m*x+d*g)*R,this.mat4[8]=(a*T-l*B+p*w)*R,this.mat4[9]=(o*B-t*T-r*w)*R,this.mat4[10]=(y*A-b*x+_*v)*R,this.mat4[11]=(u*x-c*A-d*v)*R,this.mat4[12]=(l*V-a*M-h*w)*R,this.mat4[13]=(t*M-o*V+n*w)*R,this.mat4[14]=(b*g-y*S-f*v)*R,this.mat4[15]=(c*S-u*g+m*v)*R,this):null},i.Matrix.prototype.invert3x3=function(){var e=this.mat3[0],t=this.mat3[1],o=this.mat3[2],i=this.mat3[3],n=this.mat3[4],r=this.mat3[5],s=this.mat3[6],a=this.mat3[7],l=this.mat3[8],h=l*n-r*a,p=-l*i+r*s,c=a*i-n*s,u=e*h+t*p+o*c;return u?(u=1/u,this.mat3[0]=h*u,this.mat3[1]=(-l*t+o*a)*u,this.mat3[2]=(r*t-o*n)*u,this.mat3[3]=p*u,this.mat3[4]=(l*e-o*s)*u,this.mat3[5]=(-r*e+o*i)*u,this.mat3[6]=c*u,this.mat3[7]=(-a*e+t*s)*u,this.mat3[8]=(n*e-t*i)*u,this):null},i.Matrix.prototype.transpose3x3=function(e){var t=e[1],o=e[2],i=e[5];return this.mat3[1]=e[3],this.mat3[2]=e[6],this.mat3[3]=t,this.mat3[5]=e[7],this.mat3[6]=o,this.mat3[7]=i,this},i.Matrix.prototype.inverseTranspose=function(e){return void 0===this.mat3?console.error("sorry, this function only works with mat3"):(this.mat3[0]=e.mat4[0],this.mat3[1]=e.mat4[1],this.mat3[2]=e.mat4[2],this.mat3[3]=e.mat4[4],this.mat3[4]=e.mat4[5],this.mat3[5]=e.mat4[6],this.mat3[6]=e.mat4[8],this.mat3[7]=e.mat4[9],this.mat3[8]=e.mat4[10]),this.invert3x3().transpose3x3(this.mat3),this},i.Matrix.prototype.determinant=function(){var e=this.mat4[0]*this.mat4[5]-this.mat4[1]*this.mat4[4],t=this.mat4[0]*this.mat4[6]-this.mat4[2]*this.mat4[4],o=this.mat4[0]*this.mat4[7]-this.mat4[3]*this.mat4[4],i=this.mat4[1]*this.mat4[6]-this.mat4[2]*this.mat4[5],n=this.mat4[1]*this.mat4[7]-this.mat4[3]*this.mat4[5],r=this.mat4[2]*this.mat4[7]-this.mat4[3]*this.mat4[6],s=this.mat4[8]*this.mat4[13]-this.mat4[9]*this.mat4[12],a=this.mat4[8]*this.mat4[14]-this.mat4[10]*this.mat4[12],l=this.mat4[8]*this.mat4[15]-this.mat4[11]*this.mat4[12],h=this.mat4[9]*this.mat4[14]-this.mat4[10]*this.mat4[13],p=this.mat4[9]*this.mat4[15]-this.mat4[11]*this.mat4[13];return e*(this.mat4[10]*this.mat4[15]-this.mat4[11]*this.mat4[14])-t*p+o*h+i*l-n*a+r*s},i.Matrix.prototype.mult=function(e){var t=new s(16),o=new s(16);e instanceof i.Matrix?o=e.mat4:e instanceof s&&(o=e);var n=this.mat4[0],r=this.mat4[1],a=this.mat4[2],l=this.mat4[3];return t[0]=n*o[0]+r*o[4]+a*o[8]+l*o[12],t[1]=n*o[1]+r*o[5]+a*o[9]+l*o[13],t[2]=n*o[2]+r*o[6]+a*o[10]+l*o[14],t[3]=n*o[3]+r*o[7]+a*o[11]+l*o[15],n=this.mat4[4],r=this.mat4[5],a=this.mat4[6],l=this.mat4[7],t[4]=n*o[0]+r*o[4]+a*o[8]+l*o[12],t[5]=n*o[1]+r*o[5]+a*o[9]+l*o[13],t[6]=n*o[2]+r*o[6]+a*o[10]+l*o[14],t[7]=n*o[3]+r*o[7]+a*o[11]+l*o[15],n=this.mat4[8],r=this.mat4[9],a=this.mat4[10],l=this.mat4[11],t[8]=n*o[0]+r*o[4]+a*o[8]+l*o[12],t[9]=n*o[1]+r*o[5]+a*o[9]+l*o[13],t[10]=n*o[2]+r*o[6]+a*o[10]+l*o[14],t[11]=n*o[3]+r*o[7]+a*o[11]+l*o[15],n=this.mat4[12],r=this.mat4[13],a=this.mat4[14],l=this.mat4[15],t[12]=n*o[0]+r*o[4]+a*o[8]+l*o[12],t[13]=n*o[1]+r*o[5]+a*o[9]+l*o[13],t[14]=n*o[2]+r*o[6]+a*o[10]+l*o[14],t[15]=n*o[3]+r*o[7]+a*o[11]+l*o[15],this.mat4=t,this},i.Matrix.prototype.scale=function(){for(var e,t,o,n=new Array(arguments.length),r=0;r<n.length;++r)n[r]=arguments[r];n[0]instanceof i.Vector?(e=n[0].x,t=n[0].y,o=n[0].z):n[0]instanceof Array&&(e=n[0][0],t=n[0][1],o=n[0][2]);var a=new s(16);return a[0]=this.mat4[0]*e,a[1]=this.mat4[1]*e,a[2]=this.mat4[2]*e,a[3]=this.mat4[3]*e,a[4]=this.mat4[4]*t,a[5]=this.mat4[5]*t,a[6]=this.mat4[6]*t,a[7]=this.mat4[7]*t,a[8]=this.mat4[8]*o,a[9]=this.mat4[9]*o,a[10]=this.mat4[10]*o,a[11]=this.mat4[11]*o,a[12]=this.mat4[12],a[13]=this.mat4[13],a[14]=this.mat4[14],a[15]=this.mat4[15],this.mat4=a,this},i.Matrix.prototype.rotate=function(e,t){var o,s,a,l,h;this.p5?this.p5._angleMode===r.DEGREES&&(l=n.degreesToRadians(e)):l=e,t instanceof i.Vector?(o=t.x,s=t.y,a=t.z):t instanceof Array&&(o=t[0],s=t[1],a=t[2]),h=Math.sqrt(o*o+s*s+a*a),o*=1/h,s*=1/h,a*=1/h;var p=this.mat4[0],c=this.mat4[1],u=this.mat4[2],m=this.mat4[3],d=this.mat4[4],y=this.mat4[5],b=this.mat4[6],f=this.mat4[7],_=this.mat4[8],v=this.mat4[9],g=this.mat4[10],x=this.mat4[11],S=Math.sin(l),A=Math.cos(l),C=1-A,w=o*o*C+A,V=s*o*C+a*S,B=a*o*C-s*S,M=o*s*C-a*S,T=s*s*C+A,P=a*s*C+o*S,R=o*a*C+s*S,E=s*a*C-o*S,I=a*a*C+A;return this.mat4[0]=p*w+d*V+_*B,this.mat4[1]=c*w+y*V+v*B,this.mat4[2]=u*w+b*V+g*B,this.mat4[3]=m*w+f*V+x*B,this.mat4[4]=p*M+d*T+_*P,this.mat4[5]=c*M+y*T+v*P,this.mat4[6]=u*M+b*T+g*P,this.mat4[7]=m*M+f*T+x*P,this.mat4[8]=p*R+d*E+_*I,this.mat4[9]=c*R+y*E+v*I,this.mat4[10]=u*R+b*E+g*I,this.mat4[11]=m*R+f*E+x*I,this},i.Matrix.prototype.translate=function(e){var t=e[0],o=e[1],i=e[2]||0;this.mat4[12]=this.mat4[0]*t+this.mat4[4]*o+this.mat4[8]*i+this.mat4[12],this.mat4[13]=this.mat4[1]*t+this.mat4[5]*o+this.mat4[9]*i+this.mat4[13],this.mat4[14]=this.mat4[2]*t+this.mat4[6]*o+this.mat4[10]*i+this.mat4[14],this.mat4[15]=this.mat4[3]*t+this.mat4[7]*o+this.mat4[11]*i+this.mat4[15]},i.Matrix.prototype.rotateX=function(e){this.rotate(e,[1,0,0])},i.Matrix.prototype.rotateY=function(e){this.rotate(e,[0,1,0])},i.Matrix.prototype.rotateZ=function(e){this.rotate(e,[0,0,1])},i.Matrix.prototype.perspective=function(e,t,o,i){var n=1/Math.tan(e/2),r=1/(o-i);return this.mat4[0]=n/t,this.mat4[1]=0,this.mat4[2]=0,this.mat4[3]=0,this.mat4[4]=0,this.mat4[5]=n,this.mat4[6]=0,this.mat4[7]=0,this.mat4[8]=0,this.mat4[9]=0,this.mat4[10]=(i+o)*r,this.mat4[11]=-1,this.mat4[12]=0,this.mat4[13]=0,this.mat4[14]=2*i*o*r,this.mat4[15]=0,this},i.Matrix.prototype.ortho=function(e,t,o,i,n,r){var s=1/(e-t),a=1/(o-i),l=1/(n-r);return this.mat4[0]=-2*s,this.mat4[1]=0,this.mat4[2]=0,this.mat4[3]=0,this.mat4[4]=0,this.mat4[5]=-2*a,this.mat4[6]=0,this.mat4[7]=0,this.mat4[8]=0,this.mat4[9]=0,this.mat4[10]=2*l,this.mat4[11]=0,this.mat4[12]=(e+t)*s,this.mat4[13]=(i+o)*a,this.mat4[14]=(r+n)*l,this.mat4[15]=1,this},t.exports=i.Matrix},{"../core/constants":41,"../core/core":42,"../math/polargeometry":72}],89:[function(e,t,o){"use strict";var i=e("../core/core"),n=e("../core/constants");i.RendererGL.prototype.beginShape=function(e){return this.immediateMode.shapeMode=void 0!==e?e:n.LINE_STRIP,void 0===this.immediateMode.vertexPositions?(this.immediateMode.vertexPositions=[],this.immediateMode.vertexColors=[],this.immediateMode.vertexBuffer=this.GL.createBuffer(),this.immediateMode.colorBuffer=this.GL.createBuffer()):(this.immediateMode.vertexPositions.length=0,this.immediateMode.vertexColors.length=0),this.isImmediateDrawing=!0,this},i.RendererGL.prototype.vertex=function(e,t,o){this.immediateMode.vertexPositions.push(e,t,o);var i=this.curFillColor||[.5,.5,.5,1];return this.immediateMode.vertexColors.push(i[0],i[1],i[2],i[3]),this},i.RendererGL.prototype.endShape=function(e,t,o,i,r,s){var a=this.GL;if(this._bindImmediateBuffers(this.immediateMode.vertexPositions,this.immediateMode.vertexColors),e)if("fill"===this.drawMode||"texture"===this.drawMode)switch(this.immediateMode.shapeMode){case n.LINE_STRIP:case n.LINES:this.immediateMode.shapeMode=n.TRIANGLE_FAN;break;case n.TRIANGLES:this.immediateMode.shapeMode=n.TRIANGLE_FAN}else switch(this.immediateMode.shapeMode){case n.LINE_STRIP:this.immediateMode.shapeMode=n.LINE_LOOP;break;case n.LINES:this.immediateMode.shapeMode=n.LINE_LOOP}if(this.immediateMode.shapeMode===n.QUADS||this.immediateMode.shapeMode===n.QUAD_STRIP)throw new Error("sorry, "+this.immediateMode.shapeMode+" not yet implemented in webgl mode.");return a.enable(a.BLEND),a.drawArrays(this.immediateMode.shapeMode,0,this.immediateMode.vertexPositions.length/3),this.immediateMode.vertexPositions.length=0,this.immediateMode.vertexColors.length=0,this.isImmediateDrawing=!1,this},i.RendererGL.prototype._bindImmediateBuffers=function(e,t){this._setDefaultCamera();var o=this.GL,i=this._getCurShaderId(),n=this.mHash[i];return n.vertexPositionAttribute=o.getAttribLocation(n,"aPosition"),o.enableVertexAttribArray(n.vertexPositionAttribute),o.bindBuffer(o.ARRAY_BUFFER,this.immediateMode.vertexBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e),o.DYNAMIC_DRAW),o.vertexAttribPointer(n.vertexPositionAttribute,3,o.FLOAT,!1,0,0),n.vertexColorAttribute=o.getAttribLocation(n,"aVertexColor"),o.enableVertexAttribArray(n.vertexColorAttribute),o.bindBuffer(o.ARRAY_BUFFER,this.immediateMode.colorBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(t),o.DYNAMIC_DRAW),o.vertexAttribPointer(n.vertexColorAttribute,4,o.FLOAT,!1,0,0),this._setMatrixUniforms(i),this},i.RendererGL.prototype._getColorVertexShader=function(){var e,t=this.GL,o="immediateVert|vertexColorFrag";return this.materialInHash(o)?e=this.mHash[o]:(e=this._initShaders("immediateVert","vertexColorFrag",!0),this.mHash[o]=e,e.vertexColorAttribute=t.getAttribLocation(e,"aVertexColor"),t.enableVertexAttribArray(e.vertexColorAttribute)),e},t.exports=i.RendererGL},{"../core/constants":41,"../core/core":42}],90:[function(e,t,o){"use strict";function i(e){return e.length>0?e.reduce(function(e,t){return e.concat(t)}):[]}function n(e){return i(e.map(function(e){return[e.x,e.y,e.z]}))}var r=e("../core/core"),s=0;r.RendererGL.prototype._initBufferDefaults=function(e){if(++s>1e3){var t=Object.keys(this.gHash)[0];delete this.gHash[t],s--}var o=this.GL;this.gHash[e]={},this.gHash[e].vertexBuffer=o.createBuffer(),this.gHash[e].normalBuffer=o.createBuffer(),this.gHash[e].uvBuffer=o.createBuffer(),this.gHash[e].indexBuffer=o.createBuffer()},r.RendererGL.prototype.createBuffers=function(e,t){var o=this.GL;this._setDefaultCamera(),this._initBufferDefaults(e);var r=this.mHash[this._getCurShaderId()];this.gHash[e].numberOfItems=3*t.faces.length,o.bindBuffer(o.ARRAY_BUFFER,this.gHash[e].vertexBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(n(t.vertices)),o.STATIC_DRAW),r.vertexPositionAttribute=o.getAttribLocation(r,"aPosition"),o.enableVertexAttribArray(r.vertexPositionAttribute),o.vertexAttribPointer(r.vertexPositionAttribute,3,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.gHash[e].normalBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(n(t.vertexNormals)),o.STATIC_DRAW),r.vertexNormalAttribute=o.getAttribLocation(r,"aNormal"),o.enableVertexAttribArray(r.vertexNormalAttribute),o.vertexAttribPointer(r.vertexNormalAttribute,3,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.gHash[e].uvBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(i(t.uvs)),o.STATIC_DRAW),r.textureCoordAttribute=o.getAttribLocation(r,"aTexCoord"),o.enableVertexAttribArray(r.textureCoordAttribute),o.vertexAttribPointer(r.textureCoordAttribute,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.gHash[e].indexBuffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(i(t.faces)),o.STATIC_DRAW)},r.RendererGL.prototype.drawBuffers=function(e){this._setDefaultCamera();var t=this.GL,o=this._getCurShaderId(),i=this.mHash[o];return t.bindBuffer(t.ARRAY_BUFFER,this.gHash[e].vertexBuffer),t.vertexAttribPointer(i.vertexPositionAttribute,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this.gHash[e].normalBuffer),t.vertexAttribPointer(i.vertexNormalAttribute,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this.gHash[e].uvBuffer),t.vertexAttribPointer(i.textureCoordAttribute,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.gHash[e].indexBuffer),this._setMatrixUniforms(o),t.drawElements(t.TRIANGLES,this.gHash[e].numberOfItems,t.UNSIGNED_SHORT,0),this},t.exports=r.RendererGL},{"../core/core":42}],91:[function(e,t,o){"use strict";var i=e("../core/core"),n=e("./shader");e("../core/p5.Renderer"),e("./p5.Matrix");var r=[],s={alpha:!0,depth:!0,stencil:!0,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1};i.RendererGL=function(e,t,o){return i.Renderer.call(this,e,t,o),this._initContext(),this.isP3D=!0,this.GL=this.drawingContext,this.ambientLightCount=0,this.directionalLightCount=0,this.pointLightCount=0,this._curCamera=null,this.uMVMatrix=new i.Matrix,this.uPMatrix=new i.Matrix,this.uNMatrix=new i.Matrix("mat3"),this.gHash={},this.mHash={},this.isImmediateDrawing=!1,this.immediateMode={},this.curFillColor=[.5,.5,.5,1],this.curStrokeColor=[.5,.5,.5,1],this.pointSize=5,this},i.RendererGL.prototype=Object.create(i.Renderer.prototype),i.RendererGL.prototype._initContext=function(){try{if(this.drawingContext=this.canvas.getContext("webgl",s)||this.canvas.getContext("experimental-webgl",s),null===this.drawingContext)throw new Error("Error creating webgl context");console.log("p5.RendererGL: enabled webgl context");var e=this.drawingContext;e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight)}catch(e){throw new Error(e)}},i.RendererGL.prototype._setDefaultCamera=function(){if(null===this._curCamera){var e=this.width,t=this.height;this.uPMatrix=i.Matrix.identity();var o=this.height/2/Math.tan(30*Math.PI/180);this.uPMatrix.perspective(60/180*Math.PI,e/t,.1*o,10*o),this._curCamera="default"}},i.RendererGL.prototype._update=function(){this.uMVMatrix=i.Matrix.identity(),this.translate(0,0,-this.height/2/Math.tan(30*Math.PI/180)),this.ambientLightCount=0,this.directionalLightCount=0,this.pointLightCount=0},i.RendererGL.prototype.background=function(){var e=this.GL,t=this._pInst.color.apply(this._pInst,arguments),o=t.levels[0]/255,i=t.levels[1]/255,n=t.levels[2]/255,r=t.levels[3]/255;e.clearColor(o,i,n,r),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},i.RendererGL.prototype._initShaders=function(e,t,o){var i=this.GL,r=i.createShader(i.VERTEX_SHADER);if(i.shaderSource(r,n[e]),i.compileShader(r),!i.getShaderParameter(r,i.COMPILE_STATUS))return alert("Yikes! An error occurred compiling the shaders:"+i.getShaderInfoLog(r)),null;var s=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(s,n[t]),i.compileShader(s),!i.getShaderParameter(s,i.COMPILE_STATUS))return alert("Darn! An error occurred compiling the shaders:"+i.getShaderInfoLog(s)),null;var a=i.createProgram();return i.attachShader(a,r),i.attachShader(a,s),i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS)||alert("Snap! Error linking shader program"),this._getLocation(a,o),a},i.RendererGL.prototype._getLocation=function(e,t){var o=this.GL;o.useProgram(e),e.uPMatrixUniform=o.getUniformLocation(e,"uProjectionMatrix"),e.uMVMatrixUniform=o.getUniformLocation(e,"uModelViewMatrix"),void 0===t&&(e.uNMatrixUniform=o.getUniformLocation(e,"uNormalMatrix"),e.samplerUniform=o.getUniformLocation(e,"uSampler"))},i.RendererGL.prototype._setUniform1f=function(e,t,o){var i=this.GL,n=this.mHash[e];return i.useProgram(n),n[t]=i.getUniformLocation(n,t),i.uniform1f(n[t],o),this},i.RendererGL.prototype._setMatrixUniforms=function(e){var t=this.GL,o=this.mHash[e];t.useProgram(o),t.uniformMatrix4fv(o.uPMatrixUniform,!1,this.uPMatrix.mat4),t.uniformMatrix4fv(o.uMVMatrixUniform,!1,this.uMVMatrix.mat4),this.uNMatrix.inverseTranspose(this.uMVMatrix),t.uniformMatrix3fv(o.uNMatrixUniform,!1,this.uNMatrix.mat3)},i.RendererGL.prototype._getShader=function(e,t,o){var i=e+"|"+t;if(!this.materialInHash(i)){var n=this._initShaders(e,t,o);this.mHash[i]=n}return this.curShaderId=i,this.mHash[this.curShaderId]},i.RendererGL.prototype._getCurShaderId=function(){var e,t;return"fill"!==this.drawMode&&void 0===this.curShaderId?(e="normalVert|normalFrag",t=this._initShaders("normalVert","normalFrag"),this.mHash[e]=t,this.curShaderId=e):this.isImmediateDrawing&&"fill"===this.drawMode&&(e="immediateVert|vertexColorFrag",t=this._initShaders("immediateVert","vertexColorFrag"),this.mHash[e]=t,this.curShaderId=e),this.curShaderId},i.RendererGL.prototype.fill=function(e,t,o,i){var n,r=this.GL,s=this._applyColorBlend.apply(this,arguments);return this.curFillColor=s,this.drawMode="fill",this.isImmediateDrawing?(n=this._getShader("immediateVert","vertexColorFrag"),r.useProgram(n)):(n=this._getShader("normalVert","basicFrag"),r.useProgram(n),n.uMaterialColor=r.getUniformLocation(n,"uMaterialColor"),r.uniform4f(n.uMaterialColor,s[0],s[1],s[2],s[3])),this},i.RendererGL.prototype.stroke=function(e,t,o,i){var n=this._pInst.color.apply(this._pInst,arguments),r=n._array;return this.curStrokeColor=r,this.drawMode="stroke",this},i.RendererGL.prototype._strokeCheck=function(){if("stroke"===this.drawMode)throw new Error("stroke for shapes in 3D not yet implemented, use fill for now :(")},i.RendererGL.prototype.strokeWeight=function(e){return this.pointSize=e,this},i.RendererGL.prototype.geometryInHash=function(e){return void 0!==this.gHash[e]},i.RendererGL.prototype.materialInHash=function(e){return void 0!==this.mHash[e]},i.RendererGL.prototype.resize=function(e,t){var o=this.GL;i.Renderer.prototype.resize.call(this,e,t),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),"default"===this._curCamera&&(this._curCamera=null,this._setDefaultCamera())},i.RendererGL.prototype.clear=function(){var e=this.GL;e.clearColor(arguments[0],arguments[1],arguments[2],arguments[3]),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},i.RendererGL.prototype.translate=function(e,t,o){return this.uMVMatrix.translate([e,-t,o]),this},i.RendererGL.prototype.scale=function(e,t,o){return this.uMVMatrix.scale([e,t,o]),this},i.RendererGL.prototype.rotate=function(e,t){return this.uMVMatrix.rotate(e,t),this},i.RendererGL.prototype.rotateX=function(e){return this.rotate(e,[1,0,0]),this},i.RendererGL.prototype.rotateY=function(e){return this.rotate(e,[0,1,0]),this},i.RendererGL.prototype.rotateZ=function(e){return this.rotate(e,[0,0,1]),this},i.RendererGL.prototype.push=function(){r.push(this.uMVMatrix.copy())},i.RendererGL.prototype.pop=function(){if(0===r.length)throw new Error("Invalid popMatrix!");this.uMVMatrix=r.pop()},i.RendererGL.prototype.resetMatrix=function(){return this.uMVMatrix=i.Matrix.identity(),this.translate(0,0,-800),this},i.RendererGL.prototype._applyTextProperties=function(){console.error("text commands not yet implemented in webgl")},t.exports=i.RendererGL},{"../core/core":42,"../core/p5.Renderer":48,"./p5.Matrix":88,"./shader":93}],92:[function(e,t,o){"use strict";var i=e("../core/core");e("./p5.Geometry"),i.prototype.plane=function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];var o=e[0]||50,n=e[1]||o,r="number"==typeof e[2]?e[2]:1,s="number"==typeof e[3]?e[3]:1,a="plane|"+o+"|"+n+"|"+r+"|"+s;if(!this._renderer.geometryInHash(a)){var l=function(){for(var e,t,r,s=0;s<=this.detailY;s++){t=s/this.detailY;for(var a=0;a<=this.detailX;a++)e=a/this.detailX,r=new i.Vector(o*e-o/2,n*t-n/2,0),this.vertices.push(r),this.uvs.push([e,t])}},h=new i.Geometry(r,s,l);h.computeFaces().computeNormals(),this._renderer.createBuffers(a,h)}this._renderer.drawBuffers(a)},i.prototype.box=function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];var o=e[0]||50,n=e[1]||o,r=e[2]||o,s="number"==typeof e[3]?e[3]:4,a="number"==typeof e[4]?e[4]:4,l="box|"+o+"|"+n+"|"+r+"|"+s+"|"+a;if(!this._renderer.geometryInHash(l)){var h=function(){for(var e=[[0,4,2,6],[1,3,5,7],[0,1,4,5],[2,6,3,7],[0,2,1,3],[4,5,6,7]],t=0,s=0;s<e.length;s++){for(var a=e[s],l=4*s,h=0;h<4;h++){var p=a[h],c=new i.Vector((2*(1&p)-1)*o/2,((2&p)-1)*n/2,((4&p)/2-1)*r/2);this.vertices.push(c),this.uvs.push([1&h,(2&h)/2]),t++}this.faces.push([l,l+1,l+2]),this.faces.push([l+2,l+1,l+3])}},p=new i.Geometry(s,a,h);p.computeNormals(),this._renderer.createBuffers(l,p)}return this._renderer.drawBuffers(l),this},i.prototype.sphere=function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];var o=e[0]||50,n="number"==typeof e[1]?e[1]:24,r="number"==typeof e[2]?e[2]:16,s="sphere|"+o+"|"+n+"|"+r;if(!this._renderer.geometryInHash(s)){var a=function(){for(var e,t,n,r=0;r<=this.detailY;r++){t=r/this.detailY;for(var s=0;s<=this.detailX;s++){e=s/this.detailX;var a=2*Math.PI*e,l=Math.PI*t-Math.PI/2;n=new i.Vector(o*Math.cos(l)*Math.sin(a),o*Math.sin(l),o*Math.cos(l)*Math.cos(a)),this.vertices.push(n),this.uvs.push([e,t])}}},l=new i.Geometry(n,r,a);l.computeFaces().computeNormals().averageNormals().averagePoleNormals(),this._renderer.createBuffers(s,l)}return this._renderer.drawBuffers(s),this};var n=function(e,t,o,n,r,s,a){n=n<3?3:n,r=r<1?1:r,s=void 0===s||s,a=void 0===a||a;var l,h,p=(s?2:0)+(a?2:0),c=n+1,u=Math.atan2(e-t,o),m=s?-2:0,d=r+(a?2:0);for(l=m;l<=d;++l){var y,b=l/r,f=o*b;for(l<0?(f=0,b=1,y=e):l>r?(f=o,b=1,y=t):y=e+l/r*(t-e),-2!==l&&l!==r+2||(y=0,b=0),f-=o/2,h=0;h<c;++h)this.vertices.push(new i.Vector(Math.sin(h*Math.PI*2/n)*y,f,Math.cos(h*Math.PI*2/n)*y)),this.vertexNormals.push(new i.Vector(l<0||l>r?0:Math.sin(h*Math.PI*2/n)*Math.cos(u),l<0?-1:l>r?1:Math.sin(u),l<0||l>r?0:Math.cos(h*Math.PI*2/n)*Math.cos(u))),this.uvs.push([h/n,b])}for(l=0;l<r+p;++l)for(h=0;h<n;++h)this.faces.push([c*(l+0)+0+h,c*(l+0)+1+h,c*(l+1)+1+h]),this.faces.push([c*(l+0)+0+h,c*(l+1)+1+h,c*(l+1)+0+h])};i.prototype.cylinder=function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];var o=e[0]||50,r=e[1]||o,s="number"==typeof e[2]?e[2]:24,a="number"==typeof e[3]?e[3]:16,l="cylinder|"+o+"|"+r+"|"+s+"|"+a;if(!this._renderer.geometryInHash(l)){var h=new i.Geometry(s,a);n.call(h,o,o,r,s,a,!0,!0),h.computeNormals(),this._renderer.createBuffers(l,h)}return this._renderer.drawBuffers(l),this},i.prototype.cone=function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];var o=e[0]||50,r=e[1]||o,s="number"==typeof e[2]?e[2]:24,a="number"==typeof e[3]?e[3]:16,l="cone|"+o+"|"+r+"|"+s+"|"+a;if(!this._renderer.geometryInHash(l)){var h=new i.Geometry(s,a);n.call(h,o,0,r,s,a,!0,!0),h.computeNormals(),this._renderer.createBuffers(l,h)}return this._renderer.drawBuffers(l),this},i.prototype.ellipsoid=function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];var o="number"==typeof e[3]?e[3]:24,n="number"==typeof e[4]?e[4]:24,r=e[0]||50,s=e[1]||r,a=e[2]||r,l="ellipsoid|"+r+"|"+s+"|"+a+"|"+o+"|"+n;if(!this._renderer.geometryInHash(l)){var h=function(){for(var e,t,o,n=0;n<=this.detailY;n++){t=n/this.detailY;for(var l=0;l<=this.detailX;l++){e=l/this.detailX;var h=2*Math.PI*e,p=Math.PI*t-Math.PI/2;o=new i.Vector(r*Math.cos(p)*Math.sin(h),s*Math.sin(p),a*Math.cos(p)*Math.cos(h)),this.vertices.push(o),this.uvs.push([e,t])}}},p=new i.Geometry(o,n,h);p.computeFaces().computeNormals(),this._renderer.createBuffers(l,p)}return this._renderer.drawBuffers(l),this},i.prototype.torus=function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];var o="number"==typeof e[2]?e[2]:24,n="number"==typeof e[3]?e[3]:16,r=e[0]||50,s=e[1]||10,a="torus|"+r+"|"+s+"|"+o+"|"+n;if(!this._renderer.geometryInHash(a)){var l=function(){for(var e,t,o,n=0;n<=this.detailY;n++){t=n/this.detailY;for(var a=0;a<=this.detailX;a++){e=a/this.detailX;var l=2*Math.PI*e,h=2*Math.PI*t;o=new i.Vector((r+s*Math.cos(h))*Math.cos(l),(r+s*Math.cos(h))*Math.sin(l),s*Math.sin(h)),this.vertices.push(o),this.uvs.push([e,t])}}},h=new i.Geometry(o,n,l);h.computeFaces().computeNormals().averageNormals(),this._renderer.createBuffers(a,h)}return this._renderer.drawBuffers(a),this},i.RendererGL.prototype.point=function(e,t,o){return console.log("point not yet implemented in webgl"),this},i.RendererGL.prototype.triangle=function(e){var t=e[0],o=e[1],n=e[2],r=e[3],s=e[4],a=e[5],l="tri|"+t+"|"+o+"|"+n+"|"+r+"|"+s+"|"+a;if(!this.geometryInHash(l)){var h=function(){var e=[];e.push(new i.Vector(t,o,0)),e.push(new i.Vector(n,r,0)),e.push(new i.Vector(s,a,0)),this.vertices=e,this.faces=[[0,1,2]],this.uvs=[[0,0],[0,1],[1,1]]},p=new i.Geometry(1,1,h);p.computeNormals(),this.createBuffers(l,p)}return this.drawBuffers(l),this},i.RendererGL.prototype.ellipse=function(e){var t=e[0],o=e[1],n=e[2],r=e[3],s=e[4]||24,a=e[5]||16,l="ellipse|"+e[0]+"|"+e[1]+"|"+e[2]+"|"+e[3];if(!this.geometryInHash(l)){var h=function(){for(var e,s,a,l=t+.5*n,h=o+.5*r,p=0;p<=this.detailY;p++){s=p/this.detailY;for(var c=0;c<=this.detailX;c++){e=c/this.detailX;var u=2*Math.PI*e;if(0===s)a=new i.Vector(l,h,0);else{var m=l+.5*n*Math.cos(u),d=h+.5*r*Math.sin(u);a=new i.Vector(m,d,0)}this.vertices.push(a),this.uvs.push([e,s])}}},p=new i.Geometry(s,a,h);p.computeFaces().computeNormals(),this.createBuffers(l,p)}return this.drawBuffers(l),this},i.RendererGL.prototype.rect=function(e){var t="rect|"+e[0]+"|"+e[1]+"|"+e[2]+"|"+e[3],o=e[0],n=e[1],r=e[2],s=e[3],a=e[4]||24,l=e[5]||16;if(!this.geometryInHash(t)){var h=function(){for(var e,t,a,l=0;l<=this.detailY;l++){t=l/this.detailY;for(var h=0;h<=this.detailX;h++)e=h/this.detailX,a=new i.Vector(o+r*e,n+s*t,0),this.vertices.push(a),this.uvs.push([e,t])}},p=new i.Geometry(a,l,h);p.computeFaces().computeNormals(),this.createBuffers(t,p)}return this.drawBuffers(t),this},i.RendererGL.prototype.quad=function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];var o=e[0],n=e[1],r=e[2],s=e[3],a=e[4],l=e[5],h=e[6],p=e[7],c="quad|"+o+"|"+n+"|"+r+"|"+s+"|"+a+"|"+l+"|"+h+"|"+p;if(!this.geometryInHash(c)){var u=function(){this.vertices.push(new i.Vector(o,n,0)),this.vertices.push(new i.Vector(r,s,0)),this.vertices.push(new i.Vector(a,l,0)),this.vertices.push(new i.Vector(h,p,0)),this.uvs.push([0,0],[1,0],[1,1],[0,1])},m=new i.Geometry(2,2,u);m.computeNormals(),m.faces=[[0,1,2],[2,3,0]],this.createBuffers(c,m)}return this.drawBuffers(c),this},i.RendererGL.prototype.bezier=function(e){var t=e[12]||20;this.beginShape();for(var o=[0,0,0,0],i=[0,0,0],n=0;n<=t;n++)o[0]=Math.pow(1-n/t,3),o[1]=n/t*3*Math.pow(1-n/t,2),o[2]=3*Math.pow(n/t,2)*(1-n/t),o[3]=Math.pow(n/t,3),i[0]=e[0]*o[0]+e[3]*o[1]+e[6]*o[2]+e[9]*o[3],i[1]=e[1]*o[0]+e[4]*o[1]+e[7]*o[2]+e[10]*o[3],i[2]=e[2]*o[0]+e[5]*o[1]+e[8]*o[2]+e[11]*o[3],this.vertex(i[0],i[1],i[2]);return this.endShape(),this},i.RendererGL.prototype.curve=function(e){var t=e[12];this.beginShape();for(var o=[0,0,0,0],i=[0,0,0],n=0;n<=t;n++)o[0]=.5*Math.pow(n/t,3),o[1]=.5*Math.pow(n/t,2),o[2]=n/t*.5,o[3]=.5,i[0]=o[0]*(-e[0]+3*e[3]-3*e[6]+e[9])+o[1]*(2*e[0]-5*e[3]+4*e[6]-e[9])+o[2]*(-e[0]+e[6])+o[3]*(2*e[3]),i[1]=o[0]*(-e[1]+3*e[4]-3*e[7]+e[10])+o[1]*(2*e[1]-5*e[4]+4*e[7]-e[10])+o[2]*(-e[1]+e[7])+o[3]*(2*e[4]),i[2]=o[0]*(-e[2]+3*e[5]-3*e[8]+e[11])+o[1]*(2*e[2]-5*e[5]+4*e[8]-e[11])+o[2]*(-e[2]+e[8])+o[3]*(2*e[5]),this.vertex(i[0],i[1],i[2]);return this.endShape(),this},t.exports=i},{"../core/core":42,"./p5.Geometry":87}],93:[function(e,t,o){t.exports={immediateVert:"attribute vec3 aPosition;\nattribute vec4 aVertexColor;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform float uResolution;\nuniform float uPointSize;\n\nvarying vec4 vColor;\nvoid main(void) {\n  vec4 positionVec4 = vec4(aPosition * vec3(1.0, -1.0, 1.0), 1.0);\n  gl_Position = uProjectionMatrix * uModelViewMatrix * positionVec4;\n  vColor = aVertexColor;\n  gl_PointSize = uPointSize;\n}\n",vertexColorVert:"attribute vec3 aPosition;\nattribute vec4 aVertexColor;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  vec4 positionVec4 = vec4(aPosition * vec3(1.0, -1.0, 1.0), 1.0);\n  gl_Position = uProjectionMatrix * uModelViewMatrix * positionVec4;\n  vColor = aVertexColor;\n}\n",vertexColorFrag:"precision mediump float;\nvarying vec4 vColor;\nvoid main(void) {\n  gl_FragColor = vColor;\n}",normalVert:"attribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform mat3 uNormalMatrix;\n\nvarying vec3 vVertexNormal;\nvarying highp vec2 vVertTexCoord;\n\nvoid main(void) {\n  vec4 positionVec4 = vec4(aPosition * vec3(1.0, -1.0, 1.0), 1.0);\n  gl_Position = uProjectionMatrix * uModelViewMatrix * positionVec4;\n  vVertexNormal = vec3( uNormalMatrix * aNormal );\n  vVertTexCoord = aTexCoord;\n}\n",normalFrag:"precision mediump float;\nvarying vec3 vVertexNormal;\nvoid main(void) {\n  gl_FragColor = vec4(vVertexNormal, 1.0);\n}",basicFrag:"precision mediump float;\nvarying vec3 vVertexNormal;\nuniform vec4 uMaterialColor;\nvoid main(void) {\n  gl_FragColor = uMaterialColor;\n}",lightVert:"attribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform mat3 uNormalMatrix;\nuniform int uAmbientLightCount;\nuniform int uDirectionalLightCount;\nuniform int uPointLightCount;\n\nuniform vec3 uAmbientColor[8];\nuniform vec3 uLightingDirection[8];\nuniform vec3 uDirectionalColor[8];\nuniform vec3 uPointLightLocation[8];\nuniform vec3 uPointLightColor[8];\nuniform bool uSpecular;\n\nvarying vec3 vVertexNormal;\nvarying vec2 vVertTexCoord;\nvarying vec3 vLightWeighting;\n\nvec3 ambientLightFactor = vec3(0.0, 0.0, 0.0);\nvec3 directionalLightFactor = vec3(0.0, 0.0, 0.0);\nvec3 pointLightFactor = vec3(0.0, 0.0, 0.0);\nvec3 pointLightFactor2 = vec3(0.0, 0.0, 0.0);\n\nvoid main(void){\n\n  vec4 positionVec4 = vec4(aPosition, 1.0);\n  gl_Position = uProjectionMatrix * uModelViewMatrix * positionVec4;\n\n  vec3 vertexNormal = vec3( uNormalMatrix * aNormal );\n  vVertexNormal = vertexNormal;\n  vVertTexCoord = aTexCoord;\n\n  vec4 mvPosition = uModelViewMatrix * vec4(aPosition, 1.0);\n  vec3 eyeDirection = normalize(-mvPosition.xyz);\n\n  float shininess = 32.0;\n  float specularFactor = 2.0;\n  float diffuseFactor = 0.3;\n\n  for(int i = 0; i < 8; i++){\n    if(uAmbientLightCount == i) break;\n    ambientLightFactor += uAmbientColor[i];\n  }\n\n  for(int j = 0; j < 8; j++){\n    if(uDirectionalLightCount == j) break;\n    vec3 dir = uLightingDirection[j];\n    float directionalLightWeighting = max(dot(vertexNormal, dir), 0.0);\n    directionalLightFactor += uDirectionalColor[j] * directionalLightWeighting;\n  }\n\n  for(int k = 0; k < 8; k++){\n    if(uPointLightCount == k) break;\n    vec3 loc = uPointLightLocation[k];\n    vec3 lightDirection = normalize(loc - mvPosition.xyz);\n\n    float directionalLightWeighting = max(dot(vertexNormal, lightDirection), 0.0);\n    pointLightFactor += uPointLightColor[k] * directionalLightWeighting;\n\n    //factor2 for specular\n    vec3 reflectionDirection = reflect(-lightDirection, vertexNormal);\n    float specularLightWeighting = pow(max(dot(reflectionDirection, eyeDirection), 0.0), shininess);\n\n    pointLightFactor2 += uPointLightColor[k] * (specularFactor * specularLightWeighting\n      +  directionalLightWeighting * diffuseFactor);\n  }\n\n  if(!uSpecular){\n    vLightWeighting =  ambientLightFactor + directionalLightFactor + pointLightFactor;\n  }else{\n    vLightWeighting = ambientLightFactor + directionalLightFactor + pointLightFactor2;\n  }\n\n}\n",lightTextureFrag:"precision mediump float;\n\nuniform vec4 uMaterialColor;\nuniform sampler2D uSampler;\nuniform bool isTexture;\n\nvarying vec3 vLightWeighting;\nvarying highp vec2 vVertTexCoord;\n\nvoid main(void) {\n  if(!isTexture){\n    gl_FragColor = vec4(vec3(uMaterialColor.rgb * vLightWeighting), uMaterialColor.a);\n  }else{\n    vec4 textureColor = texture2D(uSampler, vVertTexCoord);\n    if(vLightWeighting == vec3(0., 0., 0.)){\n      gl_FragColor = textureColor;\n    }else{\n      gl_FragColor = vec4(vec3(textureColor.rgb * vLightWeighting), textureColor.a);\n    }\n  }\n}"}},{}]},{},[33])(33)})}).call(t,o(51))},function(e,t,o){"use strict";(function(t){function i(e,t){if("function"==typeof e)return i("*",e);if("function"==typeof t)for(var o=new a(e),n=1;n<arguments.length;++n)i.callbacks.push(o.middleware(arguments[n]));else"string"==typeof e?i["string"==typeof t?"redirect":"show"](e,t):i.start(e)}function n(e){if(!e.handled){var t;t=v?_+y.hash.replace("#!",""):y.pathname+y.search,t!==e.canonicalPath&&(i.stop(),e.handled=!1,y.href=e.canonicalPath)}}function r(e){return"string"!=typeof e?e:f?decodeURIComponent(e.replace(/\+/g," ")):e}function s(e,t){"/"===e[0]&&0!==e.indexOf(_)&&(e=_+(v?"#!":"")+e);var o=e.indexOf("?");if(this.canonicalPath=e,this.path=e.replace(_,"")||"/",v&&(this.path=this.path.replace("#!","")||"/"),this.title=document.title,this.state=t||{},this.state.path=e,this.querystring=~o?r(e.slice(o+1)):"",this.pathname=r(~o?e.slice(0,o):e),this.params={},this.hash="",!v){if(!~this.path.indexOf("#"))return;var i=this.path.split("#");this.path=i[0],this.hash=r(i[1])||"",this.querystring=this.querystring.split("#")[0]}}function a(e,t){t=t||{},this.path="*"===e?"(.*)":e,this.method="GET",this.regexp=c(this.path,this.keys=[],t)}function l(e){if(1===h(e)&&!(e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)){for(var o=e.path?e.path[0]:e.target;o&&"A"!==o.nodeName;)o=o.parentNode;if(o&&"A"===o.nodeName&&!o.hasAttribute("download")&&"external"!==o.getAttribute("rel")){var n=o.getAttribute("href");if((v||o.pathname!==y.pathname||!o.hash&&"#"!==n)&&!(n&&n.indexOf("mailto:")>-1)&&!o.target&&p(o.href)){var r=o.pathname+o.search+(o.hash||"");void 0!==t&&r.match(/^\/[a-zA-Z]:\//)&&(r=r.replace(/^\/[a-zA-Z]:\//,"/"));var s=r;0===r.indexOf(_)&&(r=r.substr(_.length)),v&&(r=r.replace("#!","")),_&&s===r||(e.preventDefault(),i.show(s))}}}}function h(e){return e=e||window.event,null===e.which?e.button:e.which}function p(e){var t=y.protocol+"//"+y.hostname;return y.port&&(t+=":"+y.port),e&&0===e.indexOf(t)}var c=o(44);e.exports=i;var u,m,d="undefined"!=typeof document&&document.ontouchstart?"touchstart":"click",y="undefined"!=typeof window&&(window.history.location||window.location),b=!0,f=!0,_="",v=!1;i.callbacks=[],i.exits=[],i.current="",i.len=0,i.base=function(e){if(0===arguments.length)return _;_=e},i.start=function(e){if(e=e||{},!u&&(u=!0,!1===e.dispatch&&(b=!1),!1===e.decodeURLComponents&&(f=!1),!1!==e.popstate&&window.addEventListener("popstate",g,!1),!1!==e.click&&document.addEventListener(d,l,!1),!0===e.hashbang&&(v=!0),b)){var t=v&&~y.hash.indexOf("#!")?y.hash.substr(2)+y.search:y.pathname+y.search+y.hash;i.replace(t,null,!0,b)}},i.stop=function(){u&&(i.current="",i.len=0,u=!1,document.removeEventListener(d,l,!1),window.removeEventListener("popstate",g,!1))},i.show=function(e,t,o,n){var r=new s(e,t);return i.current=r.path,!1!==o&&i.dispatch(r),!1!==r.handled&&!1!==n&&r.pushState(),r},i.back=function(e,t){i.len>0?(history.back(),i.len--):e?setTimeout(function(){i.show(e,t)}):setTimeout(function(){i.show(_,t)})},i.redirect=function(e,t){"string"==typeof e&&"string"==typeof t&&i(e,function(e){setTimeout(function(){i.replace(t)},0)}),"string"==typeof e&&void 0===t&&setTimeout(function(){i.replace(e)},0)},i.replace=function(e,t,o,n){var r=new s(e,t);return i.current=r.path,r.init=o,r.save(),!1!==n&&i.dispatch(r),r},i.dispatch=function(e){function t(){var e=i.exits[a++];if(!e)return o();e(r,t)}function o(){var t=i.callbacks[s++];return e.path!==i.current?void(e.handled=!1):t?void t(e,o):n(e)}var r=m,s=0,a=0;m=e,r?t():o()},i.exit=function(e,t){if("function"==typeof e)return i.exit("*",e);for(var o=new a(e),n=1;n<arguments.length;++n)i.exits.push(o.middleware(arguments[n]))},i.Context=s,s.prototype.pushState=function(){i.len++,history.pushState(this.state,this.title,v&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},s.prototype.save=function(){history.replaceState(this.state,this.title,v&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},i.Route=a,a.prototype.middleware=function(e){var t=this;return function(o,i){if(t.match(o.path,o.params))return e(o,i);i()}},a.prototype.match=function(e,t){var o=this.keys,i=e.indexOf("?"),n=~i?e.slice(0,i):e,s=this.regexp.exec(decodeURIComponent(n));if(!s)return!1;for(var a=1,l=s.length;a<l;++a){var h=o[a-1],p=r(s[a]);void 0===p&&hasOwnProperty.call(t,h.name)||(t[h.name]=p)}return!0};var g=function(){var e=!1;if("undefined"!=typeof window)return"complete"===document.readyState?e=!0:window.addEventListener("load",function(){setTimeout(function(){e=!0},0)}),function(t){if(e)if(t.state){var o=t.state.path;i.replace(o,t.state)}else i.show(y.pathname+y.hash,void 0,void 0,!1)}}();i.sameOrigin=p}).call(t,o(45))},function(e,t,o){function i(e){for(var t,o=[],i=0,n=0,r="";null!=(t=b.exec(e));){var s=t[0],l=t[1],h=t.index;if(r+=e.slice(n,h),n=h+s.length,l)r+=l[1];else{r&&(o.push(r),r="");var p=t[2],c=t[3],u=t[4],m=t[5],d=t[6],y=t[7],f="+"===d||"*"===d,_="?"===d||"*"===d,v=p||"/",g=u||m||(y?".*":"[^"+v+"]+?");o.push({name:c||i++,prefix:p||"",delimiter:v,optional:_,repeat:f,pattern:a(g)})}}return n<e.length&&(r+=e.substr(n)),r&&o.push(r),o}function n(e){return r(i(e))}function r(e){for(var t=new Array(e.length),o=0;o<e.length;o++)"object"==typeof e[o]&&(t[o]=new RegExp("^"+e[o].pattern+"$"));return function(o){for(var i="",n=o||{},r=0;r<e.length;r++){var s=e[r];if("string"!=typeof s){var a,l=n[s.name];if(null==l){if(s.optional)continue;throw new TypeError('Expected "'+s.name+'" to be defined')}if(y(l)){if(!s.repeat)throw new TypeError('Expected "'+s.name+'" to not repeat, but received "'+l+'"');if(0===l.length){if(s.optional)continue;throw new TypeError('Expected "'+s.name+'" to not be empty')}for(var h=0;h<l.length;h++){if(a=encodeURIComponent(l[h]),!t[r].test(a))throw new TypeError('Expected all "'+s.name+'" to match "'+s.pattern+'", but received "'+a+'"');i+=(0===h?s.prefix:s.delimiter)+a}}else{if(a=encodeURIComponent(l),!t[r].test(a))throw new TypeError('Expected "'+s.name+'" to match "'+s.pattern+'", but received "'+a+'"');i+=s.prefix+a}}else i+=s}return i}}function s(e){return e.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function a(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function l(e,t){return e.keys=t,e}function h(e){return e.sensitive?"":"i"}function p(e,t){var o=e.source.match(/\((?!\?)/g);if(o)for(var i=0;i<o.length;i++)t.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return l(e,t)}function c(e,t,o){for(var i=[],n=0;n<e.length;n++)i.push(d(e[n],t,o).source);return l(new RegExp("(?:"+i.join("|")+")",h(o)),t)}function u(e,t,o){for(var n=i(e),r=m(n,o),s=0;s<n.length;s++)"string"!=typeof n[s]&&t.push(n[s]);return l(r,t)}function m(e,t){t=t||{};for(var o=t.strict,i=!1!==t.end,n="",r=e[e.length-1],a="string"==typeof r&&/\/$/.test(r),l=0;l<e.length;l++){var p=e[l];if("string"==typeof p)n+=s(p);else{var c=s(p.prefix),u=p.pattern;p.repeat&&(u+="(?:"+c+u+")*"),u=p.optional?c?"(?:"+c+"("+u+"))?":"("+u+")?":c+"("+u+")",n+=u}}return o||(n=(a?n.slice(0,-2):n)+"(?:\\/(?=$))?"),n+=i?"$":o&&a?"":"(?=\\/|$)",new RegExp("^"+n,h(t))}function d(e,t,o){return t=t||[],y(t)?o||(o={}):(o=t,t=[]),e instanceof RegExp?p(e,t,o):y(e)?c(e,t,o):u(e,t,o)}var y=o(41);e.exports=d,e.exports.parse=i,e.exports.compile=n,e.exports.tokensToFunction=r,e.exports.tokensToRegExp=m;var b=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g")},function(e,t){function o(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function n(e){if(p===setTimeout)return setTimeout(e,0);if((p===o||!p)&&setTimeout)return p=setTimeout,setTimeout(e,0);try{return p(e,0)}catch(t){try{return p.call(null,e,0)}catch(t){return p.call(this,e,0)}}}function r(e){if(c===clearTimeout)return clearTimeout(e);if((c===i||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{return c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}function s(){y&&m&&(y=!1,m.length?d=m.concat(d):b=-1,d.length&&a())}function a(){if(!y){var e=n(s);y=!0;for(var t=d.length;t;){for(m=d,d=[];++b<t;)m&&m[b].run();b=-1,t=d.length}m=null,y=!1,r(e)}}function l(e,t){this.fun=e,this.array=t}function h(){}var p,c,u=e.exports={};!function(){try{p="function"==typeof setTimeout?setTimeout:o}catch(e){p=o}try{c="function"==typeof clearTimeout?clearTimeout:i}catch(e){c=i}}();var m,d=[],y=!1,b=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];d.push(new l(e,t)),1!==d.length||y||n(a)},l.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=h,u.addListener=h,u.once=h,u.off=h,u.removeListener=h,u.removeAllListeners=h,u.emit=h,u.prependListener=h,u.prependOnceListener=h,u.listeners=function(e){return[]},u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},function(e,t){e.exports='/*!\nhttps://github.com/mvasilkov/box2d-html5\n*/!function(){{var t,e=function(){var t=!1,e=e||{};return e.global=this,e.global.CLOSURE_DEFINES,e.exportPath_=function(t,o,i){var n=t.split("."),s=i||e.global;n[0]in s||!s.execScript||s.execScript("var "+n[0]);for(var r;n.length&&(r=n.shift());)n.length||void 0===o?s=s[r]?s[r]:s[r]={}:s[r]=o},e.define=function(o,i){var n=i;t||e.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(e.global.CLOSURE_DEFINES,o)&&(n=e.global.CLOSURE_DEFINES[o]),e.exportPath_(o,n)},e.DEBUG=!0,e.define("goog.LOCALE","en"),e.define("goog.TRUSTED_SITE",!0),e.provide=function(o){if(!t){if(e.isProvided_(o))throw Error(\'Namespace "\'+o+\'" already declared.\');delete e.implicitNamespaces_[o];for(var i=o;(i=i.substring(0,i.lastIndexOf(".")))&&!e.getObjectByName(i);)e.implicitNamespaces_[i]=!0}e.exportPath_(o)},e.setTestOnly=function(o){if(t&&!e.DEBUG)throw o=o||"",Error(": "+o)},t||(e.isProvided_=function(t){return!e.implicitNamespaces_[t]&&!!e.getObjectByName(t)},e.implicitNamespaces_={}),e.getObjectByName=function(t,o){for(var i,n=t.split("."),s=o||e.global;i=n.shift();){if(!e.isDefAndNotNull(s[i]))return null;s=s[i]}return s},e.globalize=function(t,o){var i=o||e.global;for(var n in t)i[n]=t[n]},e.addDependency=function(t,o,i){if(e.DEPENDENCIES_ENABLED){for(var n,s,r=t.replace(/\\\\/g,"/"),a=e.dependencies_,l=0;n=o[l];l++)a.nameToPath[n]=r,r in a.pathToNames||(a.pathToNames[r]={}),a.pathToNames[r][n]=!0;for(var p=0;s=i[p];p++)r in a.requires||(a.requires[r]={}),a.requires[r][s]=!0}},e.define("goog.ENABLE_DEBUG_LOADER",!0),e.require=function(o){if(!t){if(e.isProvided_(o))return;if(e.ENABLE_DEBUG_LOADER){var i=e.getPathFromDeps_(o);if(i)return e.included_[i]=!0,e.writeScripts_(),void 0}var n="goog.require could not find: "+o;throw e.global.console&&e.global.console.error(n),Error(n)}},e.basePath="",e.global.CLOSURE_BASE_PATH,e.global.CLOSURE_NO_DEPS,e.global.CLOSURE_IMPORT_SCRIPT,e.nullFunction=function(){},e.identityFunction=function(t){return t},e.abstractMethod=function(){throw Error("unimplemented abstract method")},e.addSingletonGetter=function(t){t.getInstance=function(){return t.instance_?t.instance_:(e.DEBUG&&(e.instantiatedSingletons_[e.instantiatedSingletons_.length]=t),t.instance_=new t)}},e.instantiatedSingletons_=[],e.DEPENDENCIES_ENABLED=!t&&e.ENABLE_DEBUG_LOADER,e.DEPENDENCIES_ENABLED&&(e.included_={},e.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}},e.inHtmlDocument_=function(){var t=e.global.document;return"undefined"!=typeof t&&"write"in t},e.findBasePath_=function(){if(e.global.CLOSURE_BASE_PATH)return e.basePath=e.global.CLOSURE_BASE_PATH,void 0;if(e.inHtmlDocument_())for(var t=e.global.document,o=t.getElementsByTagName("script"),i=o.length-1;i>=0;--i){var n=o[i].src,s=n.lastIndexOf("?"),r=-1==s?n.length:s;if("base.js"==n.substr(r-7,7))return e.basePath=n.substr(0,r-7),void 0}},e.importScript_=function(t){var o=e.global.CLOSURE_IMPORT_SCRIPT||e.writeScriptTag_;!e.dependencies_.written[t]&&o(t)&&(e.dependencies_.written[t]=!0)},e.writeScriptTag_=function(t){if(e.inHtmlDocument_()){var o=e.global.document;if("complete"==o.readyState){var i=/\\bdeps.js$/.test(t);if(i)return!1;throw Error(\'Cannot write "\'+t+\'" after document load\')}return o.write(\'<script type="text/javascript" src="\'+t+\'"><\/script>\'),!0}return!1},e.writeScripts_=function(){function t(s){if(!(s in n.written)){if(s in n.visited)return s in i||(i[s]=!0,o.push(s)),void 0;if(n.visited[s]=!0,s in n.requires)for(var r in n.requires[s])if(!e.isProvided_(r)){if(!(r in n.nameToPath))throw Error("Undefined nameToPath for "+r);t(n.nameToPath[r])}s in i||(i[s]=!0,o.push(s))}}var o=[],i={},n=e.dependencies_;for(var s in e.included_)n.written[s]||t(s);for(var r=0;r<o.length;r++){if(!o[r])throw Error("Undefined script input");e.importScript_(e.basePath+o[r])}},e.getPathFromDeps_=function(t){return t in e.dependencies_.nameToPath?e.dependencies_.nameToPath[t]:null},e.findBasePath_(),e.global.CLOSURE_NO_DEPS||e.importScript_(e.basePath+"deps.js")),e.typeOf=function(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var o=Object.prototype.toString.call(t);if("[object Window]"==o)return"object";if("[object Array]"==o||"number"==typeof t.length&&"undefined"!=typeof t.splice&&"undefined"!=typeof t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==o||"undefined"!=typeof t.call&&"undefined"!=typeof t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&"undefined"==typeof t.call)return"object";return e},e.isDef=function(t){return void 0!==t},e.isNull=function(t){return null===t},e.isDefAndNotNull=function(t){return null!=t},e.isArray=function(t){return"array"==e.typeOf(t)},e.isArrayLike=function(t){var o=e.typeOf(t);return"array"==o||"object"==o&&"number"==typeof t.length},e.isDateLike=function(t){return e.isObject(t)&&"function"==typeof t.getFullYear},e.isString=function(t){return"string"==typeof t},e.isBoolean=function(t){return"boolean"==typeof t},e.isNumber=function(t){return"number"==typeof t},e.isFunction=function(t){return"function"==e.typeOf(t)},e.isObject=function(t){var e=typeof t;return"object"==e&&null!=t||"function"==e},e.getUid=function(t){return t[e.UID_PROPERTY_]||(t[e.UID_PROPERTY_]=++e.uidCounter_)},e.hasUid=function(t){return!!t[e.UID_PROPERTY_]},e.removeUid=function(t){"removeAttribute"in t&&t.removeAttribute(e.UID_PROPERTY_);try{delete t[e.UID_PROPERTY_]}catch(o){}},e.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),e.uidCounter_=0,e.getHashCode=e.getUid,e.removeHashCode=e.removeUid,e.cloneObject=function(t){var o=e.typeOf(t);if("object"==o||"array"==o){if(t.clone)return t.clone();var i="array"==o?[]:{};for(var n in t)i[n]=e.cloneObject(t[n]);return i}return t},e.bindNative_=function(t){return t.call.apply(t.bind,arguments)},e.bindJs_=function(t,e){if(!t)throw new Error;if(arguments.length>2){var o=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,o),t.apply(e,i)}}return function(){return t.apply(e,arguments)}},e.bind=function(){return e.bind=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?e.bindNative_:e.bindJs_,e.bind.apply(null,arguments)},e.partial=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){var o=e.slice();return o.push.apply(o,arguments),t.apply(this,o)}},e.mixin=function(t,e){for(var o in e)t[o]=e[o]},e.now=e.TRUSTED_SITE&&Date.now||function(){return+new Date},e.globalEval=function(t){if(e.global.execScript)e.global.execScript(t,"JavaScript");else{if(!e.global.eval)throw Error("goog.globalEval not available");if(null==e.evalWorksForGlobals_&&(e.global.eval("var _et_ = 1;"),"undefined"!=typeof e.global._et_?(delete e.global._et_,e.evalWorksForGlobals_=!0):e.evalWorksForGlobals_=!1),e.evalWorksForGlobals_)e.global.eval(t);else{var o=e.global.document,i=o.createElement("script");i.type="text/javascript",i.defer=!1,i.appendChild(o.createTextNode(t)),o.body.appendChild(i),o.body.removeChild(i)}}},e.evalWorksForGlobals_=null,e.cssNameMapping_,e.cssNameMappingStyle_,e.getCssName=function(t,o){var i,n=function(t){return e.cssNameMapping_[t]||t},s=function(t){for(var e=t.split("-"),o=[],i=0;i<e.length;i++)o.push(n(e[i]));return o.join("-")};return i=e.cssNameMapping_?"BY_WHOLE"==e.cssNameMappingStyle_?n:s:function(t){return t},o?t+"-"+i(o):i(t)},e.setCssNameMapping=function(t,o){e.cssNameMapping_=t,e.cssNameMappingStyle_=o},e.global.CLOSURE_CSS_NAME_MAPPING,!t&&e.global.CLOSURE_CSS_NAME_MAPPING&&(e.cssNameMapping_=e.global.CLOSURE_CSS_NAME_MAPPING),e.getMsg=function(t,e){var o=e||{};for(var i in o){var n=(""+o[i]).replace(/\\$/g,"$$$$");t=t.replace(new RegExp("\\\\{\\\\$"+i+"\\\\}","gi"),n)}return t},e.getMsgWithFallback=function(t){return t},e.exportSymbol=function(t,o,i){e.exportPath_(t,o,i)},e.exportProperty=function(t,e,o){t[e]=o},e.inherits=function(t,e){function o(){}o.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new o,t.prototype.constructor=t},e.base=function(t,o){var i=arguments.callee.caller;if(e.DEBUG&&!i)throw Error("arguments.caller not defined.  goog.base() expects not to be running in strict mode. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(i.superClass_)return i.superClass_.constructor.apply(t,Array.prototype.slice.call(arguments,1));for(var n=Array.prototype.slice.call(arguments,2),s=!1,r=t.constructor;r;r=r.superClass_&&r.superClass_.constructor)if(r.prototype[o]===i)s=!0;else if(s)return r.prototype[o].apply(t,n);if(t[o]===i)return t.constructor.prototype[o].apply(t,n);throw Error("goog.base called from a method of one name to a method of a different name")},e.scope=function(t){t.call(e.global)},e}(),o=function(e){return"undefined"==typeof t&&(t={}),"undefined"==typeof t.b2Settings&&(t.b2Settings={}),Object.defineProperty||(Object.defineProperty=function(t,e,o){Object.__defineGetter__&&("get"in o?t.__defineGetter__(e,o.get):"value"in o&&t.__defineGetter__(e,o.value)),Object.__defineSetter__&&("set"in o?t.__defineSetter__(e,o.set):"value"in o&&t.__defineSetter__(e,o.value))}),t.DEBUG=!0,t.ENABLE_ASSERTS=t.DEBUG,t.b2Assert=function(e){t.DEBUG},t.b2_maxFloat=1e37,t.b2_epsilon=1e-5,t.b2_epsilon_sq=t.b2_epsilon*t.b2_epsilon,t.b2_pi=Math.PI,t.b2_maxManifoldPoints=2,t.b2_maxPolygonVertices=8,t.b2_aabbExtension=.1,t.b2_aabbMultiplier=2,t.b2_linearSlop=.008,t.b2_angularSlop=2/180*t.b2_pi,t.b2_polygonRadius=2*t.b2_linearSlop,t.b2_maxSubSteps=8,t.b2_maxTOIContacts=32,t.b2_velocityThreshold=1,t.b2_maxLinearCorrection=.2,t.b2_maxAngularCorrection=8/180*t.b2_pi,t.b2_maxTranslation=2,t.b2_maxTranslationSquared=t.b2_maxTranslation*t.b2_maxTranslation,t.b2_maxRotation=.5*t.b2_pi,t.b2_maxRotationSquared=t.b2_maxRotation*t.b2_maxRotation,t.b2_baumgarte=.2,t.b2_toiBaumgarte=.75,t.b2_timeToSleep=.5,t.b2_linearSleepTolerance=.01,t.b2_angularSleepTolerance=2/180*t.b2_pi,t.b2Alloc=function(){return null},t.b2Free=function(){},t.b2Log=function(){e.global.console.log.apply(null,arguments)},t.b2Version=function(t,e,o){this.major=t||0,this.minor=e||0,this.revision=o||0},t.b2Version.prototype.major=0,t.b2Version.prototype.minor=0,t.b2Version.prototype.revision=0,t.b2Version.prototype.toString=function(){return this.major+"."+this.minor+"."+this.revision},t.b2_version=new t.b2Version(2,3,0),t.b2_changelist=278,t.b2ParseInt=function(t){return parseInt(t,10)},t.b2ParseUInt=function(e){return t.b2Abs(parseInt(e,10))},t.b2MakeArray=function(t,e){void 0===t&&(t=0);var o=new Array(t);if(void 0!==e)for(var i=0;t>i;++i)o[i]=e(i);return o},t.b2MakeNumberArray=function(e){return t.b2MakeArray(e,function(){return 0})},t}(e),i=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2Math&&(e.b2Math={}),e.b2_pi_over_180=e.b2_pi/180,e.b2_180_over_pi=180/e.b2_pi,e.b2_two_pi=2*e.b2_pi,e.b2Abs=function(t){return 0>t?-t:t},e.b2Min=function(t,e){return e>t?t:e},e.b2Max=function(t,e){return t>e?t:e},e.b2Clamp=function(t,e,o){return e>t?e:t>o?o:t},e.b2Swap=function(t,o){e.ENABLE_ASSERTS&&e.b2Assert(!1);var i=t[0];t[0]=o[0],o[0]=i},e.b2IsValid=function(t){return isFinite(t)},e.b2Sq=function(t){return t*t},e.b2InvSqrt=function(t){return 1/Math.sqrt(t)},e.b2Sqrt=function(t){return Math.sqrt(t)},e.b2Pow=function(t,e){return Math.pow(t,e)},e.b2DegToRad=function(t){return t*e.b2_pi_over_180},e.b2RadToDeg=function(t){return t*e.b2_180_over_pi},e.b2Cos=function(t){return Math.cos(t)},e.b2Sin=function(t){return Math.sin(t)},e.b2Acos=function(t){return Math.acos(t)},e.b2Asin=function(t){return Math.asin(t)},e.b2Atan2=function(t,e){return Math.atan2(t,e)},e.b2NextPowerOfTwo=function(t){return t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,t|=t>>16&65535,t+1},e.b2IsPowerOfTwo=function(t){return t>0&&0==(t&t-1)},e.b2Random=function(){return 2*Math.random()-1},e.b2RandomRange=function(t,e){return(e-t)*Math.random()+t},e.b2Vec2=function(t,e){this.x=t||0,this.y=e||0},e.b2Vec2.prototype.x=0,e.b2Vec2.prototype.y=0,e.b2Vec2_zero=new e.b2Vec2,e.b2Vec2.ZERO=new e.b2Vec2,e.b2Vec2.UNITX=new e.b2Vec2(1,0),e.b2Vec2.UNITY=new e.b2Vec2(0,1),e.b2Vec2.s_t0=new e.b2Vec2,e.b2Vec2.s_t1=new e.b2Vec2,e.b2Vec2.s_t2=new e.b2Vec2,e.b2Vec2.s_t3=new e.b2Vec2,e.b2Vec2.MakeArray=function(t){return e.b2MakeArray(t,function(){return new e.b2Vec2})},e.b2Vec2.prototype.Clone=function(){return new e.b2Vec2(this.x,this.y)},e.b2Vec2.prototype.SetZero=function(){return this.x=0,this.y=0,this},e.b2Vec2.prototype.Set=function(t,e){return this.x=t,this.y=e,this},e.b2Vec2.prototype.Copy=function(t){return this.x=t.x,this.y=t.y,this},e.b2Vec2.prototype.SelfAdd=function(t){return this.x+=t.x,this.y+=t.y,this},e.b2Vec2.prototype.SelfAddXY=function(t,e){return this.x+=t,this.y+=e,this},e.b2Vec2.prototype.SelfSub=function(t){return this.x-=t.x,this.y-=t.y,this},e.b2Vec2.prototype.SelfSubXY=function(t,e){return this.x-=t,this.y-=e,this},e.b2Vec2.prototype.SelfMul=function(t){return this.x*=t,this.y*=t,this},e.b2Vec2.prototype.SelfMulAdd=function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this},e.b2Vec2.prototype.SelfMulSub=function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this},e.b2Vec2.prototype.Dot=function(t){return this.x*t.x+this.y*t.y},e.b2Vec2.prototype.Cross=function(t){return this.x*t.y-this.y*t.x},e.b2Vec2.prototype.Length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},e.b2Vec2.prototype.GetLength=e.b2Vec2.prototype.Length,e.b2Vec2.prototype.LengthSquared=function(){var t=this.x,e=this.y;return t*t+e*e},e.b2Vec2.prototype.GetLengthSquared=e.b2Vec2.prototype.LengthSquared,e.b2Vec2.prototype.Normalize=function(){var t=this.GetLength();if(t>=e.b2_epsilon){var o=1/t;this.x*=o,this.y*=o}return t},e.b2Vec2.prototype.SelfNormalize=function(){var t=this.GetLength();if(t>=e.b2_epsilon){var o=1/t;this.x*=o,this.y*=o}return this},e.b2Vec2.prototype.SelfRotate=function(t,e){var o=this.x,i=this.y;return this.x=t*o-e*i,this.y=e*o+t*i,this},e.b2Vec2.prototype.SelfRotateRadians=function(t){return this.SelfRotate(Math.cos(t),Math.sin(t))},e.b2Vec2.prototype.SelfRotateDegrees=function(t){return this.SelfRotateRadians(e.b2DegToRad(t))},e.b2Vec2.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},e.b2Vec2.prototype.SelfCrossVS=function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this},e.b2Vec2.prototype.SelfCrossSV=function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this},e.b2Vec2.prototype.SelfMinV=function(t){return this.x=e.b2Min(this.x,t.x),this.y=e.b2Min(this.y,t.y),this},e.b2Vec2.prototype.SelfMaxV=function(t){return this.x=e.b2Max(this.x,t.x),this.y=e.b2Max(this.y,t.y),this},e.b2Vec2.prototype.SelfAbs=function(){return this.x=e.b2Abs(this.x),this.y=e.b2Abs(this.y),this},e.b2Vec2.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this},e.b2Vec2.prototype.SelfSkew=function(){var t=this.x;return this.x=-this.y,this.y=t,this},e.b2AbsV=function(t,o){return o.x=e.b2Abs(t.x),o.y=e.b2Abs(t.y),o},e.b2MinV=function(t,o,i){return i.x=e.b2Min(t.x,o.x),i.y=e.b2Min(t.y,o.y),i},e.b2MaxV=function(t,o,i){return i.x=e.b2Max(t.x,o.x),i.y=e.b2Max(t.y,o.y),i},e.b2ClampV=function(t,o,i,n){return n.x=e.b2Clamp(t.x,o.x,i.x),n.y=e.b2Clamp(t.y,o.y,i.y),n},e.b2RotateV=function(t,e,o,i){var n=t.x,s=t.y;return i.x=e*n-o*s,i.y=o*n+e*s,i},e.b2RotateRadiansV=function(t,o,i){return e.b2RotateV(t,Math.cos(o),Math.sin(o),i)},e.b2RotateDegreesV=function(t,o,i){return e.b2RotateRadiansV(t,e.b2DegToRad(o),i)},e.b2DotVV=function(t,e){return t.x*e.x+t.y*e.y},e.b2CrossVV=function(t,e){return t.x*e.y-t.y*e.x},e.b2CrossVS=function(t,e,o){var i=t.x;return o.x=e*t.y,o.y=-e*i,o},e.b2CrossVOne=function(t,e){var o=t.x;return e.x=t.y,e.y=-o,e},e.b2CrossSV=function(t,e,o){var i=e.x;return o.x=-t*e.y,o.y=t*i,o},e.b2CrossOneV=function(t,e){var o=t.x;return e.x=-t.y,e.y=o,e},e.b2AddVV=function(t,e,o){return o.x=t.x+e.x,o.y=t.y+e.y,o},e.b2SubVV=function(t,e,o){return o.x=t.x-e.x,o.y=t.y-e.y,o},e.b2MulSV=function(t,e,o){return o.x=e.x*t,o.y=e.y*t,o},e.b2AddVMulSV=function(t,e,o,i){return i.x=t.x+e*o.x,i.y=t.y+e*o.y,i},e.b2SubVMulSV=function(t,e,o,i){return i.x=t.x-e*o.x,i.y=t.y-e*o.y,i},e.b2AddVCrossSV=function(t,e,o,i){var n=o.x;return i.x=t.x-e*o.y,i.y=t.y+e*n,i},e.b2MidVV=function(t,e,o){return o.x=.5*(t.x+e.x),o.y=.5*(t.y+e.y),o},e.b2ExtVV=function(t,e,o){return o.x=.5*(e.x-t.x),o.y=.5*(e.y-t.y),o},e.b2IsEqualToV=function(t,e){return t.x==e.x&&t.y==e.y},e.b2DistanceVV=function(t,e){var o=t.x-e.x,i=t.y-e.y;return Math.sqrt(o*o+i*i)},e.b2DistanceSquaredVV=function(t,e){var o=t.x-e.x,i=t.y-e.y;return o*o+i*i},e.b2NegV=function(t,e){return e.x=-t.x,e.y=-t.y,e},e.b2Vec3=function(t,e,o){this.x=t||0,this.y=e||0,this.z=o||0},e.b2Vec3.prototype.x=0,e.b2Vec3.prototype.y=0,e.b2Vec3.prototype.z=0,e.b2Vec3.ZERO=new e.b2Vec3,e.b2Vec3.s_t0=new e.b2Vec3,e.b2Vec3.prototype.Clone=function(){return new e.b2Vec3(this.x,this.y,this.z)},e.b2Vec3.prototype.SetZero=function(){return this.x=0,this.y=0,this.z=0,this},e.b2Vec3.prototype.Set=function(t,e,o){return this.x=t,this.y=e,this.z=o,this},e.b2Vec3.prototype.Copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},e.b2Vec3.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},e.b2Vec3.prototype.SelfAdd=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},e.b2Vec3.prototype.SelfAddXYZ=function(t,e,o){return this.x+=t,this.y+=e,this.z+=o,this},e.b2Vec3.prototype.SelfSub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},e.b2Vec3.prototype.SelfSubXYZ=function(t,e,o){return this.x-=t,this.y-=e,this.z-=o,this},e.b2Vec3.prototype.SelfMul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},e.b2DotV3V3=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},e.b2CrossV3V3=function(t,e,o){var i=t.x,n=t.y,s=t.z,r=e.x,a=e.y,l=e.z;return o.x=n*l-s*a,o.y=s*r-i*l,o.z=i*a-n*r,o},e.b2Mat22=function(){this.ex=new e.b2Vec2(1,0),this.ey=new e.b2Vec2(0,1)},e.b2Mat22.prototype.ex=null,e.b2Mat22.prototype.ey=null,e.b2Mat22.IDENTITY=new e.b2Mat22,e.b2Mat22.prototype.Clone=function(){return(new e.b2Mat22).Copy(this)},e.b2Mat22.FromVV=function(t,o){return(new e.b2Mat22).SetVV(t,o)},e.b2Mat22.FromSSSS=function(t,o,i,n){return(new e.b2Mat22).SetSSSS(t,o,i,n)},e.b2Mat22.FromAngleRadians=function(t){return(new e.b2Mat22).SetAngleRadians(t)},e.b2Mat22.prototype.SetSSSS=function(t,e,o,i){return this.ex.Set(t,o),this.ey.Set(e,i),this},e.b2Mat22.prototype.SetVV=function(t,e){return this.ex.Copy(t),this.ey.Copy(e),this},e.b2Mat22.prototype.SetAngle=function(t){var e=Math.cos(t),o=Math.sin(t);return this.ex.Set(e,o),this.ey.Set(-o,e),this},e.b2Mat22.prototype.SetAngleRadians=e.b2Mat22.prototype.SetAngle,e.b2Mat22.prototype.SetAngleDegrees=function(t){return this.SetAngle(e.b2DegToRad(t))},e.b2Mat22.prototype.Copy=function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this},e.b2Mat22.prototype.SetIdentity=function(){return this.ex.Set(1,0),this.ey.Set(0,1),this},e.b2Mat22.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this},e.b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.ex.y,this.ex.x)},e.b2Mat22.prototype.GetAngleRadians=e.b2Mat22.prototype.GetAngle,e.b2Mat22.prototype.GetInverse=function(t){var e=this.ex.x,o=this.ey.x,i=this.ex.y,n=this.ey.y,s=e*n-o*i;return 0!=s&&(s=1/s),t.ex.x=s*n,t.ey.x=-s*o,t.ex.y=-s*i,t.ey.y=s*e,t},e.b2Mat22.prototype.Solve=function(t,e,o){var i=this.ex.x,n=this.ey.x,s=this.ex.y,r=this.ey.y,a=i*r-n*s;return 0!=a&&(a=1/a),o.x=a*(r*t-n*e),o.y=a*(i*e-s*t),o},e.b2Mat22.prototype.SelfAbs=function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this},e.b2Mat22.prototype.SelfInv=function(){return this.GetInverse(this)},e.b2Mat22.prototype.SelfAddM=function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this},e.b2Mat22.prototype.SelfSubM=function(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this},e.b2AbsM=function(t,o){var i=t.ex,n=t.ey;return o.ex.x=e.b2Abs(i.x),o.ex.y=e.b2Abs(i.y),o.ey.x=e.b2Abs(n.x),o.ey.y=e.b2Abs(n.y),o},e.b2MulMV=function(t,e,o){var i=t.ex,n=t.ey,s=e.x,r=e.y;return o.x=i.x*s+n.x*r,o.y=i.y*s+n.y*r,o},e.b2MulTMV=function(t,e,o){var i=t.ex,n=t.ey,s=e.x,r=e.y;return o.x=i.x*s+i.y*r,o.y=n.x*s+n.y*r,o},e.b2AddMM=function(t,e,o){var i=t.ex,n=t.ey,s=e.ex,r=e.ey;return o.ex.x=i.x+s.x,o.ex.y=i.y+s.y,o.ey.x=n.x+r.x,o.ey.y=n.y+r.y,o},e.b2MulMM=function(t,e,o){var i=t.ex.x,n=t.ex.y,s=t.ey.x,r=t.ey.y,a=e.ex.x,l=e.ex.y,p=e.ey.x,m=e.ey.y;return o.ex.x=i*a+s*l,o.ex.y=n*a+r*l,o.ey.x=i*p+s*m,o.ey.y=n*p+r*m,o},e.b2MulTMM=function(t,e,o){var i=t.ex.x,n=t.ex.y,s=t.ey.x,r=t.ey.y,a=e.ex.x,l=e.ex.y,p=e.ey.x,m=e.ey.y;return o.ex.x=i*a+n*l,o.ex.y=s*a+r*l,o.ey.x=i*p+n*m,o.ey.y=s*p+r*m,o},e.b2Mat33=function(){this.ex=new e.b2Vec3(1,0,0),this.ey=new e.b2Vec3(0,1,0),this.ez=new e.b2Vec3(0,0,1)},e.b2Mat33.prototype.ex=null,e.b2Mat33.prototype.ey=null,e.b2Mat33.prototype.ez=null,e.b2Mat33.IDENTITY=new e.b2Mat33,e.b2Mat33.prototype.Clone=function(){return(new e.b2Mat33).Copy(this)},e.b2Mat33.prototype.SetVVV=function(t,e,o){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(o),this},e.b2Mat33.prototype.Copy=function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this},e.b2Mat33.prototype.SetIdentity=function(){return this.ex.Set(1,0,0),this.ey.Set(0,1,0),this.ez.Set(0,0,1),this},e.b2Mat33.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this},e.b2Mat33.prototype.SelfAddM=function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this},e.b2Mat33.prototype.Solve33=function(t,e,o,i){var n=this.ex.x,s=this.ex.y,r=this.ex.z,a=this.ey.x,l=this.ey.y,p=this.ey.z,m=this.ez.x,_=this.ez.y,b=this.ez.z,h=n*(l*b-p*_)+s*(p*m-a*b)+r*(a*_-l*m);return 0!=h&&(h=1/h),i.x=h*(t*(l*b-p*_)+e*(p*m-a*b)+o*(a*_-l*m)),i.y=h*(n*(e*b-o*_)+s*(o*m-t*b)+r*(t*_-e*m)),i.z=h*(n*(l*o-p*e)+s*(p*t-a*o)+r*(a*e-l*t)),i},e.b2Mat33.prototype.Solve22=function(t,e,o){var i=this.ex.x,n=this.ey.x,s=this.ex.y,r=this.ey.y,a=i*r-n*s;return 0!=a&&(a=1/a),o.x=a*(r*t-n*e),o.y=a*(i*e-s*t),o},e.b2Mat33.prototype.GetInverse22=function(t){var e=this.ex.x,o=this.ey.x,i=this.ex.y,n=this.ey.y,s=e*n-o*i;0!=s&&(s=1/s),t.ex.x=s*n,t.ey.x=-s*o,t.ex.z=0,t.ex.y=-s*i,t.ey.y=s*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},e.b2Mat33.prototype.GetSymInverse33=function(t){var o=e.b2DotV3V3(this.ex,e.b2CrossV3V3(this.ey,this.ez,e.b2Vec3.s_t0));0!=o&&(o=1/o);var i=this.ex.x,n=this.ey.x,s=this.ez.x,r=this.ey.y,a=this.ez.y,l=this.ez.z;t.ex.x=o*(r*l-a*a),t.ex.y=o*(s*a-n*l),t.ex.z=o*(n*a-s*r),t.ey.x=t.ex.y,t.ey.y=o*(i*l-s*s),t.ey.z=o*(s*n-i*a),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=o*(i*r-n*n)},e.b2MulM33V3=function(t,e,o){var i=e.x,n=e.y,s=e.z;return o.x=t.ex.x*i+t.ey.x*n+t.ez.x*s,o.y=t.ex.y*i+t.ey.y*n+t.ez.y*s,o.z=t.ex.z*i+t.ey.z*n+t.ez.z*s,o},e.b2MulM33XYZ=function(t,e,o,i,n){return n.x=t.ex.x*e+t.ey.x*o+t.ez.x*i,n.y=t.ex.y*e+t.ey.y*o+t.ez.y*i,n.z=t.ex.z*e+t.ey.z*o+t.ez.z*i,n},e.b2MulM33V2=function(t,e,o){var i=e.x,n=e.y;return o.x=t.ex.x*i+t.ey.x*n,o.y=t.ex.y*i+t.ey.y*n,o},e.b2MulM33XY=function(t,e,o,i){return i.x=t.ex.x*e+t.ey.x*o,i.y=t.ex.y*e+t.ey.y*o,i},e.b2Rot=function(t){t&&(this.angle=t,this.s=Math.sin(t),this.c=Math.cos(t))},e.b2Rot.prototype.angle=0,e.b2Rot.prototype.s=0,e.b2Rot.prototype.c=1,e.b2Rot.IDENTITY=new e.b2Rot,e.b2Rot.prototype.Clone=function(){return(new e.b2Rot).Copy(this)},e.b2Rot.prototype.Copy=function(t){return this.angle=t.angle,this.s=t.s,this.c=t.c,this},e.b2Rot.prototype.SetAngle=function(t){return this.angle!=t&&(this.angle=t,this.s=Math.sin(t),this.c=Math.cos(t)),this},e.b2Rot.prototype.SetAngleRadians=e.b2Rot.prototype.SetAngle,e.b2Rot.prototype.SetAngleDegrees=function(t){return this.SetAngle(e.b2DegToRad(t))},e.b2Rot.prototype.SetIdentity=function(){return this.angle=0,this.s=0,this.c=1,this},e.b2Rot.prototype.GetAngle=function(){return this.angle},e.b2Rot.prototype.GetAngleRadians=e.b2Rot.prototype.GetAngle,e.b2Rot.prototype.GetAngleDegrees=function(){return e.b2RadToDeg(this.GetAngle())},e.b2Rot.prototype.GetXAxis=function(t){return t.x=this.c,t.y=this.s,t},e.b2Rot.prototype.GetYAxis=function(t){return t.x=-this.s,t.y=this.c,t},e.b2MulRR=function(t,o,i){var n=t.c,s=t.s,r=o.c,a=o.s;for(i.s=s*r+n*a,i.c=n*r-s*a,i.angle=t.angle+o.angle;i.angle<-e.b2_pi;)i.angle+=e.b2_two_pi;for(;i.angle>=e.b2_pi;)i.angle-=e.b2_two_pi;return i},e.b2MulTRR=function(t,o,i){var n=t.c,s=t.s,r=o.c,a=o.s;for(i.s=n*a-s*r,i.c=n*r+s*a,i.angle=t.angle-o.angle;i.angle<-e.b2_pi;)i.angle+=e.b2_two_pi;for(;i.angle>=e.b2_pi;)i.angle-=e.b2_two_pi;return i},e.b2MulRV=function(t,e,o){var i=t.c,n=t.s,s=e.x,r=e.y;return o.x=i*s-n*r,o.y=n*s+i*r,o},e.b2MulTRV=function(t,e,o){var i=t.c,n=t.s,s=e.x,r=e.y;return o.x=i*s+n*r,o.y=-n*s+i*r,o},e.b2Transform=function(){this.p=new e.b2Vec2,this.q=new e.b2Rot},e.b2Transform.prototype.p=null,e.b2Transform.prototype.q=null,e.b2Transform.IDENTITY=new e.b2Transform,e.b2Transform.prototype.Clone=function(){return(new e.b2Transform).Copy(this)},e.b2Transform.prototype.Copy=function(t){return this.p.Copy(t.p),this.q.Copy(t.q),this},e.b2Transform.prototype.SetIdentity=function(){return this.p.SetZero(),this.q.SetIdentity(),this},e.b2Transform.prototype.SetPositionRotation=function(t,e){return this.p.Copy(t),this.q.Copy(e),this},e.b2Transform.prototype.SetPositionAngleRadians=function(t,e){return this.p.Copy(t),this.q.SetAngleRadians(e),this},e.b2Transform.prototype.SetPosition=function(t){return this.p.Copy(t),this},e.b2Transform.prototype.SetPositionXY=function(t,e){return this.p.Set(t,e),this},e.b2Transform.prototype.SetRotation=function(t){return this.q.Copy(t),this},e.b2Transform.prototype.SetRotationAngleRadians=function(t){return this.q.SetAngleRadians(t),this},e.b2Transform.prototype.GetPosition=function(){return this.p},e.b2Transform.prototype.GetRotation=function(){return this.q},e.b2Transform.prototype.GetRotationAngle=function(){return this.q.GetAngle()},e.b2Transform.prototype.GetRotationAngleRadians=e.b2Transform.prototype.GetRotationAngle,e.b2Transform.prototype.GetAngle=function(){return this.q.GetAngle()},e.b2Transform.prototype.GetAngleRadians=e.b2Transform.prototype.GetAngle,e.b2MulXV=function(t,e,o){var i=t.q.c,n=t.q.s,s=e.x,r=e.y;return o.x=i*s-n*r+t.p.x,o.y=n*s+i*r+t.p.y,o},e.b2MulTXV=function(t,e,o){var i=t.q.c,n=t.q.s,s=e.x-t.p.x,r=e.y-t.p.y;return o.x=i*s+n*r,o.y=-n*s+i*r,o},e.b2MulXX=function(t,o,i){return e.b2MulRR(t.q,o.q,i.q),e.b2AddVV(e.b2MulRV(t.q,o.p,i.p),t.p,i.p),i},e.b2MulTXX=function(t,o,i){return e.b2MulTRR(t.q,o.q,i.q),e.b2MulTRV(t.q,e.b2SubVV(o.p,t.p,i.p),i.p),i},e.b2Sweep=function(){this.localCenter=new e.b2Vec2,this.c0=new e.b2Vec2,this.c=new e.b2Vec2},e.b2Sweep.prototype.localCenter=null,e.b2Sweep.prototype.c0=null,e.b2Sweep.prototype.c=null,e.b2Sweep.prototype.a0=0,e.b2Sweep.prototype.a=0,e.b2Sweep.prototype.alpha0=0,e.b2Sweep.prototype.Clone=function(){return(new e.b2Sweep).Copy(this)},e.b2Sweep.prototype.Copy=function(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this},e.b2Sweep.prototype.GetTransform=function(t,o){var i=1-o;t.p.x=i*this.c0.x+o*this.c.x,t.p.y=i*this.c0.y+o*this.c.y;var n=i*this.a0+o*this.a;return t.q.SetAngleRadians(n),t.p.SelfSub(e.b2MulRV(t.q,this.localCenter,e.b2Vec2.s_t0)),t},e.b2Sweep.prototype.Advance=function(t){e.ENABLE_ASSERTS&&e.b2Assert(this.alpha0<1);var o=(t-this.alpha0)/(1-this.alpha0);this.c0.x+=o*(this.c.x-this.c0.x),this.c0.y+=o*(this.c.y-this.c0.y),this.a0+=o*(this.a-this.a0),this.alpha0=t},e.b2Sweep.prototype.Normalize=function(){var t=e.b2_two_pi*Math.floor(this.a0/e.b2_two_pi);this.a0-=t,this.a-=t},e}(e,o),n=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2Joint&&(e.b2Joint={}),e.b2JointType={e_unknownJoint:0,e_revoluteJoint:1,e_prismaticJoint:2,e_distanceJoint:3,e_pulleyJoint:4,e_mouseJoint:5,e_gearJoint:6,e_wheelJoint:7,e_weldJoint:8,e_frictionJoint:9,e_ropeJoint:10,e_motorJoint:11,e_areaJoint:12},t.exportProperty(e.b2JointType,"e_unknownJoint",e.b2JointType.e_unknownJoint),t.exportProperty(e.b2JointType,"e_revoluteJoint",e.b2JointType.e_revoluteJoint),t.exportProperty(e.b2JointType,"e_prismaticJoint",e.b2JointType.e_prismaticJoint),t.exportProperty(e.b2JointType,"e_distanceJoint",e.b2JointType.e_distanceJoint),t.exportProperty(e.b2JointType,"e_pulleyJoint",e.b2JointType.e_pulleyJoint),t.exportProperty(e.b2JointType,"e_mouseJoint",e.b2JointType.e_mouseJoint),t.exportProperty(e.b2JointType,"e_gearJoint",e.b2JointType.e_gearJoint),t.exportProperty(e.b2JointType,"e_wheelJoint",e.b2JointType.e_wheelJoint),t.exportProperty(e.b2JointType,"e_weldJoint",e.b2JointType.e_weldJoint),t.exportProperty(e.b2JointType,"e_frictionJoint",e.b2JointType.e_frictionJoint),t.exportProperty(e.b2JointType,"e_ropeJoint",e.b2JointType.e_ropeJoint),t.exportProperty(e.b2JointType,"e_motorJoint",e.b2JointType.e_motorJoint),t.exportProperty(e.b2JointType,"e_areaJoint",e.b2JointType.e_areaJoint),e.b2LimitState={e_inactiveLimit:0,e_atLowerLimit:1,e_atUpperLimit:2,e_equalLimits:3},t.exportProperty(e.b2LimitState,"e_inactiveLimit",e.b2LimitState.e_inactiveLimit),t.exportProperty(e.b2LimitState,"e_atLowerLimit",e.b2LimitState.e_atLowerLimit),t.exportProperty(e.b2LimitState,"e_atUpperLimit",e.b2LimitState.e_atUpperLimit),t.exportProperty(e.b2LimitState,"e_equalLimits",e.b2LimitState.e_equalLimits),e.b2Jacobian=function(){this.linear=new e.b2Vec2},e.b2Jacobian.prototype.linear=null,e.b2Jacobian.prototype.angularA=0,e.b2Jacobian.prototype.angularB=0,e.b2Jacobian.prototype.SetZero=function(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this},e.b2Jacobian.prototype.Set=function(t,e,o){return this.linear.Copy(t),this.angularA=e,this.angularB=o,this},e.b2JointEdge=function(){},e.b2JointEdge.prototype.other=null,e.b2JointEdge.prototype.joint=null,e.b2JointEdge.prototype.prev=null,e.b2JointEdge.prototype.next=null,e.b2JointDef=function(t){this.type=t},e.b2JointDef.prototype.type=e.b2JointType.e_unknownJoint,e.b2JointDef.prototype.userData=null,e.b2JointDef.prototype.bodyA=null,e.b2JointDef.prototype.bodyB=null,e.b2JointDef.prototype.collideConnected=!1,e.b2Joint=function(t){e.ENABLE_ASSERTS&&e.b2Assert(t.bodyA!=t.bodyB),this.m_type=t.type,this.m_edgeA=new e.b2JointEdge,this.m_edgeB=new e.b2JointEdge,this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=t.collideConnected,this.m_userData=t.userData},e.b2Joint.prototype.m_type=e.b2JointType.e_unknownJoint,e.b2Joint.prototype.m_prev=null,e.b2Joint.prototype.m_next=null,e.b2Joint.prototype.m_edgeA=null,e.b2Joint.prototype.m_edgeB=null,e.b2Joint.prototype.m_bodyA=null,e.b2Joint.prototype.m_bodyB=null,e.b2Joint.prototype.m_index=0,e.b2Joint.prototype.m_islandFlag=!1,e.b2Joint.prototype.m_collideConnected=!1,e.b2Joint.prototype.m_userData=null,e.b2Joint.prototype.GetAnchorA=function(t){return t.SetZero()},e.b2Joint.prototype.GetAnchorB=function(t){return t.SetZero()},e.b2Joint.prototype.GetReactionForce=function(t,e){return e.SetZero()},e.b2Joint.prototype.GetReactionTorque=function(){return 0},e.b2Joint.prototype.InitVelocityConstraints=function(){},e.b2Joint.prototype.SolveVelocityConstraints=function(){},e.b2Joint.prototype.SolvePositionConstraints=function(){return!1},e.b2Joint.prototype.GetType=function(){return this.m_type},e.b2Joint.prototype.GetBodyA=function(){return this.m_bodyA},e.b2Joint.prototype.GetBodyB=function(){return this.m_bodyB},e.b2Joint.prototype.GetNext=function(){return this.m_next},e.b2Joint.prototype.GetUserData=function(){return this.m_userData},e.b2Joint.prototype.SetUserData=function(t){this.m_userData=t},e.b2Joint.prototype.GetCollideConnected=function(){return this.m_collideConnected},e.b2Joint.prototype.Dump=function(){e.DEBUG&&e.b2Log("// Dump is not supported for this joint type.\\n")},e.b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},e.b2Joint.prototype.ShiftOrigin=function(){},e}(e,i,o),s=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2AreaJoint&&(e.b2AreaJoint={}),e.b2AreaJointDef=function(){t.base(this,e.b2JointType.e_areaJoint),this.bodies=new Array\n},t.inherits(e.b2AreaJointDef,e.b2JointDef),e.b2AreaJointDef.prototype.world=null,e.b2AreaJointDef.prototype.bodies=null,e.b2AreaJointDef.prototype.frequencyHz=0,e.b2AreaJointDef.prototype.dampingRatio=0,e.b2AreaJointDef.prototype.AddBody=function(t){this.bodies.push(t),1==this.bodies.length?this.bodyA=t:2==this.bodies.length&&(this.bodyB=t)},e.b2AreaJoint=function(o){t.base(this,o),e.ENABLE_ASSERTS&&e.b2Assert(o.bodies.length>=3,"You cannot create an area joint with less than three bodies."),this.m_bodies=o.bodies,this.m_frequencyHz=o.frequencyHz,this.m_dampingRatio=o.dampingRatio,this.m_targetLengths=e.b2MakeNumberArray(o.bodies.length),this.m_normals=e.b2Vec2.MakeArray(o.bodies.length),this.m_joints=new Array(o.bodies.length),this.m_deltas=e.b2Vec2.MakeArray(o.bodies.length),this.m_delta=new e.b2Vec2;var i=new e.b2DistanceJointDef;i.frequencyHz=o.frequencyHz,i.dampingRatio=o.dampingRatio,this.m_targetArea=0;for(var n=0,s=this.m_bodies.length;s>n;++n){var r=this.m_bodies[n],a=this.m_bodies[(n+1)%s],l=r.GetWorldCenter(),p=a.GetWorldCenter();this.m_targetLengths[n]=e.b2DistanceVV(l,p),this.m_targetArea+=e.b2CrossVV(l,p),i.Initialize(r,a,l,p),this.m_joints[n]=o.world.CreateJoint(i)}this.m_targetArea*=.5},t.inherits(e.b2AreaJoint,e.b2Joint),e.b2AreaJoint.prototype.m_bodies=null,e.b2AreaJoint.prototype.m_frequencyHz=0,e.b2AreaJoint.prototype.m_dampingRatio=0,e.b2AreaJoint.prototype.m_impulse=0,e.b2AreaJoint.prototype.m_targetLengths=null,e.b2AreaJoint.prototype.m_targetArea=0,e.b2AreaJoint.prototype.m_normals=null,e.b2AreaJoint.prototype.m_joints=null,e.b2AreaJoint.prototype.m_deltas=null,e.b2AreaJoint.prototype.m_delta=null,e.b2AreaJoint.prototype.GetAnchorA=function(t){return t.SetZero()},e.b2AreaJoint.prototype.GetAnchorB=function(t){return t.SetZero()},e.b2AreaJoint.prototype.GetReactionForce=function(t,e){return e.SetZero()},e.b2AreaJoint.prototype.GetReactionTorque=function(){return 0},e.b2AreaJoint.prototype.SetFrequency=function(t){this.m_frequencyHz=t;for(var e=0,o=this.m_joints.length;o>e;++e)this.m_joints[e].SetFrequency(t)},e.b2AreaJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},e.b2AreaJoint.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t;for(var e=0,o=this.m_joints.length;o>e;++e)this.m_joints[e].SetDampingRatio(t)},e.b2AreaJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},e.b2AreaJoint.prototype.Dump=function(){e.DEBUG&&e.b2Log("Area joint dumping is not supported.\\n")},e.b2AreaJoint.prototype.InitVelocityConstraints=function(t){for(var o=0,i=this.m_bodies.length;i>o;++o){var n=this.m_bodies[(o+i-1)%i],s=this.m_bodies[(o+1)%i],r=t.positions[n.m_islandIndex].c,a=t.positions[s.m_islandIndex].c,l=this.m_deltas[o];e.b2SubVV(a,r,l)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(var o=0,i=this.m_bodies.length;i>o;++o){var p=this.m_bodies[o],m=t.velocities[p.m_islandIndex].v,l=this.m_deltas[o];m.x+=p.m_invMass*l.y*.5*this.m_impulse,m.y+=p.m_invMass*-l.x*.5*this.m_impulse}}else this.m_impulse=0},e.b2AreaJoint.prototype.SolveVelocityConstraints=function(t){for(var o=0,i=0,n=0,s=this.m_bodies.length;s>n;++n){var r=this.m_bodies[n],a=t.velocities[r.m_islandIndex].v,l=this.m_deltas[n];o+=l.GetLengthSquared()/r.GetMass(),i+=e.b2CrossVV(a,l)}var p=-2*i/o;this.m_impulse+=p;for(var n=0,s=this.m_bodies.length;s>n;++n){var r=this.m_bodies[n],a=t.velocities[r.m_islandIndex].v,l=this.m_deltas[n];a.x+=r.m_invMass*l.y*.5*p,a.y+=r.m_invMass*-l.x*.5*p}},e.b2AreaJoint.prototype.SolvePositionConstraints=function(t){for(var o=0,i=0,n=0,s=this.m_bodies.length;s>n;++n){var r=this.m_bodies[n],a=this.m_bodies[(n+1)%s],l=t.positions[r.m_islandIndex].c,p=t.positions[a.m_islandIndex].c,m=e.b2SubVV(p,l,this.m_delta),_=m.GetLength();_<e.b2_epsilon&&(_=1),this.m_normals[n].x=m.y/_,this.m_normals[n].y=-m.x/_,o+=_,i+=e.b2CrossVV(l,p)}i*=.5;for(var b=this.m_targetArea-i,h=.5*b/o,c=!0,n=0,s=this.m_bodies.length;s>n;++n){var r=this.m_bodies[n],l=t.positions[r.m_islandIndex].c,u=(n+1)%s,m=e.b2AddVV(this.m_normals[n],this.m_normals[u],this.m_delta);m.SelfMul(h);var y=m.GetLengthSquared();y>e.b2Sq(e.b2_maxLinearCorrection)&&m.SelfMul(e.b2_maxLinearCorrection/e.b2Sqrt(y)),y>e.b2Sq(e.b2_linearSlop)&&(c=!1),l.x+=m.x,l.y+=m.y}return c},e}(e,n,i,o),r=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2Distance&&(e.b2Distance={}),e.b2DistanceProxy=function(){this.m_buffer=e.b2Vec2.MakeArray(2)},e.b2DistanceProxy.prototype.m_buffer=null,e.b2DistanceProxy.prototype.m_vertices=null,e.b2DistanceProxy.prototype.m_count=0,e.b2DistanceProxy.prototype.m_radius=0,e.b2DistanceProxy.prototype.Reset=function(){return this.m_vertices=null,this.m_count=0,this.m_radius=0,this},e.b2DistanceProxy.prototype.SetShape=function(t,e){t.SetupDistanceProxy(this,e)},e.b2DistanceProxy.prototype.GetSupport=function(t){for(var o=0,i=e.b2DotVV(this.m_vertices[0],t),n=1;n<this.m_count;++n){var s=e.b2DotVV(this.m_vertices[n],t);s>i&&(o=n,i=s)}return o},e.b2DistanceProxy.prototype.GetSupportVertex=function(t,o){for(var i=0,n=e.b2DotVV(this.m_vertices[0],t),s=1;s<this.m_count;++s){var r=e.b2DotVV(this.m_vertices[s],t);r>n&&(i=s,n=r)}return o.Copy(this.m_vertices[i])},e.b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count},e.b2DistanceProxy.prototype.GetVertex=function(t){return e.ENABLE_ASSERTS&&e.b2Assert(t>=0&&t<this.m_count),this.m_vertices[t]},e.b2SimplexCache=function(){this.indexA=e.b2MakeNumberArray(3),this.indexB=e.b2MakeNumberArray(3)},e.b2SimplexCache.prototype.metric=0,e.b2SimplexCache.prototype.count=0,e.b2SimplexCache.prototype.indexA=null,e.b2SimplexCache.prototype.indexB=null,e.b2SimplexCache.prototype.Reset=function(){return this.metric=0,this.count=0,this},e.b2DistanceInput=function(){this.proxyA=new e.b2DistanceProxy,this.proxyB=new e.b2DistanceProxy,this.transformA=new e.b2Transform,this.transformB=new e.b2Transform},e.b2DistanceInput.prototype.proxyA=null,e.b2DistanceInput.prototype.proxyB=null,e.b2DistanceInput.prototype.transformA=null,e.b2DistanceInput.prototype.transformB=null,e.b2DistanceInput.prototype.useRadii=!1,e.b2DistanceInput.prototype.Reset=function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this},e.b2DistanceOutput=function(){this.pointA=new e.b2Vec2,this.pointB=new e.b2Vec2},e.b2DistanceOutput.prototype.pointA=null,e.b2DistanceOutput.prototype.pointB=null,e.b2DistanceOutput.prototype.distance=0,e.b2DistanceOutput.prototype.iterations=0,e.b2DistanceOutput.prototype.Reset=function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this},e.b2_gjkCalls=0,e.b2_gjkIters=0,e.b2_gjkMaxIters=0,e.b2SimplexVertex=function(){this.wA=new e.b2Vec2,this.wB=new e.b2Vec2,this.w=new e.b2Vec2},e.b2SimplexVertex.prototype.wA=null,e.b2SimplexVertex.prototype.wB=null,e.b2SimplexVertex.prototype.w=null,e.b2SimplexVertex.prototype.a=0,e.b2SimplexVertex.prototype.indexA=0,e.b2SimplexVertex.prototype.indexB=0,e.b2SimplexVertex.prototype.Copy=function(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this},e.b2Simplex=function(){this.m_v1=new e.b2SimplexVertex,this.m_v2=new e.b2SimplexVertex,this.m_v3=new e.b2SimplexVertex,this.m_vertices=new Array(3),this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},e.b2Simplex.prototype.m_v1=null,e.b2Simplex.prototype.m_v2=null,e.b2Simplex.prototype.m_v3=null,e.b2Simplex.prototype.m_vertices=null,e.b2Simplex.prototype.m_count=0,e.b2Simplex.prototype.ReadCache=function(t,o,i,n,s){e.ENABLE_ASSERTS&&e.b2Assert(0<=t.count&&t.count<=3),this.m_count=t.count;for(var r=this.m_vertices,a=0;a<this.m_count;++a){var l=r[a];l.indexA=t.indexA[a],l.indexB=t.indexB[a];var p=o.GetVertex(l.indexA),m=n.GetVertex(l.indexB);e.b2MulXV(i,p,l.wA),e.b2MulXV(s,m,l.wB),e.b2SubVV(l.wB,l.wA,l.w),l.a=0}if(this.m_count>1){var _=t.metric,b=this.GetMetric();(.5*_>b||b>2*_||b<e.b2_epsilon)&&(this.m_count=0)}if(0==this.m_count){var l=r[0];l.indexA=0,l.indexB=0;var p=o.GetVertex(0),m=n.GetVertex(0);e.b2MulXV(i,p,l.wA),e.b2MulXV(s,m,l.wB),e.b2SubVV(l.wB,l.wA,l.w),l.a=1,this.m_count=1}},e.b2Simplex.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,o=0;o<this.m_count;++o)t.indexA[o]=e[o].indexA,t.indexB[o]=e[o].indexB},e.b2Simplex.prototype.GetSearchDirection=function(t){switch(this.m_count){case 1:return e.b2NegV(this.m_v1.w,t);case 2:var o=e.b2SubVV(this.m_v2.w,this.m_v1.w,t),i=e.b2CrossVV(o,e.b2NegV(this.m_v1.w,e.b2Vec2.s_t0));return i>0?e.b2CrossOneV(o,t):e.b2CrossVOne(o,t);default:return e.ENABLE_ASSERTS&&e.b2Assert(!1),t.SetZero()}},e.b2Simplex.prototype.GetClosestPoint=function(t){switch(this.m_count){case 0:return e.ENABLE_ASSERTS&&e.b2Assert(!1),t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:return t.SetZero();default:return e.ENABLE_ASSERTS&&e.b2Assert(!1),t.SetZero()}},e.b2Simplex.prototype.GetWitnessPoints=function(t,o){switch(this.m_count){case 0:e.ENABLE_ASSERTS&&e.b2Assert(!1);break;case 1:t.Copy(this.m_v1.wA),o.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,o.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,o.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:o.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,o.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:e.ENABLE_ASSERTS&&e.b2Assert(!1)}},e.b2Simplex.prototype.GetMetric=function(){switch(this.m_count){case 0:return e.ENABLE_ASSERTS&&e.b2Assert(!1),0;case 1:return 0;case 2:return e.b2DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return e.b2CrossVV(e.b2SubVV(this.m_v2.w,this.m_v1.w,e.b2Vec2.s_t0),e.b2SubVV(this.m_v3.w,this.m_v1.w,e.b2Vec2.s_t1));default:return e.ENABLE_ASSERTS&&e.b2Assert(!1),0}},e.b2Simplex.prototype.Solve2=function(){var t=this.m_v1.w,o=this.m_v2.w,i=e.b2SubVV(o,t,e.b2Simplex.s_e12),n=-e.b2DotVV(t,i);if(0>=n)return this.m_v1.a=1,this.m_count=1,void 0;var s=e.b2DotVV(o,i);if(0>=s)return this.m_v2.a=1,this.m_count=1,this.m_v1.Copy(this.m_v2),void 0;var r=1/(s+n);this.m_v1.a=s*r,this.m_v2.a=n*r,this.m_count=2},e.b2Simplex.prototype.Solve3=function(){var t=this.m_v1.w,o=this.m_v2.w,i=this.m_v3.w,n=e.b2SubVV(o,t,e.b2Simplex.s_e12),s=e.b2DotVV(t,n),r=e.b2DotVV(o,n),a=r,l=-s,p=e.b2SubVV(i,t,e.b2Simplex.s_e13),m=e.b2DotVV(t,p),_=e.b2DotVV(i,p),b=_,h=-m,c=e.b2SubVV(i,o,e.b2Simplex.s_e23),u=e.b2DotVV(o,c),y=e.b2DotVV(i,c),d=y,f=-u,A=e.b2CrossVV(n,p),S=A*e.b2CrossVV(o,i),C=A*e.b2CrossVV(i,t),v=A*e.b2CrossVV(t,o);if(0>=l&&0>=h)return this.m_v1.a=1,this.m_count=1,void 0;if(a>0&&l>0&&0>=v){var x=1/(a+l);return this.m_v1.a=a*x,this.m_v2.a=l*x,this.m_count=2,void 0}if(b>0&&h>0&&0>=C){var V=1/(b+h);return this.m_v1.a=b*V,this.m_v3.a=h*V,this.m_count=2,this.m_v2.Copy(this.m_v3),void 0}if(0>=a&&0>=f)return this.m_v2.a=1,this.m_count=1,this.m_v1.Copy(this.m_v2),void 0;if(0>=b&&0>=d)return this.m_v3.a=1,this.m_count=1,this.m_v1.Copy(this.m_v3),void 0;if(d>0&&f>0&&0>=S){var g=1/(d+f);return this.m_v2.a=d*g,this.m_v3.a=f*g,this.m_count=2,this.m_v1.Copy(this.m_v3),void 0}var B=1/(S+C+v);this.m_v1.a=S*B,this.m_v2.a=C*B,this.m_v3.a=v*B,this.m_count=3},e.b2Simplex.s_e12=new e.b2Vec2,e.b2Simplex.s_e13=new e.b2Vec2,e.b2Simplex.s_e23=new e.b2Vec2,e.b2Distance=function(t,o,i){++e.b2_gjkCalls;var n=i.proxyA,s=i.proxyB,r=i.transformA,a=i.transformB,l=e.b2Distance.s_simplex;l.ReadCache(o,n,r,s,a);for(var p=l.m_vertices,m=20,_=e.b2Distance.s_saveA,b=e.b2Distance.s_saveB,h=0,c=e.b2_maxFloat,u=c,y=0;m>y;){h=l.m_count;for(var d=0;h>d;++d)_[d]=p[d].indexA,b[d]=p[d].indexB;switch(l.m_count){case 1:break;case 2:l.Solve2();break;case 3:l.Solve3();break;default:e.ENABLE_ASSERTS&&e.b2Assert(!1)}if(3==l.m_count)break;var f=l.GetClosestPoint(e.b2Distance.s_p);u=f.GetLengthSquared(),c=u;var A=l.GetSearchDirection(e.b2Distance.s_d);if(A.GetLengthSquared()<e.b2_epsilon_sq)break;var S=p[l.m_count];S.indexA=n.GetSupport(e.b2MulTRV(r.q,e.b2NegV(A,e.b2Vec2.s_t0),e.b2Distance.s_supportA)),e.b2MulXV(r,n.GetVertex(S.indexA),S.wA),S.indexB=s.GetSupport(e.b2MulTRV(a.q,A,e.b2Distance.s_supportB)),e.b2MulXV(a,s.GetVertex(S.indexB),S.wB),e.b2SubVV(S.wB,S.wA,S.w),++y,++e.b2_gjkIters;for(var C=!1,d=0;h>d;++d)if(S.indexA==_[d]&&S.indexB==b[d]){C=!0;break}if(C)break;++l.m_count}if(e.b2_gjkMaxIters=e.b2Max(e.b2_gjkMaxIters,y),l.GetWitnessPoints(t.pointA,t.pointB),t.distance=e.b2DistanceVV(t.pointA,t.pointB),t.iterations=y,l.WriteCache(o),i.useRadii){var v=n.m_radius,x=s.m_radius;if(t.distance>v+x&&t.distance>e.b2_epsilon){t.distance-=v+x;var V=e.b2SubVV(t.pointB,t.pointA,e.b2Distance.s_normal);V.Normalize(),t.pointA.SelfMulAdd(v,V),t.pointB.SelfMulSub(x,V)}else{var f=e.b2MidVV(t.pointA,t.pointB,e.b2Distance.s_p);t.pointA.Copy(f),t.pointB.Copy(f),t.distance=0}}},e.b2Distance.s_simplex=new e.b2Simplex,e.b2Distance.s_saveA=e.b2MakeNumberArray(3),e.b2Distance.s_saveB=e.b2MakeNumberArray(3),e.b2Distance.s_p=new e.b2Vec2,e.b2Distance.s_d=new e.b2Vec2,e.b2Distance.s_normal=new e.b2Vec2,e.b2Distance.s_supportA=new e.b2Vec2,e.b2Distance.s_supportB=new e.b2Vec2,e}(e,i,o),a=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2Collision&&(e.b2Collision={}),e.b2ContactFeatureType={e_vertex:0,e_face:1},t.exportProperty(e.b2ContactFeatureType,"e_vertex",e.b2ContactFeatureType.e_vertex),t.exportProperty(e.b2ContactFeatureType,"e_face",e.b2ContactFeatureType.e_face),e.b2ContactFeature=function(t){this._id=t},e.b2ContactFeature.prototype._id=null,e.b2ContactFeature.prototype._indexA=0,e.b2ContactFeature.prototype._indexB=0,e.b2ContactFeature.prototype._typeA=0,e.b2ContactFeature.prototype._typeB=0,Object.defineProperty(e.b2ContactFeature.prototype,"indexA",{enumerable:!1,configurable:!0,get:function(){return this._indexA},set:function(t){this._indexA=t,this._id._key=4294967040&this._id._key|255&this._indexA}}),Object.defineProperty(e.b2ContactFeature.prototype,"indexB",{enumerable:!1,configurable:!0,get:function(){return this._indexB},set:function(t){this._indexB=t,this._id._key=4294902015&this._id._key|this._indexB<<8&65280}}),Object.defineProperty(e.b2ContactFeature.prototype,"typeA",{enumerable:!1,configurable:!0,get:function(){return this._typeA},set:function(t){this._typeA=t,this._id._key=4278255615&this._id._key|this._typeA<<16&16711680}}),Object.defineProperty(e.b2ContactFeature.prototype,"typeB",{enumerable:!1,configurable:!0,get:function(){return this._typeB},set:function(t){this._typeB=t,this._id._key=16777215&this._id._key|this._typeB<<24&4278190080}}),e.b2ContactID=function(){this.cf=new e.b2ContactFeature(this)},e.b2ContactID.prototype.cf=null,e.b2ContactID.prototype.key=0,e.b2ContactID.prototype.Copy=function(t){return this.key=t.key,this},e.b2ContactID.prototype.Clone=function(){return(new e.b2ContactID).Copy(this)},Object.defineProperty(e.b2ContactID.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key},set:function(t){this._key=t,this.cf._indexA=255&this._key,this.cf._indexB=this._key>>8&255,this.cf._typeA=this._key>>16&255,this.cf._typeB=this._key>>24&255}}),e.b2ManifoldPoint=function(){this.localPoint=new e.b2Vec2,this.id=new e.b2ContactID},e.b2ManifoldPoint.prototype.localPoint=null,e.b2ManifoldPoint.prototype.normalImpulse=0,e.b2ManifoldPoint.prototype.tangentImpulse=0,e.b2ManifoldPoint.prototype.id=null,e.b2ManifoldPoint.MakeArray=function(t){return e.b2MakeArray(t,function(){return new e.b2ManifoldPoint})},e.b2ManifoldPoint.prototype.Reset=function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0},e.b2ManifoldPoint.prototype.Copy=function(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this},e.b2ManifoldType={e_unknown:-1,e_circles:0,e_faceA:1,e_faceB:2},t.exportProperty(e.b2ManifoldType,"e_unknown",e.b2ManifoldType.e_unknown),t.exportProperty(e.b2ManifoldType,"e_circles",e.b2ManifoldType.e_circles),t.exportProperty(e.b2ManifoldType,"e_faceA",e.b2ManifoldType.e_faceA),t.exportProperty(e.b2ManifoldType,"e_faceB",e.b2ManifoldType.e_faceB),e.b2Manifold=function(){this.points=e.b2ManifoldPoint.MakeArray(e.b2_maxManifoldPoints),this.localNormal=new e.b2Vec2,this.localPoint=new e.b2Vec2,this.type=e.b2ManifoldType.e_unknown,this.pointCount=0},e.b2Manifold.prototype.points=null,e.b2Manifold.prototype.localNormal=null,e.b2Manifold.prototype.localPoint=null,e.b2Manifold.prototype.type=e.b2ManifoldType.e_unknown,e.b2Manifold.prototype.pointCount=0,e.b2Manifold.prototype.Reset=function(){for(var t=0,o=e.b2_maxManifoldPoints;o>t;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=e.b2ManifoldType.e_unknown,this.pointCount=0},e.b2Manifold.prototype.Copy=function(t){this.pointCount=t.pointCount;for(var o=0,i=e.b2_maxManifoldPoints;i>o;++o)this.points[o].Copy(t.points[o]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this},e.b2Manifold.prototype.Clone=function(){return(new e.b2Manifold).Copy(this)},e.b2WorldManifold=function(){this.normal=new e.b2Vec2,this.points=e.b2Vec2.MakeArray(e.b2_maxManifoldPoints),this.separations=e.b2MakeNumberArray(e.b2_maxManifoldPoints)},e.b2WorldManifold.prototype.normal=null,e.b2WorldManifold.prototype.points=null,e.b2WorldManifold.prototype.separations=null,e.b2WorldManifold.prototype.Initialize=function(t,o,i,n,s){if(0!=t.pointCount)switch(t.type){case e.b2ManifoldType.e_circles:this.normal.Set(1,0);var r=e.b2MulXV(o,t.localPoint,e.b2WorldManifold.prototype.Initialize.s_pointA),a=e.b2MulXV(n,t.points[0].localPoint,e.b2WorldManifold.prototype.Initialize.s_pointB);e.b2DistanceSquaredVV(r,a)>e.b2_epsilon_sq&&e.b2SubVV(a,r,this.normal).SelfNormalize();var l=e.b2AddVMulSV(r,i,this.normal,e.b2WorldManifold.prototype.Initialize.s_cA),p=e.b2SubVMulSV(a,s,this.normal,e.b2WorldManifold.prototype.Initialize.s_cB);e.b2MidVV(l,p,this.points[0]),this.separations[0]=e.b2DotVV(e.b2SubVV(p,l,e.b2Vec2.s_t0),this.normal);break;case e.b2ManifoldType.e_faceA:e.b2MulRV(o.q,t.localNormal,this.normal);for(var m=e.b2MulXV(o,t.localPoint,e.b2WorldManifold.prototype.Initialize.s_planePoint),_=0,b=t.pointCount;b>_;++_){var h=e.b2MulXV(n,t.points[_].localPoint,e.b2WorldManifold.prototype.Initialize.s_clipPoint),c=i-e.b2DotVV(e.b2SubVV(h,m,e.b2Vec2.s_t0),this.normal),l=e.b2AddVMulSV(h,c,this.normal,e.b2WorldManifold.prototype.Initialize.s_cA),p=e.b2SubVMulSV(h,s,this.normal,e.b2WorldManifold.prototype.Initialize.s_cB);e.b2MidVV(l,p,this.points[_]),this.separations[_]=e.b2DotVV(e.b2SubVV(p,l,e.b2Vec2.s_t0),this.normal)}break;case e.b2ManifoldType.e_faceB:e.b2MulRV(n.q,t.localNormal,this.normal);for(var m=e.b2MulXV(n,t.localPoint,e.b2WorldManifold.prototype.Initialize.s_planePoint),_=0,b=t.pointCount;b>_;++_){var h=e.b2MulXV(o,t.points[_].localPoint,e.b2WorldManifold.prototype.Initialize.s_clipPoint),c=s-e.b2DotVV(e.b2SubVV(h,m,e.b2Vec2.s_t0),this.normal),p=e.b2AddVMulSV(h,c,this.normal,e.b2WorldManifold.prototype.Initialize.s_cB),l=e.b2SubVMulSV(h,i,this.normal,e.b2WorldManifold.prototype.Initialize.s_cA);e.b2MidVV(l,p,this.points[_]),this.separations[_]=e.b2DotVV(e.b2SubVV(l,p,e.b2Vec2.s_t0),this.normal)}this.normal.SelfNeg()}},e.b2WorldManifold.prototype.Initialize.s_pointA=new e.b2Vec2,e.b2WorldManifold.prototype.Initialize.s_pointB=new e.b2Vec2,e.b2WorldManifold.prototype.Initialize.s_cA=new e.b2Vec2,e.b2WorldManifold.prototype.Initialize.s_cB=new e.b2Vec2,e.b2WorldManifold.prototype.Initialize.s_planePoint=new e.b2Vec2,e.b2WorldManifold.prototype.Initialize.s_clipPoint=new e.b2Vec2,e.b2PointState={b2_nullState:0,b2_addState:1,b2_persistState:2,b2_removeState:3},t.exportProperty(e.b2PointState,"b2_nullState   ",e.b2PointState.b2_nullState),t.exportProperty(e.b2PointState,"b2_addState    ",e.b2PointState.b2_addState),t.exportProperty(e.b2PointState,"b2_persistState",e.b2PointState.b2_persistState),t.exportProperty(e.b2PointState,"b2_removeState ",e.b2PointState.b2_removeState),e.b2GetPointStates=function(t,o,i,n){for(var s=0,r=i.pointCount;r>s;++s){var a=i.points[s].id,l=a.key;t[s]=e.b2PointState.b2_removeState;for(var p=0,m=n.pointCount;m>p;++p)if(n.points[p].id.key==l){t[s]=e.b2PointState.b2_persistState;break}}for(var r=e.b2_maxManifoldPoints;r>s;++s)t[s]=e.b2PointState.b2_nullState;for(var s=0,r=n.pointCount;r>s;++s){var a=n.points[s].id,l=a.key;o[s]=e.b2PointState.b2_addState;for(var p=0,m=i.pointCount;m>p;++p)if(i.points[p].id.key==l){o[s]=e.b2PointState.b2_persistState;break}}for(var r=e.b2_maxManifoldPoints;r>s;++s)o[s]=e.b2PointState.b2_nullState},e.b2ClipVertex=function(){this.v=new e.b2Vec2,this.id=new e.b2ContactID},e.b2ClipVertex.prototype.v=null,e.b2ClipVertex.prototype.id=null,e.b2ClipVertex.MakeArray=function(t){return e.b2MakeArray(t,function(){return new e.b2ClipVertex})},e.b2ClipVertex.prototype.Copy=function(t){return this.v.Copy(t.v),this.id.Copy(t.id),this},e.b2RayCastInput=function(){this.p1=new e.b2Vec2,this.p2=new e.b2Vec2,this.maxFraction=1},e.b2RayCastInput.prototype.p1=null,e.b2RayCastInput.prototype.p2=null,e.b2RayCastInput.prototype.maxFraction=1,e.b2RayCastInput.prototype.Copy=function(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this},e.b2RayCastOutput=function(){this.normal=new e.b2Vec2,this.fraction=0},e.b2RayCastOutput.prototype.normal=null,e.b2RayCastOutput.prototype.fraction=0,e.b2RayCastOutput.prototype.Copy=function(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this},e.b2AABB=function(){this.lowerBound=new e.b2Vec2,this.upperBound=new e.b2Vec2,this.m_out_center=new e.b2Vec2,this.m_out_extent=new e.b2Vec2},e.b2AABB.prototype.lowerBound=null,e.b2AABB.prototype.upperBound=null,e.b2AABB.prototype.m_out_center=null,e.b2AABB.prototype.m_out_extent=null,e.b2AABB.prototype.Copy=function(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this},e.b2AABB.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y,o=t>=0&&e>=0;return o=o&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},e.b2AABB.prototype.GetCenter=function(){return e.b2MidVV(this.lowerBound,this.upperBound,this.m_out_center)},e.b2AABB.prototype.GetExtents=function(){return e.b2ExtVV(this.lowerBound,this.upperBound,this.m_out_extent)},e.b2AABB.prototype.GetPerimeter=function(){var t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y;return 2*(t+e)},e.b2AABB.prototype.Combine1=function(t){return this.lowerBound.x=e.b2Min(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=e.b2Min(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=e.b2Max(this.upperBound.x,t.upperBound.x),this.upperBound.y=e.b2Max(this.upperBound.y,t.upperBound.y),this},e.b2AABB.prototype.Combine2=function(t,o){return this.lowerBound.x=e.b2Min(t.lowerBound.x,o.lowerBound.x),this.lowerBound.y=e.b2Min(t.lowerBound.y,o.lowerBound.y),this.upperBound.x=e.b2Max(t.upperBound.x,o.upperBound.x),this.upperBound.y=e.b2Max(t.upperBound.y,o.upperBound.y),this},e.b2AABB.Combine=function(t,e,o){return o.Combine2(t,e),o},e.b2AABB.prototype.Contains=function(t){var e=!0;return e=e&&this.lowerBound.x<=t.lowerBound.x,e=e&&this.lowerBound.y<=t.lowerBound.y,e=e&&t.upperBound.x<=this.upperBound.x,e=e&&t.upperBound.y<=this.upperBound.y},e.b2AABB.prototype.RayCast=function(t,o){var i=-e.b2_maxFloat,n=e.b2_maxFloat,s=o.p1.x,r=o.p1.y,a=o.p2.x-o.p1.x,l=o.p2.y-o.p1.y,p=e.b2Abs(a),m=e.b2Abs(l),_=t.normal;if(p<e.b2_epsilon){if(s<this.lowerBound.x||this.upperBound.x<s)return!1}else{var b=1/a,h=(this.lowerBound.x-s)*b,c=(this.upperBound.x-s)*b,u=-1;if(h>c){var y=h;h=c,c=y,u=1}if(h>i&&(_.x=u,_.y=0,i=h),n=e.b2Min(n,c),i>n)return!1}if(m<e.b2_epsilon){if(r<this.lowerBound.y||this.upperBound.y<r)return!1}else{var b=1/l,h=(this.lowerBound.y-r)*b,c=(this.upperBound.y-r)*b,u=-1;if(h>c){var y=h;h=c,c=y,u=1}if(h>i&&(_.x=0,_.y=u,i=h),n=e.b2Min(n,c),i>n)return!1}return 0>i||o.maxFraction<i?!1:(t.fraction=i,!0)},e.b2AABB.prototype.TestOverlap=function(t){var e=t.lowerBound.x-this.upperBound.x,o=t.lowerBound.y-this.upperBound.y,i=this.lowerBound.x-t.upperBound.x,n=this.lowerBound.y-t.upperBound.y;return e>0||o>0?!1:i>0||n>0?!1:!0},e.b2TestOverlapAABB=function(t,e){var o=e.lowerBound.x-t.upperBound.x,i=e.lowerBound.y-t.upperBound.y,n=t.lowerBound.x-e.upperBound.x,s=t.lowerBound.y-e.upperBound.y;return o>0||i>0?!1:n>0||s>0?!1:!0},e.b2ClipSegmentToLine=function(t,o,i,n,s){var r=0,a=o[0],l=o[1],p=e.b2DotVV(i,a.v)-n,m=e.b2DotVV(i,l.v)-n;if(0>=p&&t[r++].Copy(a),0>=m&&t[r++].Copy(l),0>p*m){var _=p/(p-m),b=t[r].v;b.x=a.v.x+_*(l.v.x-a.v.x),b.y=a.v.y+_*(l.v.y-a.v.y);var h=t[r].id;h.cf.indexA=s,h.cf.indexB=a.id.cf.indexB,h.cf.typeA=e.b2ContactFeatureType.e_vertex,h.cf.typeB=e.b2ContactFeatureType.e_face,++r}return r},e.b2TestOverlapShape=function(t,o,i,n,s,r){var a=e.b2TestOverlapShape.s_input.Reset();a.proxyA.SetShape(t,o),a.proxyB.SetShape(i,n),a.transformA.Copy(s),a.transformB.Copy(r),a.useRadii=!0;var l=e.b2TestOverlapShape.s_simplexCache.Reset();l.count=0;var p=e.b2TestOverlapShape.s_output.Reset();return e.b2Distance(p,l,a),p.distance<10*e.b2_epsilon},e.b2TestOverlapShape.s_input=new e.b2DistanceInput,e.b2TestOverlapShape.s_simplexCache=new e.b2SimplexCache,e.b2TestOverlapShape.s_output=new e.b2DistanceOutput,e}(e,r,i,o),l=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2Shape&&(e.b2Shape={}),e.b2MassData=function(){this.center=new e.b2Vec2(0,0)},e.b2MassData.prototype.mass=0,e.b2MassData.prototype.center=null,e.b2MassData.prototype.I=0,e.b2ShapeType={e_unknown:-1,e_circleShape:0,e_edgeShape:1,e_polygonShape:2,e_chainShape:3,e_shapeTypeCount:4},t.exportProperty(e.b2ShapeType,"e_unknown",e.b2ShapeType.e_unknown),t.exportProperty(e.b2ShapeType,"e_circleShape",e.b2ShapeType.e_circleShape),t.exportProperty(e.b2ShapeType,"e_edgeShape",e.b2ShapeType.e_edgeShape),t.exportProperty(e.b2ShapeType,"e_polygonShape",e.b2ShapeType.e_polygonShape),t.exportProperty(e.b2ShapeType,"e_chainShape",e.b2ShapeType.e_chainShape),t.exportProperty(e.b2ShapeType,"e_shapeTypeCount",e.b2ShapeType.e_shapeTypeCount),e.b2Shape=function(t,e){this.m_type=t,this.m_radius=e},e.b2Shape.prototype.m_type=e.b2ShapeType.e_unknown,e.b2Shape.prototype.m_radius=0,e.b2Shape.prototype.Clone=function(){return e.ENABLE_ASSERTS&&e.b2Assert(!1),null},e.b2Shape.prototype.Copy=function(t){return e.ENABLE_ASSERTS&&e.b2Assert(this.m_type==t.m_type),this.m_radius=t.m_radius,this},e.b2Shape.prototype.GetType=function(){return this.m_type},e.b2Shape.prototype.GetChildCount=function(){return e.ENABLE_ASSERTS&&e.b2Assert(!1,"pure virtual"),0},e.b2Shape.prototype.TestPoint=function(){return e.ENABLE_ASSERTS&&e.b2Assert(!1,"pure virtual"),!1},e.b2Shape.prototype.RayCast=function(){return e.ENABLE_ASSERTS&&e.b2Assert(!1,"pure virtual"),!1},e.b2Shape.prototype.ComputeAABB=function(){e.ENABLE_ASSERTS&&e.b2Assert(!1,"pure virtual")},e.b2Shape.prototype.ComputeMass=function(){e.ENABLE_ASSERTS&&e.b2Assert(!1,"pure virtual")},e.b2Shape.prototype.SetupDistanceProxy=function(){e.ENABLE_ASSERTS&&e.b2Assert(!1,"pure virtual")},e.b2Shape.prototype.ComputeSubmergedArea=function(){return e.ENABLE_ASSERTS&&e.b2Assert(!1,"pure virtual"),0},e.b2Shape.prototype.Dump=function(){e.ENABLE_ASSERTS&&e.b2Assert(!1,"pure virtual")},e}(e,r,i,o),p=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2Fixture&&(e.b2Fixture={}),e.b2Filter=function(){},e.b2Filter.prototype.categoryBits=1,e.b2Filter.prototype.maskBits=65535,e.b2Filter.prototype.groupIndex=0,e.b2Filter.prototype.Clone=function(){return(new e.b2Filter).Copy(this)},e.b2Filter.prototype.Copy=function(t){return e.ENABLE_ASSERTS&&e.b2Assert(this!==t),this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex,this},e.b2FixtureDef=function(){this.filter=new e.b2Filter},e.b2FixtureDef.prototype.shape=null,e.b2FixtureDef.prototype.userData=null,e.b2FixtureDef.prototype.friction=.2,e.b2FixtureDef.prototype.restitution=0,e.b2FixtureDef.prototype.density=0,e.b2FixtureDef.prototype.isSensor=!1,e.b2FixtureDef.prototype.filter=null,e.b2FixtureProxy=function(){this.aabb=new e.b2AABB},e.b2FixtureProxy.prototype.aabb=null,e.b2FixtureProxy.prototype.fixture=null,e.b2FixtureProxy.prototype.childIndex=0,e.b2FixtureProxy.prototype.proxy=null,e.b2FixtureProxy.MakeArray=function(t){return e.b2MakeArray(t,function(){return new e.b2FixtureProxy})},e.b2Fixture=function(){this.m_proxyCount=0,this.m_filter=new e.b2Filter},e.b2Fixture.prototype.m_density=0,e.b2Fixture.prototype.m_next=null,e.b2Fixture.prototype.m_body=null,e.b2Fixture.prototype.m_shape=null,e.b2Fixture.prototype.m_friction=0,e.b2Fixture.prototype.m_restitution=0,e.b2Fixture.prototype.m_proxies=null,e.b2Fixture.prototype.m_proxyCount=0,e.b2Fixture.prototype.m_filter=null,e.b2Fixture.prototype.m_isSensor=!1,e.b2Fixture.prototype.m_userData=null,e.b2Fixture.prototype.GetType=function(){return this.m_shape.GetType()},e.b2Fixture.prototype.GetShape=function(){return this.m_shape},e.b2Fixture.prototype.IsSensor=function(){return this.m_isSensor},e.b2Fixture.prototype.GetFilterData=function(){return this.m_filter},e.b2Fixture.prototype.GetUserData=function(){return this.m_userData},e.b2Fixture.prototype.SetUserData=function(t){this.m_userData=t},e.b2Fixture.prototype.GetBody=function(){return this.m_body},e.b2Fixture.prototype.GetNext=function(){return this.m_next},e.b2Fixture.prototype.SetDensity=function(t){this.m_density=t},e.b2Fixture.prototype.GetDensity=function(){return this.m_density},e.b2Fixture.prototype.GetFriction=function(){return this.m_friction},e.b2Fixture.prototype.SetFriction=function(t){this.m_friction=t},e.b2Fixture.prototype.GetRestitution=function(){return this.m_restitution},e.b2Fixture.prototype.SetRestitution=function(t){this.m_restitution=t},e.b2Fixture.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},e.b2Fixture.prototype.RayCast=function(t,e,o){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),o)},e.b2Fixture.prototype.GetMassData=function(t){return t=t||new e.b2MassData,this.m_shape.ComputeMass(t,this.m_density),t},e.b2Fixture.prototype.GetAABB=function(t){return e.ENABLE_ASSERTS&&e.b2Assert(t>=0&&t<this.m_proxyCount),this.m_proxies[t].aabb},e.b2Fixture.prototype.Create=function(t,o){this.m_userData=o.userData,this.m_friction=o.friction,this.m_restitution=o.restitution,this.m_body=t,this.m_next=null,this.m_filter.Copy(o.filter),this.m_isSensor=o.isSensor,this.m_shape=o.shape.Clone(),this.m_proxies=e.b2FixtureProxy.MakeArray(this.m_shape.GetChildCount()),this.m_proxyCount=0,this.m_density=o.density},e.b2Fixture.prototype.Destroy=function(){e.ENABLE_ASSERTS&&e.b2Assert(0==this.m_proxyCount),this.m_shape=null},e.b2Fixture.prototype.CreateProxies=function(t,o){e.ENABLE_ASSERTS&&e.b2Assert(0==this.m_proxyCount),this.m_proxyCount=this.m_shape.GetChildCount();for(var i=0;i<this.m_proxyCount;++i){var n=this.m_proxies[i];this.m_shape.ComputeAABB(n.aabb,o,i),n.proxy=t.CreateProxy(n.aabb,n),n.fixture=this,n.childIndex=i}},e.b2Fixture.prototype.DestroyProxies=function(t){for(var e=0;e<this.m_proxyCount;++e){var o=this.m_proxies[e];t.DestroyProxy(o.proxy),o.proxy=null}this.m_proxyCount=0},e.b2Fixture.prototype.Synchronize=function(t,o,i){if(0!=this.m_proxyCount)for(var n=0;n<this.m_proxyCount;++n){var s=this.m_proxies[n],r=e.b2Fixture.prototype.Synchronize.s_aabb1,a=e.b2Fixture.prototype.Synchronize.s_aabb2;this.m_shape.ComputeAABB(r,o,n),this.m_shape.ComputeAABB(a,i,n),s.aabb.Combine2(r,a);var l=e.b2SubVV(i.p,o.p,e.b2Fixture.prototype.Synchronize.s_displacement);t.MoveProxy(s.proxy,s.aabb,l)}},e.b2Fixture.prototype.Synchronize.s_aabb1=new e.b2AABB,e.b2Fixture.prototype.Synchronize.s_aabb2=new e.b2AABB,e.b2Fixture.prototype.Synchronize.s_displacement=new e.b2Vec2,e.b2Fixture.prototype.SetFilterData=function(t){this.m_filter.Copy(t),this.Refilter()\n},e.b2Fixture.prototype.Refilter=function(){if(!this.m_body){for(var t=this.m_body.GetContactList();t;){var e=t.contact,o=e.GetFixtureA(),i=e.GetFixtureB();(o==this||i==this)&&e.FlagForFiltering(),t=t.next}var n=this.m_body.GetWorld();if(null!==n)for(var s=n.m_contactManager.m_broadPhase,r=0;r<this.m_proxyCount;++r)s.TouchProxy(this.m_proxies[r].proxy)}},e.b2Fixture.prototype.SetSensor=function(t){t!=this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)},e.b2Fixture.prototype.Dump=function(t){e.DEBUG&&(e.b2Log("    /*box2d.b2FixtureDef*/ var fd = new box2d.b2FixtureDef();\\n"),e.b2Log("    fd.friction = %.15f;\\n",this.m_friction),e.b2Log("    fd.restitution = %.15f;\\n",this.m_restitution),e.b2Log("    fd.density = %.15f;\\n",this.m_density),e.b2Log("    fd.isSensor = %s;\\n",this.m_isSensor?"true":"false"),e.b2Log("    fd.filter.categoryBits = %d;\\n",this.m_filter.categoryBits),e.b2Log("    fd.filter.maskBits = %d;\\n",this.m_filter.maskBits),e.b2Log("    fd.filter.groupIndex = %d;\\n",this.m_filter.groupIndex),this.m_shape.Dump(),e.b2Log("\\n"),e.b2Log("    fd.shape = shape;\\n"),e.b2Log("\\n"),e.b2Log("    bodies[%d].CreateFixture(fd);\\n",t))},e}(e,a,o,l),m=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2Body&&(e.b2Body={}),e.b2BodyType={b2_unknown:-1,b2_staticBody:0,b2_kinematicBody:1,b2_dynamicBody:2,b2_bulletBody:3},t.exportProperty(e.b2BodyType,"b2_unknown",e.b2BodyType.b2_unknown),t.exportProperty(e.b2BodyType,"b2_staticBody",e.b2BodyType.b2_staticBody),t.exportProperty(e.b2BodyType,"b2_kinematicBody",e.b2BodyType.b2_kinematicBody),t.exportProperty(e.b2BodyType,"b2_dynamicBody",e.b2BodyType.b2_dynamicBody),t.exportProperty(e.b2BodyType,"b2_bulletBody",e.b2BodyType.b2_bulletBody),e.b2BodyDef=function(){this.position=new e.b2Vec2(0,0),this.linearVelocity=new e.b2Vec2(0,0)},e.b2BodyDef.prototype.type=e.b2BodyType.b2_staticBody,e.b2BodyDef.prototype.position=null,e.b2BodyDef.prototype.angle=0,e.b2BodyDef.prototype.linearVelocity=null,e.b2BodyDef.prototype.angularVelocity=0,e.b2BodyDef.prototype.linearDamping=0,e.b2BodyDef.prototype.angularDamping=0,e.b2BodyDef.prototype.allowSleep=!0,e.b2BodyDef.prototype.awake=!0,e.b2BodyDef.prototype.fixedRotation=!1,e.b2BodyDef.prototype.bullet=!1,e.b2BodyDef.prototype.active=!0,e.b2BodyDef.prototype.userData=null,e.b2BodyDef.prototype.gravityScale=1,e.b2BodyFlag={e_none:0,e_islandFlag:1,e_awakeFlag:2,e_autoSleepFlag:4,e_bulletFlag:8,e_fixedRotationFlag:16,e_activeFlag:32,e_toiFlag:64},t.exportProperty(e.b2BodyFlag,"e_none",e.b2BodyFlag.e_none),t.exportProperty(e.b2BodyFlag,"e_islandFlag",e.b2BodyFlag.e_islandFlag),t.exportProperty(e.b2BodyFlag,"e_awakeFlag",e.b2BodyFlag.e_awakeFlag),t.exportProperty(e.b2BodyFlag,"e_autoSleepFlag",e.b2BodyFlag.e_autoSleepFlag),t.exportProperty(e.b2BodyFlag,"e_bulletFlag",e.b2BodyFlag.e_bulletFlag),t.exportProperty(e.b2BodyFlag,"e_fixedRotationFlag",e.b2BodyFlag.e_fixedRotationFlag),t.exportProperty(e.b2BodyFlag,"e_activeFlag",e.b2BodyFlag.e_activeFlag),t.exportProperty(e.b2BodyFlag,"e_toiFlag",e.b2BodyFlag.e_toiFlag),e.b2Body=function(t,o){this.m_xf=new e.b2Transform,this.m_out_xf=new e.b2Transform,this.m_sweep=new e.b2Sweep,this.m_out_sweep=new e.b2Sweep,this.m_linearVelocity=new e.b2Vec2,this.m_out_linearVelocity=new e.b2Vec2,this.m_force=new e.b2Vec2,e.ENABLE_ASSERTS&&e.b2Assert(t.position.IsValid()),e.ENABLE_ASSERTS&&e.b2Assert(t.linearVelocity.IsValid()),e.ENABLE_ASSERTS&&e.b2Assert(e.b2IsValid(t.angle)),e.ENABLE_ASSERTS&&e.b2Assert(e.b2IsValid(t.angularVelocity)),e.ENABLE_ASSERTS&&e.b2Assert(e.b2IsValid(t.gravityScale)&&t.gravityScale>=0),e.ENABLE_ASSERTS&&e.b2Assert(e.b2IsValid(t.angularDamping)&&t.angularDamping>=0),e.ENABLE_ASSERTS&&e.b2Assert(e.b2IsValid(t.linearDamping)&&t.linearDamping>=0),this.m_flags=e.b2BodyFlag.e_none,t.bullet&&(this.m_flags|=e.b2BodyFlag.e_bulletFlag),t.fixedRotation&&(this.m_flags|=e.b2BodyFlag.e_fixedRotationFlag),t.allowSleep&&(this.m_flags|=e.b2BodyFlag.e_autoSleepFlag),t.awake&&(this.m_flags|=e.b2BodyFlag.e_awakeFlag),t.active&&(this.m_flags|=e.b2BodyFlag.e_activeFlag),this.m_world=o,this.m_xf.p.Copy(t.position),this.m_xf.q.SetAngleRadians(t.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=t.angle,this.m_sweep.a=t.angle,this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(t.linearVelocity),this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_gravityScale=t.gravityScale,this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=t.type,t.type==e.b2BodyType.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0},e.b2Body.prototype.m_flags=e.b2BodyFlag.e_none,e.b2Body.prototype.m_islandIndex=0,e.b2Body.prototype.m_world=null,e.b2Body.prototype.m_xf=null,e.b2Body.prototype.m_out_xf=null,e.b2Body.prototype.m_sweep=null,e.b2Body.prototype.m_out_sweep=null,e.b2Body.prototype.m_jointList=null,e.b2Body.prototype.m_contactList=null,e.b2Body.prototype.m_prev=null,e.b2Body.prototype.m_next=null,e.b2Body.prototype.m_linearVelocity=null,e.b2Body.prototype.m_out_linearVelocity=null,e.b2Body.prototype.m_angularVelocity=0,e.b2Body.prototype.m_linearDamping=0,e.b2Body.prototype.m_angularDamping=0,e.b2Body.prototype.m_gravityScale=1,e.b2Body.prototype.m_force=null,e.b2Body.prototype.m_torque=0,e.b2Body.prototype.m_sleepTime=0,e.b2Body.prototype.m_type=e.b2BodyType.b2_staticBody,e.b2Body.prototype.m_mass=1,e.b2Body.prototype.m_invMass=1,e.b2Body.prototype.m_I=0,e.b2Body.prototype.m_invI=0,e.b2Body.prototype.m_userData=null,e.b2Body.prototype.m_fixtureList=null,e.b2Body.prototype.m_fixtureCount=0,e.b2Body.prototype.m_controllerList=null,e.b2Body.prototype.m_controllerCount=0,e.b2Body.prototype.CreateFixture=function(t){if(e.ENABLE_ASSERTS&&e.b2Assert(0==this.m_world.IsLocked()),1==this.m_world.IsLocked())return null;var o=new e.b2Fixture;if(o.Create(this,t),this.m_flags&e.b2BodyFlag.e_activeFlag){var i=this.m_world.m_contactManager.m_broadPhase;o.CreateProxies(i,this.m_xf)}return o.m_next=this.m_fixtureList,this.m_fixtureList=o,++this.m_fixtureCount,o.m_body=this,o.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=e.b2WorldFlag.e_newFixture,o},e.b2Body.prototype.CreateFixture2=function(t,o){void 0===o&&(o=0);var i=e.b2Body.prototype.CreateFixture2.s_def;return i.shape=t,i.density=o,this.CreateFixture(i)},e.b2Body.prototype.CreateFixture2.s_def=new e.b2FixtureDef,e.b2Body.prototype.DestroyFixture=function(t){if(e.ENABLE_ASSERTS&&e.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()){e.ENABLE_ASSERTS&&e.b2Assert(t.m_body==this),e.ENABLE_ASSERTS&&e.b2Assert(this.m_fixtureCount>0);for(var o=this.m_fixtureList,i=null,n=!1;null!=o;){if(o==t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next,n=!0;break}i=o,o=o.m_next}e.ENABLE_ASSERTS&&e.b2Assert(n);for(var s=this.m_contactList;s;){var r=s.contact;s=s.next;var a=r.GetFixtureA(),l=r.GetFixtureB();(t==a||t==l)&&this.m_world.m_contactManager.Destroy(r)}if(this.m_flags&e.b2BodyFlag.e_activeFlag){var p=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxies(p)}t.Destroy(),t.m_body=null,t.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},e.b2Body.prototype.SetTransformVecRadians=function(t,e){this.SetTransformXYRadians(t.x,t.y,e)},e.b2Body.prototype.SetTransformXYRadians=function(t,o,i){if((this.m_xf.p.x!=t||this.m_xf.p.y!=o||this.m_xf.q.GetAngleRadians()!=i)&&(e.ENABLE_ASSERTS&&e.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked())){this.m_xf.q.SetAngleRadians(i),this.m_xf.p.Set(t,o),e.b2MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(var n=this.m_world.m_contactManager.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)s.Synchronize(n,this.m_xf,this.m_xf)}},e.b2Body.prototype.SetTransform=function(t){this.SetTransformVecRadians(t.p,t.GetAngleRadians())},e.b2Body.prototype.GetTransform=function(t){return t=t||this.m_out_xf,t.Copy(this.m_xf)},e.b2Body.prototype.GetPosition=function(t){return t=t||this.m_out_xf.p,t.Copy(this.m_xf.p)},e.b2Body.prototype.SetPosition=function(t){this.SetTransformVecRadians(t,this.GetAngleRadians())},e.b2Body.prototype.SetPositionXY=function(t,e){this.SetTransformXYRadians(t,e,this.GetAngleRadians())},e.b2Body.prototype.GetAngleRadians=function(){return this.m_sweep.a},e.b2Body.prototype.SetAngleRadians=function(t){this.SetTransformVecRadians(this.GetPosition(),t)},e.b2Body.prototype.GetWorldCenter=function(t){return t=t||this.m_out_sweep.c,t.Copy(this.m_sweep.c)},e.b2Body.prototype.GetLocalCenter=function(t){return t=t||this.m_out_sweep.localCenter,t.Copy(this.m_sweep.localCenter)},e.b2Body.prototype.SetLinearVelocity=function(t){this.m_type!=e.b2BodyType.b2_staticBody&&(e.b2DotVV(t,t)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(t))},e.b2Body.prototype.GetLinearVelocity=function(t){return t=t||this.m_out_linearVelocity,t.Copy(this.m_linearVelocity)},e.b2Body.prototype.SetAngularVelocity=function(t){this.m_type!=e.b2BodyType.b2_staticBody&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)},e.b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},e.b2Body.prototype.GetDefinition=function(t){return t.type=this.GetType(),t.allowSleep=(this.m_flags&e.b2BodyFlag.e_autoSleepFlag)==e.b2BodyFlag.e_autoSleepFlag,t.angle=this.GetAngleRadians(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=(this.m_flags&e.b2BodyFlag.e_fixedRotationFlag)==e.b2BodyFlag.e_fixedRotationFlag,t.bullet=(this.m_flags&e.b2BodyFlag.e_bulletFlag)==e.b2BodyFlag.e_bulletFlag,t.awake=(this.m_flags&e.b2BodyFlag.e_awakeFlag)==e.b2BodyFlag.e_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t},e.b2Body.prototype.ApplyForce=function(t,o,i){i=i||!0,this.m_type==e.b2BodyType.b2_dynamicBody&&(i&&0==(this.m_flags&e.b2BodyFlag.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&e.b2BodyFlag.e_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(o.x-this.m_sweep.c.x)*t.y-(o.y-this.m_sweep.c.y)*t.x))},e.b2Body.prototype.ApplyForceToCenter=function(t,o){o=o||!0,this.m_type==e.b2BodyType.b2_dynamicBody&&(o&&0==(this.m_flags&e.b2BodyFlag.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&e.b2BodyFlag.e_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))},e.b2Body.prototype.ApplyTorque=function(t,o){o=o||!0,this.m_type==e.b2BodyType.b2_dynamicBody&&(o&&0==(this.m_flags&e.b2BodyFlag.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&e.b2BodyFlag.e_awakeFlag&&(this.m_torque+=t))},e.b2Body.prototype.ApplyLinearImpulse=function(t,o,i){i=i||!0,this.m_type==e.b2BodyType.b2_dynamicBody&&(i&&0==(this.m_flags&e.b2BodyFlag.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&e.b2BodyFlag.e_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((o.x-this.m_sweep.c.x)*t.y-(o.y-this.m_sweep.c.y)*t.x)))},e.b2Body.prototype.ApplyAngularImpulse=function(t,o){o=o||!0,this.m_type==e.b2BodyType.b2_dynamicBody&&(o&&0==(this.m_flags&e.b2BodyFlag.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&e.b2BodyFlag.e_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},e.b2Body.prototype.GetMass=function(){return this.m_mass},e.b2Body.prototype.GetInertia=function(){return this.m_I+this.m_mass*e.b2DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)},e.b2Body.prototype.GetMassData=function(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*e.b2DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t},e.b2Body.prototype.SetMassData=function(t){if(e.ENABLE_ASSERTS&&e.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==e.b2BodyType.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&0==(this.m_flags&e.b2BodyFlag.e_fixedRotationFlag)&&(this.m_I=t.I-this.m_mass*e.b2DotVV(t.center,t.center),e.ENABLE_ASSERTS&&e.b2Assert(this.m_I>0),this.m_invI=1/this.m_I);var o=e.b2Body.prototype.SetMassData.s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t.center),e.b2MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),e.b2AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,e.b2SubVV(this.m_sweep.c,o,e.b2Vec2.s_t0),this.m_linearVelocity)}},e.b2Body.prototype.SetMassData.s_oldCenter=new e.b2Vec2,e.b2Body.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type==e.b2BodyType.b2_staticBody||this.m_type==e.b2BodyType.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a,void 0;e.ENABLE_ASSERTS&&e.b2Assert(this.m_type==e.b2BodyType.b2_dynamicBody);for(var t=e.b2Body.prototype.ResetMassData.s_localCenter.SetZero(),o=this.m_fixtureList;o;o=o.m_next)if(0!=o.m_density){var i=o.GetMassData(e.b2Body.prototype.ResetMassData.s_massData);this.m_mass+=i.mass,t.x+=i.center.x*i.mass,t.y+=i.center.y*i.mass,this.m_I+=i.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,t.x*=this.m_invMass,t.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==(this.m_flags&e.b2BodyFlag.e_fixedRotationFlag)?(this.m_I-=this.m_mass*e.b2DotVV(t,t),e.ENABLE_ASSERTS&&e.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var n=e.b2Body.prototype.ResetMassData.s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t),e.b2MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),e.b2AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,e.b2SubVV(this.m_sweep.c,n,e.b2Vec2.s_t0),this.m_linearVelocity)},e.b2Body.prototype.ResetMassData.s_localCenter=new e.b2Vec2,e.b2Body.prototype.ResetMassData.s_oldCenter=new e.b2Vec2,e.b2Body.prototype.ResetMassData.s_massData=new e.b2MassData,e.b2Body.prototype.GetWorldPoint=function(t,o){return e.b2MulXV(this.m_xf,t,o)},e.b2Body.prototype.GetWorldVector=function(t,o){return e.b2MulRV(this.m_xf.q,t,o)},e.b2Body.prototype.GetLocalPoint=function(t,o){return e.b2MulTXV(this.m_xf,t,o)},e.b2Body.prototype.GetLocalVector=function(t,o){return e.b2MulTRV(this.m_xf.q,t,o)},e.b2Body.prototype.GetLinearVelocityFromWorldPoint=function(t,o){return e.b2AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,e.b2SubVV(t,this.m_sweep.c,e.b2Vec2.s_t0),o)},e.b2Body.prototype.GetLinearVelocityFromLocalPoint=function(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)},e.b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping},e.b2Body.prototype.SetLinearDamping=function(t){this.m_linearDamping=t},e.b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping},e.b2Body.prototype.SetAngularDamping=function(t){this.m_angularDamping=t},e.b2Body.prototype.GetGravityScale=function(){return this.m_gravityScale},e.b2Body.prototype.SetGravityScale=function(t){this.m_gravityScale=t},e.b2Body.prototype.SetType=function(t){if(e.ENABLE_ASSERTS&&e.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type!=t){this.m_type=t,this.ResetMassData(),this.m_type==e.b2BodyType.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var o=this.m_contactList;o;){var i=o;o=o.next,this.m_world.m_contactManager.Destroy(i.contact)}this.m_contactList=null;for(var n=this.m_world.m_contactManager.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)for(var r=s.m_proxyCount,a=0;r>a;++a)n.TouchProxy(s.m_proxies[a].proxy)}},e.b2Body.prototype.GetType=function(){return this.m_type},e.b2Body.prototype.SetBullet=function(t){t?this.m_flags|=e.b2BodyFlag.e_bulletFlag:this.m_flags&=~e.b2BodyFlag.e_bulletFlag},e.b2Body.prototype.IsBullet=function(){return(this.m_flags&e.b2BodyFlag.e_bulletFlag)==e.b2BodyFlag.e_bulletFlag},e.b2Body.prototype.SetSleepingAllowed=function(t){t?this.m_flags|=e.b2BodyFlag.e_autoSleepFlag:(this.m_flags&=~e.b2BodyFlag.e_autoSleepFlag,this.SetAwake(!0))},e.b2Body.prototype.IsSleepingAllowed=function(){return(this.m_flags&e.b2BodyFlag.e_autoSleepFlag)==e.b2BodyFlag.e_autoSleepFlag},e.b2Body.prototype.SetAwake=function(t){t?0==(this.m_flags&e.b2BodyFlag.e_awakeFlag)&&(this.m_flags|=e.b2BodyFlag.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~e.b2BodyFlag.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},e.b2Body.prototype.IsAwake=function(){return(this.m_flags&e.b2BodyFlag.e_awakeFlag)==e.b2BodyFlag.e_awakeFlag},e.b2Body.prototype.SetActive=function(t){if(e.ENABLE_ASSERTS&&e.b2Assert(0==this.m_world.IsLocked()),t!=this.IsActive())if(t){this.m_flags|=e.b2BodyFlag.e_activeFlag;for(var o=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.CreateProxies(o,this.m_xf)}else{this.m_flags&=~e.b2BodyFlag.e_activeFlag;for(var o=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.DestroyProxies(o);for(var n=this.m_contactList;n;){var s=n;n=n.next,this.m_world.m_contactManager.Destroy(s.contact)}this.m_contactList=null}},e.b2Body.prototype.IsActive=function(){return(this.m_flags&e.b2BodyFlag.e_activeFlag)==e.b2BodyFlag.e_activeFlag},e.b2Body.prototype.SetFixedRotation=function(t){var o=(this.m_flags&e.b2BodyFlag.e_fixedRotationFlag)==e.b2BodyFlag.e_fixedRotationFlag;o!=t&&(t?this.m_flags|=e.b2BodyFlag.e_fixedRotationFlag:this.m_flags&=~e.b2BodyFlag.e_fixedRotationFlag,this.m_angularVelocity=0,this.ResetMassData())},e.b2Body.prototype.IsFixedRotation=function(){return(this.m_flags&e.b2BodyFlag.e_fixedRotationFlag)==e.b2BodyFlag.e_fixedRotationFlag},e.b2Body.prototype.GetFixtureList=function(){return this.m_fixtureList},e.b2Body.prototype.GetJointList=function(){return this.m_jointList},e.b2Body.prototype.GetContactList=function(){return this.m_contactList},e.b2Body.prototype.GetNext=function(){return this.m_next},e.b2Body.prototype.GetUserData=function(){return this.m_userData},e.b2Body.prototype.SetUserData=function(t){this.m_userData=t},e.b2Body.prototype.GetWorld=function(){return this.m_world},e.b2Body.prototype.SynchronizeFixtures=function(){var t=e.b2Body.prototype.SynchronizeFixtures.s_xf1;t.q.SetAngleRadians(this.m_sweep.a0),e.b2MulRV(t.q,this.m_sweep.localCenter,t.p),e.b2SubVV(this.m_sweep.c0,t.p,t.p);for(var o=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.Synchronize(o,t,this.m_xf)},e.b2Body.prototype.SynchronizeFixtures.s_xf1=new e.b2Transform,e.b2Body.prototype.SynchronizeTransform=function(){this.m_xf.q.SetAngleRadians(this.m_sweep.a),e.b2MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),e.b2SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},e.b2Body.prototype.ShouldCollide=function(t){if(this.m_type!=e.b2BodyType.b2_dynamicBody&&t.m_type!=e.b2BodyType.b2_dynamicBody)return!1;for(var o=this.m_jointList;o;o=o.next)if(o.other==t&&0==o.joint.m_collideConnected)return!1;return!0},e.b2Body.prototype.Advance=function(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngleRadians(this.m_sweep.a),e.b2MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),e.b2SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},e.b2Body.prototype.Dump=function(){if(e.DEBUG){var t=this.m_islandIndex;e.b2Log("if (true)\\n"),e.b2Log("{\\n"),e.b2Log("  /*box2d.b2BodyDef*/ var bd = new box2d.b2BodyDef();\\n");var o="";switch(this.m_type){case e.b2BodyType.b2_staticBody:o="box2d.b2BodyType.b2_staticBody";break;case e.b2BodyType.b2_kinematicBody:o="box2d.b2BodyType.b2_kinematicBody";break;case e.b2BodyType.b2_dynamicBody:o="box2d.b2BodyType.b2_dynamicBody";break;default:e.ENABLE_ASSERTS&&e.b2Assert(!1)}e.b2Log("  bd.type = %s;\\n",o),e.b2Log("  bd.position.Set(%.15f, %.15f);\\n",this.m_xf.p.x,this.m_xf.p.y),e.b2Log("  bd.angle = %.15f;\\n",this.m_sweep.a),e.b2Log("  bd.linearVelocity.Set(%.15f, %.15f);\\n",this.m_linearVelocity.x,this.m_linearVelocity.y),e.b2Log("  bd.angularVelocity = %.15f;\\n",this.m_angularVelocity),e.b2Log("  bd.linearDamping = %.15f;\\n",this.m_linearDamping),e.b2Log("  bd.angularDamping = %.15f;\\n",this.m_angularDamping),e.b2Log("  bd.allowSleep = %s;\\n",this.m_flags&e.b2BodyFlag.e_autoSleepFlag?"true":"false"),e.b2Log("  bd.awake = %s;\\n",this.m_flags&e.b2BodyFlag.e_awakeFlag?"true":"false"),e.b2Log("  bd.fixedRotation = %s;\\n",this.m_flags&e.b2BodyFlag.e_fixedRotationFlag?"true":"false"),e.b2Log("  bd.bullet = %s;\\n",this.m_flags&e.b2BodyFlag.e_bulletFlag?"true":"false"),e.b2Log("  bd.active = %s;\\n",this.m_flags&e.b2BodyFlag.e_activeFlag?"true":"false"),e.b2Log("  bd.gravityScale = %.15f;\\n",this.m_gravityScale),e.b2Log("\\n"),e.b2Log("  bodies[%d] = this.m_world.CreateBody(bd);\\n",this.m_islandIndex),e.b2Log("\\n");for(var i=this.m_fixtureList;i;i=i.m_next)e.b2Log("  if (true)\\n"),e.b2Log("  {\\n"),i.Dump(t),e.b2Log("  }\\n");e.b2Log("}\\n")}},e.b2Body.prototype.GetControllerList=function(){return this.m_controllerList},e.b2Body.prototype.GetControllerCount=function(){return this.m_controllerCount},e}(e,p,i,o),_=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2GrowableStack&&(e.b2GrowableStack={}),e.b2GrowableStack=function(t){this.m_stack=new Array(t)},e.b2GrowableStack.prototype.m_stack=null,e.b2GrowableStack.prototype.m_count=0,e.b2GrowableStack.prototype.Reset=function(){return this.m_count=0,this},e.b2GrowableStack.prototype.Push=function(t){this.m_stack[this.m_count]=t,++this.m_count},e.b2GrowableStack.prototype.Pop=function(){e.ENABLE_ASSERTS&&e.b2Assert(this.m_count>0),--this.m_count;var t=this.m_stack[this.m_count];return this.m_stack[this.m_count]=null,t},e.b2GrowableStack.prototype.GetCount=function(){return this.m_count},e}(e,o),b=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2DynamicTree&&(e.b2DynamicTree={}),e.b2TreeNode=function(t){this.m_id=t||0,this.aabb=new e.b2AABB},e.b2TreeNode.prototype.m_id=0,e.b2TreeNode.prototype.aabb=null,e.b2TreeNode.prototype.userData=null,e.b2TreeNode.prototype.parent=null,e.b2TreeNode.prototype.child1=null,e.b2TreeNode.prototype.child2=null,e.b2TreeNode.prototype.height=0,e.b2TreeNode.prototype.IsLeaf=function(){return null==this.child1},e.b2DynamicTree=function(){},e.b2DynamicTree.prototype.m_root=null,e.b2DynamicTree.prototype.m_freeList=null,e.b2DynamicTree.prototype.m_path=0,e.b2DynamicTree.prototype.m_insertionCount=0,e.b2DynamicTree.s_stack=new e.b2GrowableStack(256),e.b2DynamicTree.s_r=new e.b2Vec2,e.b2DynamicTree.s_v=new e.b2Vec2,e.b2DynamicTree.s_abs_v=new e.b2Vec2,e.b2DynamicTree.s_segmentAABB=new e.b2AABB,e.b2DynamicTree.s_subInput=new e.b2RayCastInput,e.b2DynamicTree.s_combinedAABB=new e.b2AABB,e.b2DynamicTree.s_aabb=new e.b2AABB,e.b2DynamicTree.prototype.GetUserData=function(t){return e.ENABLE_ASSERTS&&e.b2Assert(null!=t),t.userData},e.b2DynamicTree.prototype.GetFatAABB=function(t){return e.ENABLE_ASSERTS&&e.b2Assert(null!=t),t.aabb},e.b2DynamicTree.prototype.Query=function(t,o){if(null!=this.m_root){var i=e.b2DynamicTree.s_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var n=i.Pop();if(null!=n&&n.aabb.TestOverlap(o))if(n.IsLeaf()){var s=t(n);if(0==s)return}else i.Push(n.child1),i.Push(n.child2)}}},e.b2DynamicTree.prototype.RayCast=function(t,o){if(null!=this.m_root){var i=o.p1,n=o.p2,s=e.b2SubVV(n,i,e.b2DynamicTree.s_r);e.ENABLE_ASSERTS&&e.b2Assert(s.GetLengthSquared()>0),s.Normalize();var r=e.b2CrossOneV(s,e.b2DynamicTree.s_v),a=e.b2AbsV(r,e.b2DynamicTree.s_abs_v),l=o.maxFraction,p=e.b2DynamicTree.s_segmentAABB,m=i.x+l*(n.x-i.x),_=i.y+l*(n.y-i.y);p.lowerBound.x=e.b2Min(i.x,m),p.lowerBound.y=e.b2Min(i.y,_),p.upperBound.x=e.b2Max(i.x,m),p.upperBound.y=e.b2Max(i.y,_);var b=e.b2DynamicTree.s_stack.Reset();for(b.Push(this.m_root);b.GetCount()>0;){var h=b.Pop();if(null!=h&&0!=e.b2TestOverlapAABB(h.aabb,p)){var c=h.aabb.GetCenter(),u=h.aabb.GetExtents(),y=e.b2Abs(e.b2DotVV(r,e.b2SubVV(i,c,e.b2Vec2.s_t0)))-e.b2DotVV(a,u);if(!(y>0))if(h.IsLeaf()){var d=e.b2DynamicTree.s_subInput;d.p1.Copy(o.p1),d.p2.Copy(o.p2),d.maxFraction=l;var f=t(d,h);if(0==f)return;f>0&&(l=f,m=i.x+l*(n.x-i.x),_=i.y+l*(n.y-i.y),p.lowerBound.x=e.b2Min(i.x,m),p.lowerBound.y=e.b2Min(i.y,_),p.upperBound.x=e.b2Max(i.x,m),p.upperBound.y=e.b2Max(i.y,_))}else b.Push(h.child1),b.Push(h.child2)}}}},e.b2DynamicTree.prototype.AllocateNode=function(){if(this.m_freeList){var t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t.height=0,t.userData=null,t}return new e.b2TreeNode(e.b2DynamicTree.prototype.s_node_id++)},e.b2DynamicTree.prototype.s_node_id=0,e.b2DynamicTree.prototype.FreeNode=function(t){t.parent=this.m_freeList,t.height=-1,this.m_freeList=t},e.b2DynamicTree.prototype.CreateProxy=function(t,o){var i=this.AllocateNode(),n=e.b2_aabbExtension,s=e.b2_aabbExtension;return i.aabb.lowerBound.x=t.lowerBound.x-n,i.aabb.lowerBound.y=t.lowerBound.y-s,i.aabb.upperBound.x=t.upperBound.x+n,i.aabb.upperBound.y=t.upperBound.y+s,i.userData=o,i.height=0,this.InsertLeaf(i),i},e.b2DynamicTree.prototype.DestroyProxy=function(t){e.ENABLE_ASSERTS&&e.b2Assert(t.IsLeaf()),this.RemoveLeaf(t),this.FreeNode(t)},e.b2DynamicTree.prototype.MoveProxy=function(t,o,i){if(e.ENABLE_ASSERTS&&e.b2Assert(t.IsLeaf()),t.aabb.Contains(o))return!1;this.RemoveLeaf(t);var n=e.b2_aabbExtension+e.b2_aabbMultiplier*(i.x>0?i.x:-i.x),s=e.b2_aabbExtension+e.b2_aabbMultiplier*(i.y>0?i.y:-i.y);return t.aabb.lowerBound.x=o.lowerBound.x-n,t.aabb.lowerBound.y=o.lowerBound.y-s,t.aabb.upperBound.x=o.upperBound.x+n,t.aabb.upperBound.y=o.upperBound.y+s,this.InsertLeaf(t),!0},e.b2DynamicTree.prototype.InsertLeaf=function(t){if(++this.m_insertionCount,null==this.m_root)return this.m_root=t,this.m_root.parent=null,void 0;for(var o,i,n=t.aabb,s=(n.GetCenter(),this.m_root);0==s.IsLeaf();){o=s.child1,i=s.child2;var r=s.aabb.GetPerimeter(),a=e.b2DynamicTree.s_combinedAABB;a.Combine2(s.aabb,n);var l,p,m,_=a.GetPerimeter(),b=2*_,h=2*(_-r),c=e.b2DynamicTree.s_aabb;o.IsLeaf()?(c.Combine2(n,o.aabb),l=c.GetPerimeter()+h):(c.Combine2(n,o.aabb),p=o.aabb.GetPerimeter(),m=c.GetPerimeter(),l=m-p+h);var u;if(i.IsLeaf()?(c.Combine2(n,i.aabb),u=c.GetPerimeter()+h):(c.Combine2(n,i.aabb),p=i.aabb.GetPerimeter(),m=c.GetPerimeter(),u=m-p+h),l>b&&u>b)break;s=u>l?o:i}var y=s,d=y.parent,f=this.AllocateNode();for(f.parent=d,f.userData=null,f.aabb.Combine2(n,y.aabb),f.height=y.height+1,d?(d.child1==y?d.child1=f:d.child2=f,f.child1=y,f.child2=t,y.parent=f,t.parent=f):(f.child1=y,f.child2=t,y.parent=f,t.parent=f,this.m_root=f),s=t.parent;null!=s;)s=this.Balance(s),o=s.child1,i=s.child2,e.ENABLE_ASSERTS&&e.b2Assert(null!=o),e.ENABLE_ASSERTS&&e.b2Assert(null!=i),s.height=1+e.b2Max(o.height,i.height),s.aabb.Combine2(o.aabb,i.aabb),s=s.parent},e.b2DynamicTree.prototype.RemoveLeaf=function(t){if(t==this.m_root)return this.m_root=null,void 0;var o,i=t.parent,n=i.parent;if(o=i.child1==t?i.child2:i.child1,n){n.child1==i?n.child1=o:n.child2=o,o.parent=n,this.FreeNode(i);for(var s=n;s;){s=this.Balance(s);var r=s.child1,a=s.child2;s.aabb.Combine2(r.aabb,a.aabb),s.height=1+e.b2Max(r.height,a.height),s=s.parent}}else this.m_root=o,o.parent=null,this.FreeNode(i)},e.b2DynamicTree.prototype.Balance=function(t){if(e.ENABLE_ASSERTS&&e.b2Assert(null!=t),t.IsLeaf()||t.height<2)return t;var o=t.child1,i=t.child2,n=i.height-o.height;if(n>1){var s=i.child1,r=i.child2;return i.child1=t,i.parent=t.parent,t.parent=i,null!=i.parent?i.parent.child1==t?i.parent.child1=i:(e.ENABLE_ASSERTS&&e.b2Assert(i.parent.child2==t),i.parent.child2=i):this.m_root=i,s.height>r.height?(i.child2=s,t.child2=r,r.parent=t,t.aabb.Combine2(o.aabb,r.aabb),i.aabb.Combine2(t.aabb,s.aabb),t.height=1+e.b2Max(o.height,r.height),i.height=1+e.b2Max(t.height,s.height)):(i.child2=r,t.child2=s,s.parent=t,t.aabb.Combine2(o.aabb,s.aabb),i.aabb.Combine2(t.aabb,r.aabb),t.height=1+e.b2Max(o.height,s.height),i.height=1+e.b2Max(t.height,r.height)),i}if(-1>n){var a=o.child1,l=o.child2;return o.child1=t,o.parent=t.parent,t.parent=o,null!=o.parent?o.parent.child1==t?o.parent.child1=o:(e.ENABLE_ASSERTS&&e.b2Assert(o.parent.child2==t),o.parent.child2=o):this.m_root=o,a.height>l.height?(o.child2=a,t.child1=l,l.parent=t,t.aabb.Combine2(i.aabb,l.aabb),o.aabb.Combine2(t.aabb,a.aabb),t.height=1+e.b2Max(i.height,l.height),o.height=1+e.b2Max(t.height,a.height)):(o.child2=l,t.child1=a,a.parent=t,t.aabb.Combine2(i.aabb,a.aabb),o.aabb.Combine2(t.aabb,l.aabb),t.height=1+e.b2Max(i.height,a.height),o.height=1+e.b2Max(t.height,l.height)),o}return t},e.b2DynamicTree.prototype.GetHeight=function(){return null==this.m_root?0:this.m_root.height},e.b2DynamicTree.prototype.GetAreaRatio=function(){if(null==this.m_root)return 0;var t=this.m_root,e=t.aabb.GetPerimeter(),o=function(t){if(null==t)return 0;if(t.IsLeaf())return 0;var e=t.aabb.GetPerimeter();return e+=o(t.child1),e+=o(t.child2)},i=o(this.m_root);return i/e},e.b2DynamicTree.prototype.ComputeHeightNode=function(t){if(t.IsLeaf())return 0;var o=this.ComputeHeightNode(t.child1),i=this.ComputeHeightNode(t.child2);return 1+e.b2Max(o,i)},e.b2DynamicTree.prototype.ComputeHeight=function(){var t=this.ComputeHeightNode(this.m_root);return t},e.b2DynamicTree.prototype.ValidateStructure=function(t){if(null!=t){t==this.m_root&&e.ENABLE_ASSERTS&&e.b2Assert(null==t.parent);var o=t,i=o.child1,n=o.child2;if(o.IsLeaf())return e.ENABLE_ASSERTS&&e.b2Assert(null==i),e.ENABLE_ASSERTS&&e.b2Assert(null==n),e.ENABLE_ASSERTS&&e.b2Assert(0==o.height),void 0;e.ENABLE_ASSERTS&&e.b2Assert(i.parent==t),e.ENABLE_ASSERTS&&e.b2Assert(n.parent==t),this.ValidateStructure(i),this.ValidateStructure(n)}},e.b2DynamicTree.prototype.ValidateMetrics=function(t){if(null!=t){var o=t,i=o.child1,n=o.child2;if(o.IsLeaf())return e.ENABLE_ASSERTS&&e.b2Assert(null==i),e.ENABLE_ASSERTS&&e.b2Assert(null==n),e.ENABLE_ASSERTS&&e.b2Assert(0==o.height),void 0;var s,r=i.height,a=n.height;s=1+e.b2Max(r,a),e.ENABLE_ASSERTS&&e.b2Assert(o.height==s);var l=e.b2DynamicTree.s_aabb;l.Combine2(i.aabb,n.aabb),e.ENABLE_ASSERTS&&e.b2Assert(l.lowerBound==o.aabb.lowerBound),e.ENABLE_ASSERTS&&e.b2Assert(l.upperBound==o.aabb.upperBound),this.ValidateMetrics(i),this.ValidateMetrics(n)}},e.b2DynamicTree.prototype.Validate=function(){this.ValidateStructure(this.m_root),this.ValidateMetrics(this.m_root);for(var t=0,o=this.m_freeList;null!=o;)o=o.parent,++t;e.ENABLE_ASSERTS&&e.b2Assert(this.GetHeight()==this.ComputeHeight())},e.b2DynamicTree.prototype.GetMaxBalance=function(){var t=function(t,o){if(null==t)return o;if(t.height<=1)return o;e.ENABLE_ASSERTS&&e.b2Assert(0==t.IsLeaf());var i=t.child1,n=t.child2,s=e.b2Abs(n.height-i.height);return e.b2Max(o,s)},o=t(this.m_root,0);return o},e.b2DynamicTree.prototype.RebuildBottomUp=function(){this.Validate()},e.b2DynamicTree.prototype.ShiftOrigin=function(t){var o=function(t,i){if(null!=t&&!(t.height<=1)){e.ENABLE_ASSERTS&&e.b2Assert(0==t.IsLeaf());var n=t.child1,s=t.child2;o(n,i),o(s,i),t.aabb.lowerBound.SelfSub(i),t.aabb.upperBound.SelfSub(i)}};o(this.m_root,t)},e}(e,a,_,o),h=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2BroadPhase&&(e.b2BroadPhase={}),e.b2Pair=function(){},e.b2Pair.prototype.proxyA=null,e.b2Pair.prototype.proxyB=null,e.b2BroadPhase=function(){this.m_tree=new e.b2DynamicTree,this.m_moveBuffer=new Array,this.m_pairBuffer=new Array},e.b2BroadPhase.prototype.m_tree=null,e.b2BroadPhase.prototype.m_proxyCount=0,e.b2BroadPhase.prototype.m_moveCount=0,e.b2BroadPhase.prototype.m_moveBuffer=null,e.b2BroadPhase.prototype.m_pairCount=0,e.b2BroadPhase.prototype.m_pairBuffer=null,e.b2BroadPhase.prototype.CreateProxy=function(t,e){var o=this.m_tree.CreateProxy(t,e);\nreturn++this.m_proxyCount,this.BufferMove(o),o},e.b2BroadPhase.prototype.DestroyProxy=function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},e.b2BroadPhase.prototype.MoveProxy=function(t,e,o){var i=this.m_tree.MoveProxy(t,e,o);i&&this.BufferMove(t)},e.b2BroadPhase.prototype.TouchProxy=function(t){this.BufferMove(t)},e.b2BroadPhase.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)},e.b2BroadPhase.prototype.GetUserData=function(t){return this.m_tree.GetUserData(t)},e.b2BroadPhase.prototype.TestOverlap=function(t,o){var i=this.m_tree.GetFatAABB(t),n=this.m_tree.GetFatAABB(o);return e.b2TestOverlapAABB(i,n)},e.b2BroadPhase.prototype.GetProxyCount=function(){return this.m_proxyCount},e.b2BroadPhase.prototype.GetTreeHeight=function(){return this.m_tree.GetHeight()},e.b2BroadPhase.prototype.GetTreeBalance=function(){return this.m_tree.GetMaxBalance()},e.b2BroadPhase.prototype.GetTreeQuality=function(){return this.m_tree.GetAreaRatio()},e.b2BroadPhase.prototype.ShiftOrigin=function(t){this.m_tree.ShiftOrigin(t)},e.b2BroadPhase.prototype.UpdatePairs=function(t){this.m_pairCount=0;for(var o=0;o<this.m_moveCount;++o){var i=this.m_moveBuffer[o];if(null!=i){var n=this,s=function(t){if(t.m_id==i.m_id)return!0;n.m_pairCount==n.m_pairBuffer.length&&(n.m_pairBuffer[n.m_pairCount]=new e.b2Pair);var o=n.m_pairBuffer[n.m_pairCount];return t.m_id<i.m_id?(o.proxyA=t,o.proxyB=i):(o.proxyA=i,o.proxyB=t),++n.m_pairCount,!0},r=this.m_tree.GetFatAABB(i);this.m_tree.Query(s,r)}}this.m_moveCount=0,this.m_pairBuffer.length=this.m_pairCount,this.m_pairBuffer.sort(e.b2PairLessThan);for(var o=0;o<this.m_pairCount;){var a=this.m_pairBuffer[o],l=this.m_tree.GetUserData(a.proxyA),p=this.m_tree.GetUserData(a.proxyB);for(t.AddPair(l,p),++o;o<this.m_pairCount;){var m=this.m_pairBuffer[o];if(m.proxyA.m_id!=a.proxyA.m_id||m.proxyB.m_id!=a.proxyB.m_id)break;++o}}},e.b2BroadPhase.prototype.Query=function(t,e){this.m_tree.Query(t,e)},e.b2BroadPhase.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)},e.b2BroadPhase.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount},e.b2BroadPhase.prototype.UnBufferMove=function(t){var e=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[e]=null},e.b2PairLessThan=function(t,e){return t.proxyA.m_id==e.proxyA.m_id?t.proxyB.m_id-e.proxyB.m_id:t.proxyA.m_id-e.proxyA.m_id},e}(e,b,o),c=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2Controller&&(e.b2Controller={}),e.b2ControllerEdge=function(){},e.b2ControllerEdge.prototype.controller=null,e.b2ControllerEdge.prototype.body=null,e.b2ControllerEdge.prototype.prevBody=null,e.b2ControllerEdge.prototype.nextBody=null,e.b2ControllerEdge.prototype.prevController=null,e.b2ControllerEdge.prototype.nextController=null,e.b2Controller=function(){},e.b2Controller.prototype.m_world=null,e.b2Controller.prototype.m_bodyList=null,e.b2Controller.prototype.m_bodyCount=0,e.b2Controller.prototype.m_prev=null,e.b2Controller.prototype.m_next=null,e.b2Controller.prototype.Step=function(){},e.b2Controller.prototype.Draw=function(){},e.b2Controller.prototype.GetNext=function(){return this.m_next},e.b2Controller.prototype.GetPrev=function(){return this.m_prev},e.b2Controller.prototype.GetWorld=function(){return this.m_world},e.b2Controller.prototype.GetBodyList=function(){return this.m_bodyList},e.b2Controller.prototype.AddBody=function(t){var o=new e.b2ControllerEdge;o.body=t,o.controller=this,o.nextBody=this.m_bodyList,o.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=o),this.m_bodyList=o,++this.m_bodyCount,o.nextController=t.m_controllerList,o.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=o),t.m_controllerList=o,++t.m_controllerCount},e.b2Controller.prototype.RemoveBody=function(t){e.ENABLE_ASSERTS&&e.b2Assert(this.m_bodyCount>0);for(var o=this.m_bodyList;o&&o.body!=t;)o=o.nextBody;e.ENABLE_ASSERTS&&e.b2Assert(null!=o),o.prevBody&&(o.prevBody.nextBody=o.nextBody),o.nextBody&&(o.nextBody.prevBody=o.prevBody),this.m_bodyList==o&&(this.m_bodyList=o.nextBody),--this.m_bodyCount,o.nextController&&(o.nextController.prevController=o.prevController),o.prevController&&(o.prevController.nextController=o.nextController),t.m_controllerList==o&&(t.m_controllerList=o.nextController),--t.m_controllerCount},e.b2Controller.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0},e}(e,o),u=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2WorldCallbacks&&(e.b2WorldCallbacks={}),e.b2DestructionListener=function(){},e.b2DestructionListener.prototype.SayGoodbyeJoint=function(){},e.b2DestructionListener.prototype.SayGoodbyeFixture=function(){},e.b2ContactFilter=function(){},e.b2ContactFilter.prototype.ShouldCollide=function(t,e){var o=t.GetFilterData(),i=e.GetFilterData();if(o.groupIndex==i.groupIndex&&0!=o.groupIndex)return o.groupIndex>0;var n=0!=(o.maskBits&i.categoryBits)&&0!=(o.categoryBits&i.maskBits);return n},e.b2ContactFilter.b2_defaultFilter=new e.b2ContactFilter,e.b2ContactImpulse=function(){this.normalImpulses=e.b2MakeNumberArray(e.b2_maxManifoldPoints),this.tangentImpulses=e.b2MakeNumberArray(e.b2_maxManifoldPoints)},e.b2ContactImpulse.prototype.normalImpulses=null,e.b2ContactImpulse.prototype.tangentImpulses=null,e.b2ContactImpulse.prototype.count=0,e.b2ContactListener=function(){},e.b2ContactListener.prototype.BeginContact=function(){},e.b2ContactListener.prototype.EndContact=function(){},e.b2ContactListener.prototype.PreSolve=function(){},e.b2ContactListener.prototype.PostSolve=function(){},e.b2ContactListener.b2_defaultListener=new e.b2ContactListener,e.b2QueryCallback=function(){},e.b2QueryCallback.prototype.ReportFixture=function(){return!0},e.b2RayCastCallback=function(){},e.b2RayCastCallback.prototype.ReportFixture=function(t,e,o,i){return i},e}(e,o),y=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2BuoyancyController&&(e.b2BuoyancyController={}),e.b2BuoyancyController=function(){t.base(this),this.normal=new e.b2Vec2(0,1),this.velocity=new e.b2Vec2(0,0),this.gravity=new e.b2Vec2(0,0)},t.inherits(e.b2BuoyancyController,e.b2Controller),e.b2BuoyancyController.prototype.normal=null,e.b2BuoyancyController.prototype.offset=0,e.b2BuoyancyController.prototype.density=0,e.b2BuoyancyController.prototype.velocity=null,e.b2BuoyancyController.prototype.linearDrag=0,e.b2BuoyancyController.prototype.angularDrag=0,e.b2BuoyancyController.prototype.useDensity=!1,e.b2BuoyancyController.prototype.useWorldGravity=!0,e.b2BuoyancyController.prototype.gravity=null,e.b2BuoyancyController.prototype.Step=function(){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.GetWorld().GetGravity());for(var t=this.m_bodyList;t;t=t.nextBody){var o=t.body;if(0!=o.IsAwake()){for(var i=new e.b2Vec2,n=new e.b2Vec2,s=0,r=0,a=o.GetFixtureList();a;a=a.m_next){var l=new e.b2Vec2,p=a.GetShape().ComputeSubmergedArea(this.normal,this.offset,o.GetTransform(),l);s+=p,i.x+=p*l.x,i.y+=p*l.y;var m=0;m=this.useDensity?a.GetDensity():1,r+=p*m,n.x+=p*l.x*m,n.y+=p*l.y*m}if(i.x/=s,i.y/=s,n.x/=r,n.y/=r,!(s<e.b2_epsilon)){var _=e.b2NegV(this.gravity,new e.b2Vec2);_.SelfMul(this.density*s),o.ApplyForce(_,n);var b=o.GetLinearVelocityFromWorldPoint(i,new e.b2Vec2);b.SelfSub(this.velocity),b.SelfMul(-this.linearDrag*s),o.ApplyForce(b,i),o.ApplyTorque(-o.GetInertia()/o.GetMass()*s*o.GetAngularVelocity()*this.angularDrag)}}}}},e.b2BuoyancyController.prototype.Draw=function(t){var o=100,i=new e.b2Vec2,n=new e.b2Vec2;i.x=this.normal.x*this.offset+this.normal.y*o,i.y=this.normal.y*this.offset-this.normal.x*o,n.x=this.normal.x*this.offset-this.normal.y*o,n.y=this.normal.y*this.offset+this.normal.x*o;var s=new e.b2Color(0,0,.8);t.DrawSegment(i,n,s)},e}(e,c,i,o,u),d=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2EdgeShape&&(e.b2EdgeShape={}),e.b2EdgeShape=function(){t.base(this,e.b2ShapeType.e_edgeShape,e.b2_polygonRadius),this.m_vertex1=new e.b2Vec2,this.m_vertex2=new e.b2Vec2,this.m_vertex0=new e.b2Vec2,this.m_vertex3=new e.b2Vec2},t.inherits(e.b2EdgeShape,e.b2Shape),e.b2EdgeShape.prototype.m_vertex1=null,e.b2EdgeShape.prototype.m_vertex2=null,e.b2EdgeShape.prototype.m_vertex0=null,e.b2EdgeShape.prototype.m_vertex3=null,e.b2EdgeShape.prototype.m_hasVertex0=!1,e.b2EdgeShape.prototype.m_hasVertex3=!1,e.b2EdgeShape.prototype.Set=function(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},e.b2EdgeShape.prototype.SetAsEdge=e.b2EdgeShape.prototype.Set,e.b2EdgeShape.prototype.Clone=function(){return(new e.b2EdgeShape).Copy(this)},e.b2EdgeShape.prototype.Copy=function(o){return t.base(this,"Copy",o),e.ENABLE_ASSERTS&&e.b2Assert(o instanceof e.b2EdgeShape),this.m_vertex1.Copy(o.m_vertex1),this.m_vertex2.Copy(o.m_vertex2),this.m_vertex0.Copy(o.m_vertex0),this.m_vertex3.Copy(o.m_vertex3),this.m_hasVertex0=o.m_hasVertex0,this.m_hasVertex3=o.m_hasVertex3,this},e.b2EdgeShape.prototype.GetChildCount=function(){return 1},e.b2EdgeShape.prototype.TestPoint=function(){return!1},e.b2EdgeShape.prototype.RayCast=function(t,o,i){var n=e.b2MulTXV(i,o.p1,e.b2EdgeShape.prototype.RayCast.s_p1),s=e.b2MulTXV(i,o.p2,e.b2EdgeShape.prototype.RayCast.s_p2),r=e.b2SubVV(s,n,e.b2EdgeShape.prototype.RayCast.s_d),a=this.m_vertex1,l=this.m_vertex2,p=e.b2SubVV(l,a,e.b2EdgeShape.prototype.RayCast.s_e),m=t.normal.Set(p.y,-p.x).SelfNormalize(),_=e.b2DotVV(m,e.b2SubVV(a,n,e.b2Vec2.s_t0)),b=e.b2DotVV(m,r);if(0==b)return!1;var h=_/b;if(0>h||o.maxFraction<h)return!1;var c=e.b2AddVMulSV(n,h,r,e.b2EdgeShape.prototype.RayCast.s_q),u=e.b2SubVV(l,a,e.b2EdgeShape.prototype.RayCast.s_r),y=e.b2DotVV(u,u);if(0==y)return!1;var d=e.b2DotVV(e.b2SubVV(c,a,e.b2Vec2.s_t0),u)/y;return 0>d||d>1?!1:(t.fraction=h,e.b2MulRV(i.q,t.normal,t.normal),_>0&&t.normal.SelfNeg(),!0)},e.b2EdgeShape.prototype.RayCast.s_p1=new e.b2Vec2,e.b2EdgeShape.prototype.RayCast.s_p2=new e.b2Vec2,e.b2EdgeShape.prototype.RayCast.s_d=new e.b2Vec2,e.b2EdgeShape.prototype.RayCast.s_e=new e.b2Vec2,e.b2EdgeShape.prototype.RayCast.s_q=new e.b2Vec2,e.b2EdgeShape.prototype.RayCast.s_r=new e.b2Vec2,e.b2EdgeShape.prototype.ComputeAABB=function(t,o){var i=e.b2MulXV(o,this.m_vertex1,e.b2EdgeShape.prototype.ComputeAABB.s_v1),n=e.b2MulXV(o,this.m_vertex2,e.b2EdgeShape.prototype.ComputeAABB.s_v2);e.b2MinV(i,n,t.lowerBound),e.b2MaxV(i,n,t.upperBound);var s=this.m_radius;t.lowerBound.SelfSubXY(s,s),t.upperBound.SelfAddXY(s,s)},e.b2EdgeShape.prototype.ComputeAABB.s_v1=new e.b2Vec2,e.b2EdgeShape.prototype.ComputeAABB.s_v2=new e.b2Vec2,e.b2EdgeShape.prototype.ComputeMass=function(t){t.mass=0,e.b2MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0},e.b2EdgeShape.prototype.SetupDistanceProxy=function(t){t.m_vertices=new Array(2),t.m_vertices[0]=this.m_vertex1,t.m_vertices[1]=this.m_vertex2,t.m_count=2,t.m_radius=this.m_radius},e.b2EdgeShape.prototype.ComputeSubmergedArea=function(t,e,o,i){return i.SetZero(),0},e.b2EdgeShape.prototype.Dump=function(){e.b2Log("    /*box2d.b2EdgeShape*/ var shape = new box2d.b2EdgeShape();\\n"),e.b2Log("    shape.m_radius = %.15f;\\n",this.m_radius),e.b2Log("    shape.m_vertex0.Set(%.15f, %.15f);\\n",this.m_vertex0.x,this.m_vertex0.y),e.b2Log("    shape.m_vertex1.Set(%.15f, %.15f);\\n",this.m_vertex1.x,this.m_vertex1.y),e.b2Log("    shape.m_vertex2.Set(%.15f, %.15f);\\n",this.m_vertex2.x,this.m_vertex2.y),e.b2Log("    shape.m_vertex3.Set(%.15f, %.15f);\\n",this.m_vertex3.x,this.m_vertex3.y),e.b2Log("    shape.m_hasVertex0 = %s;\\n",this.m_hasVertex0),e.b2Log("    shape.m_hasVertex3 = %s;\\n",this.m_hasVertex3)},e}(e,l),f=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2ChainShape&&(e.b2ChainShape={}),e.b2ChainShape=function(){t.base(this,e.b2ShapeType.e_chainShape,e.b2_polygonRadius),this.m_prevVertex=new e.b2Vec2,this.m_nextVertex=new e.b2Vec2},t.inherits(e.b2ChainShape,e.b2Shape),e.b2ChainShape.prototype.m_vertices=null,e.b2ChainShape.prototype.m_count=0,e.b2ChainShape.prototype.m_prevVertex=null,e.b2ChainShape.prototype.m_nextVertex=null,e.b2ChainShape.prototype.m_hasPrevVertex=!1,e.b2ChainShape.prototype.m_hasNextVertex=!1,e.b2ChainShape.prototype.CreateLoop=function(t,o){if(o=o||t.length,e.ENABLE_ASSERTS&&e.b2Assert(null==this.m_vertices&&0==this.m_count),e.ENABLE_ASSERTS&&e.b2Assert(o>=3),e.ENABLE_ASSERTS)for(var i=1;o>i;++i){var n=t[i-1],s=t[i];e.b2Assert(e.b2DistanceSquaredVV(n,s)>e.b2_linearSlop*e.b2_linearSlop)}this.m_count=o+1,this.m_vertices=e.b2Vec2.MakeArray(this.m_count);for(var i=0;o>i;++i)this.m_vertices[i].Copy(t[i]);return this.m_vertices[o].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},e.b2ChainShape.prototype.CreateChain=function(t,o){if(o=o||t.length,e.ENABLE_ASSERTS&&e.b2Assert(null==this.m_vertices&&0==this.m_count),e.ENABLE_ASSERTS&&e.b2Assert(o>=2),e.ENABLE_ASSERTS)for(var i=1;o>i;++i){var n=t[i-1],s=t[i];e.b2Assert(e.b2DistanceSquaredVV(n,s)>e.b2_linearSlop*e.b2_linearSlop)}this.m_count=o,this.m_vertices=e.b2Vec2.MakeArray(o);for(var i=0;o>i;++i)this.m_vertices[i].Copy(t[i]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this},e.b2ChainShape.prototype.SetPrevVertex=function(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this},e.b2ChainShape.prototype.SetNextVertex=function(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this},e.b2ChainShape.prototype.Clone=function(){return(new e.b2ChainShape).Copy(this)},e.b2ChainShape.prototype.Copy=function(o){return t.base(this,"Copy",o),e.ENABLE_ASSERTS&&e.b2Assert(o instanceof e.b2ChainShape),this.CreateChain(o.m_vertices,o.m_count),this.m_prevVertex.Copy(o.m_prevVertex),this.m_nextVertex.Copy(o.m_nextVertex),this.m_hasPrevVertex=o.m_hasPrevVertex,this.m_hasNextVertex=o.m_hasNextVertex,this},e.b2ChainShape.prototype.GetChildCount=function(){return this.m_count-1},e.b2ChainShape.prototype.GetChildEdge=function(t,o){e.ENABLE_ASSERTS&&e.b2Assert(o>=0&&o<this.m_count-1),t.m_type=e.b2ShapeType.e_edgeShape,t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[o]),t.m_vertex2.Copy(this.m_vertices[o+1]),o>0?(t.m_vertex0.Copy(this.m_vertices[o-1]),t.m_hasVertex0=!0):(t.m_vertex0.Copy(this.m_prevVertex),t.m_hasVertex0=this.m_hasPrevVertex),o<this.m_count-2?(t.m_vertex3.Copy(this.m_vertices[o+2]),t.m_hasVertex3=!0):(t.m_vertex3.Copy(this.m_nextVertex),t.m_hasVertex3=this.m_hasNextVertex)},e.b2ChainShape.prototype.TestPoint=function(){return!1},e.b2ChainShape.prototype.RayCast=function(t,o,i,n){e.ENABLE_ASSERTS&&e.b2Assert(n<this.m_count);var s=e.b2ChainShape.s_edgeShape;return s.m_vertex1.Copy(this.m_vertices[n]),s.m_vertex2.Copy(this.m_vertices[(n+1)%this.m_count]),s.RayCast(t,o,i,0)},e.b2ChainShape.s_edgeShape=new e.b2EdgeShape,e.b2ChainShape.prototype.ComputeAABB=function(t,o,i){e.ENABLE_ASSERTS&&e.b2Assert(i<this.m_count);var n=this.m_vertices[i],s=this.m_vertices[(i+1)%this.m_count],r=e.b2MulXV(o,n,e.b2ChainShape.prototype.ComputeAABB.s_v1),a=e.b2MulXV(o,s,e.b2ChainShape.prototype.ComputeAABB.s_v2);e.b2MinV(r,a,t.lowerBound),e.b2MaxV(r,a,t.upperBound)},e.b2ChainShape.prototype.ComputeAABB.s_v1=new e.b2Vec2,e.b2ChainShape.prototype.ComputeAABB.s_v2=new e.b2Vec2,e.b2ChainShape.prototype.ComputeMass=function(t){t.mass=0,t.center.SetZero(),t.I=0},e.b2ChainShape.prototype.SetupDistanceProxy=function(t,o){e.ENABLE_ASSERTS&&e.b2Assert(o>=0&&o<this.m_count),t.m_buffer[0].Copy(this.m_vertices[o]),o+1<this.m_count?t.m_buffer[1].Copy(this.m_vertices[o+1]):t.m_buffer[1].Copy(this.m_vertices[0]),t.m_vertices=t.m_buffer,t.m_count=2,t.m_radius=this.m_radius},e.b2ChainShape.prototype.ComputeSubmergedArea=function(t,e,o,i){return i.SetZero(),0},e.b2ChainShape.prototype.Dump=function(){e.b2Log("    /*box2d.b2ChainShape*/ var shape = new box2d.b2ChainShape();\\n"),e.b2Log("    /*box2d.b2Vec2[]*/ var vs = box2d.b2Vec2.MakeArray(%d);\\n",e.b2_maxPolygonVertices);for(var t=0;t<this.m_count;++t)e.b2Log("    vs[%d].Set(%.15f, %.15f);\\n",t,this.m_vertices[t].x,this.m_vertices[t].y);e.b2Log("    shape.CreateChain(vs, %d);\\n",this.m_count),e.b2Log("    shape.m_prevVertex.Set(%.15f, %.15f);\\n",this.m_prevVertex.x,this.m_prevVertex.y),e.b2Log("    shape.m_nextVertex.Set(%.15f, %.15f);\\n",this.m_nextVertex.x,this.m_nextVertex.y),e.b2Log("    shape.m_hasPrevVertex = %s;\\n",this.m_hasPrevVertex?"true":"false"),e.b2Log("    shape.m_hasNextVertex = %s;\\n",this.m_hasNextVertex?"true":"false")},e}(e,d,l),A=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2CircleShape&&(e.b2CircleShape={}),e.b2CircleShape=function(o){t.base(this,e.b2ShapeType.e_circleShape,o||0),this.m_p=new e.b2Vec2},t.inherits(e.b2CircleShape,e.b2Shape),e.b2CircleShape.prototype.m_p=null,e.b2CircleShape.prototype.Clone=function(){return(new e.b2CircleShape).Copy(this)},e.b2CircleShape.prototype.Copy=function(o){return t.base(this,"Copy",o),e.ENABLE_ASSERTS&&e.b2Assert(o instanceof e.b2CircleShape),this.m_p.Copy(o.m_p),this},e.b2CircleShape.prototype.GetChildCount=function(){return 1},e.b2CircleShape.prototype.TestPoint=function(t,o){var i=e.b2MulXV(t,this.m_p,e.b2CircleShape.prototype.TestPoint.s_center),n=e.b2SubVV(o,i,e.b2CircleShape.prototype.TestPoint.s_d);return e.b2DotVV(n,n)<=e.b2Sq(this.m_radius)},e.b2CircleShape.prototype.TestPoint.s_center=new e.b2Vec2,e.b2CircleShape.prototype.TestPoint.s_d=new e.b2Vec2,e.b2CircleShape.prototype.RayCast=function(t,o,i){var n=e.b2MulXV(i,this.m_p,e.b2CircleShape.prototype.RayCast.s_position),s=e.b2SubVV(o.p1,n,e.b2CircleShape.prototype.RayCast.s_s),r=e.b2DotVV(s,s)-e.b2Sq(this.m_radius),a=e.b2SubVV(o.p2,o.p1,e.b2CircleShape.prototype.RayCast.s_r),l=e.b2DotVV(s,a),p=e.b2DotVV(a,a),m=l*l-p*r;if(0>m||p<e.b2_epsilon)return!1;var _=-(l+e.b2Sqrt(m));return _>=0&&_<=o.maxFraction*p?(_/=p,t.fraction=_,e.b2AddVMulSV(s,_,a,t.normal).SelfNormalize(),!0):!1},e.b2CircleShape.prototype.RayCast.s_position=new e.b2Vec2,e.b2CircleShape.prototype.RayCast.s_s=new e.b2Vec2,e.b2CircleShape.prototype.RayCast.s_r=new e.b2Vec2,e.b2CircleShape.prototype.ComputeAABB=function(t,o){var i=e.b2MulXV(o,this.m_p,e.b2CircleShape.prototype.ComputeAABB.s_p);t.lowerBound.Set(i.x-this.m_radius,i.y-this.m_radius),t.upperBound.Set(i.x+this.m_radius,i.y+this.m_radius)},e.b2CircleShape.prototype.ComputeAABB.s_p=new e.b2Vec2,e.b2CircleShape.prototype.ComputeMass=function(t,o){var i=e.b2Sq(this.m_radius);t.mass=o*e.b2_pi*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+e.b2DotVV(this.m_p,this.m_p))},e.b2CircleShape.prototype.SetupDistanceProxy=function(t){t.m_vertices=new Array(1,!0),t.m_vertices[0]=this.m_p,t.m_count=1,t.m_radius=this.m_radius},e.b2CircleShape.prototype.ComputeSubmergedArea=function(t,o,i,n){var s=e.b2MulXV(i,this.m_p,new e.b2Vec2),r=-(e.b2DotVV(t,s)-o);if(r<-this.m_radius+e.b2_epsilon)return 0;if(r>this.m_radius)return n.Copy(s),e.b2_pi*this.m_radius*this.m_radius;var a=this.m_radius*this.m_radius,l=r*r,p=a*(e.b2Asin(r/this.m_radius)+e.b2_pi/2)+r*e.b2Sqrt(a-l),m=-2/3*e.b2Pow(a-l,1.5)/p;return n.x=s.x+t.x*m,n.y=s.y+t.y*m,p},e.b2CircleShape.prototype.Dump=function(){e.b2Log("    /*box2d.b2CircleShape*/ var shape = new box2d.b2CircleShape();\\n"),e.b2Log("    shape.m_radius = %.15f;\\n",this.m_radius),e.b2Log("    shape.m_p.Set(%.15f, %.15f);\\n",this.m_p.x,this.m_p.y)},e}(e,l),S=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2ConstantAccelController&&(e.b2ConstantAccelController={}),e.b2ConstantAccelController=function(){t.base(this),this.A=new e.b2Vec2(0,0)},t.inherits(e.b2ConstantAccelController,e.b2Controller),e.b2ConstantAccelController.prototype.A=null,e.b2ConstantAccelController.prototype.Step=function(t){for(var o=e.b2MulSV(t.dt,this.A,e.b2ConstantAccelController.prototype.Step.s_dtA),i=this.m_bodyList;i;i=i.nextBody){var n=i.body;n.IsAwake()&&n.SetLinearVelocity(e.b2AddVV(n.GetLinearVelocity(),o,e.b2Vec2.s_t0))}},e.b2ConstantAccelController.prototype.Step.s_dtA=new e.b2Vec2,e}(e,c,i,o),C=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2ConstantForceController&&(e.b2ConstantForceController={}),e.b2ConstantForceController=function(){t.base(this),this.F=new e.b2Vec2(0,0)},t.inherits(e.b2ConstantForceController,e.b2Controller),e.b2ConstantForceController.prototype.F=null,e.b2ConstantForceController.prototype.Step=function(){for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;e.IsAwake()&&e.ApplyForce(this.F,e.GetWorldCenter())}},e}(e,c,i,o),v=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2Timer&&(e.b2Timer={}),e.b2Timer=function(){this.m_start=(new Date).getTime()},e.b2Timer.prototype.m_start=0,e.b2Timer.prototype.Reset=function(){return this.m_start=(new Date).getTime(),this},e.b2Timer.prototype.GetMilliseconds=function(){return(new Date).getTime()-this.m_start},e.b2Counter=function(){},e.b2Counter.prototype.m_count=0,e.b2Counter.prototype.m_min_count=0,e.b2Counter.prototype.m_max_count=0,e.b2Counter.prototype.GetCount=function(){return this.m_count},e.b2Counter.prototype.GetMinCount=function(){return this.m_min_count},e.b2Counter.prototype.GetMaxCount=function(){return this.m_max_count},e.b2Counter.prototype.ResetCount=function(){var t=this.m_count;return this.m_count=0,t},e.b2Counter.prototype.ResetMinCount=function(){this.m_min_count=0},e.b2Counter.prototype.ResetMaxCount=function(){this.m_max_count=0},e.b2Counter.prototype.Increment=function(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)},e.b2Counter.prototype.Decrement=function(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)},e}(e,o),x=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2TimeOfImpact&&(e.b2TimeOfImpact={}),e.b2_toiTime=0,e.b2_toiMaxTime=0,e.b2_toiCalls=0,e.b2_toiIters=0,e.b2_toiMaxIters=0,e.b2_toiRootIters=0,e.b2_toiMaxRootIters=0,e.b2TOIInput=function(){this.proxyA=new e.b2DistanceProxy,this.proxyB=new e.b2DistanceProxy,this.sweepA=new e.b2Sweep,this.sweepB=new e.b2Sweep},e.b2TOIInput.prototype.proxyA=null,e.b2TOIInput.prototype.proxyB=null,e.b2TOIInput.prototype.sweepA=null,e.b2TOIInput.prototype.sweepB=null,e.b2TOIInput.prototype.tMax=0,e.b2TOIOutputState={e_unknown:0,e_failed:1,e_overlapped:2,e_touching:3,e_separated:4},t.exportProperty(e.b2TOIOutputState,"e_unknown",e.b2TOIOutputState.e_unknown),t.exportProperty(e.b2TOIOutputState,"e_failed",e.b2TOIOutputState.e_failed),t.exportProperty(e.b2TOIOutputState,"e_overlapped",e.b2TOIOutputState.e_overlapped),t.exportProperty(e.b2TOIOutputState,"e_touching",e.b2TOIOutputState.e_touching),t.exportProperty(e.b2TOIOutputState,"e_separated",e.b2TOIOutputState.e_separated),e.b2TOIOutput=function(){},e.b2TOIOutput.prototype.state=e.b2TOIOutputState.e_unknown,e.b2TOIOutput.prototype.t=0,e.b2SeparationFunctionType={e_unknown:-1,e_points:0,e_faceA:1,e_faceB:2},t.exportProperty(e.b2SeparationFunctionType,"e_unknown",e.b2SeparationFunctionType.e_unknown),t.exportProperty(e.b2SeparationFunctionType,"e_points",e.b2SeparationFunctionType.e_points),t.exportProperty(e.b2SeparationFunctionType,"e_faceA",e.b2SeparationFunctionType.e_faceA),t.exportProperty(e.b2SeparationFunctionType,"e_faceB",e.b2SeparationFunctionType.e_faceB),e.b2SeparationFunction=function(){this.m_sweepA=new e.b2Sweep,this.m_sweepB=new e.b2Sweep,this.m_localPoint=new e.b2Vec2,this.m_axis=new e.b2Vec2},e.b2SeparationFunction.prototype.m_proxyA=null,e.b2SeparationFunction.prototype.m_proxyB=null,e.b2SeparationFunction.prototype.m_sweepA=null,e.b2SeparationFunction.prototype.m_sweepB=null,e.b2SeparationFunction.prototype.m_type=e.b2SeparationFunctionType.e_unknown,e.b2SeparationFunction.prototype.m_localPoint=null,e.b2SeparationFunction.prototype.m_axis=null,e.b2SeparationFunction.prototype.Initialize=function(t,o,i,n,s,r){this.m_proxyA=o,this.m_proxyB=n;var a=t.count;e.ENABLE_ASSERTS&&e.b2Assert(a>0&&3>a),this.m_sweepA.Copy(i),this.m_sweepB.Copy(s);var l=e.b2TimeOfImpact.s_xfA,p=e.b2TimeOfImpact.s_xfB;if(this.m_sweepA.GetTransform(l,r),this.m_sweepB.GetTransform(p,r),1==a){this.m_type=e.b2SeparationFunctionType.e_points;var m=this.m_proxyA.GetVertex(t.indexA[0]),_=this.m_proxyB.GetVertex(t.indexB[0]),b=e.b2MulXV(l,m,e.b2TimeOfImpact.s_pointA),h=e.b2MulXV(p,_,e.b2TimeOfImpact.s_pointB);e.b2SubVV(h,b,this.m_axis);var c=this.m_axis.Normalize();return c}if(t.indexA[0]==t.indexA[1]){this.m_type=e.b2SeparationFunctionType.e_faceB;var u=this.m_proxyB.GetVertex(t.indexB[0]),y=this.m_proxyB.GetVertex(t.indexB[1]);e.b2CrossVOne(e.b2SubVV(y,u,e.b2Vec2.s_t0),this.m_axis).SelfNormalize();var d=e.b2MulRV(p.q,this.m_axis,e.b2TimeOfImpact.s_normal);e.b2MidVV(u,y,this.m_localPoint);var h=e.b2MulXV(p,this.m_localPoint,e.b2TimeOfImpact.s_pointB),m=this.m_proxyA.GetVertex(t.indexA[0]),b=e.b2MulXV(l,m,e.b2TimeOfImpact.s_pointA),c=e.b2DotVV(e.b2SubVV(b,h,e.b2Vec2.s_t0),d);return 0>c&&(this.m_axis.SelfNeg(),c=-c),c}this.m_type=e.b2SeparationFunctionType.e_faceA;var f=this.m_proxyA.GetVertex(t.indexA[0]),A=this.m_proxyA.GetVertex(t.indexA[1]);e.b2CrossVOne(e.b2SubVV(A,f,e.b2Vec2.s_t0),this.m_axis).SelfNormalize();var d=e.b2MulRV(l.q,this.m_axis,e.b2TimeOfImpact.s_normal);e.b2MidVV(f,A,this.m_localPoint);var b=e.b2MulXV(l,this.m_localPoint,e.b2TimeOfImpact.s_pointA),_=this.m_proxyB.GetVertex(t.indexB[0]),h=e.b2MulXV(p,_,e.b2TimeOfImpact.s_pointB),c=e.b2DotVV(e.b2SubVV(h,b,e.b2Vec2.s_t0),d);return 0>c&&(this.m_axis.SelfNeg(),c=-c),c},e.b2SeparationFunction.prototype.FindMinSeparation=function(t,o,i){var n=e.b2TimeOfImpact.s_xfA,s=e.b2TimeOfImpact.s_xfB;switch(this.m_sweepA.GetTransform(n,i),this.m_sweepB.GetTransform(s,i),this.m_type){case e.b2SeparationFunctionType.e_points:var r=e.b2MulTRV(n.q,this.m_axis,e.b2TimeOfImpact.s_axisA),a=e.b2MulTRV(s.q,e.b2NegV(this.m_axis,e.b2Vec2.s_t0),e.b2TimeOfImpact.s_axisB);t[0]=this.m_proxyA.GetSupport(r),o[0]=this.m_proxyB.GetSupport(a);var l=this.m_proxyA.GetVertex(t[0]),p=this.m_proxyB.GetVertex(o[0]),m=e.b2MulXV(n,l,e.b2TimeOfImpact.s_pointA),_=e.b2MulXV(s,p,e.b2TimeOfImpact.s_pointB),b=e.b2DotVV(e.b2SubVV(_,m,e.b2Vec2.s_t0),this.m_axis);return b;case e.b2SeparationFunctionType.e_faceA:var h=e.b2MulRV(n.q,this.m_axis,e.b2TimeOfImpact.s_normal),m=e.b2MulXV(n,this.m_localPoint,e.b2TimeOfImpact.s_pointA),a=e.b2MulTRV(s.q,e.b2NegV(h,e.b2Vec2.s_t0),e.b2TimeOfImpact.s_axisB);t[0]=-1,o[0]=this.m_proxyB.GetSupport(a);var p=this.m_proxyB.GetVertex(o[0]),_=e.b2MulXV(s,p,e.b2TimeOfImpact.s_pointB),b=e.b2DotVV(e.b2SubVV(_,m,e.b2Vec2.s_t0),h);return b;case e.b2SeparationFunctionType.e_faceB:var h=e.b2MulRV(s.q,this.m_axis,e.b2TimeOfImpact.s_normal),_=e.b2MulXV(s,this.m_localPoint,e.b2TimeOfImpact.s_pointB),r=e.b2MulTRV(n.q,e.b2NegV(h,e.b2Vec2.s_t0),e.b2TimeOfImpact.s_axisA);o[0]=-1,t[0]=this.m_proxyA.GetSupport(r);var l=this.m_proxyA.GetVertex(t[0]),m=e.b2MulXV(n,l,e.b2TimeOfImpact.s_pointA),b=e.b2DotVV(e.b2SubVV(m,_,e.b2Vec2.s_t0),h);return b;default:return e.ENABLE_ASSERTS&&e.b2Assert(!1),t[0]=-1,o[0]=-1,0}},e.b2SeparationFunction.prototype.Evaluate=function(t,o,i){var n=e.b2TimeOfImpact.s_xfA,s=e.b2TimeOfImpact.s_xfB;switch(this.m_sweepA.GetTransform(n,i),this.m_sweepB.GetTransform(s,i),this.m_type){case e.b2SeparationFunctionType.e_points:var r=this.m_proxyA.GetVertex(t),a=this.m_proxyB.GetVertex(o),l=e.b2MulXV(n,r,e.b2TimeOfImpact.s_pointA),p=e.b2MulXV(s,a,e.b2TimeOfImpact.s_pointB),m=e.b2DotVV(e.b2SubVV(p,l,e.b2Vec2.s_t0),this.m_axis);return m;case e.b2SeparationFunctionType.e_faceA:var _=e.b2MulRV(n.q,this.m_axis,e.b2TimeOfImpact.s_normal),l=e.b2MulXV(n,this.m_localPoint,e.b2TimeOfImpact.s_pointA),a=this.m_proxyB.GetVertex(o),p=e.b2MulXV(s,a,e.b2TimeOfImpact.s_pointB),m=e.b2DotVV(e.b2SubVV(p,l,e.b2Vec2.s_t0),_);return m;case e.b2SeparationFunctionType.e_faceB:var _=e.b2MulRV(s.q,this.m_axis,e.b2TimeOfImpact.s_normal),p=e.b2MulXV(s,this.m_localPoint,e.b2TimeOfImpact.s_pointB),r=this.m_proxyA.GetVertex(t),l=e.b2MulXV(n,r,e.b2TimeOfImpact.s_pointA),m=e.b2DotVV(e.b2SubVV(l,p,e.b2Vec2.s_t0),_);return m;default:return e.ENABLE_ASSERTS&&e.b2Assert(!1),0}},e.b2TimeOfImpact=function(t,o){var i=e.b2TimeOfImpact.s_timer.Reset();++e.b2_toiCalls,t.state=e.b2TOIOutputState.e_unknown,t.t=o.tMax;var n=o.proxyA,s=o.proxyB,r=e.b2TimeOfImpact.s_sweepA.Copy(o.sweepA),a=e.b2TimeOfImpact.s_sweepB.Copy(o.sweepB);r.Normalize(),a.Normalize();var l=o.tMax,p=n.m_radius+s.m_radius,m=e.b2Max(e.b2_linearSlop,p-3*e.b2_linearSlop),_=.25*e.b2_linearSlop;e.ENABLE_ASSERTS&&e.b2Assert(m>_);var b=0,h=20,c=0,u=e.b2TimeOfImpact.s_cache;u.count=0;var y=e.b2TimeOfImpact.s_distanceInput;for(y.proxyA=o.proxyA,y.proxyB=o.proxyB,y.useRadii=!1;;){var d=e.b2TimeOfImpact.s_xfA,f=e.b2TimeOfImpact.s_xfB;r.GetTransform(d,b),a.GetTransform(f,b),y.transformA.Copy(d),y.transformB.Copy(f);var A=e.b2TimeOfImpact.s_distanceOutput;if(e.b2Distance(A,u,y),A.distance<=0){t.state=e.b2TOIOutputState.e_overlapped,t.t=0;break}if(A.distance<m+_){t.state=e.b2TOIOutputState.e_touching,t.t=b;break}var S=e.b2TimeOfImpact.s_fcn;S.Initialize(u,n,r,s,a,b);for(var C=!1,v=l,x=0;;){var V=e.b2TimeOfImpact.s_indexA,g=e.b2TimeOfImpact.s_indexB,B=S.FindMinSeparation(V,g,v);if(B>m+_){t.state=e.b2TOIOutputState.e_separated,t.t=l,C=!0;break}if(B>m-_){b=v;break}var w=S.Evaluate(V[0],g[0],b);if(m-_>w){t.state=e.b2TOIOutputState.e_failed,t.t=b,C=!0;break}if(m+_>=w){t.state=e.b2TOIOutputState.e_touching,t.t=b,C=!0;break}for(var M=0,J=b,P=v;;){var T=0;T=1&M?J+(m-w)*(P-J)/(B-w):.5*(J+P),++M,++e.b2_toiRootIters;var D=S.Evaluate(V[0],g[0],T);if(e.b2Abs(D-m)<_){v=T;break}if(D>m?(J=T,w=D):(P=T,B=D),50==M)break}if(e.b2_toiMaxRootIters=e.b2Max(e.b2_toiMaxRootIters,M),++x,x==e.b2_maxPolygonVertices)break}if(++c,++e.b2_toiIters,C)break;if(c==h){t.state=e.b2TOIOutputState.e_failed,t.t=b;break}}e.b2_toiMaxIters=e.b2Max(e.b2_toiMaxIters,c);var R=i.GetMilliseconds();e.b2_toiMaxTime=e.b2Max(e.b2_toiMaxTime,R),e.b2_toiTime+=R},e.b2TimeOfImpact.s_timer=new e.b2Timer,e.b2TimeOfImpact.s_cache=new e.b2SimplexCache,e.b2TimeOfImpact.s_distanceInput=new e.b2DistanceInput,e.b2TimeOfImpact.s_distanceOutput=new e.b2DistanceOutput,e.b2TimeOfImpact.s_xfA=new e.b2Transform,e.b2TimeOfImpact.s_xfB=new e.b2Transform,e.b2TimeOfImpact.s_indexA=e.b2MakeNumberArray(1),e.b2TimeOfImpact.s_indexB=e.b2MakeNumberArray(1),e.b2TimeOfImpact.s_fcn=new e.b2SeparationFunction,e.b2TimeOfImpact.s_sweepA=new e.b2Sweep,e.b2TimeOfImpact.s_sweepB=new e.b2Sweep,e.b2TimeOfImpact.s_pointA=new e.b2Vec2,e.b2TimeOfImpact.s_pointB=new e.b2Vec2,e.b2TimeOfImpact.s_normal=new e.b2Vec2,e.b2TimeOfImpact.s_axisA=new e.b2Vec2,e.b2TimeOfImpact.s_axisB=new e.b2Vec2,e}(e,r,i,o,v),V=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2Contact&&(e.b2Contact={}),e.b2MixFriction=function(t,o){return e.b2Sqrt(t*o)},e.b2MixRestitution=function(t,e){return t>e?t:e},e.b2ContactEdge=function(){},e.b2ContactEdge.prototype.other=null,e.b2ContactEdge.prototype.contact=null,e.b2ContactEdge.prototype.prev=null,e.b2ContactEdge.prototype.next=null,e.b2ContactFlag={e_none:0,e_islandFlag:1,e_touchingFlag:2,e_enabledFlag:4,e_filterFlag:8,e_bulletHitFlag:16,e_toiFlag:32},t.exportProperty(e.b2ContactFlag,"e_none",e.b2ContactFlag.e_none),t.exportProperty(e.b2ContactFlag,"e_islandFlag",e.b2ContactFlag.e_islandFlag),t.exportProperty(e.b2ContactFlag,"e_touchingFlag",e.b2ContactFlag.e_touchingFlag),t.exportProperty(e.b2ContactFlag,"e_enabledFlag",e.b2ContactFlag.e_enabledFlag),t.exportProperty(e.b2ContactFlag,"e_filterFlag",e.b2ContactFlag.e_filterFlag),t.exportProperty(e.b2ContactFlag,"e_bulletHitFlag",e.b2ContactFlag.e_bulletHitFlag),t.exportProperty(e.b2ContactFlag,"e_toiFlag",e.b2ContactFlag.e_toiFlag),e.b2Contact=function(){this.m_nodeA=new e.b2ContactEdge,this.m_nodeB=new e.b2ContactEdge,this.m_manifold=new e.b2Manifold,this.m_oldManifold=new e.b2Manifold},e.b2Contact.prototype.m_flags=e.b2ContactFlag.e_none,e.b2Contact.prototype.m_prev=null,e.b2Contact.prototype.m_next=null,e.b2Contact.prototype.m_nodeA=null,e.b2Contact.prototype.m_nodeB=null,e.b2Contact.prototype.m_fixtureA=null,e.b2Contact.prototype.m_fixtureB=null,e.b2Contact.prototype.m_indexA=0,e.b2Contact.prototype.m_indexB=0,e.b2Contact.prototype.m_manifold=null,e.b2Contact.prototype.m_toiCount=0,e.b2Contact.prototype.m_toi=0,e.b2Contact.prototype.m_friction=0,e.b2Contact.prototype.m_restitution=0,e.b2Contact.prototype.m_tangentSpeed=0,e.b2Contact.prototype.m_oldManifold=null,e.b2Contact.prototype.GetManifold=function(){return this.m_manifold\n},e.b2Contact.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody(),i=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),i.m_radius,o.GetTransform(),n.m_radius)},e.b2Contact.prototype.IsTouching=function(){return(this.m_flags&e.b2ContactFlag.e_touchingFlag)==e.b2ContactFlag.e_touchingFlag},e.b2Contact.prototype.SetEnabled=function(t){t?this.m_flags|=e.b2ContactFlag.e_enabledFlag:this.m_flags&=~e.b2ContactFlag.e_enabledFlag},e.b2Contact.prototype.IsEnabled=function(){return(this.m_flags&e.b2ContactFlag.e_enabledFlag)==e.b2ContactFlag.e_enabledFlag},e.b2Contact.prototype.GetNext=function(){return this.m_next},e.b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA},e.b2Contact.prototype.GetChildIndexA=function(){return this.m_indexA},e.b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB},e.b2Contact.prototype.GetChildIndexB=function(){return this.m_indexB},e.b2Contact.prototype.Evaluate=function(){},e.b2Contact.prototype.FlagForFiltering=function(){this.m_flags|=e.b2ContactFlag.e_filterFlag},e.b2Contact.prototype.SetFriction=function(t){this.m_friction=t},e.b2Contact.prototype.GetFriction=function(){return this.m_friction},e.b2Contact.prototype.ResetFriction=function(){this.m_friction=e.b2MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},e.b2Contact.prototype.SetRestitution=function(t){this.m_restitution=t},e.b2Contact.prototype.GetRestitution=function(){return this.m_restitution},e.b2Contact.prototype.ResetRestitution=function(){this.m_restitution=e.b2MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},e.b2Contact.prototype.SetTangentSpeed=function(t){this.m_tangentSpeed=t},e.b2Contact.prototype.GetTangentSpeed=function(){return this.m_tangentSpeed},e.b2Contact.prototype.Reset=function(t,o,i,n){this.m_flags=e.b2ContactFlag.e_enabledFlag,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=o,this.m_indexB=n,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null,this.m_toiCount=0,this.m_friction=e.b2MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=e.b2MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},e.b2Contact.prototype.Update=function(t){var o=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=o,this.m_flags|=e.b2ContactFlag.e_enabledFlag;var i=!1,n=(this.m_flags&e.b2ContactFlag.e_touchingFlag)==e.b2ContactFlag.e_touchingFlag,s=this.m_fixtureA.IsSensor(),r=this.m_fixtureB.IsSensor(),a=s||r,l=this.m_fixtureA.GetBody(),p=this.m_fixtureB.GetBody(),m=l.GetTransform(),_=p.GetTransform();if(a){var b=this.m_fixtureA.GetShape(),h=this.m_fixtureB.GetShape();i=e.b2TestOverlapShape(b,this.m_indexA,h,this.m_indexB,m,_),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,m,_),i=this.m_manifold.pointCount>0;for(var c=0;c<this.m_manifold.pointCount;++c){var u=this.m_manifold.points[c];u.normalImpulse=0,u.tangentImpulse=0;for(var y=u.id,d=0;d<this.m_oldManifold.pointCount;++d){var f=this.m_oldManifold.points[d];if(f.id.key==y.key){u.normalImpulse=f.normalImpulse,u.tangentImpulse=f.tangentImpulse;break}}}i!=n&&(l.SetAwake(!0),p.SetAwake(!0))}i?this.m_flags|=e.b2ContactFlag.e_touchingFlag:this.m_flags&=~e.b2ContactFlag.e_touchingFlag,0==n&&1==i&&t&&t.BeginContact(this),1==n&&0==i&&t&&t.EndContact(this),0==a&&i&&t&&t.PreSolve(this,this.m_oldManifold)},e.b2Contact.prototype.ComputeTOI=function(t,o){var i=e.b2Contact.prototype.ComputeTOI.s_input;i.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA),i.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB),i.sweepA.Copy(t),i.sweepB.Copy(o),i.tMax=e.b2_linearSlop;var n=e.b2Contact.prototype.ComputeTOI.s_output;return e.b2TimeOfImpact(n,i),n.t},e.b2Contact.prototype.ComputeTOI.s_input=new e.b2TOIInput,e.b2Contact.prototype.ComputeTOI.s_output=new e.b2TOIOutput,e}(e,a,o,x),g=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2DistanceJoint&&(e.b2DistanceJoint={}),e.b2DistanceJointDef=function(){t.base(this,e.b2JointType.e_distanceJoint),this.localAnchorA=new e.b2Vec2,this.localAnchorB=new e.b2Vec2},t.inherits(e.b2DistanceJointDef,e.b2JointDef),e.b2DistanceJointDef.prototype.localAnchorA=null,e.b2DistanceJointDef.prototype.localAnchorB=null,e.b2DistanceJointDef.prototype.length=1,e.b2DistanceJointDef.prototype.frequencyHz=0,e.b2DistanceJointDef.prototype.dampingRatio=0,e.b2DistanceJointDef.prototype.Initialize=function(t,o,i,n){this.bodyA=t,this.bodyB=o,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.length=e.b2DistanceVV(i,n),this.frequencyHz=0,this.dampingRatio=0},e.b2DistanceJoint=function(o){t.base(this,o),this.m_u=new e.b2Vec2,this.m_rA=new e.b2Vec2,this.m_rB=new e.b2Vec2,this.m_localCenterA=new e.b2Vec2,this.m_localCenterB=new e.b2Vec2,this.m_qA=new e.b2Rot,this.m_qB=new e.b2Rot,this.m_lalcA=new e.b2Vec2,this.m_lalcB=new e.b2Vec2,this.m_frequencyHz=o.frequencyHz,this.m_dampingRatio=o.dampingRatio,this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_length=o.length},t.inherits(e.b2DistanceJoint,e.b2Joint),e.b2DistanceJoint.prototype.m_frequencyHz=0,e.b2DistanceJoint.prototype.m_dampingRatio=0,e.b2DistanceJoint.prototype.m_bias=0,e.b2DistanceJoint.prototype.m_localAnchorA=null,e.b2DistanceJoint.prototype.m_localAnchorB=null,e.b2DistanceJoint.prototype.m_gamma=0,e.b2DistanceJoint.prototype.m_impulse=0,e.b2DistanceJoint.prototype.m_length=0,e.b2DistanceJoint.prototype.m_indexA=0,e.b2DistanceJoint.prototype.m_indexB=0,e.b2DistanceJoint.prototype.m_u=null,e.b2DistanceJoint.prototype.m_rA=null,e.b2DistanceJoint.prototype.m_rB=null,e.b2DistanceJoint.prototype.m_localCenterA=null,e.b2DistanceJoint.prototype.m_localCenterB=null,e.b2DistanceJoint.prototype.m_invMassA=0,e.b2DistanceJoint.prototype.m_invMassB=0,e.b2DistanceJoint.prototype.m_invIA=0,e.b2DistanceJoint.prototype.m_invIB=0,e.b2DistanceJoint.prototype.m_mass=0,e.b2DistanceJoint.prototype.m_qA=null,e.b2DistanceJoint.prototype.m_qB=null,e.b2DistanceJoint.prototype.m_lalcA=null,e.b2DistanceJoint.prototype.m_lalcB=null,e.b2DistanceJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.b2DistanceJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.b2DistanceJoint.prototype.GetReactionForce=function(t,e){return e.Set(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)},e.b2DistanceJoint.prototype.GetReactionTorque=function(){return 0},e.b2DistanceJoint.prototype.GetLocalAnchorA=function(t){return t.Copy(this.m_localAnchorA)},e.b2DistanceJoint.prototype.GetLocalAnchorB=function(t){return t.Copy(this.m_localAnchorB)},e.b2DistanceJoint.prototype.SetLength=function(t){this.m_length=t},e.b2DistanceJoint.prototype.GetLength=function(){return this.m_length},e.b2DistanceJoint.prototype.SetFrequency=function(t){this.m_frequencyHz=t},e.b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},e.b2DistanceJoint.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},e.b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},e.b2DistanceJoint.prototype.Dump=function(){if(e.DEBUG){var t=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;e.b2Log("  /*box2d.b2DistanceJointDef*/ var jd = new box2d.b2DistanceJointDef();\\n"),e.b2Log("  jd.bodyA = bodies[%d];\\n",t),e.b2Log("  jd.bodyB = bodies[%d];\\n",o),e.b2Log("  jd.collideConnected = %s;\\n",this.m_collideConnected?"true":"false"),e.b2Log("  jd.localAnchorA.Set(%.15f, %.15f);\\n",this.m_localAnchorA.x,this.m_localAnchorA.y),e.b2Log("  jd.localAnchorB.Set(%.15f, %.15f);\\n",this.m_localAnchorB.x,this.m_localAnchorB.y),e.b2Log("  jd.length = %.15f;\\n",this.m_length),e.b2Log("  jd.frequencyHz = %.15f;\\n",this.m_frequencyHz),e.b2Log("  jd.dampingRatio = %.15f;\\n",this.m_dampingRatio),e.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\\n",this.m_index)}},e.b2DistanceJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,p=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngleRadians(i),_=this.m_qB.SetAngleRadians(a);e.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),e.b2MulRV(m,this.m_lalcA,this.m_rA),e.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),e.b2MulRV(_,this.m_lalcB,this.m_rB),this.m_u.x=r.x+this.m_rB.x-o.x-this.m_rA.x,this.m_u.y=r.y+this.m_rB.y-o.y-this.m_rA.y;var b=this.m_u.GetLength();b>e.b2_linearSlop?this.m_u.SelfMul(1/b):this.m_u.SetZero();var h=e.b2CrossVV(this.m_rA,this.m_u),c=e.b2CrossVV(this.m_rB,this.m_u),u=this.m_invMassA+this.m_invIA*h*h+this.m_invMassB+this.m_invIB*c*c;if(this.m_mass=0!=u?1/u:0,this.m_frequencyHz>0){var y=b-this.m_length,d=2*e.b2_pi*this.m_frequencyHz,f=2*this.m_mass*this.m_dampingRatio*d,A=this.m_mass*d*d,S=t.step.dt;this.m_gamma=S*(f+S*A),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=y*S*A*this.m_gamma,u+=this.m_gamma,this.m_mass=0!=u?1/u:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var C=e.b2MulSV(this.m_impulse,this.m_u,e.b2DistanceJoint.prototype.InitVelocityConstraints.s_P);n.SelfMulSub(this.m_invMassA,C),s-=this.m_invIA*e.b2CrossVV(this.m_rA,C),l.SelfMulAdd(this.m_invMassB,C),p+=this.m_invIB*e.b2CrossVV(this.m_rB,C)}else this.m_impulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=p},e.b2DistanceJoint.prototype.InitVelocityConstraints.s_P=new e.b2Vec2,e.b2DistanceJoint.prototype.SolveVelocityConstraints=function(t){var o=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,r=e.b2AddVCrossSV(o,i,this.m_rA,e.b2DistanceJoint.prototype.SolveVelocityConstraints.s_vpA),a=e.b2AddVCrossSV(n,s,this.m_rB,e.b2DistanceJoint.prototype.SolveVelocityConstraints.s_vpB),l=e.b2DotVV(this.m_u,e.b2SubVV(a,r,e.b2Vec2.s_t0)),p=-this.m_mass*(l+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=p;var m=e.b2MulSV(p,this.m_u,e.b2DistanceJoint.prototype.SolveVelocityConstraints.s_P);o.SelfMulSub(this.m_invMassA,m),i-=this.m_invIA*e.b2CrossVV(this.m_rA,m),n.SelfMulAdd(this.m_invMassB,m),s+=this.m_invIB*e.b2CrossVV(this.m_rB,m),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s},e.b2DistanceJoint.prototype.SolveVelocityConstraints.s_vpA=new e.b2Vec2,e.b2DistanceJoint.prototype.SolveVelocityConstraints.s_vpB=new e.b2Vec2,e.b2DistanceJoint.prototype.SolveVelocityConstraints.s_P=new e.b2Vec2,e.b2DistanceJoint.prototype.SolvePositionConstraints=function(t){if(this.m_frequencyHz>0)return!0;var o=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,r=(this.m_qA.SetAngleRadians(i),this.m_qB.SetAngleRadians(s),e.b2MulRV(this.m_qA,this.m_lalcA,this.m_rA)),a=e.b2MulRV(this.m_qB,this.m_lalcB,this.m_rB),l=this.m_u;l.x=n.x+a.x-o.x-r.x,l.y=n.y+a.y-o.y-r.y;var p=this.m_u.Normalize(),m=p-this.m_length;m=e.b2Clamp(m,-e.b2_maxLinearCorrection,e.b2_maxLinearCorrection);var _=-this.m_mass*m,b=e.b2MulSV(_,l,e.b2DistanceJoint.prototype.SolvePositionConstraints.s_P);return o.SelfMulSub(this.m_invMassA,b),i-=this.m_invIA*e.b2CrossVV(r,b),n.SelfMulAdd(this.m_invMassB,b),s+=this.m_invIB*e.b2CrossVV(a,b),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,e.b2Abs(m)<e.b2_linearSlop},e.b2DistanceJoint.prototype.SolvePositionConstraints.s_P=new e.b2Vec2,e}(e,n,i,o),B=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2Draw&&(e.b2Draw={}),e.b2Color=function(t,e,o){this.r=t,this.g=e,this.b=o},e.b2Color.prototype.r=.5,e.b2Color.prototype.g=.5,e.b2Color.prototype.b=.5,e.b2Color.prototype.SetRGB=function(t,e,o){return this.r=t,this.g=e,this.b=o,this},e.b2Color.prototype.MakeStyleString=function(t){var o=Math.round(Math.max(0,Math.min(255,255*this.r))),i=Math.round(Math.max(0,Math.min(255,255*this.g))),n=Math.round(Math.max(0,Math.min(255,255*this.b))),s="undefined"==typeof t?1:Math.max(0,Math.min(1,t));return e.b2Color.MakeStyleString(o,i,n,s)},e.b2Color.MakeStyleString=function(t,e,o,i){return 1>i?"rgba("+t+","+e+","+o+","+i+")":"rgb("+t+","+e+","+o+")"},e.b2Color.RED=new e.b2Color(1,0,0),e.b2Color.GREEN=new e.b2Color(0,1,0),e.b2Color.BLUE=new e.b2Color(0,0,1),e.b2DrawFlags={e_none:0,e_shapeBit:1,e_jointBit:2,e_aabbBit:4,e_pairBit:8,e_centerOfMassBit:16,e_controllerBit:32,e_all:63},t.exportProperty(e.b2DrawFlags,"e_none",e.b2DrawFlags.e_none),t.exportProperty(e.b2DrawFlags,"e_shapeBit",e.b2DrawFlags.e_shapeBit),t.exportProperty(e.b2DrawFlags,"e_jointBit",e.b2DrawFlags.e_jointBit),t.exportProperty(e.b2DrawFlags,"e_aabbBit",e.b2DrawFlags.e_aabbBit),t.exportProperty(e.b2DrawFlags,"e_pairBit",e.b2DrawFlags.e_pairBit),t.exportProperty(e.b2DrawFlags,"e_centerOfMassBit",e.b2DrawFlags.e_centerOfMassBit),t.exportProperty(e.b2DrawFlags,"e_controllerBit",e.b2DrawFlags.e_controllerBit),t.exportProperty(e.b2DrawFlags,"e_all",e.b2DrawFlags.e_all),e.b2Draw=function(){},e.b2Draw.prototype.m_drawFlags=e.b2DrawFlags.e_none,e.b2Draw.prototype.SetFlags=function(t){this.m_drawFlags=t},e.b2Draw.prototype.GetFlags=function(){return this.m_drawFlags},e.b2Draw.prototype.AppendFlags=function(t){this.m_drawFlags|=t},e.b2Draw.prototype.ClearFlags=function(t){this.m_drawFlags&=~t},e.b2Draw.prototype.PushTransform=function(){},e.b2Draw.prototype.PopTransform=function(){},e.b2Draw.prototype.DrawPolygon=function(){},e.b2Draw.prototype.DrawSolidPolygon=function(){},e.b2Draw.prototype.DrawCircle=function(){},e.b2Draw.prototype.DrawSolidCircle=function(){},e.b2Draw.prototype.DrawSegment=function(){},e.b2Draw.prototype.DrawTransform=function(){},e}(e,o),w=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2FrictionJoint&&(e.b2FrictionJoint={}),e.b2FrictionJointDef=function(){t.base(this,e.b2JointType.e_frictionJoint),this.localAnchorA=new e.b2Vec2,this.localAnchorB=new e.b2Vec2},t.inherits(e.b2FrictionJointDef,e.b2JointDef),e.b2FrictionJointDef.prototype.localAnchorA=null,e.b2FrictionJointDef.prototype.localAnchorB=null,e.b2FrictionJointDef.prototype.maxForce=0,e.b2FrictionJointDef.prototype.maxTorque=0,e.b2FrictionJointDef.prototype.Initialize=function(t,e,o){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB)},e.b2FrictionJoint=function(o){t.base(this,o),this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_linearImpulse=(new e.b2Vec2).SetZero(),this.m_maxForce=o.maxForce,this.m_maxTorque=o.maxTorque,this.m_rA=new e.b2Vec2,this.m_rB=new e.b2Vec2,this.m_localCenterA=new e.b2Vec2,this.m_localCenterB=new e.b2Vec2,this.m_linearMass=(new e.b2Mat22).SetZero(),this.m_qA=new e.b2Rot,this.m_qB=new e.b2Rot,this.m_lalcA=new e.b2Vec2,this.m_lalcB=new e.b2Vec2,this.m_K=new e.b2Mat22},t.inherits(e.b2FrictionJoint,e.b2Joint),e.b2FrictionJoint.prototype.m_localAnchorA=null,e.b2FrictionJoint.prototype.m_localAnchorB=null,e.b2FrictionJoint.prototype.m_linearImpulse=null,e.b2FrictionJoint.prototype.m_angularImpulse=0,e.b2FrictionJoint.prototype.m_maxForce=0,e.b2FrictionJoint.prototype.m_maxTorque=0,e.b2FrictionJoint.prototype.m_indexA=0,e.b2FrictionJoint.prototype.m_indexB=0,e.b2FrictionJoint.prototype.m_rA=null,e.b2FrictionJoint.prototype.m_rB=null,e.b2FrictionJoint.prototype.m_localCenterA=null,e.b2FrictionJoint.prototype.m_localCenterB=null,e.b2FrictionJoint.prototype.m_invMassA=0,e.b2FrictionJoint.prototype.m_invMassB=0,e.b2FrictionJoint.prototype.m_invIA=0,e.b2FrictionJoint.prototype.m_invIB=0,e.b2FrictionJoint.prototype.m_linearMass=null,e.b2FrictionJoint.prototype.m_angularMass=0,e.b2FrictionJoint.prototype.m_qA=null,e.b2FrictionJoint.prototype.m_qB=null,e.b2FrictionJoint.prototype.m_lalcA=null,e.b2FrictionJoint.prototype.m_lalcB=null,e.b2FrictionJoint.prototype.m_K=null,e.b2FrictionJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngleRadians(o),p=this.m_qB.SetAngleRadians(s);e.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var m=e.b2MulRV(l,this.m_lalcA,this.m_rA);e.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var _=e.b2MulRV(p,this.m_lalcB,this.m_rB),b=this.m_invMassA,h=this.m_invMassB,c=this.m_invIA,u=this.m_invIB,y=this.m_K;if(y.ex.x=b+h+c*m.y*m.y+u*_.y*_.y,y.ex.y=-c*m.x*m.y-u*_.x*_.y,y.ey.x=y.ex.y,y.ey.y=b+h+c*m.x*m.x+u*_.x*_.x,y.GetInverse(this.m_linearMass),this.m_angularMass=c+u,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var d=this.m_linearImpulse;i.SelfMulSub(b,d),n-=c*(e.b2CrossVV(this.m_rA,d)+this.m_angularImpulse),r.SelfMulAdd(h,d),a+=u*(e.b2CrossVV(this.m_rB,d)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=a},e.b2FrictionJoint.prototype.SolveVelocityConstraints=function(t){var o=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,p=this.m_invIB,m=t.step.dt,_=s-i,b=-this.m_angularMass*_,h=this.m_angularImpulse,c=m*this.m_maxTorque;this.m_angularImpulse=e.b2Clamp(this.m_angularImpulse+b,-c,c),b=this.m_angularImpulse-h,i-=l*b,s+=p*b;var _=e.b2SubVV(e.b2AddVCrossSV(n,s,this.m_rB,e.b2Vec2.s_t0),e.b2AddVCrossSV(o,i,this.m_rA,e.b2Vec2.s_t1),e.b2FrictionJoint.prototype.SolveVelocityConstraints.s_Cdot),u=e.b2MulMV(this.m_linearMass,_,e.b2FrictionJoint.prototype.SolveVelocityConstraints.s_impulseV).SelfNeg(),y=e.b2FrictionJoint.prototype.SolveVelocityConstraints.s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(u);var c=m*this.m_maxForce;this.m_linearImpulse.GetLengthSquared()>c*c&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(c)),e.b2SubVV(this.m_linearImpulse,y,u),o.SelfMulSub(r,u),i-=l*e.b2CrossVV(this.m_rA,u),n.SelfMulAdd(a,u),s+=p*e.b2CrossVV(this.m_rB,u),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s},e.b2FrictionJoint.prototype.SolveVelocityConstraints.s_Cdot=new e.b2Vec2,e.b2FrictionJoint.prototype.SolveVelocityConstraints.s_impulseV=new e.b2Vec2,e.b2FrictionJoint.prototype.SolveVelocityConstraints.s_oldImpulseV=new e.b2Vec2,e.b2FrictionJoint.prototype.SolvePositionConstraints=function(){return!0},e.b2FrictionJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.b2FrictionJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.b2FrictionJoint.prototype.GetReactionForce=function(t,e){return e.Set(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)},e.b2FrictionJoint.prototype.GetReactionTorque=function(t){return t*this.m_angularImpulse},e.b2FrictionJoint.prototype.GetLocalAnchorA=function(t){return t.Copy(this.m_localAnchorA)},e.b2FrictionJoint.prototype.GetLocalAnchorB=function(t){return t.Copy(this.m_localAnchorB)},e.b2FrictionJoint.prototype.SetMaxForce=function(t){this.m_maxForce=t},e.b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce},e.b2FrictionJoint.prototype.SetMaxTorque=function(t){this.m_maxTorque=t},e.b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},e.b2FrictionJoint.prototype.Dump=function(){if(e.DEBUG){var t=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;e.b2Log("  /*box2d.b2FrictionJointDef*/ var jd = new box2d.b2FrictionJointDef();\\n"),e.b2Log("  jd.bodyA = bodies[%d];\\n",t),e.b2Log("  jd.bodyB = bodies[%d];\\n",o),e.b2Log("  jd.collideConnected = %s;\\n",this.m_collideConnected?"true":"false"),e.b2Log("  jd.localAnchorA.Set(%.15f, %.15f);\\n",this.m_localAnchorA.x,this.m_localAnchorA.y),e.b2Log("  jd.localAnchorB.Set(%.15f, %.15f);\\n",this.m_localAnchorB.x,this.m_localAnchorB.y),e.b2Log("  jd.maxForce = %.15f;\\n",this.m_maxForce),e.b2Log("  jd.maxTorque = %.15f;\\n",this.m_maxTorque),e.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\\n",this.m_index)}},e}(e,n,i,o),M=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2PrismaticJoint&&(e.b2PrismaticJoint={}),e.b2PrismaticJointDef=function(){t.base(this,e.b2JointType.e_prismaticJoint),this.localAnchorA=new e.b2Vec2,this.localAnchorB=new e.b2Vec2,this.localAxisA=new e.b2Vec2(1,0)},t.inherits(e.b2PrismaticJointDef,e.b2JointDef),e.b2PrismaticJointDef.prototype.localAnchorA=null,e.b2PrismaticJointDef.prototype.localAnchorB=null,e.b2PrismaticJointDef.prototype.localAxisA=null,e.b2PrismaticJointDef.prototype.referenceAngle=0,e.b2PrismaticJointDef.prototype.enableLimit=!1,e.b2PrismaticJointDef.prototype.lowerTranslation=0,e.b2PrismaticJointDef.prototype.upperTranslation=0,e.b2PrismaticJointDef.prototype.enableMotor=!1,e.b2PrismaticJointDef.prototype.maxMotorForce=0,e.b2PrismaticJointDef.prototype.motorSpeed=0,e.b2PrismaticJointDef.prototype.Initialize=function(t,e,o,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.bodyA.GetLocalVector(i,this.localAxisA),this.referenceAngle=this.bodyB.GetAngleRadians()-this.bodyA.GetAngleRadians()},e.b2PrismaticJoint=function(o){t.base(this,o),this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_localXAxisA=o.localAxisA.Clone().SelfNormalize(),this.m_localYAxisA=e.b2CrossOneV(this.m_localXAxisA,new e.b2Vec2),this.m_referenceAngle=o.referenceAngle,this.m_impulse=new e.b2Vec3(0,0,0),this.m_lowerTranslation=o.lowerTranslation,this.m_upperTranslation=o.upperTranslation,this.m_maxMotorForce=o.maxMotorForce,this.m_motorSpeed=o.motorSpeed,this.m_enableLimit=o.enableLimit,this.m_enableMotor=o.enableMotor,this.m_localCenterA=new e.b2Vec2,this.m_localCenterB=new e.b2Vec2,this.m_axis=new e.b2Vec2(0,0),this.m_perp=new e.b2Vec2(0,0),this.m_K=new e.b2Mat33,this.m_K3=new e.b2Mat33,this.m_K2=new e.b2Mat22,this.m_qA=new e.b2Rot,this.m_qB=new e.b2Rot,this.m_lalcA=new e.b2Vec2,this.m_lalcB=new e.b2Vec2,this.m_rA=new e.b2Vec2,this.m_rB=new e.b2Vec2},t.inherits(e.b2PrismaticJoint,e.b2Joint),e.b2PrismaticJoint.prototype.m_localAnchorA=null,e.b2PrismaticJoint.prototype.m_localAnchorB=null,e.b2PrismaticJoint.prototype.m_localXAxisA=null,e.b2PrismaticJoint.prototype.m_localYAxisA=null,e.b2PrismaticJoint.prototype.m_referenceAngle=0,e.b2PrismaticJoint.prototype.m_impulse=null,e.b2PrismaticJoint.prototype.m_motorImpulse=0,e.b2PrismaticJoint.prototype.m_lowerTranslation=0,e.b2PrismaticJoint.prototype.m_upperTranslation=0,e.b2PrismaticJoint.prototype.m_maxMotorForce=0,e.b2PrismaticJoint.prototype.m_motorSpeed=0,e.b2PrismaticJoint.prototype.m_enableLimit=!1,e.b2PrismaticJoint.prototype.m_enableMotor=!1,e.b2PrismaticJoint.prototype.m_limitState=e.b2LimitState.e_inactiveLimit,e.b2PrismaticJoint.prototype.m_indexA=0,e.b2PrismaticJoint.prototype.m_indexB=0,e.b2PrismaticJoint.prototype.m_localCenterA=null,e.b2PrismaticJoint.prototype.m_localCenterB=null,e.b2PrismaticJoint.prototype.m_invMassA=0,e.b2PrismaticJoint.prototype.m_invMassB=0,e.b2PrismaticJoint.prototype.m_invIA=0,e.b2PrismaticJoint.prototype.m_invIB=0,e.b2PrismaticJoint.prototype.m_axis=null,e.b2PrismaticJoint.prototype.m_perp=null,e.b2PrismaticJoint.prototype.m_s1=0,e.b2PrismaticJoint.prototype.m_s2=0,e.b2PrismaticJoint.prototype.m_a1=0,e.b2PrismaticJoint.prototype.m_a2=0,e.b2PrismaticJoint.prototype.m_K=null,e.b2PrismaticJoint.prototype.m_K3=null,e.b2PrismaticJoint.prototype.m_K2=null,e.b2PrismaticJoint.prototype.m_motorMass=0,e.b2PrismaticJoint.prototype.m_qA=null,e.b2PrismaticJoint.prototype.m_qB=null,e.b2PrismaticJoint.prototype.m_lalcA=null,e.b2PrismaticJoint.prototype.m_lalcB=null,e.b2PrismaticJoint.prototype.m_rA=null,e.b2PrismaticJoint.prototype.m_rB=null,e.b2PrismaticJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,p=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngleRadians(i),_=this.m_qB.SetAngleRadians(a);e.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var b=e.b2MulRV(m,this.m_lalcA,this.m_rA);e.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var h=e.b2MulRV(_,this.m_lalcB,this.m_rB),c=e.b2AddVV(e.b2SubVV(r,o,e.b2Vec2.s_t0),e.b2SubVV(h,b,e.b2Vec2.s_t1),e.b2PrismaticJoint.prototype.InitVelocityConstraints.s_d),u=this.m_invMassA,y=this.m_invMassB,d=this.m_invIA,f=this.m_invIB;if(e.b2MulRV(m,this.m_localXAxisA,this.m_axis),this.m_a1=e.b2CrossVV(e.b2AddVV(c,b,e.b2Vec2.s_t0),this.m_axis),this.m_a2=e.b2CrossVV(h,this.m_axis),this.m_motorMass=u+y+d*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),e.b2MulRV(m,this.m_localYAxisA,this.m_perp),this.m_s1=e.b2CrossVV(e.b2AddVV(c,b,e.b2Vec2.s_t0),this.m_perp),this.m_s2=e.b2CrossVV(h,this.m_perp),this.m_K.ex.x=u+y+d*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,this.m_K.ex.y=d*this.m_s1+f*this.m_s2,this.m_K.ex.z=d*this.m_s1*this.m_a1+f*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=d+f,0==this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=d*this.m_a1+f*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=u+y+d*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_enableLimit){var A=e.b2DotVV(this.m_axis,c);e.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop?this.m_limitState=e.b2LimitState.e_equalLimits:A<=this.m_lowerTranslation?this.m_limitState!=e.b2LimitState.e_atLowerLimit&&(this.m_limitState=e.b2LimitState.e_atLowerLimit,this.m_impulse.z=0):A>=this.m_upperTranslation?this.m_limitState!=e.b2LimitState.e_atUpperLimit&&(this.m_limitState=e.b2LimitState.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=e.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=e.b2LimitState.e_inactiveLimit,this.m_impulse.z=0;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var S=e.b2AddVV(e.b2MulSV(this.m_impulse.x,this.m_perp,e.b2Vec2.s_t0),e.b2MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,e.b2Vec2.s_t1),e.b2PrismaticJoint.prototype.InitVelocityConstraints.s_P),C=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,v=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.SelfMulSub(u,S),s-=d*C,l.SelfMulAdd(y,S),p+=f*v}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=p},e.b2PrismaticJoint.prototype.InitVelocityConstraints.s_d=new e.b2Vec2,e.b2PrismaticJoint.prototype.InitVelocityConstraints.s_P=new e.b2Vec2,e.b2PrismaticJoint.prototype.SolveVelocityConstraints=function(t){var o=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,p=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=e.b2LimitState.e_equalLimits){var m=e.b2DotVV(this.m_axis,e.b2SubVV(n,o,e.b2Vec2.s_t0))+this.m_a2*s-this.m_a1*i,_=this.m_motorMass*(this.m_motorSpeed-m),b=this.m_motorImpulse,h=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=e.b2Clamp(this.m_motorImpulse+_,-h,h),_=this.m_motorImpulse-b;var c=e.b2MulSV(_,this.m_axis,e.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_P),u=_*this.m_a1,y=_*this.m_a2;o.SelfMulSub(r,c),i-=l*u,n.SelfMulAdd(a,c),s+=p*y}var d=e.b2DotVV(this.m_perp,e.b2SubVV(n,o,e.b2Vec2.s_t0))+this.m_s2*s-this.m_s1*i,f=s-i;if(this.m_enableLimit&&this.m_limitState!=e.b2LimitState.e_inactiveLimit){var A=e.b2DotVV(this.m_axis,e.b2SubVV(n,o,e.b2Vec2.s_t0))+this.m_a2*s-this.m_a1*i,S=e.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_f1.Copy(this.m_impulse),C=this.m_K.Solve33(-d,-f,-A,e.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_df3);this.m_impulse.SelfAdd(C),this.m_limitState==e.b2LimitState.e_atLowerLimit?this.m_impulse.z=e.b2Max(this.m_impulse.z,0):this.m_limitState==e.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=e.b2Min(this.m_impulse.z,0));var v=-d-(this.m_impulse.z-S.z)*this.m_K.ez.x,x=-f-(this.m_impulse.z-S.z)*this.m_K.ez.y,V=this.m_K.Solve22(v,x,e.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_f2r);V.x+=S.x,V.y+=S.y,this.m_impulse.x=V.x,this.m_impulse.y=V.y,C.x=this.m_impulse.x-S.x,C.y=this.m_impulse.y-S.y,C.z=this.m_impulse.z-S.z;var c=e.b2AddVV(e.b2MulSV(C.x,this.m_perp,e.b2Vec2.s_t0),e.b2MulSV(C.z,this.m_axis,e.b2Vec2.s_t1),e.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_P),u=C.x*this.m_s1+C.y+C.z*this.m_a1,y=C.x*this.m_s2+C.y+C.z*this.m_a2;o.SelfMulSub(r,c),i-=l*u,n.SelfMulAdd(a,c),s+=p*y}else{var C=this.m_K.Solve22(-d,-f,e.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_df2);this.m_impulse.x+=C.x,this.m_impulse.y+=C.y;var c=e.b2MulSV(C.x,this.m_perp,e.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_P),u=C.x*this.m_s1+C.y,y=C.x*this.m_s2+C.y;o.SelfMulSub(r,c),i-=l*u,n.SelfMulAdd(a,c),s+=p*y}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s},e.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_P=new e.b2Vec2,e.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_f2r=new e.b2Vec2,e.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_f1=new e.b2Vec3,e.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_df3=new e.b2Vec3,e.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_df2=new e.b2Vec2,e.b2PrismaticJoint.prototype.SolvePositionConstraints=function(t){var o=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,r=this.m_qA.SetAngleRadians(i),a=this.m_qB.SetAngleRadians(s),l=this.m_invMassA,p=this.m_invMassB,m=this.m_invIA,_=this.m_invIB,b=e.b2MulRV(r,this.m_lalcA,this.m_rA),h=e.b2MulRV(a,this.m_lalcB,this.m_rB),c=e.b2SubVV(e.b2AddVV(n,h,e.b2Vec2.s_t0),e.b2AddVV(o,b,e.b2Vec2.s_t1),e.b2PrismaticJoint.prototype.SolvePositionConstraints.s_d),u=e.b2MulRV(r,this.m_localXAxisA,this.m_axis),y=e.b2CrossVV(e.b2AddVV(c,b,e.b2Vec2.s_t0),u),d=e.b2CrossVV(h,u),f=e.b2MulRV(r,this.m_localYAxisA,this.m_perp),A=e.b2CrossVV(e.b2AddVV(c,b,e.b2Vec2.s_t0),f),S=e.b2CrossVV(h,f),C=e.b2PrismaticJoint.prototype.SolvePositionConstraints.s_impulse,v=e.b2DotVV(f,c),x=s-i-this.m_referenceAngle,V=e.b2Abs(v),g=e.b2Abs(x),B=!1,w=0;\nif(this.m_enableLimit){var M=e.b2DotVV(u,c);e.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop?(w=e.b2Clamp(M,-e.b2_maxLinearCorrection,e.b2_maxLinearCorrection),V=e.b2Max(V,e.b2Abs(M)),B=!0):M<=this.m_lowerTranslation?(w=e.b2Clamp(M-this.m_lowerTranslation+e.b2_linearSlop,-e.b2_maxLinearCorrection,0),V=e.b2Max(V,this.m_lowerTranslation-M),B=!0):M>=this.m_upperTranslation&&(w=e.b2Clamp(M-this.m_upperTranslation-e.b2_linearSlop,0,e.b2_maxLinearCorrection),V=e.b2Max(V,M-this.m_upperTranslation),B=!0)}if(B){var J=l+p+m*A*A+_*S*S,P=m*A+_*S,T=m*A*y+_*S*d,D=m+_;0==D&&(D=1);var R=m*y+_*d,I=l+p+m*y*y+_*d*d,L=this.m_K3;L.ex.Set(J,P,T),L.ey.Set(P,D,R),L.ez.Set(T,R,I),C=L.Solve33(-v,-x,-w,C)}else{var J=l+p+m*A*A+_*S*S,P=m*A+_*S,D=m+_;0==D&&(D=1);var E=this.m_K2;E.ex.Set(J,P),E.ey.Set(P,D);var F=E.Solve(-v,-x,e.b2PrismaticJoint.prototype.SolvePositionConstraints.s_impulse1);C.x=F.x,C.y=F.y,C.z=0}var G=e.b2AddVV(e.b2MulSV(C.x,f,e.b2Vec2.s_t0),e.b2MulSV(C.z,u,e.b2Vec2.s_t1),e.b2PrismaticJoint.prototype.SolvePositionConstraints.s_P),N=C.x*A+C.y+C.z*y,k=C.x*S+C.y+C.z*d;return o.SelfMulSub(l,G),i-=m*N,n.SelfMulAdd(p,G),s+=_*k,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,V<=e.b2_linearSlop&&g<=e.b2_angularSlop},e.b2PrismaticJoint.prototype.SolvePositionConstraints.s_d=new e.b2Vec2,e.b2PrismaticJoint.prototype.SolvePositionConstraints.s_impulse=new e.b2Vec3,e.b2PrismaticJoint.prototype.SolvePositionConstraints.s_impulse1=new e.b2Vec2,e.b2PrismaticJoint.prototype.SolvePositionConstraints.s_P=new e.b2Vec2,e.b2PrismaticJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.b2PrismaticJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.b2PrismaticJoint.prototype.GetReactionForce=function(t,e){return e.Set(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},e.b2PrismaticJoint.prototype.GetReactionTorque=function(t){return t*this.m_impulse.y},e.b2PrismaticJoint.prototype.GetLocalAnchorA=function(t){return t.Copy(this.m_localAnchorA)},e.b2PrismaticJoint.prototype.GetLocalAnchorB=function(t){return t.Copy(this.m_localAnchorB)},e.b2PrismaticJoint.prototype.GetLocalAxisA=function(t){return t.Copy(this.m_localXAxisA)},e.b2PrismaticJoint.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},e.b2PrismaticJoint.prototype.GetJointTranslation=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e.b2PrismaticJoint.prototype.GetJointTranslation.s_pA),o=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e.b2PrismaticJoint.prototype.GetJointTranslation.s_pB),i=e.b2SubVV(o,t,e.b2PrismaticJoint.prototype.GetJointTranslation.s_d),n=this.m_bodyA.GetWorldVector(this.m_localXAxisA,e.b2PrismaticJoint.prototype.GetJointTranslation.s_axis),s=e.b2DotVV(i,n);return s},e.b2PrismaticJoint.prototype.GetJointTranslation.s_pA=new e.b2Vec2,e.b2PrismaticJoint.prototype.GetJointTranslation.s_pB=new e.b2Vec2,e.b2PrismaticJoint.prototype.GetJointTranslation.s_d=new e.b2Vec2,e.b2PrismaticJoint.prototype.GetJointTranslation.s_axis=new e.b2Vec2,e.b2PrismaticJoint.prototype.GetJointSpeed=function(){var t=this.m_bodyA,o=this.m_bodyB;e.b2SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=e.b2MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);e.b2SubVV(this.m_localAnchorB,o.m_sweep.localCenter,this.m_lalcB);var n=e.b2MulRV(o.m_xf.q,this.m_lalcB,this.m_rB),s=e.b2AddVV(t.m_sweep.c,i,e.b2Vec2.s_t0),r=e.b2AddVV(o.m_sweep.c,n,e.b2Vec2.s_t1),a=e.b2SubVV(r,s,e.b2Vec2.s_t2),l=t.GetWorldVector(this.m_localXAxisA,this.m_axis),p=t.m_linearVelocity,m=o.m_linearVelocity,_=t.m_angularVelocity,b=o.m_angularVelocity,h=e.b2DotVV(a,e.b2CrossSV(_,l,e.b2Vec2.s_t0))+e.b2DotVV(l,e.b2SubVV(e.b2AddVCrossSV(m,b,n,e.b2Vec2.s_t0),e.b2AddVCrossSV(p,_,i,e.b2Vec2.s_t1),e.b2Vec2.s_t0));return h},e.b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},e.b2PrismaticJoint.prototype.EnableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},e.b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},e.b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},e.b2PrismaticJoint.prototype.SetLimits=function(t,e){(t!=this.m_lowerTranslation||e!=this.m_upperTranslation)&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)},e.b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},e.b2PrismaticJoint.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},e.b2PrismaticJoint.prototype.SetMotorSpeed=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},e.b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},e.b2PrismaticJoint.prototype.SetMaxMotorForce=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},e.b2PrismaticJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},e.b2PrismaticJoint.prototype.GetMotorForce=function(t){return t*this.m_motorImpulse},e.b2PrismaticJoint.prototype.Dump=function(){if(e.DEBUG){var t=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;e.b2Log("  /*box2d.b2PrismaticJointDef*/ var jd = new box2d.b2PrismaticJointDef();\\n"),e.b2Log("  jd.bodyA = bodies[%d];\\n",t),e.b2Log("  jd.bodyB = bodies[%d];\\n",o),e.b2Log("  jd.collideConnected = %s;\\n",this.m_collideConnected?"true":"false"),e.b2Log("  jd.localAnchorA.Set(%.15f, %.15f);\\n",this.m_localAnchorA.x,this.m_localAnchorA.y),e.b2Log("  jd.localAnchorB.Set(%.15f, %.15f);\\n",this.m_localAnchorB.x,this.m_localAnchorB.y),e.b2Log("  jd.localAxisA.Set(%.15f, %.15f);\\n",this.m_localXAxisA.x,this.m_localXAxisA.y),e.b2Log("  jd.referenceAngle = %.15f;\\n",this.m_referenceAngle),e.b2Log("  jd.enableLimit = %s;\\n",this.m_enableLimit?"true":"false"),e.b2Log("  jd.lowerTranslation = %.15f;\\n",this.m_lowerTranslation),e.b2Log("  jd.upperTranslation = %.15f;\\n",this.m_upperTranslation),e.b2Log("  jd.enableMotor = %s;\\n",this.m_enableMotor?"true":"false"),e.b2Log("  jd.motorSpeed = %.15f;\\n",this.m_motorSpeed),e.b2Log("  jd.maxMotorForce = %.15f;\\n",this.m_maxMotorForce),e.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\\n",this.m_index)}},e}(e,n,i,o),J=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2RevoluteJoint&&(e.b2RevoluteJoint={}),e.b2RevoluteJointDef=function(){t.base(this,e.b2JointType.e_revoluteJoint),this.localAnchorA=new e.b2Vec2(0,0),this.localAnchorB=new e.b2Vec2(0,0)},t.inherits(e.b2RevoluteJointDef,e.b2JointDef),e.b2RevoluteJointDef.prototype.localAnchorA=null,e.b2RevoluteJointDef.prototype.localAnchorB=null,e.b2RevoluteJointDef.prototype.referenceAngle=0,e.b2RevoluteJointDef.prototype.enableLimit=!1,e.b2RevoluteJointDef.prototype.lowerAngle=0,e.b2RevoluteJointDef.prototype.upperAngle=0,e.b2RevoluteJointDef.prototype.enableMotor=!1,e.b2RevoluteJointDef.prototype.motorSpeed=0,e.b2RevoluteJointDef.prototype.maxMotorTorque=0,e.b2RevoluteJointDef.prototype.Initialize=function(t,e,o){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngleRadians()-this.bodyA.GetAngleRadians()},e.b2RevoluteJoint=function(o){t.base(this,o),this.m_localAnchorA=new e.b2Vec2,this.m_localAnchorB=new e.b2Vec2,this.m_impulse=new e.b2Vec3,this.m_rA=new e.b2Vec2,this.m_rB=new e.b2Vec2,this.m_localCenterA=new e.b2Vec2,this.m_localCenterB=new e.b2Vec2,this.m_mass=new e.b2Mat33,this.m_qA=new e.b2Rot,this.m_qB=new e.b2Rot,this.m_lalcA=new e.b2Vec2,this.m_lalcB=new e.b2Vec2,this.m_K=new e.b2Mat22,this.m_localAnchorA.Copy(o.localAnchorA),this.m_localAnchorB.Copy(o.localAnchorB),this.m_referenceAngle=o.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=o.lowerAngle,this.m_upperAngle=o.upperAngle,this.m_maxMotorTorque=o.maxMotorTorque,this.m_motorSpeed=o.motorSpeed,this.m_enableLimit=o.enableLimit,this.m_enableMotor=o.enableMotor,this.m_limitState=e.b2LimitState.e_inactiveLimit},t.inherits(e.b2RevoluteJoint,e.b2Joint),e.b2RevoluteJoint.prototype.m_localAnchorA=null,e.b2RevoluteJoint.prototype.m_localAnchorB=null,e.b2RevoluteJoint.prototype.m_impulse=null,e.b2RevoluteJoint.prototype.m_motorImpulse=0,e.b2RevoluteJoint.prototype.m_enableMotor=!1,e.b2RevoluteJoint.prototype.m_maxMotorTorque=0,e.b2RevoluteJoint.prototype.m_motorSpeed=0,e.b2RevoluteJoint.prototype.m_enableLimit=!1,e.b2RevoluteJoint.prototype.m_referenceAngle=0,e.b2RevoluteJoint.prototype.m_lowerAngle=0,e.b2RevoluteJoint.prototype.m_upperAngle=0,e.b2RevoluteJoint.prototype.m_indexA=0,e.b2RevoluteJoint.prototype.m_indexB=0,e.b2RevoluteJoint.prototype.m_rA=null,e.b2RevoluteJoint.prototype.m_rB=null,e.b2RevoluteJoint.prototype.m_localCenterA=null,e.b2RevoluteJoint.prototype.m_localCenterB=null,e.b2RevoluteJoint.prototype.m_invMassA=0,e.b2RevoluteJoint.prototype.m_invMassB=0,e.b2RevoluteJoint.prototype.m_invIA=0,e.b2RevoluteJoint.prototype.m_invIB=0,e.b2RevoluteJoint.prototype.m_mass=null,e.b2RevoluteJoint.prototype.m_motorMass=0,e.b2RevoluteJoint.prototype.m_limitState=e.b2LimitState.e_inactiveLimit,e.b2RevoluteJoint.prototype.m_qA=null,e.b2RevoluteJoint.prototype.m_qB=null,e.b2RevoluteJoint.prototype.m_lalcA=null,e.b2RevoluteJoint.prototype.m_lalcB=null,e.b2RevoluteJoint.prototype.m_K=null,e.b2RevoluteJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngleRadians(o),p=this.m_qB.SetAngleRadians(s);e.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),e.b2MulRV(l,this.m_lalcA,this.m_rA),e.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),e.b2MulRV(p,this.m_lalcB,this.m_rB);var m=this.m_invMassA,_=this.m_invMassB,b=this.m_invIA,h=this.m_invIB,c=b+h==0;if(this.m_mass.ex.x=m+_+this.m_rA.y*this.m_rA.y*b+this.m_rB.y*this.m_rB.y*h,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*b-this.m_rB.y*this.m_rB.x*h,this.m_mass.ez.x=-this.m_rA.y*b-this.m_rB.y*h,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=m+_+this.m_rA.x*this.m_rA.x*b+this.m_rB.x*this.m_rB.x*h,this.m_mass.ez.y=this.m_rA.x*b+this.m_rB.x*h,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=b+h,this.m_motorMass=b+h,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(0==this.m_enableMotor||c)&&(this.m_motorImpulse=0),this.m_enableLimit&&0==c){var u=s-o-this.m_referenceAngle;e.b2Abs(this.m_upperAngle-this.m_lowerAngle)<2*e.b2_angularSlop?this.m_limitState=e.b2LimitState.e_equalLimits:u<=this.m_lowerAngle?(this.m_limitState!=e.b2LimitState.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=e.b2LimitState.e_atLowerLimit):u>=this.m_upperAngle?(this.m_limitState!=e.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=e.b2LimitState.e_atUpperLimit):(this.m_limitState=e.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=e.b2LimitState.e_inactiveLimit;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var y=e.b2RevoluteJoint.prototype.InitVelocityConstraints.s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(m,y),n-=b*(e.b2CrossVV(this.m_rA,y)+this.m_motorImpulse+this.m_impulse.z),r.SelfMulAdd(_,y),a+=h*(e.b2CrossVV(this.m_rB,y)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=a},e.b2RevoluteJoint.prototype.InitVelocityConstraints.s_P=new e.b2Vec2,e.b2RevoluteJoint.prototype.SolveVelocityConstraints=function(t){var o=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,p=this.m_invIB,m=l+p==0;if(this.m_enableMotor&&this.m_limitState!=e.b2LimitState.e_equalLimits&&0==m){var _=s-i-this.m_motorSpeed,b=-this.m_motorMass*_,h=this.m_motorImpulse,c=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=e.b2Clamp(this.m_motorImpulse+b,-c,c),b=this.m_motorImpulse-h,i-=l*b,s+=p*b}if(this.m_enableLimit&&this.m_limitState!=e.b2LimitState.e_inactiveLimit&&0==m){var u=e.b2SubVV(e.b2AddVCrossSV(n,s,this.m_rB,e.b2Vec2.s_t0),e.b2AddVCrossSV(o,i,this.m_rA,e.b2Vec2.s_t1),e.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_Cdot1),y=s-i,b=this.m_mass.Solve33(u.x,u.y,y,e.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_impulse3).SelfNeg();if(this.m_limitState==e.b2LimitState.e_equalLimits)this.m_impulse.SelfAdd(b);else if(this.m_limitState==e.b2LimitState.e_atLowerLimit){var d=this.m_impulse.z+b.z;if(0>d){var f=-u.x+this.m_impulse.z*this.m_mass.ez.x,A=-u.y+this.m_impulse.z*this.m_mass.ez.y,S=this.m_mass.Solve22(f,A,e.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_reduced);b.x=S.x,b.y=S.y,b.z=-this.m_impulse.z,this.m_impulse.x+=S.x,this.m_impulse.y+=S.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(b)}else if(this.m_limitState==e.b2LimitState.e_atUpperLimit){var d=this.m_impulse.z+b.z;if(d>0){var f=-u.x+this.m_impulse.z*this.m_mass.ez.x,A=-u.y+this.m_impulse.z*this.m_mass.ez.y,S=this.m_mass.Solve22(f,A,e.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_reduced);b.x=S.x,b.y=S.y,b.z=-this.m_impulse.z,this.m_impulse.x+=S.x,this.m_impulse.y+=S.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(b)}var C=e.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_P.Set(b.x,b.y);o.SelfMulSub(r,C),i-=l*(e.b2CrossVV(this.m_rA,C)+b.z),n.SelfMulAdd(a,C),s+=p*(e.b2CrossVV(this.m_rB,C)+b.z)}else{var _=e.b2SubVV(e.b2AddVCrossSV(n,s,this.m_rB,e.b2Vec2.s_t0),e.b2AddVCrossSV(o,i,this.m_rA,e.b2Vec2.s_t1),e.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_Cdot),b=this.m_mass.Solve22(-_.x,-_.y,e.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_impulse2);this.m_impulse.x+=b.x,this.m_impulse.y+=b.y,o.SelfMulSub(r,b),i-=l*e.b2CrossVV(this.m_rA,b),n.SelfMulAdd(a,b),s+=p*e.b2CrossVV(this.m_rB,b)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s},e.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_P=new e.b2Vec2,e.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_Cdot=new e.b2Vec2,e.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_Cdot1=new e.b2Vec2,e.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_impulse3=new e.b2Vec3,e.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_reduced=new e.b2Vec2,e.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_impulse2=new e.b2Vec2,e.b2RevoluteJoint.prototype.SolvePositionConstraints=function(t){var o=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,r=this.m_qA.SetAngleRadians(i),a=this.m_qB.SetAngleRadians(s),l=0,p=0,m=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=e.b2LimitState.e_inactiveLimit&&0==m){var _=s-i-this.m_referenceAngle,b=0;if(this.m_limitState==e.b2LimitState.e_equalLimits){var h=e.b2Clamp(_-this.m_lowerAngle,-e.b2_maxAngularCorrection,e.b2_maxAngularCorrection);b=-this.m_motorMass*h,l=e.b2Abs(h)}else if(this.m_limitState==e.b2LimitState.e_atLowerLimit){var h=_-this.m_lowerAngle;l=-h,h=e.b2Clamp(h+e.b2_angularSlop,-e.b2_maxAngularCorrection,0),b=-this.m_motorMass*h}else if(this.m_limitState==e.b2LimitState.e_atUpperLimit){var h=_-this.m_upperAngle;l=h,h=e.b2Clamp(h-e.b2_angularSlop,0,e.b2_maxAngularCorrection),b=-this.m_motorMass*h}i-=this.m_invIA*b,s+=this.m_invIB*b}r.SetAngleRadians(i),a.SetAngleRadians(s),e.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var c=e.b2MulRV(r,this.m_lalcA,this.m_rA);e.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u=e.b2MulRV(a,this.m_lalcB,this.m_rB),h=e.b2SubVV(e.b2AddVV(n,u,e.b2Vec2.s_t0),e.b2AddVV(o,c,e.b2Vec2.s_t1),e.b2RevoluteJoint.prototype.SolvePositionConstraints.s_C);p=h.GetLength();var y=this.m_invMassA,d=this.m_invMassB,f=this.m_invIA,A=this.m_invIB,S=this.m_K;S.ex.x=y+d+f*c.y*c.y+A*u.y*u.y,S.ex.y=-f*c.x*c.y-A*u.x*u.y,S.ey.x=S.ex.y,S.ey.y=y+d+f*c.x*c.x+A*u.x*u.x;var C=S.Solve(h.x,h.y,e.b2RevoluteJoint.prototype.SolvePositionConstraints.s_impulse).SelfNeg();return o.SelfMulSub(y,C),i-=f*e.b2CrossVV(c,C),n.SelfMulAdd(d,C),s+=A*e.b2CrossVV(u,C),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,p<=e.b2_linearSlop&&l<=e.b2_angularSlop},e.b2RevoluteJoint.prototype.SolvePositionConstraints.s_C=new e.b2Vec2,e.b2RevoluteJoint.prototype.SolvePositionConstraints.s_impulse=new e.b2Vec2,e.b2RevoluteJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.b2RevoluteJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.b2RevoluteJoint.prototype.GetReactionForce=function(t,e){return e.Set(t*this.m_impulse.x,t*this.m_impulse.y)},e.b2RevoluteJoint.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z},e.b2RevoluteJoint.prototype.GetLocalAnchorA=function(t){return t.Copy(this.m_localAnchorA)},e.b2RevoluteJoint.prototype.GetLocalAnchorB=function(t){return t.Copy(this.m_localAnchorB)},e.b2RevoluteJoint.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},e.b2RevoluteJoint.prototype.GetJointAngleRadians=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},e.b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},e.b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},e.b2RevoluteJoint.prototype.EnableMotor=function(t){this.m_enableMotor!=t&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},e.b2RevoluteJoint.prototype.GetMotorTorque=function(t){return t*this.m_motorImpulse},e.b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},e.b2RevoluteJoint.prototype.SetMaxMotorTorque=function(t){this.m_maxMotorTorque=t},e.b2RevoluteJoint.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},e.b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},e.b2RevoluteJoint.prototype.EnableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},e.b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle},e.b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle},e.b2RevoluteJoint.prototype.SetLimits=function(t,e){(t!=this.m_lowerAngle||e!=this.m_upperAngle)&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)},e.b2RevoluteJoint.prototype.SetMotorSpeed=function(t){this.m_motorSpeed!=t&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},e.b2RevoluteJoint.prototype.Dump=function(){if(e.DEBUG){var t=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;e.b2Log("  /*box2d.b2RevoluteJointDef*/ var jd = new box2d.b2RevoluteJointDef();\\n"),e.b2Log("  jd.bodyA = bodies[%d];\\n",t),e.b2Log("  jd.bodyB = bodies[%d];\\n",o),e.b2Log("  jd.collideConnected = %s;\\n",this.m_collideConnected?"true":"false"),e.b2Log("  jd.localAnchorA.Set(%.15f, %.15f);\\n",this.m_localAnchorA.x,this.m_localAnchorA.y),e.b2Log("  jd.localAnchorB.Set(%.15f, %.15f);\\n",this.m_localAnchorB.x,this.m_localAnchorB.y),e.b2Log("  jd.referenceAngle = %.15f;\\n",this.m_referenceAngle),e.b2Log("  jd.enableLimit = %s;\\n",this.m_enableLimit?"true":"false"),e.b2Log("  jd.lowerAngle = %.15f;\\n",this.m_lowerAngle),e.b2Log("  jd.upperAngle = %.15f;\\n",this.m_upperAngle),e.b2Log("  jd.enableMotor = %s;\\n",this.m_enableMotor?"true":"false"),e.b2Log("  jd.motorSpeed = %.15f;\\n",this.m_motorSpeed),e.b2Log("  jd.maxMotorTorque = %.15f;\\n",this.m_maxMotorTorque),e.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\\n",this.m_index)}},e}(e,n,i,o),P=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2GearJoint&&(e.b2GearJoint={}),e.b2GearJointDef=function(){t.base(this,e.b2JointType.e_gearJoint)},t.inherits(e.b2GearJointDef,e.b2JointDef),e.b2GearJointDef.prototype.joint1=null,e.b2GearJointDef.prototype.joint2=null,e.b2GearJointDef.prototype.ratio=1,e.b2GearJoint=function(o){t.base(this,o),this.m_joint1=o.joint1,this.m_joint2=o.joint2,this.m_localAnchorA=new e.b2Vec2,this.m_localAnchorB=new e.b2Vec2,this.m_localAnchorC=new e.b2Vec2,this.m_localAnchorD=new e.b2Vec2,this.m_localAxisC=new e.b2Vec2,this.m_localAxisD=new e.b2Vec2,this.m_lcA=new e.b2Vec2,this.m_lcB=new e.b2Vec2,this.m_lcC=new e.b2Vec2,this.m_lcD=new e.b2Vec2,this.m_JvAC=new e.b2Vec2,this.m_JvBD=new e.b2Vec2,this.m_qA=new e.b2Rot,this.m_qB=new e.b2Rot,this.m_qC=new e.b2Rot,this.m_qD=new e.b2Rot,this.m_lalcA=new e.b2Vec2,this.m_lalcB=new e.b2Vec2,this.m_lalcC=new e.b2Vec2,this.m_lalcD=new e.b2Vec2,this.m_typeA=this.m_joint1.GetType(),this.m_typeB=this.m_joint2.GetType(),e.ENABLE_ASSERTS&&e.b2Assert(this.m_typeA==e.b2JointType.e_revoluteJoint||this.m_typeA==e.b2JointType.e_prismaticJoint),e.ENABLE_ASSERTS&&e.b2Assert(this.m_typeB==e.b2JointType.e_revoluteJoint||this.m_typeB==e.b2JointType.e_prismaticJoint);var i,n;this.m_bodyC=this.m_joint1.GetBodyA(),this.m_bodyA=this.m_joint1.GetBodyB();var s=this.m_bodyA.m_xf,r=this.m_bodyA.m_sweep.a,a=this.m_bodyC.m_xf,l=this.m_bodyC.m_sweep.a;if(this.m_typeA==e.b2JointType.e_revoluteJoint){var p=o.joint1;this.m_localAnchorC.Copy(p.m_localAnchorA),this.m_localAnchorA.Copy(p.m_localAnchorB),this.m_referenceAngleA=p.m_referenceAngle,this.m_localAxisC.SetZero(),i=r-l-this.m_referenceAngleA}else{var m=o.joint1;this.m_localAnchorC.Copy(m.m_localAnchorA),this.m_localAnchorA.Copy(m.m_localAnchorB),this.m_referenceAngleA=m.m_referenceAngle,this.m_localAxisC.Copy(m.m_localXAxisA);var _=this.m_localAnchorC,b=e.b2MulTRV(a.q,e.b2AddVV(e.b2MulRV(s.q,this.m_localAnchorA,e.b2Vec2.s_t0),e.b2SubVV(s.p,a.p,e.b2Vec2.s_t1),e.b2Vec2.s_t0),e.b2Vec2.s_t0);i=e.b2DotVV(e.b2SubVV(b,_,e.b2Vec2.s_t0),this.m_localAxisC)}this.m_bodyD=this.m_joint2.GetBodyA(),this.m_bodyB=this.m_joint2.GetBodyB();var h=this.m_bodyB.m_xf,c=this.m_bodyB.m_sweep.a,u=this.m_bodyD.m_xf,y=this.m_bodyD.m_sweep.a;if(this.m_typeB==e.b2JointType.e_revoluteJoint){var p=o.joint2;this.m_localAnchorD.Copy(p.m_localAnchorA),this.m_localAnchorB.Copy(p.m_localAnchorB),this.m_referenceAngleB=p.m_referenceAngle,this.m_localAxisD.SetZero(),n=c-y-this.m_referenceAngleB}else{var m=o.joint2;this.m_localAnchorD.Copy(m.m_localAnchorA),this.m_localAnchorB.Copy(m.m_localAnchorB),this.m_referenceAngleB=m.m_referenceAngle,this.m_localAxisD.Copy(m.m_localXAxisA);var d=this.m_localAnchorD,f=e.b2MulTRV(u.q,e.b2AddVV(e.b2MulRV(h.q,this.m_localAnchorB,e.b2Vec2.s_t0),e.b2SubVV(h.p,u.p,e.b2Vec2.s_t1),e.b2Vec2.s_t0),e.b2Vec2.s_t0);n=e.b2DotVV(e.b2SubVV(f,d,e.b2Vec2.s_t0),this.m_localAxisD)}this.m_ratio=o.ratio,this.m_constant=i+this.m_ratio*n,this.m_impulse=0},t.inherits(e.b2GearJoint,e.b2Joint),e.b2GearJoint.prototype.m_joint1=null,e.b2GearJoint.prototype.m_joint2=null,e.b2GearJoint.prototype.m_typeA=e.b2JointType.e_unknownJoint,e.b2GearJoint.prototype.m_typeB=e.b2JointType.e_unknownJoint,e.b2GearJoint.prototype.m_bodyC=null,e.b2GearJoint.prototype.m_bodyD=null,e.b2GearJoint.prototype.m_localAnchorA=null,e.b2GearJoint.prototype.m_localAnchorB=null,e.b2GearJoint.prototype.m_localAnchorC=null,e.b2GearJoint.prototype.m_localAnchorD=null,e.b2GearJoint.prototype.m_localAxisC=null,e.b2GearJoint.prototype.m_localAxisD=null,e.b2GearJoint.prototype.m_referenceAngleA=0,e.b2GearJoint.prototype.m_referenceAngleB=0,e.b2GearJoint.prototype.m_constant=0,e.b2GearJoint.prototype.m_ratio=0,e.b2GearJoint.prototype.m_impulse=0,e.b2GearJoint.prototype.m_indexA=0,e.b2GearJoint.prototype.m_indexB=0,e.b2GearJoint.prototype.m_indexC=0,e.b2GearJoint.prototype.m_indexD=0,e.b2GearJoint.prototype.m_lcA=null,e.b2GearJoint.prototype.m_lcB=null,e.b2GearJoint.prototype.m_lcC=null,e.b2GearJoint.prototype.m_lcD=null,e.b2GearJoint.prototype.m_mA=0,e.b2GearJoint.prototype.m_mB=0,e.b2GearJoint.prototype.m_mC=0,e.b2GearJoint.prototype.m_mD=0,e.b2GearJoint.prototype.m_iA=0,e.b2GearJoint.prototype.m_iB=0,e.b2GearJoint.prototype.m_iC=0,e.b2GearJoint.prototype.m_iD=0,e.b2GearJoint.prototype.m_JvAC=null,e.b2GearJoint.prototype.m_JvBD=null,e.b2GearJoint.prototype.m_JwA=0,e.b2GearJoint.prototype.m_JwB=0,e.b2GearJoint.prototype.m_JwC=0,e.b2GearJoint.prototype.m_JwD=0,e.b2GearJoint.prototype.m_mass=0,e.b2GearJoint.prototype.m_qA=null,e.b2GearJoint.prototype.m_qB=null,e.b2GearJoint.prototype.m_qC=null,e.b2GearJoint.prototype.m_qD=null,e.b2GearJoint.prototype.m_lalcA=null,e.b2GearJoint.prototype.m_lalcB=null,e.b2GearJoint.prototype.m_lalcC=null,e.b2GearJoint.prototype.m_lalcD=null,e.b2GearJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var o=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,l=t.positions[this.m_indexC].a,p=t.velocities[this.m_indexC].v,m=t.velocities[this.m_indexC].w,_=t.positions[this.m_indexD].a,b=t.velocities[this.m_indexD].v,h=t.velocities[this.m_indexD].w,c=this.m_qA.SetAngleRadians(o),u=this.m_qB.SetAngleRadians(s),y=this.m_qC.SetAngleRadians(l),d=this.m_qD.SetAngleRadians(_);if(this.m_mass=0,this.m_typeA==e.b2JointType.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var f=e.b2MulRV(y,this.m_localAxisC,e.b2GearJoint.prototype.InitVelocityConstraints.s_u);e.b2SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var A=e.b2MulRV(y,this.m_lalcC,e.b2GearJoint.prototype.InitVelocityConstraints.s_rC);e.b2SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var S=e.b2MulRV(c,this.m_lalcA,e.b2GearJoint.prototype.InitVelocityConstraints.s_rA);this.m_JvAC.Copy(f),this.m_JwC=e.b2CrossVV(A,f),this.m_JwA=e.b2CrossVV(S,f),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB==e.b2JointType.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var f=e.b2MulRV(d,this.m_localAxisD,e.b2GearJoint.prototype.InitVelocityConstraints.s_u);e.b2SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var C=e.b2MulRV(d,this.m_lalcD,e.b2GearJoint.prototype.InitVelocityConstraints.s_rD);e.b2SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var v=e.b2MulRV(u,this.m_lalcB,e.b2GearJoint.prototype.InitVelocityConstraints.s_rB);e.b2MulSV(this.m_ratio,f,this.m_JvBD),this.m_JwD=this.m_ratio*e.b2CrossVV(C,f),this.m_JwB=this.m_ratio*e.b2CrossVV(v,f),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.step.warmStarting?(i.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),n+=this.m_iA*this.m_impulse*this.m_JwA,r.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),a+=this.m_iB*this.m_impulse*this.m_JwB,p.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),m-=this.m_iC*this.m_impulse*this.m_JwC,b.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),h-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=a,t.velocities[this.m_indexC].w=m,t.velocities[this.m_indexD].w=h},e.b2GearJoint.prototype.InitVelocityConstraints.s_u=new e.b2Vec2,e.b2GearJoint.prototype.InitVelocityConstraints.s_rA=new e.b2Vec2,e.b2GearJoint.prototype.InitVelocityConstraints.s_rB=new e.b2Vec2,e.b2GearJoint.prototype.InitVelocityConstraints.s_rC=new e.b2Vec2,e.b2GearJoint.prototype.InitVelocityConstraints.s_rD=new e.b2Vec2,e.b2GearJoint.prototype.SolveVelocityConstraints=function(t){var o=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,r=t.velocities[this.m_indexC].v,a=t.velocities[this.m_indexC].w,l=t.velocities[this.m_indexD].v,p=t.velocities[this.m_indexD].w,m=e.b2DotVV(this.m_JvAC,e.b2SubVV(o,r,e.b2Vec2.s_t0))+e.b2DotVV(this.m_JvBD,e.b2SubVV(n,l,e.b2Vec2.s_t0));m+=this.m_JwA*i-this.m_JwC*a+(this.m_JwB*s-this.m_JwD*p);var _=-this.m_mass*m;this.m_impulse+=_,o.SelfMulAdd(this.m_mA*_,this.m_JvAC),i+=this.m_iA*_*this.m_JwA,n.SelfMulAdd(this.m_mB*_,this.m_JvBD),s+=this.m_iB*_*this.m_JwB,r.SelfMulSub(this.m_mC*_,this.m_JvAC),a-=this.m_iC*_*this.m_JwC,l.SelfMulSub(this.m_mD*_,this.m_JvBD),p-=this.m_iD*_*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s,t.velocities[this.m_indexC].w=a,t.velocities[this.m_indexD].w=p},e.b2GearJoint.prototype.SolvePositionConstraints=function(t){var o,i,n,s,r,a,l=t.positions[this.m_indexA].c,p=t.positions[this.m_indexA].a,m=t.positions[this.m_indexB].c,_=t.positions[this.m_indexB].a,b=t.positions[this.m_indexC].c,h=t.positions[this.m_indexC].a,c=t.positions[this.m_indexD].c,u=t.positions[this.m_indexD].a,y=this.m_qA.SetAngleRadians(p),d=this.m_qB.SetAngleRadians(_),f=this.m_qC.SetAngleRadians(h),A=this.m_qD.SetAngleRadians(u),S=0,C=this.m_JvAC,v=this.m_JvBD,x=0;if(this.m_typeA==e.b2JointType.e_revoluteJoint)C.SetZero(),n=1,r=1,x+=this.m_iA+this.m_iC,o=p-h-this.m_referenceAngleA;else{var V=e.b2MulRV(f,this.m_localAxisC,e.b2GearJoint.prototype.SolvePositionConstraints.s_u),g=e.b2MulRV(f,this.m_lalcC,e.b2GearJoint.prototype.SolvePositionConstraints.s_rC),B=e.b2MulRV(y,this.m_lalcA,e.b2GearJoint.prototype.SolvePositionConstraints.s_rA);C.Copy(V),r=e.b2CrossVV(g,V),n=e.b2CrossVV(B,V),x+=this.m_mC+this.m_mA+this.m_iC*r*r+this.m_iA*n*n;var w=this.m_lalcC,M=e.b2MulTRV(f,e.b2AddVV(B,e.b2SubVV(l,b,e.b2Vec2.s_t0),e.b2Vec2.s_t0),e.b2Vec2.s_t0);o=e.b2DotVV(e.b2SubVV(M,w,e.b2Vec2.s_t0),this.m_localAxisC)}if(this.m_typeB==e.b2JointType.e_revoluteJoint)v.SetZero(),s=this.m_ratio,a=this.m_ratio,x+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),i=_-u-this.m_referenceAngleB;else{var V=e.b2MulRV(A,this.m_localAxisD,e.b2GearJoint.prototype.SolvePositionConstraints.s_u),J=e.b2MulRV(A,this.m_lalcD,e.b2GearJoint.prototype.SolvePositionConstraints.s_rD),P=e.b2MulRV(d,this.m_lalcB,e.b2GearJoint.prototype.SolvePositionConstraints.s_rB);e.b2MulSV(this.m_ratio,V,v),a=this.m_ratio*e.b2CrossVV(J,V),s=this.m_ratio*e.b2CrossVV(P,V),x+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*a*a+this.m_iB*s*s;var T=this.m_lalcD,D=e.b2MulTRV(A,e.b2AddVV(P,e.b2SubVV(m,c,e.b2Vec2.s_t0),e.b2Vec2.s_t0),e.b2Vec2.s_t0);i=e.b2DotVV(e.b2SubVV(D,T,e.b2Vec2.s_t0),this.m_localAxisD)}var R=o+this.m_ratio*i-this.m_constant,I=0;return x>0&&(I=-R/x),l.SelfMulAdd(this.m_mA*I,C),p+=this.m_iA*I*n,m.SelfMulAdd(this.m_mB*I,v),_+=this.m_iB*I*s,b.SelfMulSub(this.m_mC*I,C),h-=this.m_iC*I*r,c.SelfMulSub(this.m_mD*I,v),u-=this.m_iD*I*a,t.positions[this.m_indexA].a=p,t.positions[this.m_indexB].a=_,t.positions[this.m_indexC].a=h,t.positions[this.m_indexD].a=u,S<e.b2_linearSlop\n},e.b2GearJoint.prototype.SolvePositionConstraints.s_u=new e.b2Vec2,e.b2GearJoint.prototype.SolvePositionConstraints.s_rA=new e.b2Vec2,e.b2GearJoint.prototype.SolvePositionConstraints.s_rB=new e.b2Vec2,e.b2GearJoint.prototype.SolvePositionConstraints.s_rC=new e.b2Vec2,e.b2GearJoint.prototype.SolvePositionConstraints.s_rD=new e.b2Vec2,e.b2GearJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.b2GearJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.b2GearJoint.prototype.GetReactionForce=function(t,o){return e.b2MulSV(t*this.m_impulse,this.m_JvAC,o)},e.b2GearJoint.prototype.GetReactionTorque=function(t){return t*this.m_impulse*this.m_JwA},e.b2GearJoint.prototype.GetJoint1=function(){return this.m_joint1},e.b2GearJoint.prototype.GetJoint2=function(){return this.m_joint2},e.b2GearJoint.prototype.GetRatio=function(){return this.m_ratio},e.b2GearJoint.prototype.SetRatio=function(t){e.ENABLE_ASSERTS&&e.b2Assert(e.b2IsValid(t)),this.m_ratio=t},e.b2GearJoint.prototype.Dump=function(){if(e.DEBUG){var t=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex,i=this.m_joint1.m_index,n=this.m_joint2.m_index;e.b2Log("  /*box2d.b2GearJointDef*/ var jd = new box2d.b2GearJointDef();\\n"),e.b2Log("  jd.bodyA = bodies[%d];\\n",t),e.b2Log("  jd.bodyB = bodies[%d];\\n",o),e.b2Log("  jd.collideConnected = %s;\\n",this.m_collideConnected?"true":"false"),e.b2Log("  jd.joint1 = joints[%d];\\n",i),e.b2Log("  jd.joint2 = joints[%d];\\n",n),e.b2Log("  jd.ratio = %.15f;\\n",this.m_ratio),e.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\\n",this.m_index)}},e}(e,n,i,M,J,o),T=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2GravityController&&(e.b2GravityController={}),e.b2GravityController=function(){t.base(this)},t.inherits(e.b2GravityController,e.b2Controller),e.b2GravityController.prototype.G=1,e.b2GravityController.prototype.invSqr=!0,e.b2GravityController.prototype.Step=function(){if(this.invSqr)for(var t=this.m_bodyList;t;t=t.nextBody)for(var o=t.body,i=o.GetWorldCenter(),n=o.GetMass(),s=this.m_bodyList;s!=t;s=s.nextBody){var r=s.body,a=r.GetWorldCenter(),l=r.GetMass(),p=a.x-i.x,m=a.y-i.y,_=p*p+m*m;if(!(_<e.b2_epsilon)){var b=e.b2GravityController.prototype.Step.s_f.Set(p,m);b.SelfMul(this.G/_/e.b2Sqrt(_)*n*l),o.IsAwake()&&o.ApplyForce(b,i),r.IsAwake()&&r.ApplyForce(b.SelfMul(-1),a)}}else for(var t=this.m_bodyList;t;t=t.nextBody)for(var o=t.body,i=o.GetWorldCenter(),n=o.GetMass(),s=this.m_bodyList;s!=t;s=s.nextBody){var r=s.body,a=r.GetWorldCenter(),l=r.GetMass(),p=a.x-i.x,m=a.y-i.y,_=p*p+m*m;if(!(_<e.b2_epsilon)){var b=e.b2GravityController.prototype.Step.s_f.Set(p,m);b.SelfMul(this.G/_*n*l),o.IsAwake()&&o.ApplyForce(b,i),r.IsAwake()&&r.ApplyForce(b.SelfMul(-1),a)}}},e.b2GravityController.prototype.Step.s_f=new e.b2Vec2,e}(e,c,i,o),D=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2MotorJoint&&(e.b2MotorJoint={}),e.b2MotorJointDef=function(){t.base(this,e.b2JointType.e_motorJoint),this.linearOffset=new e.b2Vec2(0,0)},t.inherits(e.b2MotorJointDef,e.b2JointDef),e.b2MotorJointDef.prototype.linearOffset=null,e.b2MotorJointDef.prototype.angularOffset=0,e.b2MotorJointDef.prototype.maxForce=1,e.b2MotorJointDef.prototype.maxTorque=1,e.b2MotorJointDef.prototype.correctionFactor=.3,e.b2MotorJointDef.prototype.Initialize=function(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var o=this.bodyA.GetAngleRadians(),i=this.bodyB.GetAngleRadians();this.angularOffset=i-o},e.b2MotorJoint=function(o){t.base(this,o),this.m_linearOffset=o.linearOffset.Clone(),this.m_linearImpulse=new e.b2Vec2(0,0),this.m_maxForce=o.maxForce,this.m_maxTorque=o.maxTorque,this.m_correctionFactor=o.correctionFactor,this.m_rA=new e.b2Vec2(0,0),this.m_rB=new e.b2Vec2(0,0),this.m_localCenterA=new e.b2Vec2(0,0),this.m_localCenterB=new e.b2Vec2(0,0),this.m_linearError=new e.b2Vec2(0,0),this.m_linearMass=new e.b2Mat22,this.m_qA=new e.b2Rot,this.m_qB=new e.b2Rot,this.m_K=new e.b2Mat22},t.inherits(e.b2MotorJoint,e.b2Joint),e.b2MotorJoint.prototype.m_linearOffset=null,e.b2MotorJoint.prototype.m_angularOffset=0,e.b2MotorJoint.prototype.m_linearImpulse=null,e.b2MotorJoint.prototype.m_angularImpulse=0,e.b2MotorJoint.prototype.m_maxForce=0,e.b2MotorJoint.prototype.m_maxTorque=0,e.b2MotorJoint.prototype.m_correctionFactor=.3,e.b2MotorJoint.prototype.m_indexA=0,e.b2MotorJoint.prototype.m_indexB=0,e.b2MotorJoint.prototype.m_rA=null,e.b2MotorJoint.prototype.m_rB=null,e.b2MotorJoint.prototype.m_localCenterA=null,e.b2MotorJoint.prototype.m_localCenterB=null,e.b2MotorJoint.prototype.m_linearError=null,e.b2MotorJoint.prototype.m_angularError=0,e.b2MotorJoint.prototype.m_invMassA=0,e.b2MotorJoint.prototype.m_invMassB=0,e.b2MotorJoint.prototype.m_invIA=0,e.b2MotorJoint.prototype.m_invIB=0,e.b2MotorJoint.prototype.m_linearMass=null,e.b2MotorJoint.prototype.m_angularMass=0,e.b2MotorJoint.prototype.m_qA=null,e.b2MotorJoint.prototype.m_qB=null,e.b2MotorJoint.prototype.m_K=null,e.b2MotorJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetPosition(t)},e.b2MotorJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetPosition(t)},e.b2MotorJoint.prototype.GetReactionForce=function(t,o){return e.b2MulSV(t,this.m_linearImpulse,o)},e.b2MotorJoint.prototype.GetReactionTorque=function(t){return t*this.m_angularImpulse},e.b2MotorJoint.prototype.SetCorrectionFactor=function(t){e.ENABLE_ASSERTS&&e.b2Assert(e.b2IsValid(t)&&t>=0&&1>=t),this._correctionFactor=t},e.b2MotorJoint.prototype.GetCorrectionFactor=function(){return this.m_correctionFactor},e.b2MotorJoint.prototype.SetLinearOffset=function(t){e.b2IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))},e.b2MotorJoint.prototype.GetLinearOffset=function(t){return t.Copy(this.m_linearOffset)},e.b2MotorJoint.prototype.SetAngularOffset=function(t){t!=this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)},e.b2MotorJoint.prototype.GetAngularOffset=function(){return this.m_angularOffset},e.b2MotorJoint.prototype.SetMaxForce=function(t){e.ENABLE_ASSERTS&&e.b2Assert(e.b2IsValid(t)&&t>=0),this.m_maxForce=t},e.b2MotorJoint.prototype.GetMaxForce=function(){return this.m_maxForce},e.b2MotorJoint.prototype.SetMaxTorque=function(t){e.ENABLE_ASSERTS&&e.b2Assert(e.b2IsValid(t)&&t>=0),this.m_maxTorque=t},e.b2MotorJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},e.b2MotorJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,p=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngleRadians(i),_=this.m_qB.SetAngleRadians(a),b=e.b2MulRV(m,e.b2NegV(this.m_localCenterA,e.b2Vec2.s_t0),this.m_rA),h=e.b2MulRV(_,e.b2NegV(this.m_localCenterB,e.b2Vec2.s_t0),this.m_rB),c=this.m_invMassA,u=this.m_invMassB,y=this.m_invIA,d=this.m_invIB,f=this.m_K;if(f.ex.x=c+u+y*b.y*b.y+d*h.y*h.y,f.ex.y=-y*b.x*b.y-d*h.x*h.y,f.ey.x=f.ex.y,f.ey.y=c+u+y*b.x*b.x+d*h.x*h.x,f.GetInverse(this.m_linearMass),this.m_angularMass=y+d,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),e.b2SubVV(e.b2SubVV(e.b2AddVV(r,h,e.b2Vec2.s_t0),e.b2AddVV(o,b,e.b2Vec2.s_t1),e.b2Vec2.s_t2),e.b2MulRV(m,this.m_linearOffset,e.b2Vec2.s_t3),this.m_linearError),this.m_angularError=a-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var A=this.m_linearImpulse;n.SelfMulSub(c,A),s-=y*(e.b2CrossVV(b,A)+this.m_angularImpulse),l.SelfMulAdd(u,A),p+=d*(e.b2CrossVV(h,A)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=p},e.b2MotorJoint.prototype.SolveVelocityConstraints=function(t){var o=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,p=this.m_invIB,m=t.step.dt,_=t.step.inv_dt,b=s-i+_*this.m_correctionFactor*this.m_angularError,h=-this.m_angularMass*b,c=this.m_angularImpulse,u=m*this.m_maxTorque;this.m_angularImpulse=e.b2Clamp(this.m_angularImpulse+h,-u,u),h=this.m_angularImpulse-c,i-=l*h,s+=p*h;var y=this.m_rA,d=this.m_rB,b=e.b2AddVV(e.b2SubVV(e.b2AddVV(n,e.b2CrossSV(s,d,e.b2Vec2.s_t0),e.b2Vec2.s_t0),e.b2AddVV(o,e.b2CrossSV(i,y,e.b2Vec2.s_t1),e.b2Vec2.s_t1),e.b2Vec2.s_t2),e.b2MulSV(_*this.m_correctionFactor,this.m_linearError,e.b2Vec2.s_t3),e.b2MotorJoint.prototype.SolveVelocityConstraints.s_Cdot),h=e.b2MulMV(this.m_linearMass,b,e.b2MotorJoint.prototype.SolveVelocityConstraints.s_impulse).SelfNeg(),c=e.b2MotorJoint.prototype.SolveVelocityConstraints.s_oldImpulse.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(h);var u=m*this.m_maxForce;this.m_linearImpulse.GetLengthSquared()>u*u&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(u)),e.b2SubVV(this.m_linearImpulse,c,h),o.SelfMulSub(r,h),i-=l*e.b2CrossVV(y,h),n.SelfMulAdd(a,h),s+=p*e.b2CrossVV(d,h),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s},e.b2MotorJoint.prototype.SolveVelocityConstraints.s_Cdot=new e.b2Vec2,e.b2MotorJoint.prototype.SolveVelocityConstraints.s_impulse=new e.b2Vec2,e.b2MotorJoint.prototype.SolveVelocityConstraints.s_oldImpulse=new e.b2Vec2,e.b2MotorJoint.prototype.SolvePositionConstraints=function(){return!0},e.b2MotorJoint.prototype.Dump=function(){if(e.DEBUG){var t=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;e.b2Log("  /*box2d.b2MotorJointDef*/ var jd = new box2d.b2MotorJointDef();\\n"),e.b2Log("  jd.bodyA = bodies[%d];\\n",t),e.b2Log("  jd.bodyB = bodies[%d];\\n",o),e.b2Log("  jd.collideConnected = %s;\\n",this.m_collideConnected?"true":"false"),e.b2Log("  jd.linearOffset.Set(%.15f, %.15f);\\n",this.m_linearOffset.x,this.m_linearOffset.y),e.b2Log("  jd.angularOffset = %.15f;\\n",this.m_angularOffset),e.b2Log("  jd.maxForce = %.15f;\\n",this.m_maxForce),e.b2Log("  jd.maxTorque = %.15f;\\n",this.m_maxTorque),e.b2Log("  jd.correctionFactor = %.15f;\\n",this.m_correctionFactor),e.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\\n",this.m_index)}},e}(e,n,i,o),R=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2MouseJoint&&(e.b2MouseJoint={}),e.b2MouseJointDef=function(){t.base(this,e.b2JointType.e_mouseJoint),this.target=new e.b2Vec2},t.inherits(e.b2MouseJointDef,e.b2JointDef),e.b2MouseJointDef.prototype.target=null,e.b2MouseJointDef.prototype.maxForce=0,e.b2MouseJointDef.prototype.frequencyHz=5,e.b2MouseJointDef.prototype.dampingRatio=.7,e.b2MouseJoint=function(o){t.base(this,o),this.m_localAnchorB=new e.b2Vec2,this.m_targetA=new e.b2Vec2,this.m_impulse=new e.b2Vec2,this.m_rB=new e.b2Vec2,this.m_localCenterB=new e.b2Vec2,this.m_mass=new e.b2Mat22,this.m_C=new e.b2Vec2,this.m_qB=new e.b2Rot,this.m_lalcB=new e.b2Vec2,this.m_K=new e.b2Mat22,e.ENABLE_ASSERTS&&e.b2Assert(o.target.IsValid()),e.ENABLE_ASSERTS&&e.b2Assert(e.b2IsValid(o.maxForce)&&o.maxForce>=0),e.ENABLE_ASSERTS&&e.b2Assert(e.b2IsValid(o.frequencyHz)&&o.frequencyHz>=0),e.ENABLE_ASSERTS&&e.b2Assert(e.b2IsValid(o.dampingRatio)&&o.dampingRatio>=0),this.m_targetA.Copy(o.target),e.b2MulTXV(this.m_bodyB.GetTransform(),this.m_targetA,this.m_localAnchorB),this.m_maxForce=o.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=o.frequencyHz,this.m_dampingRatio=o.dampingRatio,this.m_beta=0,this.m_gamma=0},t.inherits(e.b2MouseJoint,e.b2Joint),e.b2MouseJoint.prototype.m_localAnchorB=null,e.b2MouseJoint.prototype.m_targetA=null,e.b2MouseJoint.prototype.m_frequencyHz=0,e.b2MouseJoint.prototype.m_dampingRatio=0,e.b2MouseJoint.prototype.m_beta=0,e.b2MouseJoint.prototype.m_impulse=null,e.b2MouseJoint.prototype.m_maxForce=0,e.b2MouseJoint.prototype.m_gamma=0,e.b2MouseJoint.prototype.m_indexA=0,e.b2MouseJoint.prototype.m_indexB=0,e.b2MouseJoint.prototype.m_rB=null,e.b2MouseJoint.prototype.m_localCenterB=null,e.b2MouseJoint.prototype.m_invMassB=0,e.b2MouseJoint.prototype.m_invIB=0,e.b2MouseJoint.prototype.m_mass=null,e.b2MouseJoint.prototype.m_C=null,e.b2MouseJoint.prototype.m_qB=null,e.b2MouseJoint.prototype.m_lalcB=null,e.b2MouseJoint.prototype.m_K=null,e.b2MouseJoint.prototype.SetTarget=function(t){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)},e.b2MouseJoint.prototype.GetTarget=function(t){return t.Copy(this.m_targetA)},e.b2MouseJoint.prototype.SetMaxForce=function(t){this.m_maxForce=t},e.b2MouseJoint.prototype.GetMaxForce=function(){return this.m_maxForce},e.b2MouseJoint.prototype.SetFrequency=function(t){this.m_frequencyHz=t},e.b2MouseJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},e.b2MouseJoint.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},e.b2MouseJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},e.b2MouseJoint.prototype.InitVelocityConstraints=function(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var o=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,r=this.m_qB.SetAngleRadians(i),a=this.m_bodyB.GetMass(),l=2*e.b2_pi*this.m_frequencyHz,p=2*a*this.m_dampingRatio*l,m=a*l*l,_=t.step.dt;e.ENABLE_ASSERTS&&e.b2Assert(p+_*m>e.b2_epsilon),this.m_gamma=_*(p+_*m),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=_*m*this.m_gamma,e.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),e.b2MulRV(r,this.m_lalcB,this.m_rB);var b=this.m_K;b.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,b.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,b.ey.x=b.ex.y,b.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,b.GetInverse(this.m_mass),this.m_C.x=o.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=o.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),s*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),n.x+=this.m_invMassB*this.m_impulse.x,n.y+=this.m_invMassB*this.m_impulse.y,s+=this.m_invIB*e.b2CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=s},e.b2MouseJoint.prototype.SolveVelocityConstraints=function(t){var o=t.velocities[this.m_indexB].v,i=t.velocities[this.m_indexB].w,n=e.b2AddVCrossSV(o,i,this.m_rB,e.b2MouseJoint.prototype.SolveVelocityConstraints.s_Cdot),s=e.b2MulMV(this.m_mass,e.b2AddVV(n,e.b2AddVV(this.m_C,e.b2MulSV(this.m_gamma,this.m_impulse,e.b2Vec2.s_t0),e.b2Vec2.s_t0),e.b2Vec2.s_t0).SelfNeg(),e.b2MouseJoint.prototype.SolveVelocityConstraints.s_impulse),r=e.b2MouseJoint.prototype.SolveVelocityConstraints.s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(s);var a=t.step.dt*this.m_maxForce;this.m_impulse.GetLengthSquared()>a*a&&this.m_impulse.SelfMul(a/this.m_impulse.GetLength()),e.b2SubVV(this.m_impulse,r,s),o.SelfMulAdd(this.m_invMassB,s),i+=this.m_invIB*e.b2CrossVV(this.m_rB,s),t.velocities[this.m_indexB].w=i},e.b2MouseJoint.prototype.SolveVelocityConstraints.s_Cdot=new e.b2Vec2,e.b2MouseJoint.prototype.SolveVelocityConstraints.s_impulse=new e.b2Vec2,e.b2MouseJoint.prototype.SolveVelocityConstraints.s_oldImpulse=new e.b2Vec2,e.b2MouseJoint.prototype.SolvePositionConstraints=function(){return!0},e.b2MouseJoint.prototype.GetAnchorA=function(t){return t.Copy(this.m_targetA)},e.b2MouseJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.b2MouseJoint.prototype.GetReactionForce=function(t,o){return e.b2MulSV(t,this.m_impulse,o)},e.b2MouseJoint.prototype.GetReactionTorque=function(){return 0},e.b2MouseJoint.prototype.Dump=function(){e.DEBUG&&e.b2Log("Mouse joint dumping is not supported.\\n")},e.b2MouseJoint.prototype.ShiftOrigin=function(t){this.m_targetA.SelfSub(t)},e}(e,n,i,o),I=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2PolygonShape&&(e.b2PolygonShape={}),e.b2PolygonShape=function(){t.base(this,e.b2ShapeType.e_polygonShape,e.b2_polygonRadius),this.m_centroid=new e.b2Vec2(0,0),this.m_vertices=e.b2Vec2.MakeArray(e.b2_maxPolygonVertices),this.m_normals=e.b2Vec2.MakeArray(e.b2_maxPolygonVertices)},t.inherits(e.b2PolygonShape,e.b2Shape),e.b2PolygonShape.prototype.m_centroid=null,e.b2PolygonShape.prototype.m_vertices=null,e.b2PolygonShape.prototype.m_normals=null,e.b2PolygonShape.prototype.m_count=0,e.b2PolygonShape.prototype.Clone=function(){return(new e.b2PolygonShape).Copy(this)},e.b2PolygonShape.prototype.Copy=function(o){t.base(this,"Copy",o),e.ENABLE_ASSERTS&&e.b2Assert(o instanceof e.b2PolygonShape),this.m_centroid.Copy(o.m_centroid),this.m_count=o.m_count;for(var i=0,n=this.m_count;n>i;++i)this.m_vertices[i].Copy(o.m_vertices[i]),this.m_normals[i].Copy(o.m_normals[i]);return this},e.b2PolygonShape.prototype.SetAsBox=function(t,e){return this.m_count=4,this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),this},e.b2PolygonShape.prototype.SetAsOrientedBox=function(t,o,i,n){this.m_count=4,this.m_vertices[0].Set(-t,-o),this.m_vertices[1].Set(t,-o),this.m_vertices[2].Set(t,o),this.m_vertices[3].Set(-t,o),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.Copy(i);var s=new e.b2Transform;s.SetPosition(i),s.SetRotationAngleRadians(n);for(var r=0,a=this.m_count;a>r;++r)e.b2MulXV(s,this.m_vertices[r],this.m_vertices[r]),e.b2MulRV(s.q,this.m_normals[r],this.m_normals[r]);return this},e.b2PolygonShape.prototype.Set=function(t,o){if(void 0===o&&(o=t.length),e.ENABLE_ASSERTS&&e.b2Assert(o>=3&&o<=e.b2_maxPolygonVertices),3>o)return this.SetAsBox(1,1);for(var i=e.b2Min(o,e.b2_maxPolygonVertices),n=e.b2PolygonShape.prototype.Set.s_ps,s=0,r=0;i>r;++r){for(var a=t[r],l=!0,p=0;s>p;++p)if(e.b2DistanceSquaredVV(a,n[p])<.5*e.b2_linearSlop){l=!1;break}l&&n[s++].Copy(a)}if(i=s,3>i)return e.ENABLE_ASSERTS&&e.b2Assert(!1),this.SetAsBox(1,1);for(var m=0,_=n[0].x,r=1;i>r;++r){var b=n[r].x;(b>_||b==_&&n[r].y<n[m].y)&&(m=r,_=b)}for(var h=e.b2PolygonShape.prototype.Set.s_hull,c=0,u=m;;){h[c]=u;for(var y=0,p=1;i>p;++p)if(y!=u){var d=e.b2SubVV(n[y],n[h[c]],e.b2PolygonShape.prototype.Set.s_r),a=e.b2SubVV(n[p],n[h[c]],e.b2PolygonShape.prototype.Set.s_v),f=e.b2CrossVV(d,a);0>f&&(y=p),0==f&&a.GetLengthSquared()>d.GetLengthSquared()&&(y=p)}else y=p;if(++c,u=y,y==m)break}this.m_count=c;for(var r=0;c>r;++r)this.m_vertices[r].Copy(n[h[r]]);for(var r=0,A=c;A>r;++r){var S=this.m_vertices[r],C=this.m_vertices[(r+1)%A],v=e.b2SubVV(C,S,e.b2Vec2.s_t0);e.ENABLE_ASSERTS&&e.b2Assert(v.GetLengthSquared()>e.b2_epsilon_sq),e.b2CrossVOne(v,this.m_normals[r]).SelfNormalize()}return e.b2PolygonShape.ComputeCentroid(this.m_vertices,c,this.m_centroid),this},e.b2PolygonShape.prototype.Set.s_ps=e.b2Vec2.MakeArray(e.b2_maxPolygonVertices),e.b2PolygonShape.prototype.Set.s_hull=e.b2MakeNumberArray(e.b2_maxPolygonVertices),e.b2PolygonShape.prototype.Set.s_r=new e.b2Vec2,e.b2PolygonShape.prototype.Set.s_v=new e.b2Vec2,e.b2PolygonShape.prototype.SetAsVector=function(t,e){return this.Set(t,e),this},e.b2PolygonShape.prototype.SetAsArray=function(t,e){return this.Set(t,e),this},e.b2PolygonShape.prototype.GetChildCount=function(){return 1},e.b2PolygonShape.prototype.TestPoint=function(t,o){for(var i=e.b2MulTXV(t,o,e.b2PolygonShape.prototype.TestPoint.s_pLocal),n=0,s=this.m_count;s>n;++n){var r=e.b2DotVV(this.m_normals[n],e.b2SubVV(i,this.m_vertices[n],e.b2Vec2.s_t0));if(r>0)return!1}return!0},e.b2PolygonShape.prototype.TestPoint.s_pLocal=new e.b2Vec2,e.b2PolygonShape.prototype.RayCast=function(t,o,i){for(var n=e.b2MulTXV(i,o.p1,e.b2PolygonShape.prototype.RayCast.s_p1),s=e.b2MulTXV(i,o.p2,e.b2PolygonShape.prototype.RayCast.s_p2),r=e.b2SubVV(s,n,e.b2PolygonShape.prototype.RayCast.s_d),a=0,l=o.maxFraction,p=-1,m=0,_=this.m_count;_>m;++m){var b=e.b2DotVV(this.m_normals[m],e.b2SubVV(this.m_vertices[m],n,e.b2Vec2.s_t0)),h=e.b2DotVV(this.m_normals[m],r);if(0==h){if(0>b)return!1}else 0>h&&a*h>b?(a=b/h,p=m):h>0&&l*h>b&&(l=b/h);if(a>l)return!1}return e.ENABLE_ASSERTS&&e.b2Assert(a>=0&&a<=o.maxFraction),p>=0?(t.fraction=a,e.b2MulRV(i.q,this.m_normals[p],t.normal),!0):!1},e.b2PolygonShape.prototype.RayCast.s_p1=new e.b2Vec2,e.b2PolygonShape.prototype.RayCast.s_p2=new e.b2Vec2,e.b2PolygonShape.prototype.RayCast.s_d=new e.b2Vec2,e.b2PolygonShape.prototype.ComputeAABB=function(t,o){for(var i=e.b2MulXV(o,this.m_vertices[0],t.lowerBound),n=t.upperBound.Copy(i),s=0,r=this.m_count;r>s;++s){var a=e.b2MulXV(o,this.m_vertices[s],e.b2PolygonShape.prototype.ComputeAABB.s_v);e.b2MinV(a,i,i),e.b2MaxV(a,n,n)}var l=this.m_radius;i.SelfSubXY(l,l),n.SelfAddXY(l,l)},e.b2PolygonShape.prototype.ComputeAABB.s_v=new e.b2Vec2,e.b2PolygonShape.prototype.ComputeMass=function(t,o){e.ENABLE_ASSERTS&&e.b2Assert(this.m_count>=3);for(var i=e.b2PolygonShape.prototype.ComputeMass.s_center.SetZero(),n=0,s=0,r=e.b2PolygonShape.prototype.ComputeMass.s_s.SetZero(),a=0,l=this.m_count;l>a;++a)r.SelfAdd(this.m_vertices[a]);r.SelfMul(1/this.m_count);for(var p=1/3,a=0,l=this.m_count;l>a;++a){var m=e.b2SubVV(this.m_vertices[a],r,e.b2PolygonShape.prototype.ComputeMass.s_e1),_=e.b2SubVV(this.m_vertices[(a+1)%l],r,e.b2PolygonShape.prototype.ComputeMass.s_e2),b=e.b2CrossVV(m,_),h=.5*b;n+=h,i.SelfAdd(e.b2MulSV(h*p,e.b2AddVV(m,_,e.b2Vec2.s_t0),e.b2Vec2.s_t1));var c=m.x,u=m.y,y=_.x,d=_.y,f=c*c+y*c+y*y,A=u*u+d*u+d*d;s+=.25*p*b*(f+A)}t.mass=o*n,e.ENABLE_ASSERTS&&e.b2Assert(n>e.b2_epsilon),i.SelfMul(1/n),e.b2AddVV(i,r,t.center),t.I=o*s,t.I+=t.mass*(e.b2DotVV(t.center,t.center)-e.b2DotVV(i,i))},e.b2PolygonShape.prototype.ComputeMass.s_center=new e.b2Vec2,e.b2PolygonShape.prototype.ComputeMass.s_s=new e.b2Vec2,e.b2PolygonShape.prototype.ComputeMass.s_e1=new e.b2Vec2,e.b2PolygonShape.prototype.ComputeMass.s_e2=new e.b2Vec2,e.b2PolygonShape.prototype.Validate=function(){for(var t=0;t<this.m_count;++t)for(var o=t,i=(t+1)%this.m_count,n=this.m_vertices[o],s=e.b2SubVV(this.m_vertices[i],n,e.b2PolygonShape.prototype.Validate.s_e),r=0;r<this.m_count;++r)if(r!=o&&r!=i){var a=e.b2SubVV(this.m_vertices[r],n,e.b2PolygonShape.prototype.Validate.s_v),l=e.b2CrossVV(s,a);if(0>l)return!1}return!0},e.b2PolygonShape.prototype.Validate.s_e=new e.b2Vec2,e.b2PolygonShape.prototype.Validate.s_v=new e.b2Vec2,e.b2PolygonShape.prototype.SetupDistanceProxy=function(t){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius},e.b2PolygonShape.prototype.ComputeSubmergedArea=function(t,o,i,n){for(var s=e.b2MulTRV(i.q,t,e.b2PolygonShape.prototype.ComputeSubmergedArea.s_normalL),r=o-e.b2DotVV(t,i.p),a=e.b2PolygonShape.prototype.ComputeSubmergedArea.s_depths,l=0,p=-1,m=-1,_=!1,b=0,h=this.m_count;h>b;++b){a[b]=e.b2DotVV(s,this.m_vertices[b])-r;var c=a[b]<-e.b2_epsilon;b>0&&(c?_||(p=b-1,l++):_&&(m=b-1,l++)),_=c}switch(l){case 0:if(_){var u=e.b2PolygonShape.prototype.ComputeSubmergedArea.s_md;return this.ComputeMass(u,1),e.b2MulXV(i,u.center,n),u.mass}return 0;case 1:-1==p?p=this.m_count-1:m=this.m_count-1}for(var y=(p+1)%this.m_count,d=(m+1)%this.m_count,f=(0-a[p])/(a[y]-a[p]),A=(0-a[m])/(a[d]-a[m]),S=e.b2PolygonShape.prototype.ComputeSubmergedArea.s_intoVec.Set(this.m_vertices[p].x*(1-f)+this.m_vertices[y].x*f,this.m_vertices[p].y*(1-f)+this.m_vertices[y].y*f),C=e.b2PolygonShape.prototype.ComputeSubmergedArea.s_outoVec.Set(this.m_vertices[m].x*(1-A)+this.m_vertices[d].x*A,this.m_vertices[m].y*(1-A)+this.m_vertices[d].y*A),v=0,x=e.b2PolygonShape.prototype.ComputeSubmergedArea.s_center.SetZero(),V=this.m_vertices[y],g=null,b=y;b!=d;){b=(b+1)%this.m_count,g=b==d?C:this.m_vertices[b];var B=.5*((V.x-S.x)*(g.y-S.y)-(V.y-S.y)*(g.x-S.x));v+=B,x.x+=B*(S.x+V.x+g.x)/3,x.y+=B*(S.y+V.y+g.y)/3,V=g}return x.SelfMul(1/v),e.b2MulXV(i,x,n),v},e.b2PolygonShape.prototype.ComputeSubmergedArea.s_normalL=new e.b2Vec2,e.b2PolygonShape.prototype.ComputeSubmergedArea.s_depths=e.b2MakeNumberArray(e.b2_maxPolygonVertices),e.b2PolygonShape.prototype.ComputeSubmergedArea.s_md=new e.b2MassData,e.b2PolygonShape.prototype.ComputeSubmergedArea.s_intoVec=new e.b2Vec2,e.b2PolygonShape.prototype.ComputeSubmergedArea.s_outoVec=new e.b2Vec2,e.b2PolygonShape.prototype.ComputeSubmergedArea.s_center=new e.b2Vec2,e.b2PolygonShape.prototype.Dump=function(){e.b2Log("    /*box2d.b2PolygonShape*/ var shape = new box2d.b2PolygonShape();\\n"),e.b2Log("    /*box2d.b2Vec2[]*/ var vs = box2d.b2Vec2.MakeArray(%d);\\n",e.b2_maxPolygonVertices);for(var t=0;t<this.m_count;++t)e.b2Log("    vs[%d].Set(%.15f, %.15f);\\n",t,this.m_vertices[t].x,this.m_vertices[t].y);e.b2Log("    shape.Set(vs, %d);\\n",this.m_count)},e.b2PolygonShape.ComputeCentroid=function(t,o,i){e.ENABLE_ASSERTS&&e.b2Assert(o>=3);var n=i;n.SetZero();for(var s=0,r=e.b2PolygonShape.ComputeCentroid.s_pRef.SetZero(),a=1/3,l=0;o>l;++l){var p=r,m=t[l],_=t[(l+1)%o],b=e.b2SubVV(m,p,e.b2PolygonShape.ComputeCentroid.s_e1),h=e.b2SubVV(_,p,e.b2PolygonShape.ComputeCentroid.s_e2),c=e.b2CrossVV(b,h),u=.5*c;s+=u,n.x+=u*a*(p.x+m.x+_.x),n.y+=u*a*(p.y+m.y+_.y)}return e.ENABLE_ASSERTS&&e.b2Assert(s>e.b2_epsilon),n.SelfMul(1/s),n},e.b2PolygonShape.ComputeCentroid.s_pRef=new e.b2Vec2,e.b2PolygonShape.ComputeCentroid.s_e1=new e.b2Vec2,e.b2PolygonShape.ComputeCentroid.s_e2=new e.b2Vec2,e}(e,l),L=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2PulleyJoint&&(e.b2PulleyJoint={}),e.b2_minPulleyLength=2,e.b2PulleyJointDef=function(){t.base(this,e.b2JointType.e_pulleyJoint),this.collideConnected=!0,this.groundAnchorA=new e.b2Vec2(-1,1),this.groundAnchorB=new e.b2Vec2(1,1),this.localAnchorA=new e.b2Vec2(-1,0),this.localAnchorB=new e.b2Vec2(1,0)},t.inherits(e.b2PulleyJointDef,e.b2JointDef),e.b2PulleyJointDef.prototype.groundAnchorA=null,e.b2PulleyJointDef.prototype.groundAnchorB=null,e.b2PulleyJointDef.prototype.localAnchorA=null,e.b2PulleyJointDef.prototype.localAnchorB=null,e.b2PulleyJointDef.prototype.lengthA=0,e.b2PulleyJointDef.prototype.lengthB=0,e.b2PulleyJointDef.prototype.ratio=1,e.b2PulleyJointDef.prototype.Initialize=function(t,o,i,n,s,r,a){this.bodyA=t,this.bodyB=o,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(n),this.bodyA.GetLocalPoint(s,this.localAnchorA),this.bodyB.GetLocalPoint(r,this.localAnchorB),this.lengthA=e.b2DistanceVV(s,i),this.lengthB=e.b2DistanceVV(r,n),this.ratio=a,e.ENABLE_ASSERTS&&e.b2Assert(this.ratio>e.b2_epsilon)},e.b2PulleyJoint=function(o){t.base(this,o),this.m_groundAnchorA=new e.b2Vec2,this.m_groundAnchorB=new e.b2Vec2,this.m_localAnchorA=new e.b2Vec2,this.m_localAnchorB=new e.b2Vec2,this.m_uA=new e.b2Vec2,this.m_uB=new e.b2Vec2,this.m_rA=new e.b2Vec2,this.m_rB=new e.b2Vec2,this.m_localCenterA=new e.b2Vec2,this.m_localCenterB=new e.b2Vec2,this.m_qA=new e.b2Rot,this.m_qB=new e.b2Rot,this.m_lalcA=new e.b2Vec2,this.m_lalcB=new e.b2Vec2,this.m_groundAnchorA.Copy(o.groundAnchorA),this.m_groundAnchorB.Copy(o.groundAnchorB),this.m_localAnchorA.Copy(o.localAnchorA),this.m_localAnchorB.Copy(o.localAnchorB),this.m_lengthA=o.lengthA,this.m_lengthB=o.lengthB,e.ENABLE_ASSERTS&&e.b2Assert(0!=o.ratio),this.m_ratio=o.ratio,this.m_constant=o.lengthA+this.m_ratio*o.lengthB,this.m_impulse=0},t.inherits(e.b2PulleyJoint,e.b2Joint),e.b2PulleyJoint.prototype.m_groundAnchorA=null,e.b2PulleyJoint.prototype.m_groundAnchorB=null,e.b2PulleyJoint.prototype.m_lengthA=0,e.b2PulleyJoint.prototype.m_lengthB=0,e.b2PulleyJoint.prototype.m_localAnchorA=null,e.b2PulleyJoint.prototype.m_localAnchorB=null,e.b2PulleyJoint.prototype.m_constant=0,e.b2PulleyJoint.prototype.m_ratio=0,e.b2PulleyJoint.prototype.m_impulse=0,e.b2PulleyJoint.prototype.m_indexA=0,e.b2PulleyJoint.prototype.m_indexB=0,e.b2PulleyJoint.prototype.m_uA=null,e.b2PulleyJoint.prototype.m_uB=null,e.b2PulleyJoint.prototype.m_rA=null,e.b2PulleyJoint.prototype.m_rB=null,e.b2PulleyJoint.prototype.m_localCenterA=null,e.b2PulleyJoint.prototype.m_localCenterB=null,e.b2PulleyJoint.prototype.m_invMassA=0,e.b2PulleyJoint.prototype.m_invMassB=0,e.b2PulleyJoint.prototype.m_invIA=0,e.b2PulleyJoint.prototype.m_invIB=0,e.b2PulleyJoint.prototype.m_mass=0,e.b2PulleyJoint.prototype.m_qA=null,e.b2PulleyJoint.prototype.m_qB=null,e.b2PulleyJoint.prototype.m_lalcA=null,e.b2PulleyJoint.prototype.m_lalcB=null,e.b2PulleyJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,p=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngleRadians(i),_=this.m_qB.SetAngleRadians(a);e.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),e.b2MulRV(m,this.m_lalcA,this.m_rA),e.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),e.b2MulRV(_,this.m_lalcB,this.m_rB),this.m_uA.Copy(o).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(r).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var b=this.m_uA.GetLength(),h=this.m_uB.GetLength();b>10*e.b2_linearSlop?this.m_uA.SelfMul(1/b):this.m_uA.SetZero(),h>10*e.b2_linearSlop?this.m_uB.SelfMul(1/h):this.m_uB.SetZero();var c=e.b2CrossVV(this.m_rA,this.m_uA),u=e.b2CrossVV(this.m_rB,this.m_uB),y=this.m_invMassA+this.m_invIA*c*c,d=this.m_invMassB+this.m_invIB*u*u;if(this.m_mass=y+this.m_ratio*this.m_ratio*d,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var f=e.b2MulSV(-this.m_impulse,this.m_uA,e.b2PulleyJoint.prototype.InitVelocityConstraints.s_PA),A=e.b2MulSV(-this.m_ratio*this.m_impulse,this.m_uB,e.b2PulleyJoint.prototype.InitVelocityConstraints.s_PB);n.SelfMulAdd(this.m_invMassA,f),s+=this.m_invIA*e.b2CrossVV(this.m_rA,f),l.SelfMulAdd(this.m_invMassB,A),p+=this.m_invIB*e.b2CrossVV(this.m_rB,A)}else this.m_impulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=p},e.b2PulleyJoint.prototype.InitVelocityConstraints.s_PA=new e.b2Vec2,e.b2PulleyJoint.prototype.InitVelocityConstraints.s_PB=new e.b2Vec2,e.b2PulleyJoint.prototype.SolveVelocityConstraints=function(t){var o=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,r=e.b2AddVCrossSV(o,i,this.m_rA,e.b2PulleyJoint.prototype.SolveVelocityConstraints.s_vpA),a=e.b2AddVCrossSV(n,s,this.m_rB,e.b2PulleyJoint.prototype.SolveVelocityConstraints.s_vpB),l=-e.b2DotVV(this.m_uA,r)-this.m_ratio*e.b2DotVV(this.m_uB,a),p=-this.m_mass*l;this.m_impulse+=p;var m=e.b2MulSV(-p,this.m_uA,e.b2PulleyJoint.prototype.SolveVelocityConstraints.s_PA),_=e.b2MulSV(-this.m_ratio*p,this.m_uB,e.b2PulleyJoint.prototype.SolveVelocityConstraints.s_PB);o.SelfMulAdd(this.m_invMassA,m),i+=this.m_invIA*e.b2CrossVV(this.m_rA,m),n.SelfMulAdd(this.m_invMassB,_),s+=this.m_invIB*e.b2CrossVV(this.m_rB,_),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s},e.b2PulleyJoint.prototype.SolveVelocityConstraints.s_vpA=new e.b2Vec2,e.b2PulleyJoint.prototype.SolveVelocityConstraints.s_vpB=new e.b2Vec2,e.b2PulleyJoint.prototype.SolveVelocityConstraints.s_PA=new e.b2Vec2,e.b2PulleyJoint.prototype.SolveVelocityConstraints.s_PB=new e.b2Vec2,e.b2PulleyJoint.prototype.SolvePositionConstraints=function(t){var o=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,r=this.m_qA.SetAngleRadians(i),a=this.m_qB.SetAngleRadians(s);\ne.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=e.b2MulRV(r,this.m_lalcA,this.m_rA);e.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var p=e.b2MulRV(a,this.m_lalcB,this.m_rB),m=this.m_uA.Copy(o).SelfAdd(l).SelfSub(this.m_groundAnchorA),_=this.m_uB.Copy(n).SelfAdd(p).SelfSub(this.m_groundAnchorB),b=m.GetLength(),h=_.GetLength();b>10*e.b2_linearSlop?m.SelfMul(1/b):m.SetZero(),h>10*e.b2_linearSlop?_.SelfMul(1/h):_.SetZero();var c=e.b2CrossVV(l,m),u=e.b2CrossVV(p,_),y=this.m_invMassA+this.m_invIA*c*c,d=this.m_invMassB+this.m_invIB*u*u,f=y+this.m_ratio*this.m_ratio*d;f>0&&(f=1/f);var A=this.m_constant-b-this.m_ratio*h,S=e.b2Abs(A),C=-f*A,v=e.b2MulSV(-C,m,e.b2PulleyJoint.prototype.SolvePositionConstraints.s_PA),x=e.b2MulSV(-this.m_ratio*C,_,e.b2PulleyJoint.prototype.SolvePositionConstraints.s_PB);return o.SelfMulAdd(this.m_invMassA,v),i+=this.m_invIA*e.b2CrossVV(l,v),n.SelfMulAdd(this.m_invMassB,x),s+=this.m_invIB*e.b2CrossVV(p,x),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,S<e.b2_linearSlop},e.b2PulleyJoint.prototype.SolvePositionConstraints.s_PA=new e.b2Vec2,e.b2PulleyJoint.prototype.SolvePositionConstraints.s_PB=new e.b2Vec2,e.b2PulleyJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.b2PulleyJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.b2PulleyJoint.prototype.GetReactionForce=function(t,e){return e.Set(t*this.m_impulse*this.m_uB.x,t*this.m_impulse*this.m_uB.y)},e.b2PulleyJoint.prototype.GetReactionTorque=function(){return 0},e.b2PulleyJoint.prototype.GetGroundAnchorA=function(t){return t.Copy(this.m_groundAnchorA)},e.b2PulleyJoint.prototype.GetGroundAnchorB=function(t){return t.Copy(this.m_groundAnchorB)},e.b2PulleyJoint.prototype.GetLengthA=function(){return this.m_lengthA},e.b2PulleyJoint.prototype.GetLengthB=function(){return this.m_lengthB},e.b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio},e.b2PulleyJoint.prototype.GetCurrentLengthA=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e.b2PulleyJoint.prototype.GetCurrentLengthA.s_p),o=this.m_groundAnchorA;return e.b2DistanceVV(t,o)},e.b2PulleyJoint.prototype.GetCurrentLengthA.s_p=new e.b2Vec2,e.b2PulleyJoint.prototype.GetCurrentLengthB=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e.b2PulleyJoint.prototype.GetCurrentLengthB.s_p),o=this.m_groundAnchorB;return e.b2DistanceVV(t,o)},e.b2PulleyJoint.prototype.GetCurrentLengthB.s_p=new e.b2Vec2,e.b2PulleyJoint.prototype.Dump=function(){if(e.DEBUG){var t=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;e.b2Log("  /*box2d.b2PulleyJointDef*/ var jd = new box2d.b2PulleyJointDef();\\n"),e.b2Log("  jd.bodyA = bodies[%d];\\n",t),e.b2Log("  jd.bodyB = bodies[%d];\\n",o),e.b2Log("  jd.collideConnected = %s;\\n",this.m_collideConnected?"true":"false"),e.b2Log("  jd.groundAnchorA.Set(%.15f, %.15f);\\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),e.b2Log("  jd.groundAnchorB.Set(%.15f, %.15f);\\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),e.b2Log("  jd.localAnchorA.Set(%.15f, %.15f);\\n",this.m_localAnchorA.x,this.m_localAnchorA.y),e.b2Log("  jd.localAnchorB.Set(%.15f, %.15f);\\n",this.m_localAnchorB.x,this.m_localAnchorB.y),e.b2Log("  jd.lengthA = %.15f;\\n",this.m_lengthA),e.b2Log("  jd.lengthB = %.15f;\\n",this.m_lengthB),e.b2Log("  jd.ratio = %.15f;\\n",this.m_ratio),e.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\\n",this.m_index)}},e.b2PulleyJoint.prototype.ShiftOrigin=function(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)},e}(e,n,i,o),E=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2Rope&&(e.b2Rope={}),e.b2RopeDef=function(){this.vertices=new Array,this.masses=new Array,this.gravity=new e.b2Vec2},e.b2RopeDef.prototype.vertices=null,e.b2RopeDef.prototype.count=0,e.b2RopeDef.prototype.masses=null,e.b2RopeDef.prototype.gravity=null,e.b2RopeDef.prototype.damping=.1,e.b2RopeDef.prototype.k2=.9,e.b2RopeDef.prototype.k3=.1,e.b2Rope=function(){this.m_gravity=new e.b2Vec2},e.b2Rope.prototype.m_count=0,e.b2Rope.prototype.m_ps=null,e.b2Rope.prototype.m_p0s=null,e.b2Rope.prototype.m_vs=null,e.b2Rope.prototype.m_ims=null,e.b2Rope.prototype.m_Ls=null,e.b2Rope.prototype.m_as=null,e.b2Rope.prototype.m_gravity=null,e.b2Rope.prototype.m_damping=0,e.b2Rope.prototype.m_k2=1,e.b2Rope.prototype.m_k3=.1,e.b2Rope.prototype.GetVertexCount=function(){return this.m_count},e.b2Rope.prototype.GetVertices=function(){return this.m_ps},e.b2Rope.prototype.Initialize=function(t){e.ENABLE_ASSERTS&&e.b2Assert(t.count>=3),this.m_count=t.count,this.m_ps=e.b2Vec2.MakeArray(this.m_count),this.m_p0s=e.b2Vec2.MakeArray(this.m_count),this.m_vs=e.b2Vec2.MakeArray(this.m_count),this.m_ims=e.b2MakeNumberArray(this.m_count);for(var o=0;o<this.m_count;++o){this.m_ps[o].Copy(t.vertices[o]),this.m_p0s[o].Copy(t.vertices[o]),this.m_vs[o].SetZero();var i=t.masses[o];this.m_ims[o]=i>0?1/i:0}var n=this.m_count-1,s=this.m_count-2;this.m_Ls=e.b2MakeNumberArray(n),this.m_as=e.b2MakeNumberArray(s);for(var o=0;n>o;++o){var r=this.m_ps[o],a=this.m_ps[o+1];this.m_Ls[o]=e.b2DistanceVV(r,a)}for(var o=0;s>o;++o){var r=this.m_ps[o],a=this.m_ps[o+1],l=this.m_ps[o+2],p=e.b2SubVV(a,r,e.b2Vec2.s_t0),m=e.b2SubVV(l,a,e.b2Vec2.s_t1),_=e.b2CrossVV(p,m),b=e.b2DotVV(p,m);this.m_as[o]=e.b2Atan2(_,b)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3},e.b2Rope.prototype.Step=function(t,o){if(0!=t){for(var i=Math.exp(-t*this.m_damping),n=0;n<this.m_count;++n)this.m_p0s[n].Copy(this.m_ps[n]),this.m_ims[n]>0&&this.m_vs[n].SelfMulAdd(t,this.m_gravity),this.m_vs[n].SelfMul(i),this.m_ps[n].SelfMulAdd(t,this.m_vs[n]);for(var n=0;o>n;++n)this.SolveC2(),this.SolveC3(),this.SolveC2();for(var s=1/t,n=0;n<this.m_count;++n)e.b2MulSV(s,e.b2SubVV(this.m_ps[n],this.m_p0s[n],e.b2Vec2.s_t0),this.m_vs[n])}},e.b2Rope.prototype.SolveC2=function(){for(var t=this.m_count-1,o=0;t>o;++o){var i=this.m_ps[o],n=this.m_ps[o+1],s=e.b2SubVV(n,i,e.b2Rope.s_d),r=s.Normalize(),a=this.m_ims[o],l=this.m_ims[o+1];if(a+l!=0){var p=a/(a+l),m=l/(a+l);i.SelfMulSub(this.m_k2*p*(this.m_Ls[o]-r),s),n.SelfMulAdd(this.m_k2*m*(this.m_Ls[o]-r),s)}}},e.b2Rope.s_d=new e.b2Vec2,e.b2Rope.prototype.SetAngleRadians=function(t){for(var e=this.m_count-2,o=0;e>o;++o)this.m_as[o]=t},e.b2Rope.prototype.SolveC3=function(){for(var t=this.m_count-2,o=0;t>o;++o){var i=this.m_ps[o],n=this.m_ps[o+1],s=this.m_ps[o+2],r=this.m_ims[o],a=this.m_ims[o+1],l=this.m_ims[o+2],p=e.b2SubVV(n,i,e.b2Rope.s_d1),m=e.b2SubVV(s,n,e.b2Rope.s_d2),_=p.GetLengthSquared(),b=m.GetLengthSquared();if(_*b!=0){var h=e.b2CrossVV(p,m),c=e.b2DotVV(p,m),u=e.b2Atan2(h,c),y=e.b2MulSV(-1/_,p.SelfSkew(),e.b2Rope.s_Jd1),d=e.b2MulSV(1/b,m.SelfSkew(),e.b2Rope.s_Jd2),f=e.b2NegV(y,e.b2Rope.s_J1),A=e.b2SubVV(y,d,e.b2Rope.s_J2),S=d,C=r*e.b2DotVV(f,f)+a*e.b2DotVV(A,A)+l*e.b2DotVV(S,S);if(0!=C){C=1/C;for(var v=u-this.m_as[o];v>e.b2_pi;)u-=2*e.b2_pi,v=u-this.m_as[o];for(;v<-e.b2_pi;)u+=2*e.b2_pi,v=u-this.m_as[o];var x=-this.m_k3*C*v;i.SelfMulAdd(r*x,f),n.SelfMulAdd(a*x,A),s.SelfMulAdd(l*x,S)}}}},e.b2Rope.s_d1=new e.b2Vec2,e.b2Rope.s_d2=new e.b2Vec2,e.b2Rope.s_Jd1=new e.b2Vec2,e.b2Rope.s_Jd2=new e.b2Vec2,e.b2Rope.s_J1=new e.b2Vec2,e.b2Rope.s_J2=new e.b2Vec2,e.b2Rope.prototype.Draw=function(t){for(var o=new e.b2Color(.4,.5,.7),i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],o)},e}(e,B,i),F=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2RopeJoint&&(e.b2RopeJoint={}),e.b2RopeJointDef=function(){t.base(this,e.b2JointType.e_ropeJoint),this.localAnchorA=new e.b2Vec2(-1,0),this.localAnchorB=new e.b2Vec2(1,0)},t.inherits(e.b2RopeJointDef,e.b2JointDef),e.b2RopeJointDef.prototype.localAnchorA=null,e.b2RopeJointDef.prototype.localAnchorB=null,e.b2RopeJointDef.prototype.maxLength=0,e.b2RopeJoint=function(o){t.base(this,o),this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_maxLength=o.maxLength,this.m_u=new e.b2Vec2,this.m_rA=new e.b2Vec2,this.m_rB=new e.b2Vec2,this.m_localCenterA=new e.b2Vec2,this.m_localCenterB=new e.b2Vec2,this.m_qA=new e.b2Rot,this.m_qB=new e.b2Rot,this.m_lalcA=new e.b2Vec2,this.m_lalcB=new e.b2Vec2},t.inherits(e.b2RopeJoint,e.b2Joint),e.b2RopeJoint.prototype.m_localAnchorA=null,e.b2RopeJoint.prototype.m_localAnchorB=null,e.b2RopeJoint.prototype.m_maxLength=0,e.b2RopeJoint.prototype.m_length=0,e.b2RopeJoint.prototype.m_impulse=0,e.b2RopeJoint.prototype.m_indexA=0,e.b2RopeJoint.prototype.m_indexB=0,e.b2RopeJoint.prototype.m_u=null,e.b2RopeJoint.prototype.m_rA=null,e.b2RopeJoint.prototype.m_rB=null,e.b2RopeJoint.prototype.m_localCenterA=null,e.b2RopeJoint.prototype.m_localCenterB=null,e.b2RopeJoint.prototype.m_invMassA=0,e.b2RopeJoint.prototype.m_invMassB=0,e.b2RopeJoint.prototype.m_invIA=0,e.b2RopeJoint.prototype.m_invIB=0,e.b2RopeJoint.prototype.m_mass=0,e.b2RopeJoint.prototype.m_state=e.b2LimitState.e_inactiveLimit,e.b2RopeJoint.prototype.m_qA=null,e.b2RopeJoint.prototype.m_qB=null,e.b2RopeJoint.prototype.m_lalcA=null,e.b2RopeJoint.prototype.m_lalcB=null,e.b2RopeJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,p=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngleRadians(i),_=this.m_qB.SetAngleRadians(a);e.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),e.b2MulRV(m,this.m_lalcA,this.m_rA),e.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),e.b2MulRV(_,this.m_lalcB,this.m_rB),this.m_u.Copy(r).SelfAdd(this.m_rB).SelfSub(o).SelfSub(this.m_rA),this.m_length=this.m_u.GetLength();var b=this.m_length-this.m_maxLength;if(this.m_state=b>0?e.b2LimitState.e_atUpperLimit:e.b2LimitState.e_inactiveLimit,!(this.m_length>e.b2_linearSlop))return this.m_u.SetZero(),this.m_mass=0,this.m_impulse=0,void 0;this.m_u.SelfMul(1/this.m_length);var h=e.b2CrossVV(this.m_rA,this.m_u),c=e.b2CrossVV(this.m_rB,this.m_u),u=this.m_invMassA+this.m_invIA*h*h+this.m_invMassB+this.m_invIB*c*c;if(this.m_mass=0!=u?1/u:0,t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var y=e.b2MulSV(this.m_impulse,this.m_u,e.b2RopeJoint.prototype.InitVelocityConstraints.s_P);n.SelfMulSub(this.m_invMassA,y),s-=this.m_invIA*e.b2CrossVV(this.m_rA,y),l.SelfMulAdd(this.m_invMassB,y),p+=this.m_invIB*e.b2CrossVV(this.m_rB,y)}else this.m_impulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=p},e.b2RopeJoint.prototype.InitVelocityConstraints.s_P=new e.b2Vec2,e.b2RopeJoint.prototype.SolveVelocityConstraints=function(t){var o=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,r=e.b2AddVCrossSV(o,i,this.m_rA,e.b2RopeJoint.prototype.SolveVelocityConstraints.s_vpA),a=e.b2AddVCrossSV(n,s,this.m_rB,e.b2RopeJoint.prototype.SolveVelocityConstraints.s_vpB),l=this.m_length-this.m_maxLength,p=e.b2DotVV(this.m_u,e.b2SubVV(a,r,e.b2Vec2.s_t0));0>l&&(p+=t.step.inv_dt*l);var m=-this.m_mass*p,_=this.m_impulse;this.m_impulse=e.b2Min(0,this.m_impulse+m),m=this.m_impulse-_;var b=e.b2MulSV(m,this.m_u,e.b2RopeJoint.prototype.SolveVelocityConstraints.s_P);o.SelfMulSub(this.m_invMassA,b),i-=this.m_invIA*e.b2CrossVV(this.m_rA,b),n.SelfMulAdd(this.m_invMassB,b),s+=this.m_invIB*e.b2CrossVV(this.m_rB,b),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s},e.b2RopeJoint.prototype.SolveVelocityConstraints.s_vpA=new e.b2Vec2,e.b2RopeJoint.prototype.SolveVelocityConstraints.s_vpB=new e.b2Vec2,e.b2RopeJoint.prototype.SolveVelocityConstraints.s_P=new e.b2Vec2,e.b2RopeJoint.prototype.SolvePositionConstraints=function(t){var o=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,r=this.m_qA.SetAngleRadians(i),a=this.m_qB.SetAngleRadians(s);e.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=e.b2MulRV(r,this.m_lalcA,this.m_rA);e.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var p=e.b2MulRV(a,this.m_lalcB,this.m_rB),m=this.m_u.Copy(n).SelfAdd(p).SelfSub(o).SelfSub(l),_=m.Normalize(),b=_-this.m_maxLength;b=e.b2Clamp(b,0,e.b2_maxLinearCorrection);var h=-this.m_mass*b,c=e.b2MulSV(h,m,e.b2RopeJoint.prototype.SolvePositionConstraints.s_P);return o.SelfMulSub(this.m_invMassA,c),i-=this.m_invIA*e.b2CrossVV(l,c),n.SelfMulAdd(this.m_invMassB,c),s+=this.m_invIB*e.b2CrossVV(p,c),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,_-this.m_maxLength<e.b2_linearSlop},e.b2RopeJoint.prototype.SolvePositionConstraints.s_P=new e.b2Vec2,e.b2RopeJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.b2RopeJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.b2RopeJoint.prototype.GetReactionForce=function(t,o){var i=e.b2MulSV(t*this.m_impulse,this.m_u,o);return i},e.b2RopeJoint.prototype.GetReactionTorque=function(){return 0},e.b2RopeJoint.prototype.GetLocalAnchorA=function(t){return t.Copy(this.m_localAnchorA)},e.b2RopeJoint.prototype.GetLocalAnchorB=function(t){return t.Copy(this.m_localAnchorB)},e.b2RopeJoint.prototype.SetMaxLength=function(t){this.m_maxLength=t},e.b2RopeJoint.prototype.GetMaxLength=function(){return this.m_maxLength},e.b2RopeJoint.prototype.GetLimitState=function(){return this.m_state},e.b2RopeJoint.prototype.Dump=function(){if(e.DEBUG){var t=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;e.b2Log("  /*box2d.b2RopeJointDef*/ var jd = new box2d.b2RopeJointDef();\\n"),e.b2Log("  jd.bodyA = bodies[%d];\\n",t),e.b2Log("  jd.bodyB = bodies[%d];\\n",o),e.b2Log("  jd.collideConnected = %s;\\n",this.m_collideConnected?"true":"false"),e.b2Log("  jd.localAnchorA.Set(%.15f, %.15f);\\n",this.m_localAnchorA.x,this.m_localAnchorA.y),e.b2Log("  jd.localAnchorB.Set(%.15f, %.15f);\\n",this.m_localAnchorB.x,this.m_localAnchorB.y),e.b2Log("  jd.maxLength = %.15f;\\n",this.m_maxLength),e.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\\n",this.m_index)}},e}(e,n,i,o),G=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2TensorDampingController&&(e.b2TensorDampingController={}),e.b2TensorDampingController=function(){t.base(this),this.T=new e.b2Mat22,this.maxTimestep=0},t.inherits(e.b2TensorDampingController,e.b2Controller),e.b2TensorDampingController.prototype.T=new e.b2Mat22,e.b2TensorDampingController.prototype.maxTimestep=0,e.b2TensorDampingController.prototype.Step=function(t){var o=t.dt;if(!(o<=e.b2_epsilon)){o>this.maxTimestep&&this.maxTimestep>0&&(o=this.maxTimestep);for(var i=this.m_bodyList;i;i=i.nextBody){var n=i.body;if(n.IsAwake()){var s=n.GetWorldVector(e.b2MulMV(this.T,n.GetLocalVector(n.GetLinearVelocity(),e.b2Vec2.s_t0),e.b2Vec2.s_t1),e.b2TensorDampingController.prototype.Step.s_damping);n.SetLinearVelocity(e.b2AddVV(n.GetLinearVelocity(),e.b2MulSV(o,s,e.b2Vec2.s_t0),e.b2Vec2.s_t1))}}}},e.b2TensorDampingController.prototype.Step.s_damping=new e.b2Vec2,e.b2TensorDampingController.prototype.SetAxisAligned=function(t,o){this.T.ex.x=-t,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-o,this.maxTimestep=t>0||o>0?1/e.b2Max(t,o):0},e}(e,c,i,o),N=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2TimeStep&&(e.b2TimeStep={}),e.b2Profile=function(){},e.b2Profile.prototype.step=0,e.b2Profile.prototype.collide=0,e.b2Profile.prototype.solve=0,e.b2Profile.prototype.solveInit=0,e.b2Profile.prototype.solveVelocity=0,e.b2Profile.prototype.solvePosition=0,e.b2Profile.prototype.broadphase=0,e.b2Profile.prototype.solveTOI=0,e.b2Profile.prototype.Reset=function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this},e.b2TimeStep=function(){},e.b2TimeStep.prototype.dt=0,e.b2TimeStep.prototype.inv_dt=0,e.b2TimeStep.prototype.dtRatio=0,e.b2TimeStep.prototype.velocityIterations=0,e.b2TimeStep.prototype.positionIterations=0,e.b2TimeStep.prototype.warmStarting=!1,e.b2TimeStep.prototype.Copy=function(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.warmStarting=t.warmStarting,this},e.b2Position=function(){this.c=new e.b2Vec2},e.b2Position.prototype.c=null,e.b2Position.prototype.a=0,e.b2Position.MakeArray=function(t){return e.b2MakeArray(t,function(){return new e.b2Position})},e.b2Velocity=function(){this.v=new e.b2Vec2},e.b2Velocity.prototype.v=null,e.b2Velocity.prototype.w=0,e.b2Velocity.MakeArray=function(t){return e.b2MakeArray(t,function(){return new e.b2Velocity})},e.b2SolverData=function(){this.step=new e.b2TimeStep},e.b2SolverData.prototype.step=null,e.b2SolverData.prototype.positions=null,e.b2SolverData.prototype.velocities=null,e}(e,o),k=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2WeldJoint&&(e.b2WeldJoint={}),e.b2WeldJointDef=function(){t.base(this,e.b2JointType.e_weldJoint),this.localAnchorA=new e.b2Vec2,this.localAnchorB=new e.b2Vec2},t.inherits(e.b2WeldJointDef,e.b2JointDef),e.b2WeldJointDef.prototype.localAnchorA=null,e.b2WeldJointDef.prototype.localAnchorB=null,e.b2WeldJointDef.prototype.referenceAngle=0,e.b2WeldJointDef.prototype.frequencyHz=0,e.b2WeldJointDef.prototype.dampingRatio=0,e.b2WeldJointDef.prototype.Initialize=function(t,e,o){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngleRadians()-this.bodyA.GetAngleRadians()},e.b2WeldJoint=function(o){t.base(this,o),this.m_frequencyHz=o.frequencyHz,this.m_dampingRatio=o.dampingRatio,this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_referenceAngle=o.referenceAngle,this.m_impulse=new e.b2Vec3(0,0,0),this.m_rA=new e.b2Vec2,this.m_rB=new e.b2Vec2,this.m_localCenterA=new e.b2Vec2,this.m_localCenterB=new e.b2Vec2,this.m_mass=new e.b2Mat33,this.m_qA=new e.b2Rot,this.m_qB=new e.b2Rot,this.m_lalcA=new e.b2Vec2,this.m_lalcB=new e.b2Vec2,this.m_K=new e.b2Mat33},t.inherits(e.b2WeldJoint,e.b2Joint),e.b2WeldJoint.prototype.m_frequencyHz=0,e.b2WeldJoint.prototype.m_dampingRatio=0,e.b2WeldJoint.prototype.m_bias=0,e.b2WeldJoint.prototype.m_localAnchorA=null,e.b2WeldJoint.prototype.m_localAnchorB=null,e.b2WeldJoint.prototype.m_referenceAngle=0,e.b2WeldJoint.prototype.m_gamma=0,e.b2WeldJoint.prototype.m_impulse=null,e.b2WeldJoint.prototype.m_indexA=0,e.b2WeldJoint.prototype.m_indexB=0,e.b2WeldJoint.prototype.m_rA=null,e.b2WeldJoint.prototype.m_rB=null,e.b2WeldJoint.prototype.m_localCenterA=null,e.b2WeldJoint.prototype.m_localCenterB=null,e.b2WeldJoint.prototype.m_invMassA=0,e.b2WeldJoint.prototype.m_invMassB=0,e.b2WeldJoint.prototype.m_invIA=0,e.b2WeldJoint.prototype.m_invIB=0,e.b2WeldJoint.prototype.m_mass=null,e.b2WeldJoint.prototype.m_qA=null,e.b2WeldJoint.prototype.m_qB=null,e.b2WeldJoint.prototype.m_lalcA=null,e.b2WeldJoint.prototype.m_lalcB=null,e.b2WeldJoint.prototype.m_K=null,e.b2WeldJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngleRadians(o),p=this.m_qB.SetAngleRadians(s);e.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),e.b2MulRV(l,this.m_lalcA,this.m_rA),e.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),e.b2MulRV(p,this.m_lalcB,this.m_rB);var m=this.m_invMassA,_=this.m_invMassB,b=this.m_invIA,h=this.m_invIB,c=this.m_K;if(c.ex.x=m+_+this.m_rA.y*this.m_rA.y*b+this.m_rB.y*this.m_rB.y*h,c.ey.x=-this.m_rA.y*this.m_rA.x*b-this.m_rB.y*this.m_rB.x*h,c.ez.x=-this.m_rA.y*b-this.m_rB.y*h,c.ex.y=c.ey.x,c.ey.y=m+_+this.m_rA.x*this.m_rA.x*b+this.m_rB.x*this.m_rB.x*h,c.ez.y=this.m_rA.x*b+this.m_rB.x*h,c.ex.z=c.ez.x,c.ey.z=c.ez.y,c.ez.z=b+h,this.m_frequencyHz>0){c.GetInverse22(this.m_mass);var u=b+h,y=u>0?1/u:0,d=s-o-this.m_referenceAngle,f=2*e.b2_pi*this.m_frequencyHz,A=2*y*this.m_dampingRatio*f,S=y*f*f,C=t.step.dt;this.m_gamma=C*(A+C*S),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=d*C*S*this.m_gamma,u+=this.m_gamma,this.m_mass.ez.z=0!=u?1/u:0}else c.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);var v=e.b2WeldJoint.prototype.InitVelocityConstraints.s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(m,v),n-=b*(e.b2CrossVV(this.m_rA,v)+this.m_impulse.z),r.SelfMulAdd(_,v),a+=h*(e.b2CrossVV(this.m_rB,v)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=a},e.b2WeldJoint.prototype.InitVelocityConstraints.s_P=new e.b2Vec2,e.b2WeldJoint.prototype.SolveVelocityConstraints=function(t){var o=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,p=this.m_invIB;if(this.m_frequencyHz>0){var m=s-i,_=-this.m_mass.ez.z*(m+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=_,i-=l*_,s+=p*_;var b=e.b2SubVV(e.b2AddVCrossSV(n,s,this.m_rB,e.b2Vec2.s_t0),e.b2AddVCrossSV(o,i,this.m_rA,e.b2Vec2.s_t1),e.b2WeldJoint.prototype.SolveVelocityConstraints.s_Cdot1),h=e.b2MulM33XY(this.m_mass,b.x,b.y,e.b2WeldJoint.prototype.SolveVelocityConstraints.s_impulse1).SelfNeg();this.m_impulse.x+=h.x,this.m_impulse.y+=h.y;var c=h;o.SelfMulSub(r,c),i-=l*e.b2CrossVV(this.m_rA,c),n.SelfMulAdd(a,c),s+=p*e.b2CrossVV(this.m_rB,c)}else{var b=e.b2SubVV(e.b2AddVCrossSV(n,s,this.m_rB,e.b2Vec2.s_t0),e.b2AddVCrossSV(o,i,this.m_rA,e.b2Vec2.s_t1),e.b2WeldJoint.prototype.SolveVelocityConstraints.s_Cdot1),m=s-i,u=e.b2MulM33XYZ(this.m_mass,b.x,b.y,m,e.b2WeldJoint.prototype.SolveVelocityConstraints.s_impulse).SelfNeg();this.m_impulse.SelfAdd(u);var c=e.b2WeldJoint.prototype.SolveVelocityConstraints.s_P.Set(u.x,u.y);o.SelfMulSub(r,c),i-=l*(e.b2CrossVV(this.m_rA,c)+u.z),n.SelfMulAdd(a,c),s+=p*(e.b2CrossVV(this.m_rB,c)+u.z)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s},e.b2WeldJoint.prototype.SolveVelocityConstraints.s_Cdot1=new e.b2Vec2,e.b2WeldJoint.prototype.SolveVelocityConstraints.s_impulse1=new e.b2Vec2,e.b2WeldJoint.prototype.SolveVelocityConstraints.s_impulse=new e.b2Vec3,e.b2WeldJoint.prototype.SolveVelocityConstraints.s_P=new e.b2Vec2,e.b2WeldJoint.prototype.SolvePositionConstraints=function(t){var o=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,r=this.m_qA.SetAngleRadians(i),a=this.m_qB.SetAngleRadians(s),l=this.m_invMassA,p=this.m_invMassB,m=this.m_invIA,_=this.m_invIB;e.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var b=e.b2MulRV(r,this.m_lalcA,this.m_rA);e.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var h,c,u=e.b2MulRV(a,this.m_lalcB,this.m_rB),y=this.m_K;if(y.ex.x=l+p+b.y*b.y*m+u.y*u.y*_,y.ey.x=-b.y*b.x*m-u.y*u.x*_,y.ez.x=-b.y*m-u.y*_,y.ex.y=y.ey.x,y.ey.y=l+p+b.x*b.x*m+u.x*u.x*_,y.ez.y=b.x*m+u.x*_,y.ex.z=y.ez.x,y.ey.z=y.ez.y,y.ez.z=m+_,this.m_frequencyHz>0){var d=e.b2SubVV(e.b2AddVV(n,u,e.b2Vec2.s_t0),e.b2AddVV(o,b,e.b2Vec2.s_t1),e.b2WeldJoint.prototype.SolvePositionConstraints.s_C1);h=d.GetLength(),c=0;var f=y.Solve22(d.x,d.y,e.b2WeldJoint.prototype.SolvePositionConstraints.s_P).SelfNeg();o.SelfMulSub(l,f),i-=m*e.b2CrossVV(b,f),n.SelfMulAdd(p,f),s+=_*e.b2CrossVV(u,f)}else{var d=e.b2SubVV(e.b2AddVV(n,u,e.b2Vec2.s_t0),e.b2AddVV(o,b,e.b2Vec2.s_t1),e.b2WeldJoint.prototype.SolvePositionConstraints.s_C1),A=s-i-this.m_referenceAngle;h=d.GetLength(),c=e.b2Abs(A);var S=y.Solve33(d.x,d.y,A,e.b2WeldJoint.prototype.SolvePositionConstraints.s_impulse).SelfNeg(),f=e.b2WeldJoint.prototype.SolvePositionConstraints.s_P.Set(S.x,S.y);o.SelfMulSub(l,f),i-=m*(e.b2CrossVV(this.m_rA,f)+S.z),n.SelfMulAdd(p,f),s+=_*(e.b2CrossVV(this.m_rB,f)+S.z)}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,h<=e.b2_linearSlop&&c<=e.b2_angularSlop},e.b2WeldJoint.prototype.SolvePositionConstraints.s_C1=new e.b2Vec2,e.b2WeldJoint.prototype.SolvePositionConstraints.s_P=new e.b2Vec2,e.b2WeldJoint.prototype.SolvePositionConstraints.s_impulse=new e.b2Vec3,e.b2WeldJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.b2WeldJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.b2WeldJoint.prototype.GetReactionForce=function(t,e){return e.Set(t*this.m_impulse.x,t*this.m_impulse.y)},e.b2WeldJoint.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z},e.b2WeldJoint.prototype.GetLocalAnchorA=function(t){return t.Copy(this.m_localAnchorA)},e.b2WeldJoint.prototype.GetLocalAnchorB=function(t){return t.Copy(this.m_localAnchorB)},e.b2WeldJoint.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},e.b2WeldJoint.prototype.SetFrequency=function(t){this.m_frequencyHz=t},e.b2WeldJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},e.b2WeldJoint.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},e.b2WeldJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},e.b2WeldJoint.prototype.Dump=function(){if(e.DEBUG){var t=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;e.b2Log("  /*box2d.b2WeldJointDef*/ var jd = new box2d.b2WeldJointDef();\\n"),e.b2Log("  jd.bodyA = bodies[%d];\\n",t),e.b2Log("  jd.bodyB = bodies[%d];\\n",o),e.b2Log("  jd.collideConnected = %s;\\n",this.m_collideConnected?"true":"false"),e.b2Log("  jd.localAnchorA.Set(%.15f, %.15f);\\n",this.m_localAnchorA.x,this.m_localAnchorA.y),e.b2Log("  jd.localAnchorB.Set(%.15f, %.15f);\\n",this.m_localAnchorB.x,this.m_localAnchorB.y),e.b2Log("  jd.referenceAngle = %.15f;\\n",this.m_referenceAngle),e.b2Log("  jd.frequencyHz = %.15f;\\n",this.m_frequencyHz),e.b2Log("  jd.dampingRatio = %.15f;\\n",this.m_dampingRatio),e.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\\n",this.m_index)}},e}(e,n,i,o),W=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2WheelJoint&&(e.b2WheelJoint={}),e.b2WheelJointDef=function(){t.base(this,e.b2JointType.e_wheelJoint),this.localAnchorA=new e.b2Vec2(0,0),this.localAnchorB=new e.b2Vec2(0,0),this.localAxisA=new e.b2Vec2(1,0)},t.inherits(e.b2WheelJointDef,e.b2JointDef),e.b2WheelJointDef.prototype.localAnchorA=null,e.b2WheelJointDef.prototype.localAnchorB=null,e.b2WheelJointDef.prototype.localAxisA=null,e.b2WheelJointDef.prototype.enableMotor=!1,e.b2WheelJointDef.prototype.maxMotorTorque=0,e.b2WheelJointDef.prototype.motorSpeed=0,e.b2WheelJointDef.prototype.frequencyHz=2,e.b2WheelJointDef.prototype.dampingRatio=.7,e.b2WheelJointDef.prototype.Initialize=function(t,e,o,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(o,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.bodyA.GetLocalVector(i,this.localAxisA)},e.b2WheelJoint=function(o){t.base(this,o),this.m_frequencyHz=o.frequencyHz,this.m_dampingRatio=o.dampingRatio,this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_localXAxisA=o.localAxisA.Clone(),this.m_localYAxisA=e.b2CrossOneV(this.m_localXAxisA,new e.b2Vec2),this.m_maxMotorTorque=o.maxMotorTorque,this.m_motorSpeed=o.motorSpeed,this.m_enableMotor=o.enableMotor,this.m_localCenterA=new e.b2Vec2,this.m_localCenterB=new e.b2Vec2,this.m_ax=new e.b2Vec2,this.m_ay=new e.b2Vec2,this.m_qA=new e.b2Rot,this.m_qB=new e.b2Rot,this.m_lalcA=new e.b2Vec2,this.m_lalcB=new e.b2Vec2,this.m_rA=new e.b2Vec2,this.m_rB=new e.b2Vec2,this.m_ax.SetZero(),this.m_ay.SetZero()},t.inherits(e.b2WheelJoint,e.b2Joint),e.b2WheelJoint.prototype.m_frequencyHz=0,e.b2WheelJoint.prototype.m_dampingRatio=0,e.b2WheelJoint.prototype.m_localAnchorA=null,e.b2WheelJoint.prototype.m_localAnchorB=null,e.b2WheelJoint.prototype.m_localXAxisA=null,e.b2WheelJoint.prototype.m_localYAxisA=null,e.b2WheelJoint.prototype.m_impulse=0,e.b2WheelJoint.prototype.m_motorImpulse=0,e.b2WheelJoint.prototype.m_springImpulse=0,e.b2WheelJoint.prototype.m_maxMotorTorque=0,e.b2WheelJoint.prototype.m_motorSpeed=0,e.b2WheelJoint.prototype.m_enableMotor=!1,e.b2WheelJoint.prototype.m_indexA=0,e.b2WheelJoint.prototype.m_indexB=0,e.b2WheelJoint.prototype.m_localCenterA=null,e.b2WheelJoint.prototype.m_localCenterB=null,e.b2WheelJoint.prototype.m_invMassA=0,e.b2WheelJoint.prototype.m_invMassB=0,e.b2WheelJoint.prototype.m_invIA=0,e.b2WheelJoint.prototype.m_invIB=0,e.b2WheelJoint.prototype.m_ax=null,e.b2WheelJoint.prototype.m_ay=null,e.b2WheelJoint.prototype.m_sAx=0,e.b2WheelJoint.prototype.m_sBx=0,e.b2WheelJoint.prototype.m_sAy=0,e.b2WheelJoint.prototype.m_sBy=0,e.b2WheelJoint.prototype.m_mass=0,e.b2WheelJoint.prototype.m_motorMass=0,e.b2WheelJoint.prototype.m_springMass=0,e.b2WheelJoint.prototype.m_bias=0,e.b2WheelJoint.prototype.m_gamma=0,e.b2WheelJoint.prototype.m_qA=null,e.b2WheelJoint.prototype.m_qB=null,e.b2WheelJoint.prototype.m_lalcA=null,e.b2WheelJoint.prototype.m_lalcB=null,e.b2WheelJoint.prototype.m_rA=null,e.b2WheelJoint.prototype.m_rB=null,e.b2WheelJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},e.b2WheelJoint.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},e.b2WheelJoint.prototype.SetSpringFrequencyHz=function(t){this.m_frequencyHz=t},e.b2WheelJoint.prototype.GetSpringFrequencyHz=function(){return this.m_frequencyHz},e.b2WheelJoint.prototype.SetSpringDampingRatio=function(t){this.m_dampingRatio=t},e.b2WheelJoint.prototype.GetSpringDampingRatio=function(){return this.m_dampingRatio},e.b2WheelJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var o=this.m_invMassA,i=this.m_invMassB,n=this.m_invIA,s=this.m_invIB,r=t.positions[this.m_indexA].c,a=t.positions[this.m_indexA].a,l=t.velocities[this.m_indexA].v,p=t.velocities[this.m_indexA].w,m=t.positions[this.m_indexB].c,_=t.positions[this.m_indexB].a,b=t.velocities[this.m_indexB].v,h=t.velocities[this.m_indexB].w,c=this.m_qA.SetAngleRadians(a),u=this.m_qB.SetAngleRadians(_);e.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var y=e.b2MulRV(c,this.m_lalcA,this.m_rA);e.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var d=e.b2MulRV(u,this.m_lalcB,this.m_rB),f=e.b2SubVV(e.b2AddVV(m,d,e.b2Vec2.s_t0),e.b2AddVV(r,y,e.b2Vec2.s_t1),e.b2WheelJoint.prototype.InitVelocityConstraints.s_d);if(e.b2MulRV(c,this.m_localYAxisA,this.m_ay),this.m_sAy=e.b2CrossVV(e.b2AddVV(f,y,e.b2Vec2.s_t0),this.m_ay),this.m_sBy=e.b2CrossVV(d,this.m_ay),this.m_mass=o+i+n*this.m_sAy*this.m_sAy+s*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){e.b2MulRV(c,this.m_localXAxisA,this.m_ax),this.m_sAx=e.b2CrossVV(e.b2AddVV(f,y,e.b2Vec2.s_t0),this.m_ax),this.m_sBx=e.b2CrossVV(d,this.m_ax);var A=o+i+n*this.m_sAx*this.m_sAx+s*this.m_sBx*this.m_sBx;\nif(A>0){this.m_springMass=1/A;var S=e.b2DotVV(f,this.m_ax),C=2*e.b2_pi*this.m_frequencyHz,v=2*this.m_springMass*this.m_dampingRatio*C,x=this.m_springMass*C*C,V=t.step.dt;this.m_gamma=V*(v+V*x),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=S*V*x*this.m_gamma,this.m_springMass=A+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=n+s,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;var g=e.b2AddVV(e.b2MulSV(this.m_impulse,this.m_ay,e.b2Vec2.s_t0),e.b2MulSV(this.m_springImpulse,this.m_ax,e.b2Vec2.s_t1),e.b2WheelJoint.prototype.InitVelocityConstraints.s_P),B=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,w=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;l.SelfMulSub(this.m_invMassA,g),p-=this.m_invIA*B,b.SelfMulAdd(this.m_invMassB,g),h+=this.m_invIB*w}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].w=p,t.velocities[this.m_indexB].w=h},e.b2WheelJoint.prototype.InitVelocityConstraints.s_d=new e.b2Vec2,e.b2WheelJoint.prototype.InitVelocityConstraints.s_P=new e.b2Vec2,e.b2WheelJoint.prototype.SolveVelocityConstraints=function(t){var o=this.m_invMassA,i=this.m_invMassB,n=this.m_invIA,s=this.m_invIB,r=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,l=t.velocities[this.m_indexB].v,p=t.velocities[this.m_indexB].w,m=e.b2DotVV(this.m_ax,e.b2SubVV(l,r,e.b2Vec2.s_t0))+this.m_sBx*p-this.m_sAx*a,_=-this.m_springMass*(m+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=_;var b=e.b2MulSV(_,this.m_ax,e.b2WheelJoint.prototype.SolveVelocityConstraints.s_P),h=_*this.m_sAx,c=_*this.m_sBx;r.SelfMulSub(o,b),a-=n*h,l.SelfMulAdd(i,b),p+=s*c;var m=p-a-this.m_motorSpeed,_=-this.m_motorMass*m,u=this.m_motorImpulse,y=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=e.b2Clamp(this.m_motorImpulse+_,-y,y),_=this.m_motorImpulse-u,a-=n*_,p+=s*_;var m=e.b2DotVV(this.m_ay,e.b2SubVV(l,r,e.b2Vec2.s_t0))+this.m_sBy*p-this.m_sAy*a,_=-this.m_mass*m;this.m_impulse+=_;var b=e.b2MulSV(_,this.m_ay,e.b2WheelJoint.prototype.SolveVelocityConstraints.s_P),h=_*this.m_sAy,c=_*this.m_sBy;r.SelfMulSub(o,b),a-=n*h,l.SelfMulAdd(i,b),p+=s*c,t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=p},e.b2WheelJoint.prototype.SolveVelocityConstraints.s_P=new e.b2Vec2,e.b2WheelJoint.prototype.SolvePositionConstraints=function(t){var o=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,r=this.m_qA.SetAngleRadians(i),a=this.m_qB.SetAngleRadians(s);e.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=e.b2MulRV(r,this.m_lalcA,this.m_rA);e.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var p,m=e.b2MulRV(a,this.m_lalcB,this.m_rB),_=e.b2AddVV(e.b2SubVV(n,o,e.b2Vec2.s_t0),e.b2SubVV(m,l,e.b2Vec2.s_t1),e.b2WheelJoint.prototype.SolvePositionConstraints.s_d),b=e.b2MulRV(r,this.m_localYAxisA,this.m_ay),h=e.b2CrossVV(e.b2AddVV(_,l,e.b2Vec2.s_t0),b),c=e.b2CrossVV(m,b),u=e.b2DotVV(_,this.m_ay),y=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;p=0!=y?-u/y:0;var d=e.b2MulSV(p,b,e.b2WheelJoint.prototype.SolvePositionConstraints.s_P),f=p*h,A=p*c;return o.SelfMulSub(this.m_invMassA,d),i-=this.m_invIA*f,n.SelfMulAdd(this.m_invMassB,d),s+=this.m_invIB*A,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,e.b2Abs(u)<=e.b2_linearSlop},e.b2WheelJoint.prototype.SolvePositionConstraints.s_d=new e.b2Vec2,e.b2WheelJoint.prototype.SolvePositionConstraints.s_P=new e.b2Vec2,e.b2WheelJoint.prototype.GetDefinition=function(t){return e.ENABLE_ASSERTS&&e.b2Assert(!1),t},e.b2WheelJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},e.b2WheelJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},e.b2WheelJoint.prototype.GetReactionForce=function(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e},e.b2WheelJoint.prototype.GetReactionTorque=function(t){return t*this.m_motorImpulse},e.b2WheelJoint.prototype.GetLocalAnchorA=function(t){return t.Copy(this.m_localAnchorA)},e.b2WheelJoint.prototype.GetLocalAnchorB=function(t){return t.Copy(this.m_localAnchorB)},e.b2WheelJoint.prototype.GetLocalAxisA=function(t){return t.Copy(this.m_localXAxisA)},e.b2WheelJoint.prototype.GetJointTranslation=function(){var t=this.m_bodyA,o=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new e.b2Vec2),n=o.GetWorldPoint(this.m_localAnchorB,new e.b2Vec2),s=e.b2SubVV(n,i,new e.b2Vec2),r=t.GetWorldVector(this.m_localXAxisA,new e.b2Vec2),a=e.b2DotVV(s,r);return a},e.b2WheelJoint.prototype.GetJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity,e=this.m_bodyB.m_angularVelocity;return e-t},e.b2WheelJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},e.b2WheelJoint.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},e.b2WheelJoint.prototype.SetMotorSpeed=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},e.b2WheelJoint.prototype.SetMaxMotorTorque=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t},e.b2WheelJoint.prototype.GetMotorTorque=function(t){return t*this.m_motorImpulse},e.b2WheelJoint.prototype.Dump=function(){if(e.DEBUG){var t=this.m_bodyA.m_islandIndex,o=this.m_bodyB.m_islandIndex;e.b2Log("  /*box2d.b2WheelJointDef*/ var jd = new box2d.b2WheelJointDef();\\n"),e.b2Log("  jd.bodyA = bodies[%d];\\n",t),e.b2Log("  jd.bodyB = bodies[%d];\\n",o),e.b2Log("  jd.collideConnected = %s;\\n",this.m_collideConnected?"true":"false"),e.b2Log("  jd.localAnchorA.Set(%.15f, %.15f);\\n",this.m_localAnchorA.x,this.m_localAnchorA.y),e.b2Log("  jd.localAnchorB.Set(%.15f, %.15f);\\n",this.m_localAnchorB.x,this.m_localAnchorB.y),e.b2Log("  jd.localAxisA.Set(%.15f, %.15f);\\n",this.m_localXAxisA.x,this.m_localXAxisA.y),e.b2Log("  jd.enableMotor = %s;\\n",this.m_enableMotor?"true":"false"),e.b2Log("  jd.motorSpeed = %.15f;\\n",this.m_motorSpeed),e.b2Log("  jd.maxMotorTorque = %.15f;\\n",this.m_maxMotorTorque),e.b2Log("  jd.frequencyHz = %.15f;\\n",this.m_frequencyHz),e.b2Log("  jd.dampingRatio = %.15f;\\n",this.m_dampingRatio),e.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\\n",this.m_index)}},e}(e,n,i,o),q=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2ContactFactory&&(e.b2ContactFactory={}),e.b2ContactRegister=function(){},e.b2ContactRegister.prototype.createFcn=null,e.b2ContactRegister.prototype.destroyFcn=null,e.b2ContactRegister.prototype.primary=!1,e.b2ContactFactory=function(t){this.m_allocator=t,this.InitializeRegisters()},e.b2ContactFactory.prototype.m_allocator=null,e.b2ContactFactory.prototype.AddType=function(t,o,i,n){var s=e.b2MakeArray(256,function(){return t()}),r=function(e){return s.length>0?s.pop():t(e)},a=function(t){s.push(t)};this.m_registers[i][n].pool=s,this.m_registers[i][n].createFcn=r,this.m_registers[i][n].destroyFcn=a,this.m_registers[i][n].primary=!0,i!=n&&(this.m_registers[n][i].pool=s,this.m_registers[n][i].createFcn=r,this.m_registers[n][i].destroyFcn=a,this.m_registers[n][i].primary=!1)},e.b2ContactFactory.prototype.InitializeRegisters=function(){this.m_registers=new Array(e.b2ShapeType.e_shapeTypeCount);for(var t=0;t<e.b2ShapeType.e_shapeTypeCount;t++){this.m_registers[t]=new Array(e.b2ShapeType.e_shapeTypeCount);for(var o=0;o<e.b2ShapeType.e_shapeTypeCount;o++)this.m_registers[t][o]=new e.b2ContactRegister}this.AddType(e.b2CircleContact.Create,e.b2CircleContact.Destroy,e.b2ShapeType.e_circleShape,e.b2ShapeType.e_circleShape),this.AddType(e.b2PolygonAndCircleContact.Create,e.b2PolygonAndCircleContact.Destroy,e.b2ShapeType.e_polygonShape,e.b2ShapeType.e_circleShape),this.AddType(e.b2PolygonContact.Create,e.b2PolygonContact.Destroy,e.b2ShapeType.e_polygonShape,e.b2ShapeType.e_polygonShape),this.AddType(e.b2EdgeAndCircleContact.Create,e.b2EdgeAndCircleContact.Destroy,e.b2ShapeType.e_edgeShape,e.b2ShapeType.e_circleShape),this.AddType(e.b2EdgeAndPolygonContact.Create,e.b2EdgeAndPolygonContact.Destroy,e.b2ShapeType.e_edgeShape,e.b2ShapeType.e_polygonShape),this.AddType(e.b2ChainAndCircleContact.Create,e.b2ChainAndCircleContact.Destroy,e.b2ShapeType.e_chainShape,e.b2ShapeType.e_circleShape),this.AddType(e.b2ChainAndPolygonContact.Create,e.b2ChainAndPolygonContact.Destroy,e.b2ShapeType.e_chainShape,e.b2ShapeType.e_polygonShape)},e.b2ContactFactory.prototype.Create=function(t,o,i,n){var s=t.GetType(),r=i.GetType();e.ENABLE_ASSERTS&&e.b2Assert(s>=0&&s<e.b2ShapeType.e_shapeTypeCount),e.ENABLE_ASSERTS&&e.b2Assert(r>=0&&r<e.b2ShapeType.e_shapeTypeCount);var a=this.m_registers[s][r],l=a.createFcn;if(null!=l){if(a.primary){var p=l(this.m_allocator);return p.Reset(t,o,i,n),p}var p=l(this.m_allocator);return p.Reset(i,n,t,o),p}return null},e.b2ContactFactory.prototype.Destroy=function(t){var o=t.m_fixtureA,i=t.m_fixtureB;t.m_manifold.pointCount>0&&0==o.IsSensor()&&0==i.IsSensor()&&(o.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0));var n=o.GetType(),s=i.GetType();e.ENABLE_ASSERTS&&e.b2Assert(n>=0&&s<e.b2ShapeType.e_shapeTypeCount),e.ENABLE_ASSERTS&&e.b2Assert(n>=0&&s<e.b2ShapeType.e_shapeTypeCount);var r=this.m_registers[n][s],a=r.destroyFcn;a(t,this.m_allocator)},e}(e,V,o),z=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2ContactManager&&(e.b2ContactManager={}),e.b2ContactManager=function(){this.m_broadPhase=new e.b2BroadPhase,this.m_contactFactory=new e.b2ContactFactory(this.m_allocator)},e.b2ContactManager.prototype.m_broadPhase=null,e.b2ContactManager.prototype.m_contactList=null,e.b2ContactManager.prototype.m_contactCount=0,e.b2ContactManager.prototype.m_contactFilter=e.b2ContactFilter.b2_defaultFilter,e.b2ContactManager.prototype.m_contactListener=e.b2ContactListener.b2_defaultListener,e.b2ContactManager.prototype.m_allocator=null,e.b2ContactManager.prototype.m_contactFactory=null,e.b2ContactManager.prototype.Destroy=function(t){var e=t.GetFixtureA(),o=t.GetFixtureB(),i=e.GetBody(),n=o.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==i.m_contactList&&(i.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount},e.b2ContactManager.prototype.Collide=function(){for(var t=this.m_contactList;t;){var o=t.GetFixtureA(),i=t.GetFixtureB(),n=t.GetChildIndexA(),s=t.GetChildIndexB(),r=o.GetBody(),a=i.GetBody();if(t.m_flags&e.b2ContactFlag.e_filterFlag){if(0==a.ShouldCollide(r)){var l=t;t=l.m_next,this.Destroy(l);continue}if(this.m_contactFilter&&0==this.m_contactFilter.ShouldCollide(o,i)){l=t,t=l.m_next,this.Destroy(l);continue}t.m_flags&=~e.b2ContactFlag.e_filterFlag}var p=r.IsAwake()&&r.m_type!=e.b2BodyType.b2_staticBody,m=a.IsAwake()&&a.m_type!=e.b2BodyType.b2_staticBody;if(0!=p||0!=m){var _=o.m_proxies[n].proxy,b=i.m_proxies[s].proxy,h=this.m_broadPhase.TestOverlap(_,b);0!=h?(t.Update(this.m_contactListener),t=t.m_next):(l=t,t=l.m_next,this.Destroy(l))}else t=t.m_next}},e.b2ContactManager.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(this)},e.b2ContactManager.prototype.AddPair=function(t,o){e.ENABLE_ASSERTS&&e.b2Assert(t instanceof e.b2FixtureProxy),e.ENABLE_ASSERTS&&e.b2Assert(o instanceof e.b2FixtureProxy);var i=t,n=o,s=i.fixture,r=n.fixture,a=i.childIndex,l=n.childIndex,p=s.GetBody(),m=r.GetBody();if(p!=m){for(var _=m.GetContactList();_;){if(_.other==p){var b=_.contact.GetFixtureA(),h=_.contact.GetFixtureB(),c=_.contact.GetChildIndexA(),u=_.contact.GetChildIndexB();if(b==s&&h==r&&c==a&&u==l)return;if(b==r&&h==s&&c==l&&u==a)return}_=_.next}if(0!=m.ShouldCollide(p)&&(!this.m_contactFilter||0!=this.m_contactFilter.ShouldCollide(s,r))){var y=this.m_contactFactory.Create(s,a,r,l);null!=y&&(s=y.GetFixtureA(),r=y.GetFixtureB(),a=y.GetChildIndexA(),l=y.GetChildIndexB(),p=s.m_body,m=r.m_body,y.m_prev=null,y.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=y),this.m_contactList=y,y.m_nodeA.contact=y,y.m_nodeA.other=m,y.m_nodeA.prev=null,y.m_nodeA.next=p.m_contactList,null!=p.m_contactList&&(p.m_contactList.prev=y.m_nodeA),p.m_contactList=y.m_nodeA,y.m_nodeB.contact=y,y.m_nodeB.other=p,y.m_nodeB.prev=null,y.m_nodeB.next=m.m_contactList,null!=m.m_contactList&&(m.m_contactList.prev=y.m_nodeB),m.m_contactList=y.m_nodeB,0==s.IsSensor()&&0==r.IsSensor()&&(p.SetAwake(!0),m.SetAwake(!0)),++this.m_contactCount)}}},e}(e,h,a,q,i,o),O=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2CollideEdge&&(e.b2CollideEdge={}),e.b2CollideEdgeAndCircle=function(t,o,i,n,s){t.pointCount=0;var r=e.b2MulTXV(i,e.b2MulXV(s,n.m_p,e.b2Vec2.s_t0),e.b2CollideEdgeAndCircle.s_Q),a=o.m_vertex1,l=o.m_vertex2,p=e.b2SubVV(l,a,e.b2CollideEdgeAndCircle.s_e),m=e.b2DotVV(p,e.b2SubVV(l,r,e.b2Vec2.s_t0)),_=e.b2DotVV(p,e.b2SubVV(r,a,e.b2Vec2.s_t0)),b=o.m_radius+n.m_radius,h=e.b2CollideEdgeAndCircle.s_id;if(h.cf.indexB=0,h.cf.typeB=e.b2ContactFeatureType.e_vertex,0>=_){var c=a,u=e.b2SubVV(r,c,e.b2CollideEdgeAndCircle.s_d),y=e.b2DotVV(u,u);if(y>b*b)return;if(o.m_hasVertex0){var d=o.m_vertex0,f=a,A=e.b2SubVV(f,d,e.b2CollideEdgeAndCircle.s_e1),S=e.b2DotVV(A,e.b2SubVV(f,r,e.b2Vec2.s_t0));if(S>0)return}return h.cf.indexA=0,h.cf.typeA=e.b2ContactFeatureType.e_vertex,t.pointCount=1,t.type=e.b2ManifoldType.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(c),t.points[0].id.Copy(h),t.points[0].localPoint.Copy(n.m_p),void 0}if(0>=m){var c=l,u=e.b2SubVV(r,c,e.b2CollideEdgeAndCircle.s_d),y=e.b2DotVV(u,u);if(y>b*b)return;if(o.m_hasVertex3){var C=o.m_vertex3,v=l,x=e.b2SubVV(C,v,e.b2CollideEdgeAndCircle.s_e2),V=e.b2DotVV(x,e.b2SubVV(r,v,e.b2Vec2.s_t0));if(V>0)return}return h.cf.indexA=1,h.cf.typeA=e.b2ContactFeatureType.e_vertex,t.pointCount=1,t.type=e.b2ManifoldType.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(c),t.points[0].id.Copy(h),t.points[0].localPoint.Copy(n.m_p),void 0}var g=e.b2DotVV(p,p);e.ENABLE_ASSERTS&&e.b2Assert(g>0);var c=e.b2CollideEdgeAndCircle.s_P;c.x=1/g*(m*a.x+_*l.x),c.y=1/g*(m*a.y+_*l.y);var u=e.b2SubVV(r,c,e.b2CollideEdgeAndCircle.s_d),y=e.b2DotVV(u,u);if(!(y>b*b)){var B=e.b2CollideEdgeAndCircle.s_n.Set(-p.y,p.x);e.b2DotVV(B,e.b2SubVV(r,a,e.b2Vec2.s_t0))<0&&B.Set(-B.x,-B.y),B.Normalize(),h.cf.indexA=0,h.cf.typeA=e.b2ContactFeatureType.e_face,t.pointCount=1,t.type=e.b2ManifoldType.e_faceA,t.localNormal.Copy(B),t.localPoint.Copy(a),t.points[0].id.Copy(h),t.points[0].localPoint.Copy(n.m_p)}},e.b2CollideEdgeAndCircle.s_Q=new e.b2Vec2,e.b2CollideEdgeAndCircle.s_e=new e.b2Vec2,e.b2CollideEdgeAndCircle.s_d=new e.b2Vec2,e.b2CollideEdgeAndCircle.s_e1=new e.b2Vec2,e.b2CollideEdgeAndCircle.s_e2=new e.b2Vec2,e.b2CollideEdgeAndCircle.s_P=new e.b2Vec2,e.b2CollideEdgeAndCircle.s_n=new e.b2Vec2,e.b2CollideEdgeAndCircle.s_id=new e.b2ContactID,e.b2EPAxisType={e_unknown:0,e_edgeA:1,e_edgeB:2},t.exportProperty(e.b2EPAxisType,"e_unknown",e.b2EPAxisType.e_unknown),t.exportProperty(e.b2EPAxisType,"e_edgeA",e.b2EPAxisType.e_edgeA),t.exportProperty(e.b2EPAxisType,"e_edgeB",e.b2EPAxisType.e_edgeB),e.b2EPAxis=function(){},e.b2EPAxis.prototype.type=e.b2EPAxisType.e_unknown,e.b2EPAxis.prototype.index=0,e.b2EPAxis.prototype.separation=0,e.b2TempPolygon=function(){this.vertices=e.b2Vec2.MakeArray(e.b2_maxPolygonVertices),this.normals=e.b2Vec2.MakeArray(e.b2_maxPolygonVertices),this.count=0},e.b2TempPolygon.prototype.vertices=null,e.b2TempPolygon.prototype.normals=null,e.b2TempPolygon.prototype.count=0,e.b2ReferenceFace=function(){this.i1=0,this.i2=0,this.v1=new e.b2Vec2,this.v2=new e.b2Vec2,this.normal=new e.b2Vec2,this.sideNormal1=new e.b2Vec2,this.sideOffset1=0,this.sideNormal2=new e.b2Vec2,this.sideOffset2=0},e.b2ReferenceFace.prototype.i1=0,e.b2ReferenceFace.prototype.i2=0,e.b2ReferenceFace.prototype.v1=null,e.b2ReferenceFace.prototype.v2=null,e.b2ReferenceFace.prototype.normal=null,e.b2ReferenceFace.prototype.sideNormal1=null,e.b2ReferenceFace.prototype.sideOffset1=0,e.b2ReferenceFace.prototype.sideNormal2=null,e.b2ReferenceFace.prototype.sideOffset2=0,e.b2EPColliderVertexType={e_isolated:0,e_concave:1,e_convex:2},t.exportProperty(e.b2EPColliderVertexType,"e_isolated",e.b2EPColliderVertexType.e_isolated),t.exportProperty(e.b2EPColliderVertexType,"e_concave",e.b2EPColliderVertexType.e_concave),t.exportProperty(e.b2EPColliderVertexType,"e_convex",e.b2EPColliderVertexType.e_convex),e.b2EPCollider=function(){this.m_polygonB=new e.b2TempPolygon,this.m_xf=new e.b2Transform,this.m_centroidB=new e.b2Vec2,this.m_v0=new e.b2Vec2,this.m_v1=new e.b2Vec2,this.m_v2=new e.b2Vec2,this.m_v3=new e.b2Vec2,this.m_normal0=new e.b2Vec2,this.m_normal1=new e.b2Vec2,this.m_normal2=new e.b2Vec2,this.m_normal=new e.b2Vec2,this.m_type1=e.b2EPColliderVertexType.e_isolated,this.m_type2=e.b2EPColliderVertexType.e_isolated,this.m_lowerLimit=new e.b2Vec2,this.m_upperLimit=new e.b2Vec2,this.m_radius=0,this.m_front=!1},e.b2EPCollider.prototype.m_polygonB=null,e.b2EPCollider.prototype.m_xf=null,e.b2EPCollider.prototype.m_centroidB=null,e.b2EPCollider.prototype.m_v0=null,e.b2EPCollider.prototype.m_v1=null,e.b2EPCollider.prototype.m_v2=null,e.b2EPCollider.prototype.m_v3=null,e.b2EPCollider.prototype.m_normal0=null,e.b2EPCollider.prototype.m_normal1=null,e.b2EPCollider.prototype.m_normal2=null,e.b2EPCollider.prototype.m_normal=null,e.b2EPCollider.prototype.m_type1=e.b2EPColliderVertexType.e_isolated,e.b2EPCollider.prototype.m_type2=e.b2EPColliderVertexType.e_isolated,e.b2EPCollider.prototype.m_lowerLimit=null,e.b2EPCollider.prototype.m_upperLimit=null,e.b2EPCollider.prototype.m_radius=0,e.b2EPCollider.prototype.m_front=!1,e.b2EPCollider.prototype.Collide=function(t,o,i,n,s){e.b2MulTXX(i,s,this.m_xf),e.b2MulXV(this.m_xf,n.m_centroid,this.m_centroidB),this.m_v0.Copy(o.m_vertex0),this.m_v1.Copy(o.m_vertex1),this.m_v2.Copy(o.m_vertex2),this.m_v3.Copy(o.m_vertex3);var r=o.m_hasVertex0,a=o.m_hasVertex3,l=e.b2SubVV(this.m_v2,this.m_v1,e.b2EPCollider.s_edge1);l.Normalize(),this.m_normal1.Set(l.y,-l.x);var p=e.b2DotVV(this.m_normal1,e.b2SubVV(this.m_centroidB,this.m_v1,e.b2Vec2.s_t0)),m=0,_=0,b=!1,h=!1;if(r){var c=e.b2SubVV(this.m_v1,this.m_v0,e.b2EPCollider.s_edge0);c.Normalize(),this.m_normal0.Set(c.y,-c.x),b=e.b2CrossVV(c,l)>=0,m=e.b2DotVV(this.m_normal0,e.b2SubVV(this.m_centroidB,this.m_v0,e.b2Vec2.s_t0))}if(a){var u=e.b2SubVV(this.m_v3,this.m_v2,e.b2EPCollider.s_edge2);u.Normalize(),this.m_normal2.Set(u.y,-u.x),h=e.b2CrossVV(l,u)>0,_=e.b2DotVV(this.m_normal2,e.b2SubVV(this.m_centroidB,this.m_v2,e.b2Vec2.s_t0))}r&&a?b&&h?(this.m_front=m>=0||p>=0||_>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):b?(this.m_front=m>=0||p>=0&&_>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):h?(this.m_front=_>=0||m>=0&&p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=m>=0&&p>=0&&_>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):r?b?(this.m_front=m>=0||p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=m>=0&&p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):a?h?(this.m_front=p>=0||_>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=p>=0&&_>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=p>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=n.m_count;for(var y=0,d=n.m_count;d>y;++y)e.b2MulXV(this.m_xf,n.m_vertices[y],this.m_polygonB.vertices[y]),e.b2MulRV(this.m_xf.q,n.m_normals[y],this.m_polygonB.normals[y]);this.m_radius=2*e.b2_polygonRadius,t.pointCount=0;var f=this.ComputeEdgeSeparation(e.b2EPCollider.s_edgeAxis);if(f.type!=e.b2EPAxisType.e_unknown&&!(f.separation>this.m_radius)){var A=this.ComputePolygonSeparation(e.b2EPCollider.s_polygonAxis);if(!(A.type!=e.b2EPAxisType.e_unknown&&A.separation>this.m_radius)){var S,C=.98,v=.001;S=A.type==e.b2EPAxisType.e_unknown?f:A.separation>C*f.separation+v?A:f;var x=e.b2EPCollider.s_ie,V=e.b2EPCollider.s_rf;if(S.type==e.b2EPAxisType.e_edgeA){t.type=e.b2ManifoldType.e_faceA;for(var g=0,B=e.b2DotVV(this.m_normal,this.m_polygonB.normals[0]),y=1,d=this.m_polygonB.count;d>y;++y){var w=e.b2DotVV(this.m_normal,this.m_polygonB.normals[y]);B>w&&(B=w,g=y)}var M=g,J=(M+1)%this.m_polygonB.count,P=x[0];P.v.Copy(this.m_polygonB.vertices[M]),P.id.cf.indexA=0,P.id.cf.indexB=M,P.id.cf.typeA=e.b2ContactFeatureType.e_face,P.id.cf.typeB=e.b2ContactFeatureType.e_vertex;var T=x[1];T.v.Copy(this.m_polygonB.vertices[J]),T.id.cf.indexA=0,T.id.cf.indexB=J,T.id.cf.typeA=e.b2ContactFeatureType.e_face,T.id.cf.typeB=e.b2ContactFeatureType.e_vertex,this.m_front?(V.i1=0,V.i2=1,V.v1.Copy(this.m_v1),V.v2.Copy(this.m_v2),V.normal.Copy(this.m_normal1)):(V.i1=1,V.i2=0,V.v1.Copy(this.m_v2),V.v2.Copy(this.m_v1),V.normal.Copy(this.m_normal1).SelfNeg())}else{t.type=e.b2ManifoldType.e_faceB;var P=x[0];P.v.Copy(this.m_v1),P.id.cf.indexA=0,P.id.cf.indexB=S.index,P.id.cf.typeA=e.b2ContactFeatureType.e_vertex,P.id.cf.typeB=e.b2ContactFeatureType.e_face;var T=x[1];T.v.Copy(this.m_v2),T.id.cf.indexA=0,T.id.cf.indexB=S.index,T.id.cf.typeA=e.b2ContactFeatureType.e_vertex,T.id.cf.typeB=e.b2ContactFeatureType.e_face,V.i1=S.index,V.i2=(V.i1+1)%this.m_polygonB.count,V.v1.Copy(this.m_polygonB.vertices[V.i1]),V.v2.Copy(this.m_polygonB.vertices[V.i2]),V.normal.Copy(this.m_polygonB.normals[V.i1])}V.sideNormal1.Set(V.normal.y,-V.normal.x),V.sideNormal2.Copy(V.sideNormal1).SelfNeg(),V.sideOffset1=e.b2DotVV(V.sideNormal1,V.v1),V.sideOffset2=e.b2DotVV(V.sideNormal2,V.v2);var D=e.b2EPCollider.s_clipPoints1,R=e.b2EPCollider.s_clipPoints2,I=0;if(I=e.b2ClipSegmentToLine(D,x,V.sideNormal1,V.sideOffset1,V.i1),!(I<e.b2_maxManifoldPoints||(I=e.b2ClipSegmentToLine(R,D,V.sideNormal2,V.sideOffset2,V.i2),I<e.b2_maxManifoldPoints))){S.type==e.b2EPAxisType.e_edgeA?(t.localNormal.Copy(V.normal),t.localPoint.Copy(V.v1)):(t.localNormal.Copy(n.m_normals[V.i1]),t.localPoint.Copy(n.m_vertices[V.i1]));for(var L=0,y=0,d=e.b2_maxManifoldPoints;d>y;++y){var E;if(E=e.b2DotVV(V.normal,e.b2SubVV(R[y].v,V.v1,e.b2Vec2.s_t0)),E<=this.m_radius){var F=t.points[L];S.type==e.b2EPAxisType.e_edgeA?(e.b2MulTXV(this.m_xf,R[y].v,F.localPoint),F.id=R[y].id):(F.localPoint.Copy(R[y].v),F.id.cf.typeA=R[y].id.cf.typeB,F.id.cf.typeB=R[y].id.cf.typeA,F.id.cf.indexA=R[y].id.cf.indexB,F.id.cf.indexB=R[y].id.cf.indexA),++L}}t.pointCount=L}}}},e.b2EPCollider.s_edge1=new e.b2Vec2,e.b2EPCollider.s_edge0=new e.b2Vec2,e.b2EPCollider.s_edge2=new e.b2Vec2,e.b2EPCollider.s_ie=e.b2ClipVertex.MakeArray(2),e.b2EPCollider.s_rf=new e.b2ReferenceFace,e.b2EPCollider.s_clipPoints1=e.b2ClipVertex.MakeArray(2),e.b2EPCollider.s_clipPoints2=e.b2ClipVertex.MakeArray(2),e.b2EPCollider.s_edgeAxis=new e.b2EPAxis,e.b2EPCollider.s_polygonAxis=new e.b2EPAxis,e.b2EPCollider.prototype.ComputeEdgeSeparation=function(t){var o=t;o.type=e.b2EPAxisType.e_edgeA,o.index=this.m_front?0:1,o.separation=e.b2_maxFloat;for(var i=0,n=this.m_polygonB.count;n>i;++i){var s=e.b2DotVV(this.m_normal,e.b2SubVV(this.m_polygonB.vertices[i],this.m_v1,e.b2Vec2.s_t0));s<o.separation&&(o.separation=s)}return o},e.b2EPCollider.prototype.ComputePolygonSeparation=function(t){var o=t;o.type=e.b2EPAxisType.e_unknown,o.index=-1,o.separation=-e.b2_maxFloat;for(var i=e.b2EPCollider.s_perp.Set(-this.m_normal.y,this.m_normal.x),n=0,s=this.m_polygonB.count;s>n;++n){var r=e.b2NegV(this.m_polygonB.normals[n],e.b2EPCollider.s_n),a=e.b2DotVV(r,e.b2SubVV(this.m_polygonB.vertices[n],this.m_v1,e.b2Vec2.s_t0)),l=e.b2DotVV(r,e.b2SubVV(this.m_polygonB.vertices[n],this.m_v2,e.b2Vec2.s_t0)),p=e.b2Min(a,l);if(p>this.m_radius)return o.type=e.b2EPAxisType.e_edgeB,o.index=n,o.separation=p,o;if(e.b2DotVV(r,i)>=0){if(e.b2DotVV(e.b2SubVV(r,this.m_upperLimit,e.b2Vec2.s_t0),this.m_normal)<-e.b2_angularSlop)continue}else if(e.b2DotVV(e.b2SubVV(r,this.m_lowerLimit,e.b2Vec2.s_t0),this.m_normal)<-e.b2_angularSlop)continue;p>o.separation&&(o.type=e.b2EPAxisType.e_edgeB,o.index=n,o.separation=p)}return o},e.b2EPCollider.s_n=new e.b2Vec2,e.b2EPCollider.s_perp=new e.b2Vec2,e.b2CollideEdgeAndPolygon=function(t,o,i,n,s){var r=e.b2CollideEdgeAndPolygon.s_collider;r.Collide(t,o,i,n,s)},e.b2CollideEdgeAndPolygon.s_collider=new e.b2EPCollider,e}(e,a),j=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2ChainAndCircleContact&&(e.b2ChainAndCircleContact={}),e.b2ChainAndCircleContact=function(){t.base(this)},t.inherits(e.b2ChainAndCircleContact,e.b2Contact),e.b2ChainAndCircleContact.Create=function(){return new e.b2ChainAndCircleContact},e.b2ChainAndCircleContact.Destroy=function(){},e.b2ChainAndCircleContact.prototype.Reset=function(o,i,n,s){t.base(this,"Reset",o,i,n,s),e.ENABLE_ASSERTS&&e.b2Assert(o.GetType()==e.b2ShapeType.e_chainShape),e.ENABLE_ASSERTS&&e.b2Assert(n.GetType()==e.b2ShapeType.e_circleShape)},e.b2ChainAndCircleContact.prototype.Evaluate=function(t,o,i){var n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();e.ENABLE_ASSERTS&&e.b2Assert(n instanceof e.b2ChainShape),e.ENABLE_ASSERTS&&e.b2Assert(s instanceof e.b2CircleShape);var r=n instanceof e.b2ChainShape?n:null,a=e.b2ChainAndCircleContact.prototype.Evaluate.s_edge;r.GetChildEdge(a,this.m_indexA),e.b2CollideEdgeAndCircle(t,a,o,s instanceof e.b2CircleShape?s:null,i)},e.b2ChainAndCircleContact.prototype.Evaluate.s_edge=new e.b2EdgeShape,e}(e,O,V,o),X=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2ChainAndPolygonContact&&(e.b2ChainAndPolygonContact={}),e.b2ChainAndPolygonContact=function(){t.base(this)},t.inherits(e.b2ChainAndPolygonContact,e.b2Contact),e.b2ChainAndPolygonContact.Create=function(){return new e.b2ChainAndPolygonContact},e.b2ChainAndPolygonContact.Destroy=function(){},e.b2ChainAndPolygonContact.prototype.Reset=function(o,i,n,s){t.base(this,"Reset",o,i,n,s),e.ENABLE_ASSERTS&&e.b2Assert(o.GetType()==e.b2ShapeType.e_chainShape),e.ENABLE_ASSERTS&&e.b2Assert(n.GetType()==e.b2ShapeType.e_polygonShape)},e.b2ChainAndPolygonContact.prototype.Evaluate=function(t,o,i){var n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();e.ENABLE_ASSERTS&&e.b2Assert(n instanceof e.b2ChainShape),e.ENABLE_ASSERTS&&e.b2Assert(s instanceof e.b2PolygonShape);var r=n instanceof e.b2ChainShape?n:null,a=e.b2ChainAndPolygonContact.prototype.Evaluate.s_edge;r.GetChildEdge(a,this.m_indexA),e.b2CollideEdgeAndPolygon(t,a,o,s instanceof e.b2PolygonShape?s:null,i)},e.b2ChainAndPolygonContact.prototype.Evaluate.s_edge=new e.b2EdgeShape,e}(e,f,O,V,I,o),U=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2CollideCircle&&(e.b2CollideCircle={}),e.b2CollideCircles=function(t,o,i,n,s){t.pointCount=0;var r=e.b2MulXV(i,o.m_p,e.b2CollideCircles.s_pA),a=e.b2MulXV(s,n.m_p,e.b2CollideCircles.s_pB),l=e.b2DistanceSquaredVV(r,a),p=o.m_radius+n.m_radius;l>p*p||(t.type=e.b2ManifoldType.e_circles,t.localPoint.Copy(o.m_p),t.localNormal.SetZero(),t.pointCount=1,t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0)},e.b2CollideCircles.s_pA=new e.b2Vec2,e.b2CollideCircles.s_pB=new e.b2Vec2,e.b2CollidePolygonAndCircle=function(t,o,i,n,s){t.pointCount=0;for(var r=e.b2MulXV(s,n.m_p,e.b2CollidePolygonAndCircle.s_c),a=e.b2MulTXV(i,r,e.b2CollidePolygonAndCircle.s_cLocal),l=0,p=-e.b2_maxFloat,m=o.m_radius+n.m_radius,_=o.m_count,b=o.m_vertices,h=o.m_normals,c=0;_>c;++c){var u=e.b2DotVV(h[c],e.b2SubVV(a,b[c],e.b2Vec2.s_t0));if(u>m)return;u>p&&(p=u,l=c)}var y=l,d=(y+1)%_,f=b[y],A=b[d];if(p<e.b2_epsilon)return t.pointCount=1,t.type=e.b2ManifoldType.e_faceA,t.localNormal.Copy(h[l]),e.b2MidVV(f,A,t.localPoint),t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0,void 0;var S=e.b2DotVV(e.b2SubVV(a,f,e.b2Vec2.s_t0),e.b2SubVV(A,f,e.b2Vec2.s_t1)),C=e.b2DotVV(e.b2SubVV(a,A,e.b2Vec2.s_t0),e.b2SubVV(f,A,e.b2Vec2.s_t1));if(0>=S){if(e.b2DistanceSquaredVV(a,f)>m*m)return;t.pointCount=1,t.type=e.b2ManifoldType.e_faceA,e.b2SubVV(a,f,t.localNormal).SelfNormalize(),t.localPoint.Copy(f),t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0}else if(0>=C){if(e.b2DistanceSquaredVV(a,A)>m*m)return;t.pointCount=1,t.type=e.b2ManifoldType.e_faceA,e.b2SubVV(a,A,t.localNormal).SelfNormalize(),t.localPoint.Copy(A),t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0}else{var v=e.b2MidVV(f,A,e.b2CollidePolygonAndCircle.s_faceCenter);if(p=e.b2DotVV(e.b2SubVV(a,v,e.b2Vec2.s_t1),h[y]),p>m)return;t.pointCount=1,t.type=e.b2ManifoldType.e_faceA,t.localNormal.Copy(h[y]).SelfNormalize(),t.localPoint.Copy(v),t.points[0].localPoint.Copy(n.m_p),t.points[0].id.key=0}},e.b2CollidePolygonAndCircle.s_c=new e.b2Vec2,e.b2CollidePolygonAndCircle.s_cLocal=new e.b2Vec2,e.b2CollidePolygonAndCircle.s_faceCenter=new e.b2Vec2,e}(e,a),Z=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2CircleContact&&(e.b2CircleContact={}),e.b2CircleContact=function(){t.base(this)},t.inherits(e.b2CircleContact,e.b2Contact),e.b2CircleContact.Create=function(){return new e.b2CircleContact},e.b2CircleContact.Destroy=function(){},e.b2CircleContact.prototype.Reset=function(e,o,i,n){t.base(this,"Reset",e,o,i,n)},e.b2CircleContact.prototype.Evaluate=function(t,o,i){var n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();e.ENABLE_ASSERTS&&e.b2Assert(n instanceof e.b2CircleShape),e.ENABLE_ASSERTS&&e.b2Assert(s instanceof e.b2CircleShape),e.b2CollideCircles(t,n instanceof e.b2CircleShape?n:null,o,s instanceof e.b2CircleShape?s:null,i)},e}(e,U,V,o),H=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2EdgeAndCircleContact&&(e.b2EdgeAndCircleContact={}),e.b2EdgeAndCircleContact=function(){t.base(this)\n},t.inherits(e.b2EdgeAndCircleContact,e.b2Contact),e.b2EdgeAndCircleContact.Create=function(){return new e.b2EdgeAndCircleContact},e.b2EdgeAndCircleContact.Destroy=function(){},e.b2EdgeAndCircleContact.prototype.Reset=function(o,i,n,s){t.base(this,"Reset",o,i,n,s),e.ENABLE_ASSERTS&&e.b2Assert(o.GetType()==e.b2ShapeType.e_edgeShape),e.ENABLE_ASSERTS&&e.b2Assert(n.GetType()==e.b2ShapeType.e_circleShape)},e.b2EdgeAndCircleContact.prototype.Evaluate=function(t,o,i){var n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();e.ENABLE_ASSERTS&&e.b2Assert(n instanceof e.b2EdgeShape),e.ENABLE_ASSERTS&&e.b2Assert(s instanceof e.b2CircleShape),e.b2CollideEdgeAndCircle(t,n instanceof e.b2EdgeShape?n:null,o,s instanceof e.b2CircleShape?s:null,i)},e}(e,O,V,o),K=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2EdgeAndPolygonContact&&(e.b2EdgeAndPolygonContact={}),e.b2EdgeAndPolygonContact=function(){t.base(this)},t.inherits(e.b2EdgeAndPolygonContact,e.b2Contact),e.b2EdgeAndPolygonContact.Create=function(){return new e.b2EdgeAndPolygonContact},e.b2EdgeAndPolygonContact.Destroy=function(){},e.b2EdgeAndPolygonContact.prototype.Reset=function(o,i,n,s){t.base(this,"Reset",o,i,n,s),e.ENABLE_ASSERTS&&e.b2Assert(o.GetType()==e.b2ShapeType.e_edgeShape),e.ENABLE_ASSERTS&&e.b2Assert(n.GetType()==e.b2ShapeType.e_polygonShape)},e.b2EdgeAndPolygonContact.prototype.Evaluate=function(t,o,i){var n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();e.ENABLE_ASSERTS&&e.b2Assert(n instanceof e.b2EdgeShape),e.ENABLE_ASSERTS&&e.b2Assert(s instanceof e.b2PolygonShape),e.b2CollideEdgeAndPolygon(t,n instanceof e.b2EdgeShape?n:null,o,s instanceof e.b2PolygonShape?s:null,i)},e}(e,V,o),Y=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2PolygonAndCircleContact&&(e.b2PolygonAndCircleContact={}),e.b2PolygonAndCircleContact=function(){t.base(this)},t.inherits(e.b2PolygonAndCircleContact,e.b2Contact),e.b2PolygonAndCircleContact.Create=function(){return new e.b2PolygonAndCircleContact},e.b2PolygonAndCircleContact.Destroy=function(){},e.b2PolygonAndCircleContact.prototype.Reset=function(o,i,n,s){t.base(this,"Reset",o,i,n,s),e.ENABLE_ASSERTS&&e.b2Assert(o.GetType()==e.b2ShapeType.e_polygonShape),e.ENABLE_ASSERTS&&e.b2Assert(n.GetType()==e.b2ShapeType.e_circleShape)},e.b2PolygonAndCircleContact.prototype.Evaluate=function(t,o,i){var n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();e.ENABLE_ASSERTS&&e.b2Assert(n instanceof e.b2PolygonShape),e.ENABLE_ASSERTS&&e.b2Assert(s instanceof e.b2CircleShape),e.b2CollidePolygonAndCircle(t,n instanceof e.b2PolygonShape?n:null,o,s instanceof e.b2CircleShape?s:null,i)},e}(e,V,o),Q=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2CollidePolygon&&(e.b2CollidePolygon={}),e.b2FindMaxSeparation=function(t,o,i,n,s){for(var r=o.m_count,a=n.m_count,l=o.m_normals,p=o.m_vertices,m=n.m_vertices,_=e.b2MulTXX(s,i,e.b2FindMaxSeparation.s_xf),b=0,h=-e.b2_maxFloat,c=0;r>c;++c){for(var u=e.b2MulRV(_.q,l[c],e.b2FindMaxSeparation.s_n),y=e.b2MulXV(_,p[c],e.b2FindMaxSeparation.s_v1),d=e.b2_maxFloat,f=0;a>f;++f){var A=e.b2DotVV(u,e.b2SubVV(m[f],y,e.b2Vec2.s_t0));d>A&&(d=A)}d>h&&(h=d,b=c)}return t[0]=b,h},e.b2FindMaxSeparation.s_xf=new e.b2Transform,e.b2FindMaxSeparation.s_n=new e.b2Vec2,e.b2FindMaxSeparation.s_v1=new e.b2Vec2,e.b2FindIncidentEdge=function(t,o,i,n,s,r){var a=o.m_count,l=o.m_normals,p=s.m_count,m=s.m_vertices,_=s.m_normals;e.ENABLE_ASSERTS&&e.b2Assert(n>=0&&a>n);for(var b=e.b2MulTRV(r.q,e.b2MulRV(i.q,l[n],e.b2Vec2.s_t0),e.b2FindIncidentEdge.s_normal1),h=0,c=e.b2_maxFloat,u=0;p>u;++u){var y=e.b2DotVV(b,_[u]);c>y&&(c=y,h=u)}var d=h,f=(d+1)%p,A=t[0];e.b2MulXV(r,m[d],A.v);var S=A.id.cf;S.indexA=n,S.indexB=d,S.typeA=e.b2ContactFeatureType.e_face,S.typeB=e.b2ContactFeatureType.e_vertex;var C=t[1];e.b2MulXV(r,m[f],C.v);var v=C.id.cf;v.indexA=n,v.indexB=f,v.typeA=e.b2ContactFeatureType.e_face,v.typeB=e.b2ContactFeatureType.e_vertex},e.b2FindIncidentEdge.s_normal1=new e.b2Vec2,e.b2CollidePolygons=function(t,o,i,n,s){t.pointCount=0;var r=o.m_radius+n.m_radius,a=e.b2CollidePolygons.s_edgeA;a[0]=0;var l=e.b2FindMaxSeparation(a,o,i,n,s);if(!(l>r)){var p=e.b2CollidePolygons.s_edgeB;p[0]=0;var m=e.b2FindMaxSeparation(p,n,s,o,i);if(!(m>r)){var _,b,h,c,u=0,y=0,d=.98,f=.001;m>d*l+f?(_=n,b=o,h=s,c=i,u=p[0],t.type=e.b2ManifoldType.e_faceB,y=1):(_=o,b=n,h=i,c=s,u=a[0],t.type=e.b2ManifoldType.e_faceA,y=0);var A=e.b2CollidePolygons.s_incidentEdge;e.b2FindIncidentEdge(A,_,h,u,b,c);var S=_.m_count,C=_.m_vertices,v=u,x=(u+1)%S,V=C[v],g=C[x],B=e.b2SubVV(g,V,e.b2CollidePolygons.s_localTangent);B.Normalize();var w,M=e.b2CrossVOne(B,e.b2CollidePolygons.s_localNormal),J=e.b2MidVV(V,g,e.b2CollidePolygons.s_planePoint),P=e.b2MulRV(h.q,B,e.b2CollidePolygons.s_tangent),T=e.b2CrossVOne(P,e.b2CollidePolygons.s_normal),D=e.b2MulXV(h,V,e.b2CollidePolygons.s_v11),R=e.b2MulXV(h,g,e.b2CollidePolygons.s_v12),I=e.b2DotVV(T,D),L=-e.b2DotVV(P,D)+r,E=e.b2DotVV(P,R)+r,F=e.b2CollidePolygons.s_clipPoints1,G=e.b2CollidePolygons.s_clipPoints2,N=e.b2NegV(P,e.b2CollidePolygons.s_ntangent);if(w=e.b2ClipSegmentToLine(F,A,N,L,v),!(2>w||(w=e.b2ClipSegmentToLine(G,F,P,E,x),2>w))){t.localNormal.Copy(M),t.localPoint.Copy(J);for(var k=0,W=0;W<e.b2_maxManifoldPoints;++W){var q=G[W],z=e.b2DotVV(T,q.v)-I;if(r>=z){var O=t.points[k];if(e.b2MulTXV(c,q.v,O.localPoint),O.id.Copy(q.id),y){var j=O.id.cf;O.id.cf.indexA=j.indexB,O.id.cf.indexB=j.indexA,O.id.cf.typeA=j.typeB,O.id.cf.typeB=j.typeA}++k}}t.pointCount=k}}}},e.b2CollidePolygons.s_incidentEdge=e.b2ClipVertex.MakeArray(2),e.b2CollidePolygons.s_clipPoints1=e.b2ClipVertex.MakeArray(2),e.b2CollidePolygons.s_clipPoints2=e.b2ClipVertex.MakeArray(2),e.b2CollidePolygons.s_edgeA=e.b2MakeNumberArray(1),e.b2CollidePolygons.s_edgeB=e.b2MakeNumberArray(1),e.b2CollidePolygons.s_localTangent=new e.b2Vec2,e.b2CollidePolygons.s_localNormal=new e.b2Vec2,e.b2CollidePolygons.s_planePoint=new e.b2Vec2,e.b2CollidePolygons.s_normal=new e.b2Vec2,e.b2CollidePolygons.s_tangent=new e.b2Vec2,e.b2CollidePolygons.s_ntangent=new e.b2Vec2,e.b2CollidePolygons.s_v11=new e.b2Vec2,e.b2CollidePolygons.s_v12=new e.b2Vec2,e}(e,a),$=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2PolygonContact&&(e.b2PolygonContact={}),e.b2PolygonContact=function(){t.base(this)},t.inherits(e.b2PolygonContact,e.b2Contact),e.b2PolygonContact.Create=function(){return new e.b2PolygonContact},e.b2PolygonContact.Destroy=function(){},e.b2PolygonContact.prototype.Reset=function(e,o,i,n){t.base(this,"Reset",e,o,i,n)},e.b2PolygonContact.prototype.Evaluate=function(t,o,i){var n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();e.ENABLE_ASSERTS&&e.b2Assert(n instanceof e.b2PolygonShape),e.ENABLE_ASSERTS&&e.b2Assert(s instanceof e.b2PolygonShape),e.b2CollidePolygons(t,n instanceof e.b2PolygonShape?n:null,o,s instanceof e.b2PolygonShape?s:null,i)},e}(e,Q,V,o),te=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2ContactSolver&&(e.b2ContactSolver={}),e.b2VelocityConstraintPoint=function(){this.rA=new e.b2Vec2,this.rB=new e.b2Vec2},e.b2VelocityConstraintPoint.prototype.rA=null,e.b2VelocityConstraintPoint.prototype.rB=null,e.b2VelocityConstraintPoint.prototype.normalImpulse=0,e.b2VelocityConstraintPoint.prototype.tangentImpulse=0,e.b2VelocityConstraintPoint.prototype.normalMass=0,e.b2VelocityConstraintPoint.prototype.tangentMass=0,e.b2VelocityConstraintPoint.prototype.velocityBias=0,e.b2VelocityConstraintPoint.MakeArray=function(t){return e.b2MakeArray(t,function(){return new e.b2VelocityConstraintPoint})},e.b2ContactVelocityConstraint=function(){this.points=e.b2VelocityConstraintPoint.MakeArray(e.b2_maxManifoldPoints),this.normal=new e.b2Vec2,this.tangent=new e.b2Vec2,this.normalMass=new e.b2Mat22,this.K=new e.b2Mat22},e.b2ContactVelocityConstraint.prototype.points=null,e.b2ContactVelocityConstraint.prototype.normal=null,e.b2ContactVelocityConstraint.prototype.tangent=null,e.b2ContactVelocityConstraint.prototype.normalMass=null,e.b2ContactVelocityConstraint.prototype.K=null,e.b2ContactVelocityConstraint.prototype.indexA=0,e.b2ContactVelocityConstraint.prototype.indexB=0,e.b2ContactVelocityConstraint.prototype.invMassA=0,e.b2ContactVelocityConstraint.prototype.invMassB=0,e.b2ContactVelocityConstraint.prototype.invIA=0,e.b2ContactVelocityConstraint.prototype.invIB=0,e.b2ContactVelocityConstraint.prototype.friction=0,e.b2ContactVelocityConstraint.prototype.restitution=0,e.b2ContactVelocityConstraint.prototype.tangentSpeed=0,e.b2ContactVelocityConstraint.prototype.pointCount=0,e.b2ContactVelocityConstraint.prototype.contactIndex=0,e.b2ContactVelocityConstraint.MakeArray=function(t){return e.b2MakeArray(t,function(){return new e.b2ContactVelocityConstraint})},e.b2ContactPositionConstraint=function(){this.localPoints=e.b2Vec2.MakeArray(e.b2_maxManifoldPoints),this.localNormal=new e.b2Vec2,this.localPoint=new e.b2Vec2,this.localCenterA=new e.b2Vec2,this.localCenterB=new e.b2Vec2},e.b2ContactPositionConstraint.prototype.localPoints=null,e.b2ContactPositionConstraint.prototype.localNormal=null,e.b2ContactPositionConstraint.prototype.localPoint=null,e.b2ContactPositionConstraint.prototype.indexA=0,e.b2ContactPositionConstraint.prototype.indexB=0,e.b2ContactPositionConstraint.prototype.invMassA=0,e.b2ContactPositionConstraint.prototype.invMassB=0,e.b2ContactPositionConstraint.prototype.localCenterA=null,e.b2ContactPositionConstraint.prototype.localCenterB=null,e.b2ContactPositionConstraint.prototype.invIA=0,e.b2ContactPositionConstraint.prototype.invIB=0,e.b2ContactPositionConstraint.prototype.type=e.b2ManifoldType.e_unknown,e.b2ContactPositionConstraint.prototype.radiusA=0,e.b2ContactPositionConstraint.prototype.radiusB=0,e.b2ContactPositionConstraint.prototype.pointCount=0,e.b2ContactPositionConstraint.MakeArray=function(t){return e.b2MakeArray(t,function(){return new e.b2ContactPositionConstraint})},e.b2ContactSolverDef=function(){this.step=new e.b2TimeStep},e.b2ContactSolverDef.prototype.step=null,e.b2ContactSolverDef.prototype.contacts=null,e.b2ContactSolverDef.prototype.count=0,e.b2ContactSolverDef.prototype.positions=null,e.b2ContactSolverDef.prototype.velocities=null,e.b2ContactSolverDef.prototype.allocator=null,e.b2ContactSolver=function(){this.m_step=new e.b2TimeStep,this.m_positionConstraints=e.b2ContactPositionConstraint.MakeArray(1024),this.m_velocityConstraints=e.b2ContactVelocityConstraint.MakeArray(1024)},e.b2ContactSolver.prototype.m_step=null,e.b2ContactSolver.prototype.m_positions=null,e.b2ContactSolver.prototype.m_velocities=null,e.b2ContactSolver.prototype.m_allocator=null,e.b2ContactSolver.prototype.m_positionConstraints=null,e.b2ContactSolver.prototype.m_velocityConstraints=null,e.b2ContactSolver.prototype.m_contacts=null,e.b2ContactSolver.prototype.m_count=0,e.b2ContactSolver.prototype.Initialize=function(t){if(this.m_step.Copy(t.step),this.m_allocator=t.allocator,this.m_count=t.count,this.m_positionConstraints.length<this.m_count){var o=e.b2Max(2*this.m_positionConstraints.length,this.m_count);for(e.DEBUG&&window.console.log("box2d.b2ContactSolver.m_positionConstraints: "+o);this.m_positionConstraints.length<o;)this.m_positionConstraints[this.m_positionConstraints.length]=new e.b2ContactPositionConstraint}if(this.m_velocityConstraints.length<this.m_count){var o=e.b2Max(2*this.m_velocityConstraints.length,this.m_count);for(e.DEBUG&&window.console.log("box2d.b2ContactSolver.m_velocityConstraints: "+o);this.m_velocityConstraints.length<o;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new e.b2ContactVelocityConstraint}this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;var i,n,s,r,a,l,p,m,_,b,h,c,u,y,d,f,A,S,C;for(i=0,n=this.m_count;n>i;++i)for(a=this.m_contacts[i],l=a.m_fixtureA,p=a.m_fixtureB,m=l.GetShape(),_=p.GetShape(),b=m.m_radius,h=_.m_radius,c=l.GetBody(),u=p.GetBody(),y=a.GetManifold(),d=y.pointCount,e.ENABLE_ASSERTS&&e.b2Assert(d>0),f=this.m_velocityConstraints[i],f.friction=a.m_friction,f.restitution=a.m_restitution,f.tangentSpeed=a.m_tangentSpeed,f.indexA=c.m_islandIndex,f.indexB=u.m_islandIndex,f.invMassA=c.m_invMass,f.invMassB=u.m_invMass,f.invIA=c.m_invI,f.invIB=u.m_invI,f.contactIndex=i,f.pointCount=d,f.K.SetZero(),f.normalMass.SetZero(),A=this.m_positionConstraints[i],A.indexA=c.m_islandIndex,A.indexB=u.m_islandIndex,A.invMassA=c.m_invMass,A.invMassB=u.m_invMass,A.localCenterA.Copy(c.m_sweep.localCenter),A.localCenterB.Copy(u.m_sweep.localCenter),A.invIA=c.m_invI,A.invIB=u.m_invI,A.localNormal.Copy(y.localNormal),A.localPoint.Copy(y.localPoint),A.pointCount=d,A.radiusA=b,A.radiusB=h,A.type=y.type,s=0,r=d;r>s;++s)S=y.points[s],C=f.points[s],this.m_step.warmStarting?(C.normalImpulse=this.m_step.dtRatio*S.normalImpulse,C.tangentImpulse=this.m_step.dtRatio*S.tangentImpulse):(C.normalImpulse=0,C.tangentImpulse=0),C.rA.SetZero(),C.rB.SetZero(),C.normalMass=0,C.tangentMass=0,C.velocityBias=0,A.localPoints[s].Copy(S.localPoint);return this},e.b2ContactSolver.prototype.InitializeVelocityConstraints=function(){var t,o,i,n,s,r,a,l,p,m,_,b,h,c,u,y,d,f,A,S,C,v,x,V,g,B,w,M,J,P,T,D,R,I,L,E,F,G,N,k,W,q,z,O,j=e.b2ContactSolver.prototype.InitializeVelocityConstraints.s_xfA,X=e.b2ContactSolver.prototype.InitializeVelocityConstraints.s_xfB,U=e.b2ContactSolver.prototype.InitializeVelocityConstraints.s_worldManifold,Z=1e3;for(t=0,o=this.m_count;o>t;++t){for(s=this.m_velocityConstraints[t],r=this.m_positionConstraints[t],a=r.radiusA,l=r.radiusB,p=this.m_contacts[s.contactIndex].GetManifold(),m=s.indexA,_=s.indexB,b=s.invMassA,h=s.invMassB,c=s.invIA,u=s.invIB,y=r.localCenterA,d=r.localCenterB,f=this.m_positions[m].c,A=this.m_positions[m].a,S=this.m_velocities[m].v,C=this.m_velocities[m].w,v=this.m_positions[_].c,x=this.m_positions[_].a,V=this.m_velocities[_].v,g=this.m_velocities[_].w,e.ENABLE_ASSERTS&&e.b2Assert(p.pointCount>0),j.q.SetAngleRadians(A),X.q.SetAngleRadians(x),e.b2SubVV(f,e.b2MulRV(j.q,y,e.b2Vec2.s_t0),j.p),e.b2SubVV(v,e.b2MulRV(X.q,d,e.b2Vec2.s_t0),X.p),U.Initialize(p,j,a,X,l),s.normal.Copy(U.normal),e.b2CrossVOne(s.normal,s.tangent),B=s.pointCount,i=0,n=B;n>i;++i)w=s.points[i],e.b2SubVV(U.points[i],f,w.rA),e.b2SubVV(U.points[i],v,w.rB),M=e.b2CrossVV(w.rA,s.normal),J=e.b2CrossVV(w.rB,s.normal),P=b+h+c*M*M+u*J*J,w.normalMass=P>0?1/P:0,T=s.tangent,D=e.b2CrossVV(w.rA,T),R=e.b2CrossVV(w.rB,T),I=b+h+c*D*D+u*R*R,w.tangentMass=I>0?1/I:0,w.velocityBias=0,L=e.b2DotVV(s.normal,e.b2SubVV(e.b2AddVCrossSV(V,g,w.rB,e.b2Vec2.s_t0),e.b2AddVCrossSV(S,C,w.rA,e.b2Vec2.s_t1),e.b2Vec2.s_t0)),L<-e.b2_velocityThreshold&&(w.velocityBias+=-s.restitution*L);2==s.pointCount&&(E=s.points[0],F=s.points[1],G=e.b2CrossVV(E.rA,s.normal),N=e.b2CrossVV(E.rB,s.normal),k=e.b2CrossVV(F.rA,s.normal),W=e.b2CrossVV(F.rB,s.normal),q=b+h+c*G*G+u*N*N,z=b+h+c*k*k+u*W*W,O=b+h+c*G*k+u*N*W,Z*(q*z-O*O)>q*q?(s.K.ex.Set(q,O),s.K.ey.Set(O,z),s.K.GetInverse(s.normalMass)):s.pointCount=1)}},e.b2ContactSolver.prototype.InitializeVelocityConstraints.s_xfA=new e.b2Transform,e.b2ContactSolver.prototype.InitializeVelocityConstraints.s_xfB=new e.b2Transform,e.b2ContactSolver.prototype.InitializeVelocityConstraints.s_worldManifold=new e.b2WorldManifold,e.b2ContactSolver.prototype.WarmStart=function(){var t,o,i,n,s,r,a,l,p,m,_,b,h,c,u,y,d,f,A,S=e.b2ContactSolver.prototype.WarmStart.s_P;for(t=0,o=this.m_count;o>t;++t){for(s=this.m_velocityConstraints[t],r=s.indexA,a=s.indexB,l=s.invMassA,p=s.invIA,m=s.invMassB,_=s.invIB,b=s.pointCount,h=this.m_velocities[r].v,c=this.m_velocities[r].w,u=this.m_velocities[a].v,y=this.m_velocities[a].w,d=s.normal,f=s.tangent,i=0,n=b;n>i;++i)A=s.points[i],e.b2AddVV(e.b2MulSV(A.normalImpulse,d,e.b2Vec2.s_t0),e.b2MulSV(A.tangentImpulse,f,e.b2Vec2.s_t1),S),c-=p*e.b2CrossVV(A.rA,S),h.SelfMulSub(l,S),y+=_*e.b2CrossVV(A.rB,S),u.SelfMulAdd(m,S);this.m_velocities[r].w=c,this.m_velocities[a].w=y}},e.b2ContactSolver.prototype.WarmStart.s_P=new e.b2Vec2,e.b2ContactSolver.prototype.SolveVelocityConstraints=function(){var t,o,i,n,s,r,a,l,p,m,_,b,h,c,u,y,d,f,A,S,C,v,x,V,g,B,w,M,J,P=e.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv,T=e.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv1,D=e.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv2,R=e.b2ContactSolver.prototype.SolveVelocityConstraints.s_P,I=e.b2ContactSolver.prototype.SolveVelocityConstraints.s_a,L=e.b2ContactSolver.prototype.SolveVelocityConstraints.s_b,E=e.b2ContactSolver.prototype.SolveVelocityConstraints.s_x,F=e.b2ContactSolver.prototype.SolveVelocityConstraints.s_d,G=e.b2ContactSolver.prototype.SolveVelocityConstraints.s_P1,N=e.b2ContactSolver.prototype.SolveVelocityConstraints.s_P2,k=e.b2ContactSolver.prototype.SolveVelocityConstraints.s_P1P2;for(t=0,o=this.m_count;o>t;++t){for(s=this.m_velocityConstraints[t],r=s.indexA,a=s.indexB,l=s.invMassA,p=s.invIA,m=s.invMassB,_=s.invIB,b=s.pointCount,h=this.m_velocities[r].v,c=this.m_velocities[r].w,u=this.m_velocities[a].v,y=this.m_velocities[a].w,d=s.normal,f=s.tangent,A=s.friction,e.ENABLE_ASSERTS&&e.b2Assert(1==b||2==b),i=0,n=b;n>i;++i)S=s.points[i],e.b2SubVV(e.b2AddVCrossSV(u,y,S.rB,e.b2Vec2.s_t0),e.b2AddVCrossSV(h,c,S.rA,e.b2Vec2.s_t1),P),C=e.b2DotVV(P,f)-s.tangentSpeed,x=S.tangentMass*-C,V=A*S.normalImpulse,g=e.b2Clamp(S.tangentImpulse+x,-V,V),x=g-S.tangentImpulse,S.tangentImpulse=g,e.b2MulSV(x,f,R),h.SelfMulSub(l,R),c-=p*e.b2CrossVV(S.rA,R),u.SelfMulAdd(m,R),y+=_*e.b2CrossVV(S.rB,R);if(1==s.pointCount)S=s.points[0],e.b2SubVV(e.b2AddVCrossSV(u,y,S.rB,e.b2Vec2.s_t0),e.b2AddVCrossSV(h,c,S.rA,e.b2Vec2.s_t1),P),v=e.b2DotVV(P,d),x=-S.normalMass*(v-S.velocityBias),g=e.b2Max(S.normalImpulse+x,0),x=g-S.normalImpulse,S.normalImpulse=g,e.b2MulSV(x,d,R),h.SelfMulSub(l,R),c-=p*e.b2CrossVV(S.rA,R),u.SelfMulAdd(m,R),y+=_*e.b2CrossVV(S.rB,R);else for(B=s.points[0],w=s.points[1],I.Set(B.normalImpulse,w.normalImpulse),e.ENABLE_ASSERTS&&e.b2Assert(I.x>=0&&I.y>=0),e.b2SubVV(e.b2AddVCrossSV(u,y,B.rB,e.b2Vec2.s_t0),e.b2AddVCrossSV(h,c,B.rA,e.b2Vec2.s_t1),T),e.b2SubVV(e.b2AddVCrossSV(u,y,w.rB,e.b2Vec2.s_t0),e.b2AddVCrossSV(h,c,w.rA,e.b2Vec2.s_t1),D),M=e.b2DotVV(T,d),J=e.b2DotVV(D,d),L.x=M-B.velocityBias,L.y=J-w.velocityBias,L.SelfSub(e.b2MulMV(s.K,I,e.b2Vec2.s_t0));;){if(e.b2MulMV(s.normalMass,L,E).SelfNeg(),E.x>=0&&E.y>=0){e.b2SubVV(E,I,F),e.b2MulSV(F.x,d,G),e.b2MulSV(F.y,d,N),e.b2AddVV(G,N,k),h.SelfMulSub(l,k),c-=p*(e.b2CrossVV(B.rA,G)+e.b2CrossVV(w.rA,N)),u.SelfMulAdd(m,k),y+=_*(e.b2CrossVV(B.rB,G)+e.b2CrossVV(w.rB,N)),B.normalImpulse=E.x,w.normalImpulse=E.y;break}if(E.x=-B.normalMass*L.x,E.y=0,M=0,J=s.K.ex.y*E.x+L.y,E.x>=0&&J>=0){e.b2SubVV(E,I,F),e.b2MulSV(F.x,d,G),e.b2MulSV(F.y,d,N),e.b2AddVV(G,N,k),h.SelfMulSub(l,k),c-=p*(e.b2CrossVV(B.rA,G)+e.b2CrossVV(w.rA,N)),u.SelfMulAdd(m,k),y+=_*(e.b2CrossVV(B.rB,G)+e.b2CrossVV(w.rB,N)),B.normalImpulse=E.x,w.normalImpulse=E.y;break}if(E.x=0,E.y=-w.normalMass*L.y,M=s.K.ey.x*E.y+L.x,J=0,E.y>=0&&M>=0){e.b2SubVV(E,I,F),e.b2MulSV(F.x,d,G),e.b2MulSV(F.y,d,N),e.b2AddVV(G,N,k),h.SelfMulSub(l,k),c-=p*(e.b2CrossVV(B.rA,G)+e.b2CrossVV(w.rA,N)),u.SelfMulAdd(m,k),y+=_*(e.b2CrossVV(B.rB,G)+e.b2CrossVV(w.rB,N)),B.normalImpulse=E.x,w.normalImpulse=E.y;break}if(E.x=0,E.y=0,M=L.x,J=L.y,M>=0&&J>=0){e.b2SubVV(E,I,F),e.b2MulSV(F.x,d,G),e.b2MulSV(F.y,d,N),e.b2AddVV(G,N,k),h.SelfMulSub(l,k),c-=p*(e.b2CrossVV(B.rA,G)+e.b2CrossVV(w.rA,N)),u.SelfMulAdd(m,k),y+=_*(e.b2CrossVV(B.rB,G)+e.b2CrossVV(w.rB,N)),B.normalImpulse=E.x,w.normalImpulse=E.y;break}break}this.m_velocities[r].w=c,this.m_velocities[a].w=y}},e.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv=new e.b2Vec2,e.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv1=new e.b2Vec2,e.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv2=new e.b2Vec2,e.b2ContactSolver.prototype.SolveVelocityConstraints.s_P=new e.b2Vec2,e.b2ContactSolver.prototype.SolveVelocityConstraints.s_a=new e.b2Vec2,e.b2ContactSolver.prototype.SolveVelocityConstraints.s_b=new e.b2Vec2,e.b2ContactSolver.prototype.SolveVelocityConstraints.s_x=new e.b2Vec2,e.b2ContactSolver.prototype.SolveVelocityConstraints.s_d=new e.b2Vec2,e.b2ContactSolver.prototype.SolveVelocityConstraints.s_P1=new e.b2Vec2,e.b2ContactSolver.prototype.SolveVelocityConstraints.s_P2=new e.b2Vec2,e.b2ContactSolver.prototype.SolveVelocityConstraints.s_P1P2=new e.b2Vec2,e.b2ContactSolver.prototype.StoreImpulses=function(){var t,e,o,i,n,s;for(t=0,e=this.m_count;e>t;++t)for(n=this.m_velocityConstraints[t],s=this.m_contacts[n.contactIndex].GetManifold(),o=0,i=n.pointCount;i>o;++o)s.points[o].normalImpulse=n.points[o].normalImpulse,s.points[o].tangentImpulse=n.points[o].tangentImpulse},e.b2PositionSolverManifold=function(){this.normal=new e.b2Vec2,this.point=new e.b2Vec2},e.b2PositionSolverManifold.prototype.normal=null,e.b2PositionSolverManifold.prototype.point=null,e.b2PositionSolverManifold.prototype.separation=0,e.b2PositionSolverManifold.prototype.Initialize=function(t,o,i,n){var s=e.b2PositionSolverManifold.prototype.Initialize.s_pointA,r=e.b2PositionSolverManifold.prototype.Initialize.s_pointB,a=e.b2PositionSolverManifold.prototype.Initialize.s_planePoint,l=e.b2PositionSolverManifold.prototype.Initialize.s_clipPoint;switch(e.ENABLE_ASSERTS&&e.b2Assert(t.pointCount>0),t.type){case e.b2ManifoldType.e_circles:e.b2MulXV(o,t.localPoint,s),e.b2MulXV(i,t.localPoints[0],r),e.b2SubVV(r,s,this.normal).SelfNormalize(),e.b2MidVV(s,r,this.point),this.separation=e.b2DotVV(e.b2SubVV(r,s,e.b2Vec2.s_t0),this.normal)-t.radiusA-t.radiusB;break;case e.b2ManifoldType.e_faceA:e.b2MulRV(o.q,t.localNormal,this.normal),e.b2MulXV(o,t.localPoint,a),e.b2MulXV(i,t.localPoints[n],l),this.separation=e.b2DotVV(e.b2SubVV(l,a,e.b2Vec2.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(l);break;case e.b2ManifoldType.e_faceB:e.b2MulRV(i.q,t.localNormal,this.normal),e.b2MulXV(i,t.localPoint,a),e.b2MulXV(o,t.localPoints[n],l),this.separation=e.b2DotVV(e.b2SubVV(l,a,e.b2Vec2.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(l),this.normal.SelfNeg()}},e.b2PositionSolverManifold.prototype.Initialize.s_pointA=new e.b2Vec2,e.b2PositionSolverManifold.prototype.Initialize.s_pointB=new e.b2Vec2,e.b2PositionSolverManifold.prototype.Initialize.s_planePoint=new e.b2Vec2,e.b2PositionSolverManifold.prototype.Initialize.s_clipPoint=new e.b2Vec2,e.b2ContactSolver.prototype.SolvePositionConstraints=function(){var t,o,i,n,s,r,a,l,p,m,_,b,h,c,u,y,d,f,A,S,C,v,x,V,g,B,w=e.b2ContactSolver.prototype.SolvePositionConstraints.s_xfA,M=e.b2ContactSolver.prototype.SolvePositionConstraints.s_xfB,J=e.b2ContactSolver.prototype.SolvePositionConstraints.s_psm,P=e.b2ContactSolver.prototype.SolvePositionConstraints.s_rA,T=e.b2ContactSolver.prototype.SolvePositionConstraints.s_rB,D=e.b2ContactSolver.prototype.SolvePositionConstraints.s_P,R=0;for(t=0,o=this.m_count;o>t;++t){for(s=this.m_positionConstraints[t],r=s.indexA,a=s.indexB,l=s.localCenterA,p=s.invMassA,m=s.invIA,_=s.localCenterB,b=s.invMassB,h=s.invIB,c=s.pointCount,u=this.m_positions[r].c,y=this.m_positions[r].a,d=this.m_positions[a].c,f=this.m_positions[a].a,i=0,n=c;n>i;++i)w.q.SetAngleRadians(y),M.q.SetAngleRadians(f),e.b2SubVV(u,e.b2MulRV(w.q,l,e.b2Vec2.s_t0),w.p),e.b2SubVV(d,e.b2MulRV(M.q,_,e.b2Vec2.s_t0),M.p),J.Initialize(s,w,M,i),A=J.normal,S=J.point,C=J.separation,e.b2SubVV(S,u,P),e.b2SubVV(S,d,T),R=e.b2Min(R,C),v=e.b2Clamp(e.b2_baumgarte*(C+e.b2_linearSlop),-e.b2_maxLinearCorrection,0),x=e.b2CrossVV(P,A),V=e.b2CrossVV(T,A),g=p+b+m*x*x+h*V*V,B=g>0?-v/g:0,e.b2MulSV(B,A,D),u.SelfMulSub(p,D),y-=m*e.b2CrossVV(P,D),d.SelfMulAdd(b,D),f+=h*e.b2CrossVV(T,D);this.m_positions[r].a=y,this.m_positions[a].a=f}return R>-3*e.b2_linearSlop},e.b2ContactSolver.prototype.SolvePositionConstraints.s_xfA=new e.b2Transform,e.b2ContactSolver.prototype.SolvePositionConstraints.s_xfB=new e.b2Transform,e.b2ContactSolver.prototype.SolvePositionConstraints.s_psm=new e.b2PositionSolverManifold,e.b2ContactSolver.prototype.SolvePositionConstraints.s_rA=new e.b2Vec2,e.b2ContactSolver.prototype.SolvePositionConstraints.s_rB=new e.b2Vec2,e.b2ContactSolver.prototype.SolvePositionConstraints.s_P=new e.b2Vec2,e.b2ContactSolver.prototype.SolveTOIPositionConstraints=function(t,o){var i,n,s,r,a,l,p,m,_,b,h,c,u,y,d,f,A,S,C,v,x,V,g,B,w,M,J=e.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_xfA,P=e.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_xfB,T=e.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_psm,D=e.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_rA,R=e.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_rB,I=e.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_P,L=0;for(i=0,n=this.m_count;n>i;++i){for(a=this.m_positionConstraints[i],l=a.indexA,p=a.indexB,m=a.localCenterA,_=a.localCenterB,b=a.pointCount,h=0,c=0,(l==t||l==o)&&(h=a.invMassA,c=a.invIA),u=0,y=0,(p==t||p==o)&&(u=a.invMassB,y=a.invIB),d=this.m_positions[l].c,f=this.m_positions[l].a,A=this.m_positions[p].c,S=this.m_positions[p].a,s=0,r=b;r>s;++s)J.q.SetAngleRadians(f),P.q.SetAngleRadians(S),e.b2SubVV(d,e.b2MulRV(J.q,m,e.b2Vec2.s_t0),J.p),e.b2SubVV(A,e.b2MulRV(P.q,_,e.b2Vec2.s_t0),P.p),T.Initialize(a,J,P,s),C=T.normal,v=T.point,x=T.separation,e.b2SubVV(v,d,D),e.b2SubVV(v,A,R),L=e.b2Min(L,x),V=e.b2Clamp(e.b2_toiBaumgarte*(x+e.b2_linearSlop),-e.b2_maxLinearCorrection,0),g=e.b2CrossVV(D,C),B=e.b2CrossVV(R,C),w=h+u+c*g*g+y*B*B,M=w>0?-V/w:0,e.b2MulSV(M,C,I),d.SelfMulSub(h,I),f-=c*e.b2CrossVV(D,I),A.SelfMulAdd(u,I),S+=y*e.b2CrossVV(R,I);this.m_positions[l].a=f,this.m_positions[p].a=S}return L>=-1.5*e.b2_linearSlop},e.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_xfA=new e.b2Transform,e.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_xfB=new e.b2Transform,e.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_psm=new e.b2PositionSolverManifold,e.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_rA=new e.b2Vec2,e.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_rB=new e.b2Vec2,e.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_P=new e.b2Vec2,e}(e,j,X,Z,a,H,K,i,Y,$,o),ee=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2Island&&(e.b2Island={}),e.b2Island=function(){this.m_bodies=new Array(1024),this.m_contacts=new Array(1024),this.m_joints=new Array(1024),this.m_positions=e.b2Position.MakeArray(1024),this.m_velocities=e.b2Velocity.MakeArray(1024)},e.b2Island.prototype.m_allocator=null,e.b2Island.prototype.m_listener=null,e.b2Island.prototype.m_bodies=null,e.b2Island.prototype.m_contacts=null,e.b2Island.prototype.m_joints=null,e.b2Island.prototype.m_positions=null,e.b2Island.prototype.m_velocities=null,e.b2Island.prototype.m_bodyCount=0,e.b2Island.prototype.m_jointCount=0,e.b2Island.prototype.m_contactCount=0,e.b2Island.prototype.m_bodyCapacity=0,e.b2Island.prototype.m_contactCapacity=0,e.b2Island.prototype.m_jointCapacity=0,e.b2Island.prototype.Initialize=function(t,o,i,n,s){for(this.m_bodyCapacity=t,this.m_contactCapacity=o,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=n,this.m_listener=s;this.m_bodies.length<t;)this.m_bodies[this.m_bodies.length]=null;for(;this.m_contacts.length<o;)this.m_contacts[this.m_contacts.length]=null;for(;this.m_joints.length<i;)this.m_joints[this.m_joints.length]=null;if(this.m_positions.length<t){var r=e.b2Max(2*this.m_positions.length,t);for(e.DEBUG&&window.console.log("box2d.b2Island.m_positions: "+r);this.m_positions.length<r;)this.m_positions[this.m_positions.length]=new e.b2Position}if(this.m_velocities.length<t){var r=e.b2Max(2*this.m_velocities.length,t);for(e.DEBUG&&window.console.log("box2d.b2Island.m_velocities: "+r);this.m_velocities.length<r;)this.m_velocities[this.m_velocities.length]=new e.b2Velocity}},e.b2Island.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},e.b2Island.prototype.AddBody=function(t){e.ENABLE_ASSERTS&&e.b2Assert(this.m_bodyCount<this.m_bodyCapacity),t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t},e.b2Island.prototype.AddContact=function(t){e.ENABLE_ASSERTS&&e.b2Assert(this.m_contactCount<this.m_contactCapacity),this.m_contacts[this.m_contactCount++]=t},e.b2Island.prototype.AddJoint=function(t){e.ENABLE_ASSERTS&&e.b2Assert(this.m_jointCount<this.m_jointCapacity),this.m_joints[this.m_jointCount++]=t},e.b2Island.prototype.Solve=function(t,o,i,n){for(var s=e.b2Island.s_timer.Reset(),r=o.dt,a=0;a<this.m_bodyCount;++a){var l=this.m_bodies[a],p=this.m_positions[a].c.Copy(l.m_sweep.c),m=l.m_sweep.a,_=this.m_velocities[a].v.Copy(l.m_linearVelocity),b=l.m_angularVelocity;l.m_sweep.c0.Copy(l.m_sweep.c),l.m_sweep.a0=l.m_sweep.a,l.m_type==e.b2BodyType.b2_dynamicBody&&(_.x+=r*(l.m_gravityScale*i.x+l.m_invMass*l.m_force.x),_.y+=r*(l.m_gravityScale*i.y+l.m_invMass*l.m_force.y),b+=r*l.m_invI*l.m_torque,_.SelfMul(1/(1+r*l.m_linearDamping)),b*=1/(1+r*l.m_angularDamping)),this.m_positions[a].a=m,this.m_velocities[a].w=b}s.Reset();var h=e.b2Island.s_solverData;h.step.Copy(o),h.positions=this.m_positions,h.velocities=this.m_velocities;var c=e.b2Island.s_contactSolverDef;c.step.Copy(o),c.contacts=this.m_contacts,c.count=this.m_contactCount,c.positions=this.m_positions,c.velocities=this.m_velocities,c.allocator=this.m_allocator;var u=e.b2Island.s_contactSolver.Initialize(c);u.InitializeVelocityConstraints(),o.warmStarting&&u.WarmStart();for(var a=0;a<this.m_jointCount;++a)this.m_joints[a].InitVelocityConstraints(h);t.solveInit=s.GetMilliseconds(),s.Reset();for(var a=0;a<o.velocityIterations;++a){for(var y=0;y<this.m_jointCount;++y)this.m_joints[y].SolveVelocityConstraints(h);u.SolveVelocityConstraints()}u.StoreImpulses(),t.solveVelocity=s.GetMilliseconds();for(var a=0;a<this.m_bodyCount;++a){var p=this.m_positions[a].c,m=this.m_positions[a].a,_=this.m_velocities[a].v,b=this.m_velocities[a].w,d=e.b2MulSV(r,_,e.b2Island.s_translation);if(e.b2DotVV(d,d)>e.b2_maxTranslationSquared){var f=e.b2_maxTranslation/d.GetLength();_.SelfMul(f)}var A=r*b;if(A*A>e.b2_maxRotationSquared){var f=e.b2_maxRotation/e.b2Abs(A);b*=f}p.x+=r*_.x,p.y+=r*_.y,m+=r*b,this.m_positions[a].a=m,this.m_velocities[a].w=b}s.Reset();for(var S=!1,a=0;a<o.positionIterations;++a){for(var C=u.SolvePositionConstraints(),v=!0,y=0;y<this.m_jointCount;++y){var x=this.m_joints[y].SolvePositionConstraints(h);v=v&&x}if(C&&v){S=!0;break}}for(var a=0;a<this.m_bodyCount;++a){var V=this.m_bodies[a];V.m_sweep.c.Copy(this.m_positions[a].c),V.m_sweep.a=this.m_positions[a].a,V.m_linearVelocity.Copy(this.m_velocities[a].v),V.m_angularVelocity=this.m_velocities[a].w,V.SynchronizeTransform()}if(t.solvePosition=s.GetMilliseconds(),this.Report(u.m_velocityConstraints),n){for(var g=e.b2_maxFloat,B=e.b2_linearSleepTolerance*e.b2_linearSleepTolerance,w=e.b2_angularSleepTolerance*e.b2_angularSleepTolerance,a=0;a<this.m_bodyCount;++a){var l=this.m_bodies[a];l.GetType()!=e.b2BodyType.b2_staticBody&&(0==(l.m_flags&e.b2BodyFlag.e_autoSleepFlag)||l.m_angularVelocity*l.m_angularVelocity>w||e.b2DotVV(l.m_linearVelocity,l.m_linearVelocity)>B?(l.m_sleepTime=0,g=0):(l.m_sleepTime+=r,g=e.b2Min(g,l.m_sleepTime)))}if(g>=e.b2_timeToSleep&&S)for(var a=0;a<this.m_bodyCount;++a){var l=this.m_bodies[a];l.SetAwake(!1)}}},e.b2Island.prototype.SolveTOI=function(t,o,i){e.ENABLE_ASSERTS&&e.b2Assert(o<this.m_bodyCount),e.ENABLE_ASSERTS&&e.b2Assert(i<this.m_bodyCount);for(var n=0;n<this.m_bodyCount;++n){var s=this.m_bodies[n];this.m_positions[n].c.Copy(s.m_sweep.c),this.m_positions[n].a=s.m_sweep.a,this.m_velocities[n].v.Copy(s.m_linearVelocity),this.m_velocities[n].w=s.m_angularVelocity}var r=e.b2Island.s_contactSolverDef;r.contacts=this.m_contacts,r.count=this.m_contactCount,r.allocator=this.m_allocator,r.step.Copy(t),r.positions=this.m_positions,r.velocities=this.m_velocities;for(var a=e.b2Island.s_contactSolver.Initialize(r),n=0;n<t.positionIterations;++n){var l=a.SolveTOIPositionConstraints(o,i);if(l)break}this.m_bodies[o].m_sweep.c0.Copy(this.m_positions[o].c),this.m_bodies[o].m_sweep.a0=this.m_positions[o].a,this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,a.InitializeVelocityConstraints();\nfor(var n=0;n<t.velocityIterations;++n)a.SolveVelocityConstraints();for(var p=t.dt,n=0;n<this.m_bodyCount;++n){var m=this.m_positions[n].c,_=this.m_positions[n].a,b=this.m_velocities[n].v,h=this.m_velocities[n].w,c=e.b2MulSV(p,b,e.b2Island.s_translation);if(e.b2DotVV(c,c)>e.b2_maxTranslationSquared){var u=e.b2_maxTranslation/c.GetLength();b.SelfMul(u)}var y=p*h;if(y*y>e.b2_maxRotationSquared){var u=e.b2_maxRotation/e.b2Abs(y);h*=u}m.SelfMulAdd(p,b),_+=p*h,this.m_positions[n].a=_,this.m_velocities[n].w=h;var d=this.m_bodies[n];d.m_sweep.c.Copy(m),d.m_sweep.a=_,d.m_linearVelocity.Copy(b),d.m_angularVelocity=h,d.SynchronizeTransform()}this.Report(a.m_velocityConstraints)},e.b2Island.prototype.Report=function(t){if(null!=this.m_listener)for(var o=0;o<this.m_contactCount;++o){var i=this.m_contacts[o];if(i){var n=t[o],s=e.b2Island.s_impulse;s.count=n.pointCount;for(var r=0;r<n.pointCount;++r)s.normalImpulses[r]=n.points[r].normalImpulse,s.tangentImpulses[r]=n.points[r].tangentImpulse;this.m_listener.PostSolve(i,s)}}},e.b2Island.s_timer=new e.b2Timer,e.b2Island.s_solverData=new e.b2SolverData,e.b2Island.s_contactSolverDef=new e.b2ContactSolverDef,e.b2Island.s_contactSolver=new e.b2ContactSolver,e.b2Island.s_translation=new e.b2Vec2,e.b2Island.s_impulse=new e.b2ContactImpulse,e}(e,te,o,N,v,u),oe=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2JointFactory&&(e.b2JointFactory={}),e.b2JointFactory.Create=function(t){var o=null;switch(t.type){case e.b2JointType.e_distanceJoint:o=new e.b2DistanceJoint(t instanceof e.b2DistanceJointDef?t:null);break;case e.b2JointType.e_mouseJoint:o=new e.b2MouseJoint(t instanceof e.b2MouseJointDef?t:null);break;case e.b2JointType.e_prismaticJoint:o=new e.b2PrismaticJoint(t instanceof e.b2PrismaticJointDef?t:null);break;case e.b2JointType.e_revoluteJoint:o=new e.b2RevoluteJoint(t instanceof e.b2RevoluteJointDef?t:null);break;case e.b2JointType.e_pulleyJoint:o=new e.b2PulleyJoint(t instanceof e.b2PulleyJointDef?t:null);break;case e.b2JointType.e_gearJoint:o=new e.b2GearJoint(t instanceof e.b2GearJointDef?t:null);break;case e.b2JointType.e_wheelJoint:o=new e.b2WheelJoint(t instanceof e.b2WheelJointDef?t:null);break;case e.b2JointType.e_weldJoint:o=new e.b2WeldJoint(t instanceof e.b2WeldJointDef?t:null);break;case e.b2JointType.e_frictionJoint:o=new e.b2FrictionJoint(t instanceof e.b2FrictionJointDef?t:null);break;case e.b2JointType.e_ropeJoint:o=new e.b2RopeJoint(t instanceof e.b2RopeJointDef?t:null);break;case e.b2JointType.e_motorJoint:o=new e.b2MotorJoint(t instanceof e.b2MotorJointDef?t:null);break;case e.b2JointType.e_areaJoint:o=new e.b2AreaJoint(t instanceof e.b2AreaJointDef?t:null);break;default:e.ENABLE_ASSERTS&&e.b2Assert(!1)}return o},e.b2JointFactory.Destroy=function(){},e}(e,n,i,o),ie=function(t,e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.b2World&&(e.b2World={}),e.b2WorldFlag={e_none:0,e_newFixture:1,e_locked:2,e_clearForces:4},t.exportProperty(e.b2WorldFlag,"e_none",e.b2WorldFlag.e_none),t.exportProperty(e.b2WorldFlag,"e_newFixture",e.b2WorldFlag.e_newFixture),t.exportProperty(e.b2WorldFlag,"e_locked",e.b2WorldFlag.e_locked),t.exportProperty(e.b2WorldFlag,"e_clearForces",e.b2WorldFlag.e_clearForces),e.b2World=function(t){this.m_flags=e.b2WorldFlag.e_clearForces,this.m_contactManager=new e.b2ContactManager,this.m_gravity=t.Clone(),this.m_out_gravity=new e.b2Vec2,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new e.b2Profile,this.m_island=new e.b2Island,this.s_stack=new Array},e.b2World.prototype.m_flags=e.b2WorldFlag.e_none,e.b2World.prototype.m_contactManager=null,e.b2World.prototype.m_bodyList=null,e.b2World.prototype.m_jointList=null,e.b2World.prototype.m_bodyCount=0,e.b2World.prototype.m_jointCount=0,e.b2World.prototype.m_gravity=null,e.b2World.prototype.m_out_gravity=null,e.b2World.prototype.m_allowSleep=!0,e.b2World.prototype.m_destructionListener=null,e.b2World.prototype.m_debugDraw=null,e.b2World.prototype.m_inv_dt0=0,e.b2World.prototype.m_warmStarting=!0,e.b2World.prototype.m_continuousPhysics=!0,e.b2World.prototype.m_subStepping=!1,e.b2World.prototype.m_stepComplete=!0,e.b2World.prototype.m_profile=null,e.b2World.prototype.m_island=null,e.b2World.prototype.s_stack=null,e.b2World.prototype.m_controllerList=null,e.b2World.prototype.m_controllerCount=0,e.b2World.prototype.SetAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,0==this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)},e.b2World.prototype.GetAllowSleeping=function(){return this.m_allowSleep},e.b2World.prototype.SetWarmStarting=function(t){this.m_warmStarting=t},e.b2World.prototype.GetWarmStarting=function(){return this.m_warmStarting},e.b2World.prototype.SetContinuousPhysics=function(t){this.m_continuousPhysics=t},e.b2World.prototype.GetContinuousPhysics=function(){return this.m_continuousPhysics},e.b2World.prototype.SetSubStepping=function(t){this.m_subStepping=t},e.b2World.prototype.GetSubStepping=function(){return this.m_subStepping},e.b2World.prototype.GetBodyList=function(){return this.m_bodyList},e.b2World.prototype.GetJointList=function(){return this.m_jointList},e.b2World.prototype.GetContactList=function(){return this.m_contactManager.m_contactList},e.b2World.prototype.GetBodyCount=function(){return this.m_bodyCount},e.b2World.prototype.GetJointCount=function(){return this.m_jointCount},e.b2World.prototype.GetContactCount=function(){return this.m_contactManager.m_contactCount},e.b2World.prototype.SetGravity=function(t,e){if(e=e||!0,(this.m_gravity.x!==t.x||this.m_gravity.y!==t.y)&&(this.m_gravity.Copy(t),e))for(var o=this.m_bodyList;o;o=o.m_next)o.SetAwake(!0)},e.b2World.prototype.GetGravity=function(t){return t=t||this.m_out_gravity,t.Copy(this.m_gravity)},e.b2World.prototype.IsLocked=function(){return(this.m_flags&e.b2WorldFlag.e_locked)>0},e.b2World.prototype.SetAutoClearForces=function(t){t?this.m_flags|=e.b2WorldFlag.e_clearForces:this.m_flags&=~e.b2WorldFlag.e_clearForces},e.b2World.prototype.GetAutoClearForces=function(){return(this.m_flags&e.b2WorldFlag.e_clearForces)==e.b2WorldFlag.e_clearForces},e.b2World.prototype.GetContactManager=function(){return this.m_contactManager},e.b2World.prototype.GetProfile=function(){return this.m_profile},e.b2World.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},e.b2World.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},e.b2World.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},e.b2World.prototype.SetDebugDraw=function(t){this.m_debugDraw=t},e.b2World.prototype.CreateBody=function(t){if(e.ENABLE_ASSERTS&&e.b2Assert(0==this.IsLocked()),this.IsLocked())return null;var o=new e.b2Body(t,this);return o.m_prev=null,o.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=o),this.m_bodyList=o,++this.m_bodyCount,o},e.b2World.prototype.DestroyBody=function(t){if(e.ENABLE_ASSERTS&&e.b2Assert(this.m_bodyCount>0),e.ENABLE_ASSERTS&&e.b2Assert(0==this.IsLocked()),!this.IsLocked()){for(var o=t.m_jointList;o;){var i=o;o=o.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=o}t.m_jointList=null;for(var n=t.m_controllerList;n;){var s=n;n=n.nextController,s.controller.RemoveBody(t)}for(var r=t.m_contactList;r;){var a=r;r=r.next,this.m_contactManager.Destroy(a.contact)}t.m_contactList=null;for(var l=t.m_fixtureList;l;){var p=l;l=l.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(p),p.DestroyProxies(this.m_contactManager.m_broadPhase),p.Destroy(),t.m_fixtureList=l,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},e.b2World.prototype.CreateJoint=function(t){if(e.ENABLE_ASSERTS&&e.b2Assert(0==this.IsLocked()),this.IsLocked())return null;var o=e.b2JointFactory.Create(t,null);o.m_prev=null,o.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=o),this.m_jointList=o,++this.m_jointCount,o.m_edgeA.joint=o,o.m_edgeA.other=o.m_bodyB,o.m_edgeA.prev=null,o.m_edgeA.next=o.m_bodyA.m_jointList,o.m_bodyA.m_jointList&&(o.m_bodyA.m_jointList.prev=o.m_edgeA),o.m_bodyA.m_jointList=o.m_edgeA,o.m_edgeB.joint=o,o.m_edgeB.other=o.m_bodyA,o.m_edgeB.prev=null,o.m_edgeB.next=o.m_bodyB.m_jointList,o.m_bodyB.m_jointList&&(o.m_bodyB.m_jointList.prev=o.m_edgeB),o.m_bodyB.m_jointList=o.m_edgeB;var i=t.bodyA,n=t.bodyB;if(0==t.collideConnected)for(var s=n.GetContactList();s;)s.other==i&&s.contact.FlagForFiltering(),s=s.next;return o},e.b2World.prototype.DestroyJoint=function(t){if(e.ENABLE_ASSERTS&&e.b2Assert(0==this.IsLocked()),!this.IsLocked()){var o=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var i=t.m_bodyA,n=t.m_bodyB;if(i.SetAwake(!0),n.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==n.m_jointList&&(n.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,e.b2JointFactory.Destroy(t,null),e.ENABLE_ASSERTS&&e.b2Assert(this.m_jointCount>0),--this.m_jointCount,0==o)for(var s=n.GetContactList();s;)s.other==i&&s.contact.FlagForFiltering(),s=s.next}},e.b2World.prototype.Solve=function(t){for(var o=this.m_controllerList;o;o=o.m_next)o.Step(t);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var i=this.m_island;i.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener);for(var n=this.m_bodyList;n;n=n.m_next)n.m_flags&=~e.b2BodyFlag.e_islandFlag;for(var s=this.m_contactManager.m_contactList;s;s=s.m_next)s.m_flags&=~e.b2ContactFlag.e_islandFlag;for(var r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;for(var a=this.m_bodyCount,l=this.s_stack,p=this.m_bodyList;p;p=p.m_next)if(!(p.m_flags&e.b2BodyFlag.e_islandFlag)&&0!=p.IsAwake()&&0!=p.IsActive()&&p.GetType()!=e.b2BodyType.b2_staticBody){i.Clear();var m=0;for(l[m++]=p,p.m_flags|=e.b2BodyFlag.e_islandFlag;m>0;){var n=l[--m];if(e.ENABLE_ASSERTS&&e.b2Assert(1==n.IsActive()),i.AddBody(n),n.SetAwake(!0),n.GetType()!=e.b2BodyType.b2_staticBody){for(var _=n.m_contactList;_;_=_.next){var b=_.contact;if(!(b.m_flags&e.b2ContactFlag.e_islandFlag)&&0!=b.IsEnabled()&&0!=b.IsTouching()){var h=b.m_fixtureA.m_isSensor,c=b.m_fixtureB.m_isSensor;if(!h&&!c){i.AddContact(b),b.m_flags|=e.b2ContactFlag.e_islandFlag;var u=_.other;u.m_flags&e.b2BodyFlag.e_islandFlag||(e.ENABLE_ASSERTS&&e.b2Assert(a>m),l[m++]=u,u.m_flags|=e.b2BodyFlag.e_islandFlag)}}}for(var y=n.m_jointList;y;y=y.next)if(1!=y.joint.m_islandFlag){var u=y.other;0!=u.IsActive()&&(i.AddJoint(y.joint),y.joint.m_islandFlag=!0,u.m_flags&e.b2BodyFlag.e_islandFlag||(e.ENABLE_ASSERTS&&e.b2Assert(a>m),l[m++]=u,u.m_flags|=e.b2BodyFlag.e_islandFlag))}}}var d=new e.b2Profile;i.Solve(d,t,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=d.solveInit,this.m_profile.solveVelocity+=d.solveVelocity,this.m_profile.solvePosition+=d.solvePosition;for(var f=0;f<i.m_bodyCount;++f){var n=i.m_bodies[f];n.GetType()==e.b2BodyType.b2_staticBody&&(n.m_flags&=~e.b2BodyFlag.e_islandFlag)}}for(var f=0;f<l.length&&l[f];++f)l[f]=null;for(var A=new e.b2Timer,n=this.m_bodyList;n;n=n.m_next)0!=(n.m_flags&e.b2BodyFlag.e_islandFlag)&&n.GetType()!=e.b2BodyType.b2_staticBody&&n.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=A.GetMilliseconds()},e.b2World.prototype.SolveTOI=function(t){var o=this.m_island;if(o.Initialize(2*e.b2_maxTOIContacts,e.b2_maxTOIContacts,0,null,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var i=this.m_bodyList;i;i=i.m_next)i.m_flags&=~e.b2BodyFlag.e_islandFlag,i.m_sweep.alpha0=0;for(var n=this.m_contactManager.m_contactList;n;n=n.m_next)n.m_flags&=~(e.b2ContactFlag.e_toiFlag|e.b2ContactFlag.e_islandFlag),n.m_toiCount=0,n.m_toi=1}for(;;){for(var s=null,r=1,n=this.m_contactManager.m_contactList;n;n=n.m_next)if(0!=n.IsEnabled()&&!(n.m_toiCount>e.b2_maxSubSteps)){var a=1;if(n.m_flags&e.b2ContactFlag.e_toiFlag)a=n.m_toi;else{var l=n.GetFixtureA(),p=n.GetFixtureB();if(l.IsSensor()||p.IsSensor())continue;var m=l.GetBody(),_=p.GetBody(),b=m.m_type,h=_.m_type;e.ENABLE_ASSERTS&&e.b2Assert(b==e.b2BodyType.b2_dynamicBody||h==e.b2BodyType.b2_dynamicBody);var c=m.IsAwake()&&b!=e.b2BodyType.b2_staticBody,u=_.IsAwake()&&h!=e.b2BodyType.b2_staticBody;if(0==c&&0==u)continue;var y=m.IsBullet()||b!=e.b2BodyType.b2_dynamicBody,d=_.IsBullet()||h!=e.b2BodyType.b2_dynamicBody;if(0==y&&0==d)continue;var f=m.m_sweep.alpha0;m.m_sweep.alpha0<_.m_sweep.alpha0?(f=_.m_sweep.alpha0,m.m_sweep.Advance(f)):_.m_sweep.alpha0<m.m_sweep.alpha0&&(f=m.m_sweep.alpha0,_.m_sweep.Advance(f)),e.ENABLE_ASSERTS&&e.b2Assert(1>f);var A=n.GetChildIndexA(),S=n.GetChildIndexB(),C=e.b2World.prototype.SolveTOI.s_toi_input;C.proxyA.SetShape(l.GetShape(),A),C.proxyB.SetShape(p.GetShape(),S),C.sweepA.Copy(m.m_sweep),C.sweepB.Copy(_.m_sweep),C.tMax=1;var v=e.b2World.prototype.SolveTOI.s_toi_output;e.b2TimeOfImpact(v,C);var x=v.t;a=v.state==e.b2TOIOutputState.e_touching?e.b2Min(f+(1-f)*x,1):1,n.m_toi=a,n.m_flags|=e.b2ContactFlag.e_toiFlag}r>a&&(s=n,r=a)}if(null==s||1-10*e.b2_epsilon<r){this.m_stepComplete=!0;break}var l=s.GetFixtureA(),p=s.GetFixtureB(),m=l.GetBody(),_=p.GetBody(),V=e.b2World.prototype.SolveTOI.s_backup1.Copy(m.m_sweep),g=e.b2World.prototype.SolveTOI.s_backup2.Copy(_.m_sweep);if(m.Advance(r),_.Advance(r),s.Update(this.m_contactManager.m_contactListener),s.m_flags&=~e.b2ContactFlag.e_toiFlag,++s.m_toiCount,0!=s.IsEnabled()&&0!=s.IsTouching()){m.SetAwake(!0),_.SetAwake(!0),o.Clear(),o.AddBody(m),o.AddBody(_),o.AddContact(s),m.m_flags|=e.b2BodyFlag.e_islandFlag,_.m_flags|=e.b2BodyFlag.e_islandFlag,s.m_flags|=e.b2ContactFlag.e_islandFlag;for(var B=0;2>B;++B){var w=0==B?m:_;if(w.m_type==e.b2BodyType.b2_dynamicBody)for(var M=w.m_contactList;M&&o.m_bodyCount!=o.m_bodyCapacity&&o.m_contactCount!=o.m_contactCapacity;M=M.next){var J=M.contact;if(!(J.m_flags&e.b2ContactFlag.e_islandFlag)){var P=M.other;if(P.m_type!=e.b2BodyType.b2_dynamicBody||0!=w.IsBullet()||0!=P.IsBullet()){var T=J.m_fixtureA.m_isSensor,D=J.m_fixtureB.m_isSensor;if(!T&&!D){var R=e.b2World.prototype.SolveTOI.s_backup.Copy(P.m_sweep);0==(P.m_flags&e.b2BodyFlag.e_islandFlag)&&P.Advance(r),J.Update(this.m_contactManager.m_contactListener),0!=J.IsEnabled()?0!=J.IsTouching()?(J.m_flags|=e.b2ContactFlag.e_islandFlag,o.AddContact(J),P.m_flags&e.b2BodyFlag.e_islandFlag||(P.m_flags|=e.b2BodyFlag.e_islandFlag,P.m_type!=e.b2BodyType.b2_staticBody&&P.SetAwake(!0),o.AddBody(P))):(P.m_sweep.Copy(R),P.SynchronizeTransform()):(P.m_sweep.Copy(R),P.SynchronizeTransform())}}}}}var I=e.b2World.prototype.SolveTOI.s_subStep;I.dt=(1-r)*t.dt,I.inv_dt=1/I.dt,I.dtRatio=1,I.positionIterations=20,I.velocityIterations=t.velocityIterations,I.warmStarting=!1,o.SolveTOI(I,m.m_islandIndex,_.m_islandIndex);for(var B=0;B<o.m_bodyCount;++B){var w=o.m_bodies[B];if(w.m_flags&=~e.b2BodyFlag.e_islandFlag,w.m_type==e.b2BodyType.b2_dynamicBody){w.SynchronizeFixtures();for(var M=w.m_contactList;M;M=M.next)M.contact.m_flags&=~(e.b2ContactFlag.e_toiFlag|e.b2ContactFlag.e_islandFlag)}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else s.SetEnabled(!1),m.m_sweep.Copy(V),_.m_sweep.Copy(g),m.SynchronizeTransform(),_.SynchronizeTransform()}},e.b2World.prototype.SolveTOI.s_subStep=new e.b2TimeStep,e.b2World.prototype.SolveTOI.s_backup=new e.b2Sweep,e.b2World.prototype.SolveTOI.s_backup1=new e.b2Sweep,e.b2World.prototype.SolveTOI.s_backup2=new e.b2Sweep,e.b2World.prototype.SolveTOI.s_toi_input=new e.b2TOIInput,e.b2World.prototype.SolveTOI.s_toi_output=new e.b2TOIOutput,e.b2World.prototype.Step=function(t,o,i){var n=new e.b2Timer;this.m_flags&e.b2WorldFlag.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~e.b2WorldFlag.e_newFixture),this.m_flags|=e.b2WorldFlag.e_locked;var s=e.b2World.prototype.Step.s_step;s.dt=t,s.velocityIterations=o,s.positionIterations=i,s.inv_dt=t>0?1/t:0,s.dtRatio=this.m_inv_dt0*t,s.warmStarting=this.m_warmStarting;var r=new e.b2Timer;if(this.m_contactManager.Collide(),this.m_profile.collide=r.GetMilliseconds(),this.m_stepComplete&&s.dt>0){var r=new e.b2Timer;this.Solve(s),this.m_profile.solve=r.GetMilliseconds()}if(this.m_continuousPhysics&&s.dt>0){var r=new e.b2Timer;this.SolveTOI(s),this.m_profile.solveTOI=r.GetMilliseconds()}s.dt>0&&(this.m_inv_dt0=s.inv_dt),this.m_flags&e.b2WorldFlag.e_clearForces&&this.ClearForces(),this.m_flags&=~e.b2WorldFlag.e_locked,this.m_profile.step=n.GetMilliseconds()},e.b2World.prototype.Step.s_step=new e.b2TimeStep,e.b2World.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0},e.b2World.prototype.QueryAABB=function(t,o){var i=this.m_contactManager.m_broadPhase,n=function(o){var n=i.GetUserData(o);e.ENABLE_ASSERTS&&e.b2Assert(n instanceof e.b2FixtureProxy);{var s=n.fixture;n.childIndex}return t instanceof e.b2QueryCallback?t.ReportFixture(s):t(s)};i.Query(n,o)},e.b2World.prototype.QueryShape=function(t,o,i){var n=this.m_contactManager.m_broadPhase,s=function(s){var r=n.GetUserData(s);e.ENABLE_ASSERTS&&e.b2Assert(r instanceof e.b2FixtureProxy);{var a=r.fixture;r.childIndex}return e.b2TestOverlapShape(o,0,a.GetShape(),0,i,a.GetBody().GetTransform())?t instanceof e.b2QueryCallback?t.ReportFixture(a):t(a):!0},r=e.b2World.prototype.QueryShape.s_aabb;o.ComputeAABB(r,i,0),n.Query(s,r)},e.b2World.prototype.QueryShape.s_aabb=new e.b2AABB,e.b2World.prototype.QueryPoint=function(t,o){var i=this.m_contactManager.m_broadPhase,n=function(n){var s=i.GetUserData(n);e.ENABLE_ASSERTS&&e.b2Assert(s instanceof e.b2FixtureProxy);{var r=s.fixture;s.childIndex}return r.TestPoint(o)?t instanceof e.b2QueryCallback?t.ReportFixture(r):t(r):!0},s=e.b2World.prototype.QueryPoint.s_aabb;s.lowerBound.Set(o.x-e.b2_linearSlop,o.y-e.b2_linearSlop),s.upperBound.Set(o.x+e.b2_linearSlop,o.y+e.b2_linearSlop),i.Query(n,s)},e.b2World.prototype.QueryPoint.s_aabb=new e.b2AABB,e.b2World.prototype.RayCast=function(t,o,i){var n=this.m_contactManager.m_broadPhase,s=function(s,r){var a=n.GetUserData(r);e.ENABLE_ASSERTS&&e.b2Assert(a instanceof e.b2FixtureProxy);var l=a.fixture,p=a.childIndex,m=e.b2World.prototype.RayCast.s_output,_=l.RayCast(m,s,p);if(_){var b=m.fraction,h=e.b2World.prototype.RayCast.s_point;return h.Set((1-b)*o.x+b*i.x,(1-b)*o.y+b*i.y),t instanceof e.b2RayCastCallback?t.ReportFixture(l,h,m.normal,b):t(l,h,m.normal,b)}return s.maxFraction},r=e.b2World.prototype.RayCast.s_input;r.maxFraction=1,r.p1.Copy(o),r.p2.Copy(i),n.RayCast(s,r)},e.b2World.prototype.RayCast.s_input=new e.b2RayCastInput,e.b2World.prototype.RayCast.s_output=new e.b2RayCastOutput,e.b2World.prototype.RayCast.s_point=new e.b2Vec2,e.b2World.prototype.RayCastOne=function(t,e){function o(t,e,o,s){return n>s&&(n=s,i=t),n}var i=null,n=1;return this.RayCast(o,t,e),i},e.b2World.prototype.RayCastAll=function(t,e,o){function i(t){return o.push(t),1}return o.length=0,this.RayCast(i,t,e),o},e.b2World.prototype.DrawShape=function(t,o){var i=t.GetShape();switch(i.m_type){case e.b2ShapeType.e_circleShape:var n=i instanceof e.b2CircleShape?i:null,s=n.m_p,r=n.m_radius,a=e.b2Vec2.UNITX;this.m_debugDraw.DrawSolidCircle(s,r,a,o);break;case e.b2ShapeType.e_edgeShape:var l=i instanceof e.b2EdgeShape?i:null,p=l.m_vertex1,m=l.m_vertex2;this.m_debugDraw.DrawSegment(p,m,o);break;case e.b2ShapeType.e_chainShape:var _=i instanceof e.b2ChainShape?i:null,b=_.m_count,h=_.m_vertices,p=h[0];this.m_debugDraw.DrawCircle(p,.05,o);for(var c=1;b>c;++c){var m=h[c];this.m_debugDraw.DrawSegment(p,m,o),this.m_debugDraw.DrawCircle(m,.05,o),p=m}break;case e.b2ShapeType.e_polygonShape:var u=i instanceof e.b2PolygonShape?i:null,y=u.m_count,h=u.m_vertices;this.m_debugDraw.DrawSolidPolygon(h,y,o)}},e.b2World.prototype.DrawJoint=function(t){var o=t.GetBodyA(),i=t.GetBodyB(),n=o.m_xf,s=i.m_xf,r=n.p,a=s.p,l=t.GetAnchorA(e.b2World.prototype.DrawJoint.s_p1),p=t.GetAnchorB(e.b2World.prototype.DrawJoint.s_p2),m=e.b2World.prototype.DrawJoint.s_color.SetRGB(.5,.8,.8);switch(t.m_type){case e.b2JointType.e_distanceJoint:this.m_debugDraw.DrawSegment(l,p,m);break;case e.b2JointType.e_pulleyJoint:var _=t instanceof e.b2PulleyJoint?t:null,b=_.GetGroundAnchorA(e.b2World.prototype.DrawJoint.s_s1),h=_.GetGroundAnchorB(e.b2World.prototype.DrawJoint.s_s2);this.m_debugDraw.DrawSegment(b,l,m),this.m_debugDraw.DrawSegment(h,p,m),this.m_debugDraw.DrawSegment(b,h,m);break;case e.b2JointType.e_mouseJoint:this.m_debugDraw.DrawSegment(l,p,m);break;default:this.m_debugDraw.DrawSegment(r,l,m),this.m_debugDraw.DrawSegment(l,p,m),this.m_debugDraw.DrawSegment(a,p,m)}},e.b2World.prototype.DrawJoint.s_p1=new e.b2Vec2,e.b2World.prototype.DrawJoint.s_p2=new e.b2Vec2,e.b2World.prototype.DrawJoint.s_color=new e.b2Color(.5,.8,.8),e.b2World.prototype.DrawJoint.s_s1=new e.b2Vec2,e.b2World.prototype.DrawJoint.s_s2=new e.b2Vec2,e.b2World.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){var t=this.m_debugDraw.GetFlags(),o=e.b2World.prototype.DrawDebugData.s_color.SetRGB(0,0,0);if(t&e.b2DrawFlags.e_shapeBit)for(var i=this.m_bodyList;i;i=i.m_next){var n=i.m_xf;this.m_debugDraw.PushTransform(n);for(var s=i.GetFixtureList();s;s=s.m_next)0==i.IsActive()?(o.SetRGB(.5,.5,.3),this.DrawShape(s,o)):i.GetType()==e.b2BodyType.b2_staticBody?(o.SetRGB(.5,.9,.5),this.DrawShape(s,o)):i.GetType()==e.b2BodyType.b2_kinematicBody?(o.SetRGB(.5,.5,.9),this.DrawShape(s,o)):0==i.IsAwake()?(o.SetRGB(.6,.6,.6),this.DrawShape(s,o)):(o.SetRGB(.9,.7,.7),this.DrawShape(s,o));this.m_debugDraw.PopTransform(n)}if(t&e.b2DrawFlags.e_jointBit)for(var r=this.m_jointList;r;r=r.m_next)this.DrawJoint(r);if(t&e.b2DrawFlags.e_aabbBit){o.SetRGB(.9,.3,.9);for(var a=this.m_contactManager.m_broadPhase,l=e.b2World.prototype.DrawDebugData.s_vs,i=this.m_bodyList;i;i=i.m_next)if(0!=i.IsActive())for(var s=i.GetFixtureList();s;s=s.m_next)for(var p=0;p<s.m_proxyCount;++p){var m=s.m_proxies[p],_=a.GetFatAABB(m.proxy);l[0].Set(_.lowerBound.x,_.lowerBound.y),l[1].Set(_.upperBound.x,_.lowerBound.y),l[2].Set(_.upperBound.x,_.upperBound.y),l[3].Set(_.lowerBound.x,_.upperBound.y),this.m_debugDraw.DrawPolygon(l,4,o)}}if(t&e.b2DrawFlags.e_centerOfMassBit)for(var i=this.m_bodyList;i;i=i.m_next){var n=e.b2World.prototype.DrawDebugData.s_xf;n.q.Copy(i.m_xf.q),n.p.Copy(i.GetWorldCenter()),this.m_debugDraw.DrawTransform(n)}if(t&e.b2DrawFlags.e_controllerBit)for(var b=this.m_controllerList;b;b=b.m_next)b.Draw(this.m_debugDraw)}},e.b2World.prototype.DrawDebugData.s_color=new e.b2Color(0,0,0),e.b2World.prototype.DrawDebugData.s_vs=e.b2Vec2.MakeArray(4),e.b2World.prototype.DrawDebugData.s_xf=new e.b2Transform,e.b2World.prototype.SetBroadPhase=function(t){var e=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var o=this.m_bodyList;o;o=o.m_next)for(var i=o.m_fixtureList;i;i=i.m_next)i.m_proxy=t.CreateProxy(e.GetFatAABB(i.m_proxy),i)},e.b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},e.b2World.prototype.GetTreeHeight=function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()},e.b2World.prototype.GetTreeBalance=function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()},e.b2World.prototype.GetTreeQuality=function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()},e.b2World.prototype.ShiftOrigin=function(t){if(e.ENABLE_ASSERTS&&e.b2Assert(0==this.IsLocked()),!this.IsLocked()){for(var o=this.m_bodyList;o;o=o.m_next)o.m_xf.p.SelfSub(t),o.m_sweep.c0.SelfSub(t),o.m_sweep.c.SelfSub(t);for(var i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}},e.b2World.prototype.Dump=function(){if(e.DEBUG){if((this.m_flags&e.b2WorldFlag.e_locked)==e.b2WorldFlag.e_locked)return;e.b2Log("/** @type {box2d.b2Vec2} */ var g = new box2d.b2Vec2(%.15f, %.15f);\\n",this.m_gravity.x,this.m_gravity.y),e.b2Log("this.m_world.SetGravity(g);\\n"),e.b2Log("/** @type {Array.<box2d.b2Body>} */ var bodies = new Array(%d);\\n",this.m_bodyCount),e.b2Log("/** @type {Array.<box2d.b2Joint>} */ var joints = new Array(%d);\\n",this.m_jointCount);for(var t=0,o=this.m_bodyList;o;o=o.m_next)o.m_islandIndex=t,o.Dump(),++t;t=0;for(var i=this.m_jointList;i;i=i.m_next)i.m_index=t,++t;for(var i=this.m_jointList;i;i=i.m_next)i.m_type!=e.b2JointType.e_gearJoint&&(e.b2Log("if (true)\\n"),e.b2Log("{\\n"),i.Dump(),e.b2Log("}\\n"));for(var i=this.m_jointList;i;i=i.m_next)i.m_type==e.b2JointType.e_gearJoint&&(e.b2Log("if (true)\\n"),e.b2Log("{\\n"),i.Dump(),e.b2Log("}\\n"))}},e.b2World.prototype.AddController=function(t){return e.ENABLE_ASSERTS&&e.b2Assert(null===t.m_world,"Controller can only be a member of one world"),t.m_world=this,t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t},e.b2World.prototype.RemoveController=function(t){e.ENABLE_ASSERTS&&e.b2Assert(t.m_world===this,"Controller is not a member of this world"),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList==t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t.m_world=null},e}(e,m,a,z,te,B,ee,oe,i,o,N,u);!function(t,e){return"undefined"==typeof e&&(e={}),e}(e,s,m,h,y,f,A,S,C,V,r,g,B,b,d,p,w,P,T,D,R,I,M,L,J,E,F,o,G,x,N,v,k,W,ie,u)}"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof window&&(window.box2d=t)}();'},function(e,t){e.exports=function(e){"undefined"!=typeof execScript?execScript(e):eval.call(null,e)}},function(e,t,o){o(47)(o(46))},function(e,t,o){function i(e,t){for(var o=0;o<e.length;o++){var i=e[o],n=d[i.id];if(n){n.refs++;for(var r=0;r<n.parts.length;r++)n.parts[r](i.parts[r]);for(;r<i.parts.length;r++)n.parts.push(p(i.parts[r],t))}else{for(var s=[],r=0;r<i.parts.length;r++)s.push(p(i.parts[r],t));d[i.id]={id:i.id,refs:1,parts:s}}}}function n(e,t){for(var o=[],i={},n=0;n<e.length;n++){var r=e[n],s=t.base?r[0]+t.base:r[0],a=r[1],l=r[2],h=r[3],p={css:a,media:l,sourceMap:h};i[s]?i[s].parts.push(p):o.push(i[s]={id:s,parts:[p]})}return o}function r(e,t){var o=b(e.insertInto);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=v[v.length-1];if("top"===e.insertAt)i?i.nextSibling?o.insertBefore(t,i.nextSibling):o.appendChild(t):o.insertBefore(t,o.firstChild),v.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");o.appendChild(t)}}function s(e){e.parentNode.removeChild(e);var t=v.indexOf(e);t>=0&&v.splice(t,1)}function a(e){var t=document.createElement("style");return e.attrs.type="text/css",h(t,e.attrs),r(e,t),t}function l(e){var t=document.createElement("link");return e.attrs.type="text/css",e.attrs.rel="stylesheet",h(t,e.attrs),r(e,t),t}function h(e,t){Object.keys(t).forEach(function(o){e.setAttribute(o,t[o])})}function p(e,t){var o,i,n,r;if(t.transform&&e.css){if(!(r=t.transform(e.css)))return function(){};e.css=r}if(t.singleton){var h=_++;o=f||(f=a(t)),i=c.bind(null,o,h,!1),n=c.bind(null,o,h,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(o=l(t),i=m.bind(null,o,t),n=function(){s(o),o.href&&URL.revokeObjectURL(o.href)}):(o=a(t),i=u.bind(null,o),n=function(){s(o)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else n()}}function c(e,t,o,i){var n=o?"":i.css;if(e.styleSheet)e.styleSheet.cssText=x(t,n);else{var r=document.createTextNode(n),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(r,s[t]):e.appendChild(r)}}function u(e,t){var o=t.css,i=t.media;if(i&&e.setAttribute("media",i),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}function m(e,t,o){var i=o.css,n=o.sourceMap,r=void 0===t.convertToAbsoluteUrls&&n;(t.convertToAbsoluteUrls||r)&&(i=g(i)),n&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var s=new Blob([i],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}var d={},y=function(e){var t;return function(){return void 0===t&&(t=e.apply(this,arguments)),t}}(function(){return window&&document&&document.all&&!window.atob}),b=function(e){var t={};return function(o){return void 0===t[o]&&(t[o]=e.call(this,o)),t[o]}}(function(e){return document.querySelector(e)}),f=null,_=0,v=[],g=o(50);e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");t=t||{},t.attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||(t.singleton=y()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var o=n(e,t);return i(o,t),function(e){for(var r=[],s=0;s<o.length;s++){var a=o[s],l=d[a.id];l.refs--,r.push(l)}if(e){i(n(e,t),t)}for(var s=0;s<r.length;s++){var l=r[s];if(0===l.refs){for(var h=0;h<l.parts.length;h++)l.parts[h]();delete d[l.id]}}}};var x=function(){var e=[];return function(t,o){return e[t]=o,e.filter(Boolean).join("\n")}}()},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var o=t.protocol+"//"+t.host,i=o+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var n=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/)/i.test(n))return e;var r;return r=0===n.indexOf("//")?n:0===n.indexOf("/")?o+n:i+n.replace(/^\.\//,""),"url("+JSON.stringify(r)+")"})}},function(e,t){var o;o=function(){return this}();try{o=o||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(o=window)}e.exports=o}]);